!function(T){var E=jQuery,s="";!function(e){"use strict";function i(e){this.clientConfiguration=e,this.user=T,this.mediaServicesFactory=T,this.version="4.9.0.44",i.Base.Logger.clearLoggers()}i.prototype={createUser:function(e){return this.user||(this.mediaServicesFactory===T&&(this.mediaServicesFactory=new i.Base.MediaServicesFactory),void 0!==s&&(s=this.version),this.user=new i.User(e,this.mediaServicesFactory,this.version)),this.user},registerLogger:function(e,t){i.Base.Logger.addLogger(e,t)},getMediaServices:function(){return this.mediaServicesFactory===T&&(this.mediaServicesFactory=new i.Base.MediaServicesFactory),this.mediaServicesFactory.getMediaServices()},getVersion:function(){return this.version}},e.AvayaClientServices=i}(window),function(e){"use strict";e.Base=e.Base||{},e.Config=e.Config||{},e.Services=e.Services||{},e.Services.Call=e.Services.Call||{},e.Services.Collaboration=e.Services.Collaboration||{},e.Services.Messaging=e.Services.Messaging||{},e.Services.Conference=e.Services.Conference||{},e.Services.Contacts=e.Services.Contacts||{},e.Services.ContentSharing=e.Services.ContentSharing||{},e.Services.Presence=e.Services.Presence||{},e.Services.VoiceMessaging=e.Services.VoiceMessaging||{}}(AvayaClientServices),function(e){"use strict";e.Base.Validators=e.Base.Validators||{},e.Providers=e.Providers||{},e.Providers.Analytics=e.Providers.Analytics||{},e.Providers.Interfaces=e.Providers.Interfaces||{},e.Providers.AMM=e.Providers.AMM||{},e.Providers.Call=e.Providers.Call||{},e.Providers.CallGateway=e.Providers.CallGateway||{},e.Providers.CallServiceGateway=e.Providers.CallServiceGateway||{},e.Providers.Scopia=e.Providers.Scopia||{},e.Providers.CM=e.Providers.CM||{},e.Providers.Focus=e.Providers.Focus||{},e.Providers.Mpaas=e.Providers.Mpaas||{},e.Providers.RemoteLogger=e.Providers.RemoteLogger||{},e.Providers.RTC=e.Providers.RTC||{},e.Providers.UCCP=e.Providers.UCCP||{},e.Providers.WCS=e.Providers.WCS||{},e.User=e.User||{},e.Services.Call=e.Services.Call||{},e.Services.Call.Capabilities=e.Services.Call.Capabilities||{},e.Services.Call.Modes=e.Services.Call.Modes||{},e.Services.SessionLogs=e.Services.SessionLogs||{},e.Services.Messaging.Common=e.Services.Messaging.Common||{},e.Providers.ACS=e.Providers.ACS||{},e.Services.SessionLogs=e.Services.SessionLogs||{},e.Providers.ContentSharing=e.Providers.ContentSharing||{},e.Services.Analytics=e.Services.Analytics||{},e.Config.Authentication=e.Config.Authentication||{}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbsoluteCategoryRating={EXCELLENT:5,GOOD:4,FAIR:3,POOR:2,BAD:1}}(),function(e){"use strict";function t(e,t){this.pointcutType=e,this.adviceFunction=t}t.prototype={},e.Base.AOPAdvice=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AOPPointcutType={BEFORE:"BEFORE",AROUND:"AROUND"}}(),function(o){"use strict";var c={_exceptionCallbacks:E.Callbacks(),addAdvices:function(e,t,i,a){for(var r=0;r<i.length;r++)c.addAdvicesToProperty(e,t,i[r],a)},addAdvicesToProperty:function(e,t,i,a){var r=c._getAdviceFunction(o.Base.AOPPointcutType.BEFORE,a),s=c._getAdviceFunction(o.Base.AOPPointcutType.AROUND,a),n=e.prototype[i];if("function"!=typeof n)throw Error("AOPTools: "+t+"."+i+" is not a function.");e.prototype[i]=function(){return r&&r(e,t,i,arguments),s?s(e,t,i,this,n,arguments):n.apply(this,arguments)}},addOnExceptionCallback:function(e){c._exceptionCallbacks.add(e)},removeOnExceptionCallback:function(e){c._exceptionCallbacks.remove(e)},triggerExceptionCallback:function(e){c._exceptionCallbacks.fire(e)},_getAdviceFunction:function(e,t){for(var i=0;i<t.length;i++)if(t[i].pointcutType===e)return t[i].adviceFunction}};o.Base.AOPTools=c}(AvayaClientServices),function(e){"use strict";function t(e,t){Error.call(this,e),this.message=e,this.name="BaseError",this._data=t}(t.prototype=Object.create(Error.prototype)).getMessage=function(){return this.message},t.prototype.getData=function(){return this._data},t.prototype.getName=function(){return this.name},e.Base.BaseError=t}(AvayaClientServices),function(){"use strict";E.ajaxTransport("+binary",function(d){var C;if(window.FormData&&(d.dataType&&"binary"===d.dataType||d.data&&(window.ArrayBuffer&&d.data instanceof ArrayBuffer||window.Blob&&d.data instanceof Blob)))return{send:function(e,t){C=new window.XMLHttpRequest;var i,a=d.url,r=d.type,s=d.async||!0,n=d.data||null,o=d.username||null,c=d.password||null,l=0;for(i in C.addEventListener("load",function(){var e={};e[d.dataType]=C.response,t(C.status,C.statusText,e,C.getAllResponseHeaders()),l=0}),C.addEventListener("progress",function(){this.readyState&&this.response&&("function"==typeof d.binaryProgressCallback&&d.binaryProgressCallback(AvayaClientServices.Base.Utils.stringToArrayBuffer(this.response.slice(l))),l=this.responseText.length)},!1),C.addEventListener("readystatechange",function(){this.readyState&&d.keepAliveCallback&&d.keepAliveCallback(this.readyState)}),C.open(r,a,s,o,c),C.overrideMimeType("text/xml; charset=x-user-defined"),e)e.hasOwnProperty(i)&&C.setRequestHeader(i,e[i]);C.responseType="text",C.send(n)},abort:function(){C.abort()}}})}(),function(){"use strict";AvayaClientServices.Base.BrowserSubType={CHROME_EXTENSION:"chrome_extension",FIREFOX_EXTENSION:"moz_extension",ELECTRON:"electon",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.BrowserType={CHROME:"chrome",FIREFOX:"firefox",IE:"ie",SAFARI:"safari",EDGE:"edge",UNKNOWN:"unknown"}}(),function(){"use strict";AvayaClientServices.Base.CacheOptions=function(){this.maxElements=T,this.timeToLive=T,this.auditInterval=T}}(),function(){"use strict";AvayaClientServices.Base.ElementCacheEvents={ELEMENT_ADDED:"ELEMENT_ADDED",ELEMENT_UPDATED:"ELEMENT_UPDATED",ELEMENT_DELETED:"ELEMENT_DELETED"}}(),function(){"use strict";AvayaClientServices.Base.IMDBSearchOptions={EXACT_MATCH:"EXACT_MATCH",CONTAINS:"CONTAINS",BEGINS_WITH:"BEGINS_WITH"}}(),function(C){"use strict";function e(e,t){this._validateKeyNames(e),this._cache=new C.Base.ElementCache(t),this._cache.on(C.Base.ElementCacheEvents.ELEMENT_DELETED,function(e){this._onCacheElementsDelete(e)}.bind(this)),this._keyToCacheIds={};for(var i=0;i<e.length;i++)this._keyToCacheIds[e[i]]={};this._cacheIdLength=6,this._generateIdFailureCounter=0}e.prototype.addElement=function(e,t){var i=new Date;this._validateKeys(e);var a=this._generateCacheId(),r={keys:e,element:t,cacheId:a};if(!this._cache.addElement(a,r)){t="SimpleIMDB: Failed to add object to underlying single-key cache. CacheId: "+a;throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,t,r),new Error(t)}this._addCacheIdWithKeys(a,e),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added element in "+(new Date-i)+" milliseconds")},e.prototype.addElements=function(e){for(var t=new Date,i=[],a=[],r=this.getCacheMaxSize(),s=e.length,n=(i=r&&r<s?e.slice(-r):e.slice()).length,o=0;o<n;o++)try{this._validateKeys(i[o].keys);var c=this._generateCacheId();i[o].elementId=c,a.push({elementId:c,element:i[o]})}catch(e){i.splice(o,1),C.Base.Logger.error(C.Base.LoggerTags.CACHE,"Invalid keys of object",e)}var l=this._cache.addElements(a);for(o=0;o<l.length;o++)this._addCacheIdWithKeys(l[o].elementId,l[o].element.keys);C.Base.Logger.info(C.Base.LoggerTags.CACHE,"SimpleIMDB: Successfully added elements in "+(new Date-t)+" milliseconds")},e.prototype.getCacheMaxSize=function(){return this._cache.getCacheMaxSize()},e.prototype._addCacheIdWithKeys=function(e,t){for(var i in t)if(t.hasOwnProperty(i))for(var a=t[i],r=0;r<a.length;r++)this._keyToCacheIds[i][a[r]]===T&&(this._keyToCacheIds[i][a[r]]=[]),this._keyToCacheIds[i][a[r]].push(e)},e.prototype.updateElement=function(e,t,i){var a=new Date;this._validateKeys(e),this._validateKeys(t);var r,s=this.searchByKeys(e);if(1<s.length)throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,r="SimpleIMDB: Update failed because multiple objects found"),new Error(r);if(s.length<1)throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,r="SimpleIMDB: Can not find object to update"),new Error(r);this.deleteElements(e),this.addElement(t,i),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Successfully updated element in "+(new Date-a)+" milliseconds")},e.prototype.deleteElements=function(e){for(var t=new Date,i=this._resolveCacheIdsByKeys(e),a=0,r=0;r<i.length;r++){var s=this._cache.getElement(i[r]);s&&(a++,this._cache.deleteElement(i[r])||C.Base.Logger.warn(C.Base.LoggerTags.CACHE,"Failed to delete object with cacheId "+i[r]+" from underlying cache"),s.keys&&this._deleteCacheIdByKeys(i[r],s.keys))}C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Deleted "+a+" element(s) successfully in "+(new Date-t)+" milliseconds")},e.prototype.searchByKeys=function(e,t){for(var i=new Date,a=[],r=this._resolveCacheIdsByKeys(e,t),s=0;s<r.length;s++){var n=this._cache.getElement(r[s]);n&&n.element&&a.push(n.element)}return a=C.Base.Utils.removeDuplicatesFromArray(a),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Found "+a.length+" results in "+(new Date-i)+" milliseconds"),a},e.prototype.searchBySingleKey=function(e,t,i){var a={};return a[e]=[t],this.searchByKeys(a,i)},e.prototype.searchByAllKeys=function(e,t){var i,a=new Date,r=[],s=[];for(i in this._keyToCacheIds)if(this._keyToCacheIds.hasOwnProperty(i)){var n=this._findMatchingValues(i,e,t);if(n)for(var o=0;o<n.length;o++)s=s.concat(this._keyToCacheIds[i][n[o]])}for(var c=0;c<s.length;c++){var l=this._cache.getElement(s[c]);l&&l.element&&r.push(l.element)}return r=C.Base.Utils.removeDuplicatesFromArray(r),C.Base.Logger.info(C.Base.LoggerTags.CACHE,"Found "+r.length+" results in "+(new Date-a)+" milliseconds"),r},e.prototype.getAllElements=function(){return this._cache.getAllElements().map(function(e){return e.element})},e.prototype._deleteCacheIdByKeys=function(e,t){for(var i in t)if(t.hasOwnProperty(i))for(var a=t[i],r=0;r<a.length;r++){var s=this._keyToCacheIds[i][a[r]],n=s.indexOf(e);0<=n&&s.splice(n,1)}},e.prototype._resolveCacheIdsByKeys=function(e,t){this._validateKeys(e);var i,a,r,s=[];for(r in e)if(e.hasOwnProperty(r)){a=e[i=r][0];break}var n=this._findMatchingValues(i,a,t),o=[];if(n){for(var c=0;c<n.length;c++)o=o.concat(this._keyToCacheIds[i][n[c]]);for(c=0;c<o.length;c++){var l=o[c],d=this._cache.getElement(l);d?this._areKeys1SubsetOfKeys2(e,d.keys,t)&&s.push(l):C.Base.Logger.warn(C.Base.LoggerTags.CACHE,"Cache object with id "+l+" is not found in underlying single-key cache")}}return s},e.prototype._findMatchingValues=function(e,t,i){return i&&i!==C.Base.IMDBSearchOptions.EXACT_MATCH?Object.keys(this._keyToCacheIds[e]).filter(function(e){return i===C.Base.IMDBSearchOptions.CONTAINS?-1<e.indexOf(t):i===C.Base.IMDBSearchOptions.BEGINS_WITH?0===e.indexOf(t):void 0}):this._keyToCacheIds[e].hasOwnProperty(t)?[t]:void 0},e.prototype._areKeys1SubsetOfKeys2=function(e,t,s){function i(e,t){for(var i,a,r=0;r<t.length;r++)if(i=e,a=t[r],s&&s!==n.EXACT_MATCH?s===n.CONTAINS?-1<a.indexOf(i):s===n.BEGINS_WITH?0===a.indexOf(i):void 0:a===i)return 1}var a,n=C.Base.IMDBSearchOptions;for(a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a))return!1;for(var r=0;r<e[a].length;r++)if(!i(e[a][r],t[a]))return!1}return!0},e.prototype._validateKeyNames=function(e){if(!e||!(e instanceof Array)||e.length<1)throw new Error('SimpleIMDB: "keyNames" argument is invalid. It should be of Array type and have at least one element. keyNames: '+JSON.stringify(e));for(var t=0;t<e.length;t++)if("string"!=typeof e[t])throw new Error("SimpleIMDB: Cache key name "+JSON.stringify(e[t])+" is not of String type. Type: "+typeof e[t])},e.prototype._validateKeys=function(e){var t,i;for(t in e)if(e.hasOwnProperty(t)){if(this._keyToCacheIds[t]===T)throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,i="Key name "+t+" is not registered for this IMDB"),new Error(i);for(var a=e[t],r=0;r<a.length;r++){var s=a[r];if("string"!=typeof s)throw i="Value "+JSON.stringify(s)+" of key "+t+" is not of string type",C.Base.Logger.error(C.Base.LoggerTags.CACHE,i),new Error(i);if(""===s)throw C.Base.Logger.error(C.Base.LoggerTags.CACHE,i="Key "+t+" has empty value"),new Error(i)}}},e.prototype._generateCacheId=function(){for(var e,t;!e;)t=C.Base.Utils.makeId(this._cacheIdLength),this._cache.getElement(t)&&++this._generateIdFailureCounter>this._cacheIdLength&&this._cacheIdLength++,e=t;return this._generateIdFailureCounter=0,e},e.prototype._onCacheElementsDelete=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.cacheId&&i.keys?this._deleteCacheIdByKeys(i.cacheId,i.keys):C.Base.Logger.error(C.Base.LoggerTags.CACHE,"Invalid cache object",i)}},C.Base.SimpleIMDB=e}(AvayaClientServices),function(t){"use strict";function e(e){this.isAllowed=e===t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,this.denialReason=e,this._onChangedCallbacks=E.Callbacks()}e.prototype={addOnChangedCallback:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.add(e)},removeOnChangedCallback:function(e){t.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"function"}]}),this._onChangedCallbacks.remove(e)},_updateIfChanged:function(e,t){this.isAllowed===e&&this.denialReason===t||(this.isAllowed=e,this.denialReason=t,this._onChangedCallbacks.fire(this))}},t.Base.Capability=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CapabilityDenialReason={CAPABILITY_NOT_DENIED:"CAPABILITY_NOT_DENIED",CAPABILITY_INVALID_STATE:"CAPABILITY_INVALID_STATE",CAPABILITY_NOT_SUPPORTED:"CAPABILITY_NOT_SUPPORTED",CAPABILITY_CALL_IS_REMOTE:"CAPABILITY_CALL_IS_REMOTE",CAPABILITY_CALL_IS_NOT_REMOTE:"CAPABILITY_CALL_IS_NOT_REMOTE",CAPABILITY_CALL_HAS_NO_AUDIO:"CAPABILITY_CALL_HAS_NO_AUDIO",CAPABILITY_CALL_HAS_NO_VIDEO:"CAPABILITY_CALL_HAS_NO_VIDEO",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CAPABILITY_NEED_SIGNIN:"CAPABILITY_NEED_SIGNIN",CAPABILITY_NEED_MODERATOR:"CAPABILITY_NEED_MODERATOR",CAPABILITY_NEED_SIGNIN_OR_MODERATOR:"CAPABILITY_NEED_SIGNIN_OR_MODERATOR",CAPABILITY_NOT_INSTALLED:"CAPABILITY_NOT_INSTALLED",CAPABILITY_NOT_CONFERENCE_OWNER:"CAPABILITY_NOT_CONFERENCE_OWNER",CAPABILITY_HARDWARE_NOT_SUPPORTED:"CAPABILITY_HARDWARE_NOT_SUPPORTED",CAPABILITY_BROWSER_NOT_SUPPORTED:"CAPABILITY_BROWSER_NOT_SUPPORTED",CAPABILITY_WEBGL_NOT_SUPPORTED:"CAPABILITY_WEBGL_NOT_SUPPORTED",CAPABILITY_HARDWARE_GPU_NOT_AVAILABLE:"CAPABILITY_HARDWARE_GPU_NOT_AVAILABLE",CAPABILITY_DISABLED_BY_ADMIN:"CAPABILITY_DISABLED_BY_ADMIN"}}(),function(t){"use strict";function e(e){this._dataSet=e||new t.Base.DataSet,this._status=t.Base.DataRetrievalStatus.IN_PROGRESS,this.isCancelled=!1,this.isCompleted=!1,this._dataRetrievalProgress=E.Callbacks(),this._dataRetrievalDone=E.Callbacks(),this._dataRetrievalFailed=E.Callbacks(),this._onCancel=T}e.prototype={cancel:function(){this._status===t.Base.DataRetrievalStatus.IN_PROGRESS&&(this._status=t.Base.DataRetrievalStatus.CANCELLED,this.isCancelled=!0,t.Base.Utils.isDefined(this._onCancel)&&this._onCancel())},getDataSet:function(){return this._dataSet},_getStatus:function(){return this._status}},t.Base.DataRetrieval=e}(AvayaClientServices),function(e){"use strict";E.extend(e.Base.DataRetrieval.prototype,{addOnDataRetrievalProgressCallback:function(e){this._dataRetrievalProgress.add(e)},removeOnDataRetrievalProgressCallback:function(e){this._dataRetrievalProgress.remove(e)},addOnDataRetrievalDoneCallback:function(e){this._dataRetrievalDone.add(e)},removeOnDataRetrievalDoneCallback:function(e){this._dataRetrievalDone.remove(e)},addOnDataRetrievalFailedCallback:function(e){this._dataRetrievalFailed.add(e)},removeOnDataRetrievalFailedCallback:function(e){this._dataRetrievalFailed.remove(e)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataRetrievalStatus={IN_PROGRESS:"IN_PROGRESS",DONE:"DONE",CANCELLED:"CANCELLED",FAILED:"FAILED"}}(),function(e){"use strict";function t(){Array.apply(this),this.dataSetChangeCallbacks=E.Callbacks(),this.dataSetInvalidatedCallbacks=E.Callbacks()}(t.prototype=Object.create(Array.prototype)).addOnDataSetChangedCallback=function(e){this.dataSetChangeCallbacks.add(e)},t.prototype.removeOnDataSetChangedCallback=function(e){this.dataSetChangeCallbacks.remove(e)},t.prototype.onDataSetChanged=function(e,t){this.dataSetChangeCallbacks.fire(e,t)},t.prototype.addOnDataSetInvalidatedCallback=function(e){this.dataSetInvalidatedCallbacks.add(e)},t.prototype.removeOnDataSetInvalidatedCallback=function(e){this.dataSetInvalidatedCallbacks.remove(e)},t.prototype.onDataSetInvalidated=function(){this.dataSetInvalidatedCallbacks.fire(this)},e.Base.DataSet=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.DataSetChangeTypes={ADDED:"ADDED",REMOVED:"REMOVED",UPDATED:"UPDATED"}}(),function(){"use strict";AvayaClientServices.Base.DeferredStates={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"}}(),function(e){"use strict";var t={INDETERMINATE:"INDETERMINATE",DETERMINATE:"DETERMINATE"};e.Base.Determinateness=function(e){if(void 0!==t[e])return t[e]}}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={generateBatteryLogs:function(e){var t=E.Deferred(),i=[];i.push("----------------------------------"),i.push("Version: "+e.applicationBuildNumber);e="Unknown";return-1!==window.navigator.userAgent.indexOf("Windows NT 10")?e="Windows 10":-1!==window.navigator.userAgent.indexOf("Windows NT 6.2")?e="Windows 8":-1!==window.navigator.userAgent.indexOf("Windows NT 6.1")?e="Windows 7":-1!==window.navigator.userAgent.indexOf("Windows NT 6.0")?e="Windows Vista":-1!==window.navigator.userAgent.indexOf("Windows NT 5.1")?e="Windows XP":-1!==window.navigator.userAgent.indexOf("Windows NT 5.0")?e="Windows 2000":-1!==window.navigator.userAgent.indexOf("Mac")?e="Mac/iOS":-1!==window.navigator.userAgent.indexOf("X11")?e="UNIX":-1!==window.navigator.userAgent.indexOf("Android")?e="Android":-1!==window.navigator.userAgent.indexOf("iPad")?e="iPad":-1!==window.navigator.userAgent.indexOf("iPhone")?e="iPhone":-1!==window.navigator.userAgent.indexOf("Linux")&&(e="Linux"),i.push("Operating system: "+e),navigator.getBattery&&"function"==typeof navigator.getBattery?navigator.getBattery().then(function(e){i.push("Is Battery Charging : "+e.charging),i.push("Battery Level (%) : "+(100*e.level).toFixed(0)+"%"),i.push("----------------------------------"),t.resolve(i)},function(){i.push("Battery Level (%) : Unavailable"),i.push("----------------------------------"),t.resolve(i)}):(i.push("Battery Level (%) : Unavailable"),i.push("----------------------------------"),t.resolve(i)),t.promise()},generateMessagingLogs:function(e){var t=E.Deferred(),i=[];return e?(i.push("Number of active conversations: "+e._messagingService.conversations.length),i.push("Number of active messages: "+e._messagingService.conversations.reduce(function(e,t){return e+t.getTotalMessageCount()},0)),i.push("Number of draft conversations: "+e.getDraftConversations().length),i.push("Number of draft messages: "+e._messagingService.conversations.reduce(function(e,t){return e+t._draftMessages.length},0))):i.push("Messaging module is unavailable."),t.resolve(i),i.push("----------------------------------"),t.promise()},generateContactsLogs:function(e){var t=E.Deferred(),i=[];return e?i.push("Number of contacts in cache: "+e._contactsService._contactsDataSet.length):i.push("Contacts module is unavailable."),i.push("----------------------------------"),t.resolve(i),t.promise()},generateCallLogs:function(e){var t=E.Deferred(),i=[];return e?i.push("Number of calls: "+e.getCallCount()):i.push("Calls module is unavailable."),i.push("----------------------------------"),t.resolve(i),t.promise()},generatePerformanceLogs:function(){var e=E.Deferred(),t=[];return t.push("Request time: "+(window.performance.timing.responseEnd-window.performance.timing.requestStart)+"ms"),t.push("Load time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.requestStart)+"ms"),t.push("DOM content loaded time: "+(window.performance.timing.domContentLoadedEventEnd-window.performance.timing.domContentLoadedEventStart)+"ms"),t.push("----------------------------------"),window.performance.memory?(t.push("JS Heap Size Limit: "+window.performance.memory.jsHeapSizeLimit),t.push("Total JS Heap Size: "+window.performance.memory.totalJSHeapSize),t.push("Used JS Heap Size: "+window.performance.memory.usedJSHeapSize)):t.push("Memory info is unavailable."),t.push("----------------------------------"),e.resolve(t),e.promise()}},e.Base.DiagnosticDataGenerator=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ErrorReasons={CAPABILITY_INVALID_STATE:"Service is in invalid state.",CAPABILITY_NOT_SUPPORTED:"Feature is not supported.",CAPABILITY_CALL_IS_REMOTE:"",CAPABILITY_CALL_IS_NOT_REMOTE:"",CAPABILITY_CALL_HAS_NO_AUDIO:"",CAPABILITY_CALL_HAS_NO_VIDEO:"",CAPABILITY_NOT_ALLOWED:"Action is not allowed.",CAPABILITY_NEED_SIGN_IN:"",CAPABILITY_NEED_MODERATOR:"",CAPABILITY_NEED_SIGN_IN_OR_MODERATOR:"",CAPABILITY_NOT_INSTALLED:"Extension is not installed.",NETWORK_ERROR:"Failed to perform operation. Network error occurred.",NETWORK_UNAUTHORIZED:"Failed to perform operation due to authorization failure.",NETWORK_AUTHORIZATION_CANCELED:"Failed to perform operation due to canceled authentication.",NETWORK_CANCELED:"Failed to perform operation. Operation was canceled.",INTERNAL_ERROR:"An internal error occurred.",TIMEOUT:"An operation has timed out",LIBRARY_NOT_SUPPORTED:"Library is not supported.",DEPRECATED:"Use of deprecated API is not recommended as if this function may be removed in the future.",BACKOFF_ALGORITHM_CANCELLED:"Backoff Algorithm canceled."}}(),function(t){"use strict";t.Base.Library={jQuery:{setHandle:function(e){return t.Base.Library.Service.jQuery.setHandle(e)}}}}(AvayaClientServices),function(i){"use strict";function e(){this._onVersionChangedCallbacks=[]}i.Base.Library.Service={SUPPORT_EXTENT_FULL:0,SUPPORT_EXTENT_COMPATIBLE:1,SUPPORT_EXTENT_NONE:2,jQuery:new e},e.prototype.setHandle=function(e){return!!this._isHandle(e)&&(this._triggerCallbacks(e),!0)},e.prototype.addOnVersionChangedCallback=function(e){e instanceof Function&&this._onVersionChangedCallbacks.push(e)},e.prototype.getSupportExtent=function(){var e=this.getSupportedVersion(),t=this.getCurrentVersion();if(t===e)return i.Base.Library.Service.SUPPORT_EXTENT_FULL;e=this._parseMajorVersion(e);return this._parseMajorVersion(t)===e?i.Base.Library.Service.SUPPORT_EXTENT_COMPATIBLE:i.Base.Library.Service.SUPPORT_EXTENT_NONE},e.prototype.getSupportedVersion=function(){return"3.6.0"},e.prototype.getCurrentVersion=function(){return E.fn.jquery},e.prototype._isHandle=function(e){return e!==T&&e.fn!==T&&e.fn.jquery!==T&&e.fn.jquery!==this.getCurrentVersion()},e.prototype._triggerCallbacks=function(e){for(var t=0;t<this._onVersionChangedCallbacks.length;++t)this._onVersionChangedCallbacks[t](e)},e.prototype._parseMajorVersion=function(e){return parseInt(e.split(".").shift())}}(AvayaClientServices),function(){"use strict";var r,c,l=[],d=!1,C=!1;function i(s,e){var n,t,o,i,a;d&&(a=e[0]+": "+e[1],(n=Array.prototype.slice.call(e,1))[0]=a),C&&(t=(i=new Date).toLocaleString("en"),(a=i.getTimezoneOffset())!==c&&(i=c=a,i=function(e){var t="-",i=-9<e&&e<9?"0":"";return e<0&&(t="+",e*=-1),t+i+Math.floor(e)}(a=c/60),a=a===parseInt(a,10)?"00":"30",r="UTC"+i+":"+a),t="["+t+", "+r+"] "+e[0]+": "+e[1],(o=Array.prototype.slice.call(e,1))[0]=t),l.forEach(function(e){var t,i,a,r=e.disableTimestamps?n:o;"function"==typeof e[s]?(t=e,i=s,a=r,AvayaClientServices.Base.Utils.isDefined(a)&&t[i].apply(t,a)):(a=e,e=s,r=r,AvayaClientServices.Base.Utils.isDefined(r)&&a.log(e,r))})}AvayaClientServices.Base.Logger={info:function(e,t){i("info",arguments)},error:function(e,t){i("error",arguments)},fatal:function(e,t){i("fatal",arguments)},debug:function(e,t){i("debug",arguments)},trace:function(e,t){i("trace",arguments)},warn:function(e,t){i("warn",arguments)},addLogger:function(e,t){if(!e||void 0===e.log)throw new TypeError("Logger should implement log method.");e.disableTimestamps=t,e.disableTimestamps?d=!0:C=!0,l.push(e)},removeLogger:function(e){e=l.indexOf(e);if(-1===e)throw new Error("Specified error does not exist.");l.splice(e,1)},clearLoggers:function(){l=[]}}}(),function(){"use strict";function e(){this.disableTimestamps=!1}e.prototype={info:function(e,t){},warn:function(e,t){},error:function(e,t){},fatal:function(e,t){},debug:function(e,t){},trace:function(e,t){}},AvayaClientServices.Base.LoggerInterface=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.LoggerTags={CACHE:"Cache",MEDIA_ENGINE:"MediaEngine",NETWORK_PROVIDER:"NetworkProvider",REST_NETWORK_PROVIDER:"RESTNetworkProvider",WEBSOCKET_NETWORK_PROVIDER:"WebSocketNetworkProvider",RTC_CALL_CONNECTION_PROVIDER:"RTCCallConnectionProvider",BANDWIDTH_MANAGER:"BandwidthManager",FSM:"FSM",SETTINGS_FILE_PARSER:"SettingsFileParser",UTILS:"Utils",ANALYTICS_SERVICE:"AnalyticsService",CALL_SERVICE:"CallService",COLLABORATION_SERVICE:"CollaborationService",CONFERENCE_SERVICE:"ConferenceService",CONTACTS_SERVICE:"ContactsService",MESSAGING_SERVICE:"MessagingService",PRESENCE_SERVICE:"PresenceService",VOICE_MESSAGING_SERVICE:"VoiceMessagingService",USER_SERVICE:"UserService",CHAT_SERVICE:"ChatService",ACS_CONTACTS_PROVIDER:"ACSContactsProvider",AMM_MESSAGING_PROVIDER:"AMMMessagingProvider",ANALYTICS_PROVIDER:"AnalyticsProvider",CALL_PROVIDER:"CallProvider",CALL_GATEWAY_PROVIDER:"CallGatewayProvider",CSG_PRESENCE_AND_CALL_PROVIDER:"CSGPresenceAndCallProvider",CM_CONFERENCE_PROVIDER:"CMConfProvider",CONTENT_SHARING_COLLABORATION_PROVIDER:"ContentSharingCollabProvider",SCOPIA_CONFERENCE_PROVIDER:"ScopiaConfProvider",UCCP_CONFERENCE_PROVIDER:"UCCPConfProvider",WCS_COLLABORATION_PROVIDER:"WCSCollabProvider",WCS_CONTENT_SHARING_HANDLER:"WCSContentSharingHandler",CALL_STATISTICS:"CallStatistics",CALL_PERFORMANCE_MONITOR:"CallPerformanceMonitor",PARTICIPANT_SERVICE:"ParticipantService"}}(),function(e){"use strict";function t(e,t,i,a){this._kind=a,this._deviceId=e,this._groupId=t,this._label=i}t.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return("audioinput"===this._kind?"Mic":"Speaker")+" [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},e.Base.AudioDevice=t}(AvayaClientServices),function(s){"use strict";function e(){this._audioContext=T,this._volume=1,this._mediaStreamContextMap={}}function n(e,t,i){this.gainFilter=e,this.mediaStreamSource=t,this.origAudioTrack=i}e.prototype.stop=function(){this._audioContext&&(this._audioContext.close&&this._audioContext.close(),this._audioContext=T),this._mediaStreamContextMap={}},e.prototype._initAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e?s.Base.Utils.isUndefined(this._audioContext)&&(this._audioContext=new e):s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Web Audio APIs are unavailable on this browser")},e.prototype.setVolume=function(e){if(1<e||e<0)throw new RangeError("Volume must be a double between 0 and 1");if(this._volume=e,s.Base.Utils.isDefined(this._audioContext))for(var t in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(this._mediaStreamContextMap[t].gainFilter.gain.value=this._volume)},e.prototype.getVolume=function(){return this._volume},e.prototype.addMediaStream=function(e){var t,i,a,r;s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Adding MediaStream to AudioInputVolumeController "+e.id),this._initAudioContext(),s.Base.Utils.isDefined(this._audioContext)&&(t=this._audioContext.createGain(),(i=this._audioContext.createMediaStreamSource(e)).connect(t),a=(r=this._audioContext.createMediaStreamDestination()).stream,t.connect(r),t.gain.value=this._volume,r=e.getAudioTracks()[0],e.addTrack(a.getAudioTracks()[0]),r.stop(),e.removeTrack(r),this._mediaStreamContextMap[e.id]=new n(t,i,r))},e.prototype.removeMediaStream=function(e){var t;s.Base.Utils.isDefined(this._audioContext)&&e&&(s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Removing MediaStream from AudioInputVolumeController "+e.id),t=this._mediaStreamContextMap[e.id],s.Base.Utils.isDefined(t)&&s.Base.Utils.isDefined(t.mediaStreamSource)&&(t.mediaStreamSource.disconnect(),t.gainFilter.disconnect(),s.Base.Logger.debug(s.Base.LoggerTags.MEDIA_ENGINE,"Stopping audio track "+t.origAudioTrack.id),t.origAudioTrack.stop(),delete this._mediaStreamContextMap[e.id]))},s.Base.AudioInputVolumeController=e}(AvayaClientServices),function(r){"use strict";function e(){this._muted=!1,this._volume=1,this._mediaStreamContextMap={},this._selectedDevice=T,this._gestureRequiredCallbacks=E.Callbacks()}e.prototype.stop=function(){this._mediaStreamContextMap={}},e.prototype.addOnGestureRequiredCallback=function(e){this._gestureRequiredCallbacks.add(e)},e.prototype.removeOnGestureRequiredCallback=function(e){this._gestureRequiredCallbacks.remove(e)},e.prototype.playAudioStream=function(e,t){var i,a;return!!(e&&0<e.getAudioTracks().length)&&(this.isPlaying(e)?r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+e.getAudioTracks()[0].id):(r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+e.id+"  active: "+e.active),e.getAudioTracks().forEach(function(e){r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+e.id+" enabled: "+e.enabled+" kind: "+e.kind+" label: "+e.label+" muted: "+e.muted+" readyState: "+e.readyState)}),(i=document.createElement("audio")).defaultMuted=!0,i.muted=this._muted||t,i.volume=this._volume,i.autoplay=!0,i.srcObject=e,a=function(e){i.play().then(function(){r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"Auto playing remote audio stream..."),i.removeEventListener("canplay",a)}.bind(this)).catch(function(e){r.Base.Logger.error(r.Base.LoggerTags.MEDIA_ENGINE,"Failed to auto play remote audio stream",e),this._gestureRequiredCallbacks.fire(a),i.removeEventListener("canplay",a)}.bind(this))}.bind(this),i.addEventListener("canplay",a),this._mediaStreamContextMap[e.id]=new r.Base.MediaStreamContext(i),this._selectedDevice&&(!0===r.Base.Utils.hasProperty(i,"setSinkId")?this._mediaStreamContextMap[e.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):r.Base.Logger.info(r.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},e.prototype.stopPlayingAudioStream=function(e,t){var i,a;e&&(i=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(i)&&(r.Base.Utils.isDefined(t)&&!t||this.logStreamChanges(e.getAudioTracks(),"Stopping playing audio for track "),t=function(){a.pause(),a.srcObject=null},0===(a=i.getMediaElement()).readyState?a.ondurationchange=t:t(),delete this._mediaStreamContextMap[e.id]))},e.prototype.isPlaying=function(e){return r.Base.Utils.isDefined(this._mediaStreamContextMap[e.id])},e.prototype.muteStream=function(e){var t;e&&(t=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(t)&&(t.setMediaMuted(!0),t.getMediaElement().muted=!0,this.logStreamChanges(e.getAudioTracks(),"Muted audio output for track ")))},e.prototype.unmuteStream=function(e){var t;e&&(t=this._mediaStreamContextMap[e.id],r.Base.Utils.isDefined(t)&&(t.setMediaMuted(!1),this._muted||(t.getMediaElement().muted=!1,this.logStreamChanges(e.getAudioTracks(),"Unmuted audio output for track "))))},e.prototype.logStreamChanges=function(e,t){e&&e[0]&&r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,t+e[0].id)},e.prototype.setVolume=function(e){if(1<e||e<0)throw new RangeError("Volume must be a double between 0 and 1");for(var t in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(this._mediaStreamContextMap[t].getMediaElement().volume=e);this._volume=e},e.prototype.getVolume=function(){return this._volume},e.prototype.mute=function(){for(var e in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(e)&&(this._mediaStreamContextMap[e].getMediaElement().muted=!0);this._muted=!0},e.prototype.unmute=function(){for(var e in this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(e)&&((e=this._mediaStreamContextMap[e]).isMediaMuted()||(e.getMediaElement().muted=!1));this._muted=!1},e.prototype.isMuted=function(){return this._muted},e.prototype.onSelectedDeviceChanged=function(e){for(var t in this._selectedDevice=e,this._mediaStreamContextMap)this._mediaStreamContextMap.hasOwnProperty(t)&&(t=this._mediaStreamContextMap[t],!0===r.Base.Utils.hasProperty(t.getMediaElement(),"setSinkId")?t.getMediaElement().setSinkId(e.getDeviceId()):r.Base.Logger.info(r.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))},r.Base.AudioOutput=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._audioInterface=e,this._videoInterface=t,this._mediaServicesService=i}t.prototype={getAudioInterface:function(){return this._audioInterface},getVideoInterface:function(){return this._videoInterface},start:function(e){return this._mediaServicesService!==T?this._mediaServicesService.start(e):E.Deferred().resolve().promise()},stop:function(){this._mediaServicesService.stop()}},e.Base.MediaServices=t}(AvayaClientServices),function(i){"use strict";function e(){this._audioInputInterfaceService=T,this._audioOutputInterfaceService=T,this._audioInterface=T,this._videoInterfaceService=T,this._videoInterface=T,this._mediaServices=T,this._mediaServicesService=T}e.prototype={getMediaServices:function(){return this.getMediaServicesService(),this._mediaServicesService||(this._mediaServicesService=this.getMediaServicesService()),this._mediaServices||(this._mediaServices=new i.Base.MediaServices(this.getAudioInterface(),this.getVideoInterface(),this._mediaServicesService)),this._mediaServices},getMediaServicesService:function(){return this._mediaServicesService||(this._mediaServicesService=new i.Base.MediaServicesService(this.getAudioInterface(),this.getVideoInterface(),this.getAudioInputInterfaceService(),this.getAudioOutputInterfaceService(),this.getVideoInterfaceService(),this.getUserMedia())),this._mediaServicesService},getAudioInputInterfaceService:function(){return this._audioInputInterfaceService||this.getAudioInterface(),this._audioInputInterfaceService},getAudioOutputInterfaceService:function(){return this._audioOutputInterfaceService||this.getAudioInterface(),this._audioOutputInterfaceService},getAudioInterface:function(){var e,t;return this._audioInterface||(this._audioInputInterfaceService=new i.Base.AudioInputInterfaceService,e=new i.Base.AudioInputInterface(this._audioInputInterfaceService),this._audioOutputInterfaceService=new i.Base.AudioOutputInterfaceService,t=new i.Base.AudioOutputInterface(this._audioOutputInterfaceService),this._audioInterface=new i.Base.AudioInterface(e,t)),this._audioInterface},getVideoInterfaceService:function(){return this._videoInterfaceService||this.getVideoInterface(),this._videoInterfaceService},getVideoInterface:function(){return this._videoInterface||(this._videoInterfaceService=new i.Base.VideoInterfaceService(this.getUserMedia()),this._videoInterface=new i.Base.VideoInterface(this._videoInterfaceService)),this._videoInterface},getUserMedia:function(){return this._userMedia||(this._userMedia=new i.Base.UserMedia),this._userMedia}},i.Base.MediaServicesFactory=e}(AvayaClientServices),function(d){"use strict";function e(e,t,i,a,r,s){this._audioInterface=e,this._videoInterface=t,this._userMedia=s,this._audioInputInterfaceService=i,this._audioOutputInterfaceService=a,this._videoInterfaceService=r}e.prototype={startMediaServiceFactory:function(){return this._audioInterface!==T&&this._videoInterface!==T?E.when(this._audioInterface.start(),this._videoInterface.start()):E.Deferred().reject("Not initialized with a audioInterface or videoInterface").promise()},start:function(e){if(window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia&&e){e=E.Deferred();return this._startMediaServiceFactory(e)}return this.startMediaServiceFactory()},stop:function(){return E.when(this._audioInterface.stop(),this._videoInterface.stop())},_startMediaServiceFactory:function(t){if(d.Base.Utils.getBrowserType()===d.Base.BrowserType.SAFARI)return this._startMediaServiceFactoryForSafari(t);var i=function(t){return this.startMediaServiceFactory().then(function(){t.getTracks().forEach(function(e){e.stop()}),this._setDefaultDevices(t)}.bind(this),function(e){t.getTracks().forEach(function(e){e.stop()})}.bind(this))}.bind(this);return window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){i(e).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this)).catch(function(e){if("NotAllowedError"!==e.name&&"NotFoundError"!==e.name&&"PermissionDeniedError"!==e.name&&"NotReadableError"!==e.name)return d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){t.reject("Can not receive media stream: "+e)});window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){i(e).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this),function(e){return d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){t.reject("Can not receive media stream: "+e)})}.bind(this))}.bind(this)),t},_startMediaServiceFactoryForSafari:function(a){var r=function(t){return this.startMediaServiceFactory().then(function(){t.getTracks().forEach(function(e){e.stop()}),this._setDefaultDevices(t)}.bind(this),function(e){t.getTracks().forEach(function(e){e.stop()})})}.bind(this);return window.navigator.mediaDevices.getUserMedia({audio:!0}).then(function(i){window.navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){i.getTracks().forEach(function(e){t.addTrack(e)}),r(t).then(function(){a.resolve()},function(e){a.reject(e)})}.bind(this),function(e){d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can only receive audio stream: "+e),r(i).then(function(){a.resolve()},function(e){a.reject(e)})}.bind(this))}.bind(this)).catch(function(e){return"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?(d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Audio media stream permission denied: "+e),this.startMediaServiceFactory().always(function(){a.reject("Audio media stream permission denied: "+e)})):(d.Base.Logger.info(d.Base.LoggerTags.USER_SERVICE,"Can not receive media stream: "+e),this.startMediaServiceFactory().always(function(){a.reject("Can not receive media stream: "+e)}))}.bind(this)),a},getAudioInputService:function(){return this._audioInputInterfaceService},getAudioOutputService:function(){return this._audioOutputInterfaceService},getVideoInterfaceService:function(){return this._videoInterfaceService},createLocalMediaStream:function(a,r,s,e,t,n,i,o,c,l){return s&&!d.Base.Utils.isDefined(n)?E.Deferred().reject("Undefined videoChannelId"):this._userMedia.getUserMedia(r,s,e,t,!1,i,o,c,l).then(function(e,t,i){return this._setDefaultDevices(e),r&&a&&this._audioInputInterfaceService.localMediaStreamCreated(a,e),s&&n&&this._videoInterfaceService.localMediaStreamCreated(n,e),{stream:e,videoResolution:t,constraint:i}}.bind(this))},_setDefaultDevices:function(e){var t=e.getAudioTracks()[0];this._setDefaultDevice(t,this._audioInterface.getInputInterface());e=e.getVideoTracks()[0];this._setDefaultDevice(e,this._videoInterface),this._setDefaultOutputDevice(this._audioInterface.getOutputInterface())},_setDefaultDevice:function(i,e){var t;!e.getSelectDeviceCapability().isAllowed||!i||e.getSelectedDevice()||(t=e.getAvailableDevices().filter(function(e){var t=i.proppedLabel||i.label;return e._label===t})[0])&&e.setSelectedDevice(t)},_setDefaultOutputDevice:function(e){var t;!e.getSelectDeviceCapability().isAllowed||e.getSelectedDevice()||(t=e.getAvailableDevices().filter(function(e){return"default"===e._deviceId})[0])&&e.setSelectedDevice(t)},addVideoTracksToLocalStream:function(e,t,i,a,r,s,n){var o=E.Deferred();return d.Base.Utils.isDefined(t)?this._userMedia.addVideoTracksToStream(e,i,a,r,s,n).then(function(e){this._videoInterfaceService.localMediaStreamCreated(t,e),o.resolve(e)}.bind(this).bind(t),function(e){o.reject(e)}):o.reject("Undefined videoChannelId"),o},removeLocalVideoTracks:function(e,t){var i=this._videoInterfaceService.getLocalMediaStream(e);if(d.Base.Utils.isDefined(i)){var a=i.getVideoTracks();d.Base.Logger.debug(d.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks starting with "+a.length+" tracks.");for(var r=a.length-1;0<=r;r--){var s=a[r],n=a.indexOf(s);-1<n&&(s.stop(),i.removeTrack(s),t&&t.isRTCRtpSenderSupported()&&t.removeIfDoesNotSupportReplaceTrack(s),a.splice(n,1))}a=i.getVideoTracks(),d.Base.Logger.debug(d.Base.LoggerTags.MEDIA_ENGINE,"removeLocalVideoTracks ending with "+a.length+" tracks."),this._videoInterfaceService.removeLocalMediaStream(e)}},getUserMedia:function(){return this._userMedia},setUserConfig:function(e,t){this._userMedia.setUserConfig(e,t)}},d.Base.MediaServicesService=e}(AvayaClientServices),function(t){"use strict";function e(e){this._selectedDevice=T,this._mediaInterfaceService=e,this._onDevicesAddedCallbacks=E.Callbacks("unique"),this._onDevicesRemovedCallbacks=E.Callbacks("unique"),this._onDevicesUpdatedCallbacks=E.Callbacks("unique"),this._onSelectedDeviceRemovedCallbacks=E.Callbacks("unique"),this._onSelectedDeviceChangedCallbacks=E.Callbacks("unique"),this._notifiedUnavailability=!1,this._onDevicesUnavailable=E.Callbacks("unique"),this._selectDeviceCapability=T,this._mediaAccessCapability=new t.Base.Capability(t.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}e.prototype={start:function(){return this._mediaInterfaceService.start(this).then(function(){this._mediaAccessCapability._updateIfChanged(!0,t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}.bind(this),function(e){this._mediaAccessCapability._updateIfChanged(!1,t.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)}.bind(this))},stop:function(){return this._mediaInterfaceService.stop(this)},setSelectedDevice:function(e){if(!this.getSelectDeviceCapability().isAllowed)throw new Error("Selecting devices is not supported in current browser.");e&&(t.Base.Utils.isUndefined(this._selectedDevice)||e.getDeviceId()!==this._selectedDevice.getDeviceId())&&(t.Base.Logger.info(t.Base.LoggerTags.MEDIA_ENGINE,"New device selected:",e.toString()),this._selectedDevice=e,this._onSelectedDeviceChangedCallbacks.fire(this,this._selectedDevice))},getAvailableDevices:function(){return this._mediaInterfaceService.getAvailableDevices()},hasAvailableDevices:function(){return this._mediaInterfaceService.hasAvailableDevices()},getSelectedDevice:function(){return this._selectedDevice},getSelectDeviceCapability:function(){var e;return this._selectDeviceCapability===T&&(e=t.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED,t.Base.Utils.isWebRTC_SupportedBrowser()&&this._canPickDevices()&&(e=t.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._selectDeviceCapability=new t.Base.Capability(e)),this._selectDeviceCapability},getMediaAccessCapability:function(){return this._mediaAccessCapability},addOnDevicesAddedCallback:function(e){this._onDevicesAddedCallbacks.add(e)},removeOnDevicesAddedCallback:function(e){this._onDevicesAddedCallbacks.remove(e)},cleanUpOnDevicesAddedCallbacks:function(){this._onDevicesAddedCallbacks.empty()},addOnDevicesRemovedCallback:function(e){this._onDevicesRemovedCallbacks.add(e)},removeOnDevicesRemovedCallback:function(e){this._onDevicesRemovedCallbacks.remove(e)},cleanUpOnDevicesRemovedCallbacks:function(){this._onDevicesRemovedCallbacks.empty()},addOnDevicesUpdatedCallback:function(e){this._onDevicesUpdatedCallbacks.add(e)},removeOnDevicesUpdatedCallback:function(e){this._onDevicesUpdatedCallbacks.remove(e)},cleanUpOnDevicesUpdatedCallbacks:function(){this._onDevicesUpdatedCallbacks.empty()},addOnSelectedDeviceRemovedCallback:function(e){this._onSelectedDeviceRemovedCallbacks.add(e)},removeOnSelectedDeviceRemovedCallback:function(e){this._onSelectedDeviceRemovedCallbacks.remove(e)},cleanUpOnSelectedDeviceRemovedCallbacks:function(){this._onSelectedDeviceRemovedCallbacks.empty()},addOnDevicesUnavailableCallback:function(e){this._onDevicesUnavailable.add(e)},removeOnDevicesUnavailableCallback:function(e){this._onDevicesUnavailable.remove(e)},cleanUpOnDevicesUnavailableCallbacks:function(){this._onDevicesUnavailable.empty()},addOnSelectedDeviceChangedCallback:function(e){this._onSelectedDeviceChangedCallbacks.add(e)},removeOnSelectedDeviceChangedCallback:function(e){this._onSelectedDeviceChangedCallbacks.remove(e)},cleanUpOnSelectedDeviceChangedCallbacks:function(){this._onSelectedDeviceChangedCallbacks.empty()},_canPickDevices:function(){return!0}},t.Base.MediaInterface=e}(AvayaClientServices),function(s){"use strict";function e(){this._devices=[],this._deviceIdentifier="",this._isStarted=!1,this._observeDevicesInterval=T,this._hasDevices=!1}e.prototype={start:function(e){var t=E.Deferred();return s.Base.Utils.isWebRTC_SupportedBrowser()?(this._isStarted?t.resolve():(this._observeDevicesInterval=setInterval(function(){this._observeDevices(e,t)}.bind(this),1e3),this._observeDevices(e,t)),t.promise()):t.reject(new s.Base.BaseError(s.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)).promise()},stop:function(e){return this._observeDevicesInterval&&(clearInterval(this._observeDevicesInterval),this._observeDevicesInterval=T),this._isStarted=!1,E.Deferred().resolve().promise()},getAvailableDevices:function(){return this._devices},hasAvailableDevices:function(){return this._hasDevices},_observeDevices:function(t,i){navigator.mediaDevices.enumerateDevices().then(function(e){this._processDevices(t,this._devices,e),this._isStarted||(this._isStarted=!0,i.resolve())}.bind(this))},_processDevices:function(e,t,i){this._scanForAddedDevices(e,t,i),this._scanForRemovedDevices(e,t,i),this._scanForAvailableDevices(e,t,i),this._updateDevicesLabel(e,t,i)},_getAddedDevices:function(a,e){var r=[],e=e.filter(function(e){return e.kind===this._deviceIdentifier}.bind(this));return this._hasDevices=0<e.length,e.forEach(function(t){var e=0<a.filter(function(e){return e.getDeviceId()===t.deviceId}).length,i=0<r.filter(function(e){return e._deviceId===t.deviceId}).length;e||i||!t.deviceId||(i=this._buildDevice(t),r.push(i))}.bind(this)),r},_updateDevicesLabel:function(e,t,i){var a=[];t.filter(function(t){i.forEach(function(e){return t._kind===e.kind&&t.getDeviceId()===e.deviceId&&(t.getLabel()!==e.label&&(t._label=e.label,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device label updated:",t.toString()),a.push(t)),!0)})}),0<a.length&&e._onDevicesUpdatedCallbacks.fire(e,a)},_scanForAddedDevices:function(e,t,i){i=this._getAddedDevices(t,i);0<i.length&&(i.forEach(function(e){s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"New device added:",e.toString()),t.push(e)}),e._notifiedUnavailability=!1,e._onDevicesAddedCallbacks.fire(e,i))},_scanForAvailableDevices:function(e,t,i){0!==t.length||e._notifiedUnavailability||(s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device unavailable:",e.toString()),e._onDevicesUnavailable.fire(e),e._notifiedUnavailability=!0)},_scanForRemovedDevices:function(e,t,i){var a,r=t.filter(function(t){return 0===i.filter(function(e){return"default"===e.deviceId||"communications"===e.deviceId?t.getDeviceId()===e.deviceId&&t.getLabel()===e.label:t.getDeviceId()===e.deviceId}).length});0<r.length&&(r.forEach(function(e){t.splice(t.indexOf(e),1)}),a=0,r.forEach(function(e){e.getDeviceId()&&(a++,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Device removed:",e.toString()))}),0<a&&e._onDevicesRemovedCallbacks.fire(e,r),-1<r.indexOf(e.getSelectedDevice())&&(r=e._selectedDevice,e._selectedDevice=T,s.Base.Logger.info(s.Base.LoggerTags.MEDIA_ENGINE,"Selected device removed:",r.toString()),e._onSelectedDeviceRemovedCallbacks.fire(e,r)))},_buildDevice:function(e){throw new Error("Unable to build device")}},s.Base.MediaInterfaceService=e}(AvayaClientServices),function(e){"use strict";function t(e){this.mediaElement=e,this.streamMuted=!1}t.prototype={isMediaMuted:function(){return this.streamMuted},setMediaMuted:function(e){this.streamMuted=e},getMediaElement:function(){return this.mediaElement}},e.Base.MediaStreamContext=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.MediaStreamError={ABORT:"AbortError",NOT_ALLOWED:"NotAllowedError",PERMISSION_DENIED:"PermissionDeniedError",NOT_FOUND:"NotFoundError",NOT_READABLE:"NotReadableError",OVERCONSTRAINED:"OverconstrainedError",SECURITY:"SecurityError",TYPE:"TypeError",DEVICES_NOT_FOUND:"DevicesNotFoundError"}}(),function(a){"use strict";function e(e,t,i){if(this._origStream=e,this._backgroundBlur=t,this._backgroundImage=i,this._inputVideo=document.createElement("video"),this._inputVideo.addEventListener("loadedmetadata",function(){this._runLoop()}.bind(this)),this._canvas=document.createElement("canvas"),this._canvasCtxt=this._canvas.getContext("2d"),this._debugDiv=document.getElementById("canvasDiv"),this._debugDiv){for(;this._debugDiv.firstChild;)this._debugDiv.removeChild(this._debugDiv.firstChild);this._debugDiv.appendChild(this._canvas)}this._outputStream=T,this._requestingFrames=!1,this._propagator=T}e.prototype.init=function(){},e.prototype.setOrigStream=function(e){this._origStream=e},e.prototype.getStream=function(){return this._inputVideo.srcObject=this._origStream,this._inputVideo.muted=!0,this._inputVideo.play().catch(function(){a.Base.Logger.error(a.Base.LoggerTags.MEDIA_ENGINE,"Failed to play inputVideo")}),this._outputStream=this._canvas.captureStream(30),this._requestingFrames&&this._outputStream&&0<this._outputStream.getVideoTracks().length&&this._outputStream.getVideoTracks()[0].requestFrame?this._outputStream=this._canvas.captureStream(0):this._requestingFrames=!1,0<this._origStream.getAudioTracks().length&&this._outputStream.addTrack(this._origStream.getAudioTracks()[0]),this._propagator=new a.Base.VideoTrackPropagator(this._origStream.getVideoTracks()[0],this._outputStream.getVideoTracks()[0]),this._outputStream.getVideoTracks()[0].avayaSetBackground=this._setBackground.bind(this),this._outputStream},e.prototype._setBackground=function(e,t){this._backgroundBlur=e,this._backgroundImage=e?T:t},e.prototype._runLoop=function(){},e.prototype._updateCanvasSize=function(){this._canvas.width=this._inputVideo.videoWidth,this._canvas.height=this._inputVideo.videoHeight,this._inputVideo.width=this._inputVideo.videoWidth,this._inputVideo.height=this._inputVideo.videoHeight},e.prototype._isVideoEnabled=function(){if(this._outputStream){var e=this._outputStream.getVideoTracks();if(e[0]&&e[0].enabled&&e[0].readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE)return!0}return!1},e.prototype._isStreamAlive=function(){var t,i=!1;return this._origStream.active&&this._outputStream.active&&this._origStream.getVideoTracks()&&this._outputStream.getVideoTracks()&&(this._origStream.getVideoTracks().forEach(function(e){"ended"!==e.readyState&&(t=!0)}),this._outputStream.getVideoTracks().forEach(function(e){"ended"!==e.readyState&&(i=!0)})),t&&i},e.prototype.cleanup=function(){a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Cleaning up MediaStreamVideoProcessor ",this._origStream,this._outputStream),this._propagator&&this._propagator.cleanup(),this._propagator=T,this._outputStream&&this._outputStream.getVideoTracks()&&(this._outputStream.getVideoTracks().forEach(function(e){e.stop()}),this._outputStream=T),this._origStream&&this._origStream.getVideoTracks()&&(this._origStream.getVideoTracks().forEach(function(e){e.stop()}),this._origStream=T),this._inputVideo=T,this._canvas=T,this._canvasCtxt=T},e.prototype.getResolutionLimit=function(){var e,t=null,i=document.createElement("canvas").getContext("webgl2");return!i||(e=i.getExtension("WEBGL_debug_renderer_info"))&&(i=i.getParameter(e.UNMASKED_RENDERER_WEBGL),a.Base.Logger.info(a.Base.LoggerTags.MEDIA_ENGINE,"Detected GPU: ",i),!i.match(/intel/i)||(e=i.match(/(.)hd graphics (\d)/i))&&(i=parseInt(e[2]),!(e="U"===e[1])&&i<6?(a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"MediaStreamVideoProcessor: limited resolution to 360p"),t=a.Base.VideoResolution.resolution360p):(!e&&6<=i||e&&i<=6)&&(a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"MediaStreamVideoProcessor: limited resolution to 480p"),t=a.Base.VideoResolution.resolution480p))),t},a.Base.MediaStreamVideoProcessor=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.MediaTypes={AUDIO_INPUT:"audioinput",AUDIO_OUTPUT:"audiooutput",VIDEO_INPUT:"videoinput"}}(),function(a){"use strict";function e(){this._audioElement=T,a.Base.AudioOutput.call(this)}(e.prototype=Object.create(a.Base.AudioOutput.prototype)).playAudioStream=function(e,t){var i;return!!(e&&e.active&&0<e.getAudioTracks().length)&&(this.isPlaying(e)?a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Audio track is already playing: "+e.getAudioTracks()[0].id):(a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Playing media stream "+e.id+"  active: "+e.active),e.getAudioTracks().forEach(function(e){a.Base.Logger.debug(a.Base.LoggerTags.MEDIA_ENGINE,"Audio track: id: "+e.id+" enabled: "+e.enabled+" kind: "+e.kind+" label: "+e.label+" muted: "+e.muted+" readyState: "+e.readyState)}),this._audioElement&&(this._audioElement.srcObject=null,this._audioElement.remove()),this._audioElement=document.createElement("audio"),this._audioElement.muted=this._muted||t,this._audioElement.volume=this._volume,this._audioElement.autoplay=!0,this._audioElement.addEventListener("canplay",function(e){this._audioElement.play().then(function(){a.Base.Logger.debug("*** Playing remote audio stream...")}).catch(function(e){a.Base.Logger.error("Failed to play remote audio stream",e)})}.bind(this)),0<e.getVideoTracks().length?(i=new MediaStream,e.getAudioTracks().forEach(function(e){i.addTrack(e)}),this._audioElement.srcObject=i):this._audioElement.srcObject=e,this._mediaStreamContextMap[e.id]=new a.Base.MediaStreamContext(this._audioElement),this._selectedDevice&&(!0===a.Base.Utils.hasProperty(this._audioElement,"setSinkId")?this._mediaStreamContextMap[e.id].getMediaElement().setSinkId(this._selectedDevice.getDeviceId()):a.Base.Logger.info(a.Base.LoggerTags.MEDIA_ENGINE,"Change of audio output device is unsupported by the browser"))),!0)},a.Base.SafariAudioOutput=e}(AvayaClientServices),function(t){"use strict";function e(e){e.libraryLocation&&!e.libraryLocation.endsWith("/")&&(e.libraryLocation+="/"),this._libraryLocation=e.libraryLocation,this._selfies=[],this._modelType=e.modelType||1,this._nextSelfieId=0}e.prototype.preAllocate=function(){if(t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.preAllocate"),this._selfies.length<1){var e=this._createSelfie();return this.return(e),e}return this._selfies[this._selfies.length-1]},e.prototype.take=function(){var e=this._selfies.pop();return e?t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.take - popped #"+e.id()):(e=this._createSelfie(),t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.take - created #"+e.id())),e},e.prototype.return=function(e){e&&(t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.return - pushed #"+e.id()),e.onResults=function(){},this._selfies.push(e))},e.prototype._createSelfie=function(){t.Base.Logger.debug(t.Base.LoggerTags.MEDIA_ENGINE,"SelfieFactory.createSelfie - #"+this._nextSelfieId);var e=new t.Base.SelfieWrapper(this._libraryLocation,this._modelType,this._nextSelfieId);return++this._nextSelfieId,e.initialize(),e},t.Base.SelfieFactory=e}(AvayaClientServices),function(r){"use strict";function e(t,e,i){var a;t&&(a={locateFile:function(e){return t+e}}),this._id=i,this._isStarted=!1,this._isFailed=!1,this._initDfd=E.Deferred();try{this._selfieSegmentation=new SelfieSegmentation(a),this._selfieSegmentation.setOptions({modelSelection:e})}catch(e){r.Base.Logger.warn(r.Base.LoggerTags.MEDIA_ENGINE,"SelfieSegmentation library is not available",e)}}e.prototype.id=function(){return this._id},e.prototype.isStarted=function(){return this._isStarted},e.prototype.isFailed=function(){return this._isFailed},e.prototype.initialize=function(){return this._selfieSegmentation?(this._selfieSegmentation.onResults(function(e){this.onResults(e)}.bind(this)),this._selfieSegmentation.initialize().then(function(){r.Base.Logger.debug(r.Base.LoggerTags.MEDIA_ENGINE,"SelfieSegmentation initialized successfully"),this._isStarted=!0,this._initDfd.resolve()}.bind(this),function(e){r.Base.Logger.warn(r.Base.LoggerTags.MEDIA_ENGINE,"SelfieSegmentation initialization failed"),this._isFailed=!0,this._initDfd.reject(e)}.bind(this))):(this._isFailed=!0,this._initDfd.reject("SelfieSegmentation library not available")),this._initDfd.promise()},e.prototype.reset=function(){this._selfieSegmentation&&this._selfieSegmentation.reset()},e.prototype.getInitPromise=function(){return this._initDfd.promise()},e.prototype.send=function(e){return this._selfieSegmentation.send(e).catch(function(e){r.Base.Logger.warn(r.Base.LoggerTags.MEDIA_ENGINE,"selfieSegmentation.send failed: ",e)})},e.prototype.onResults=function(e){r.Base.Logger.warn(r.Base.LoggerTags.MEDIA_ENGINE,"Must overwrite onResults to get results")},r.Base.SelfieWrapper=e}(AvayaClientServices),function(u){"use strict";function e(){this.isAvailable()||u.Base.Logger.info(u.Base.LoggerTags.MEDIA_ENGINE,"UserMedia not available"),this._isChromeBrowser=this._checkIfBrowserIsChrome(),this._isWebGLEnabled=!0;try{window.WebGLRenderingContext&&document.createElement("canvas").getContext("webgl2",{failIfMajorPerformanceCaveat:!0})||(this._isWebGLEnabled=!1)}catch(e){this._isWebGLEnabled=!1}this._isSoftwareGPU=!1;try{var e,t,i=document.createElement("canvas").getContext("webgl2");!i||(e=i.getExtension("WEBGL_debug_renderer_info"))&&(t=i.getParameter(e.UNMASKED_RENDERER_WEBGL),this._isSoftwareGPU=t.match(/SwiftShader/i))}catch(e){}this._supportedConstaints=this.getMediaTrackConstraints(),this._mediaConfig=T,this._selfieFactory=T,this._hasMediaPipeVideoProcessorFailed=!1,this._callPerformanceManager=T,this._onVideoBackgroundStartedCallbacks=E.Callbacks(),this._onVideoBackgroundFailedCallbacks=E.Callbacks(),this._videoBackgroundCapability=new u.Base.Capability,this._recalculateVideoBackgroundCapability()}e.prototype.isAvailable=function(){return!!navigator.mediaDevices&&!!navigator.mediaDevices.getUserMedia},e.prototype.setUserConfig=function(e,t){this._mediaConfig=e,this._callPerformanceManager=t;t=this._mediaConfig.virtualBackgroundConfiguration.libraryLocation;this._selfieFactory=new u.Base.SelfieFactory(this._mediaConfig.virtualBackgroundConfiguration),t&&this._videoBackgroundCapability.isAllowed&&this._selfieFactory.preAllocate().getInitPromise().then(function(){this._recalculateVideoBackgroundCapability(),this._onVideoBackgroundStartedCallbacks.fire()}.bind(this),function(){this._hasMediaPipeVideoProcessorFailed=!0,this._recalculateVideoBackgroundCapability(),this._onVideoBackgroundFailedCallbacks.fire()}.bind(this))},e.prototype.getMediaTrackConstraints=function(){var e={width:!0,height:!0,aspectRatio:!0,frameRate:!0,facingMode:!0,volume:!0,sampleRate:!0,sampleSize:!0,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,latency:!0,channelCount:!0,deviceId:!0,groupId:!0};return navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?(e=navigator.mediaDevices.getSupportedConstraints(),u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"supportedConstraints: ",e)):u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"navigator.mediaDevices.getSupportedConstraints is not available.  Assuming browser supports all constraints."),e},e.prototype.getUserMedia=function(e,t,i,a,r,s,n,o,c){var l,d,C=E.Deferred();return this.isAvailable()?(e=this._createAudioConstraints(e,i,n),i=[],t&&(o||c)&&this._isChromeBrowser?(n=E.Deferred(),l=new u.Base.MediaPipeVideoProcessor(T,o,c,this._selfieFactory,this._callPerformanceManager,this._mediaConfig.virtualBackgroundConfiguration),d=l.init(),(c=l.getResolutionLimit())&&c.getHeight()<s.getHeight()&&(s=c),n.then(function(e,t,i){var a;0<e.getVideoTracks().length?(l.setOrigStream(e),a=l.getStream(),d.then(function(){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Initialized MediaPipeVideoProcessor"),this._onVideoBackgroundStartedCallbacks.fire()}.bind(this),function(){this._hasMediaPipeVideoProcessorFailed=!0,this._recalculateVideoBackgroundCapability(),this._onVideoBackgroundFailedCallbacks.fire(),u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to initialize MediaPipeVideoProcessor")}.bind(this)),C.resolve(a,t,i)):(l.cleanup(),C.resolve(e,t,i))}.bind(this),function(e){C.reject(e)}),i=this._createVideoConstraintList(s,a),this._getUserMediaWithConstraints(n,e,i,r)):(t&&(i=this._createVideoConstraintList(s,a)),this._getUserMediaWithConstraints(C,e,i,r))):C.reject(new u.Services.Call.CallException(u.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)),C.promise()},e.prototype._getUserMediaWithConstraints=function(e,t,i,a,r,s){u.Base.Utils.getBrowserType()===u.Base.BrowserType.SAFARI?this._getSafariUserMediaWithConstraints(e,t,i,a,r,s):this._getGenericUserMediaWithConstraints(e,t,i,a,r)},e.prototype._getGenericUserMediaWithConstraints=function(r,s,n,o,c){var e=n.shift(),l=this._buildMediaConstraints(s,e);o&&(l.fake=!0);var i=e?e.resolution:T;l.video?u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",i):l.audio&&u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only");var d=function(e,t){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),l.video&&!e.getVideoTracks().length&&l.video?this._getUserMediaErrorHandler(r,s,n,o,c,{name:"NotFoundError",message:"No video tracks",constraintName:"OverConstrainedError"}):r.resolve(e,i,t)}.bind(this);u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(l)),navigator.mediaDevices.getUserMedia(l).then(d,function(i){var a,e=i.name===u.Base.MediaStreamError.OVERCONSTRAINED&&0===n.length;i.name===u.Base.MediaStreamError.NOT_ALLOWED||i.name===u.Base.MediaStreamError.NOT_READABLE||i.name===u.Base.MediaStreamError.NOT_FOUND||i.name===u.Base.MediaStreamError.ABORT||i.name===u.Base.MediaStreamError.PERMISSION_DENIED||e?l.audio&&l.video?(l.video=!1,u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback: ",i.message),u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running audio only constraints fallback using ",l),navigator.mediaDevices.getUserMedia(l).then(function(e){var t={error:a=this._getMediaStreamErrorCode(i.name,!0),reason:i.name};d(e,t)}.bind(this),function(e){u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed audio only constraints: ",e),(a=this._getMediaStreamErrorCode(e.name,!1))===u.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED?r.reject(new u.Services.Call.CallException(a,u.Services.Call.CallProtocolType.APPLICATION,500,e.name)):this._getUserMediaErrorHandler(r,s,n,o,c,e)}.bind(this))):(a=this._getMediaStreamErrorCode(i.name,l.video),r.reject(new u.Services.Call.CallException(a,u.Services.Call.CallProtocolType.APPLICATION,500,i.name))):l.video?this._getUserMediaErrorHandler(r,s,n,o,c,i):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this)).catch(function(e){l.video?this._getUserMediaErrorHandler(r,s,n,o,c,e):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))},e.prototype._getMediaStreamErrorCode=function(e,t){var i;switch(t=t||!1,e){case u.Base.MediaStreamError.NOT_READABLE:case u.Base.MediaStreamError.NOT_FOUND:case u.Base.MediaStreamError.ABORT:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add microphone or camera is not accessible"),i=t?u.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE:u.Services.Call.CallError.MICROPHONE_NOT_ACCESSIBLE;break;case u.Base.MediaStreamError.OVERCONSTRAINED:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to overconstrained"),i=u.Services.Call.CallError.OVERCONSTRAINED;break;default:u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to add audio or video track due to device permission denied"),i=t?u.Services.Call.CallError.CAMERA_PERMISSION_DENIED:u.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED}return i},e.prototype._getSafariUserMediaWithConstraints=function(r,s,n,o,c,l){var t=n.shift(),d=this._buildMediaConstraints(s,t);o&&(d.fake=!0);var e,i=function(){var a=t?t.resolution:T,e=function(t){u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Resolving getUserMedia dfd"),l&&l.getTracks().forEach(function(e){t.addTrack(e)}),r.resolve(t,a)}.bind(this);if(d.video)u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio and Video",a);else if(d.audio)return u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"Entering getUserMedia for Audio only"),void r.resolve(l,a);u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia with mediaOptions "+JSON.stringify(d)),d.audio=!1,navigator.mediaDevices.getUserMedia(d).then(e,function(e){var t,i=e.name===u.Base.MediaStreamError.OVERCONSTRAINED&&d.video&&0===n.length;e.name===u.Base.MediaStreamError.NOT_ALLOWED||e.name===u.Base.MediaStreamError.NOT_READABLE||e.name===u.Base.MediaStreamError.NOT_FOUND||e.name===u.Base.MediaStreamError.ABORT||e.name===u.Base.MediaStreamError.PERMISSION_DENIED||i?l?(t={error:this._getMediaStreamErrorCode(e.name,!0),reason:e.name},r.resolve(l,a,t)):(t=this._getMediaStreamErrorCode(e.name,d.video),r.reject(new u.Services.Call.CallException(t))):d.video?this._getUserMediaErrorHandler(r,s,n,o,c,e,l):r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}.bind(this))}.bind(this);u.Base.Utils.isUndefined(l)&&d.audio?(e={audio:d.audio},navigator.mediaDevices.getUserMedia(e).then(function(e){l=e,i()},function(e){e.name===u.Base.MediaStreamError.NOT_ALLOWED||e.name===u.Base.MediaStreamError.PERMISSION_DENIED||e.name===u.Base.MediaStreamError.NOT_READABLE||e.name===u.Base.MediaStreamError.ABORT||e.name===u.Base.MediaStreamError.NOT_FOUND?(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track due to device permission denied"),r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MICROPHONE_PERMISSION_DENIED))):(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Failed to allocate audio track: "+e),r.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE)))})):i()},e.prototype._getUserMediaErrorHandler=function(e,t,i,a,r,s,n){return s.name===u.Base.MediaStreamError.DEVICES_NOT_FOUND?(u.Base.Logger.error(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",s),void e.reject(new u.Services.Call.CallException(u.Services.Call.CallError.DEVICES_NOT_FOUND))):s.message&&s.message.includes("Failed to allocate")?(u.Base.Logger.error(u.Base.LoggerTags.MEDIA_ENGINE,"getUserMedia error: ",s),void((r=r||0)<2?(r++,setTimeout(function(){this._getUserMediaWithConstraints(e,t,i,a,r,n)}.bind(this),1e3)):e.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE)))):(u.Base.Logger.warn(u.Base.LoggerTags.MEDIA_ENGINE,"Running constraints fallback: ",s),void this._getUserMediaWithConstraints(e,t,i,a,r,n))},e.prototype.addVideoTracksToStream=function(e,i,t,a,r,s){var n=E.Deferred(),o=i.getVideoTracks();return u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream starting with "+o.length+" tracks."),this.getUserMedia(!1,!0,T,e,!1,t,T,r,s).then(function(e){var t;e?(t=e.getVideoTracks(),u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream got new stream with "+t.length+" tracks."),e.getTracks().forEach(function(e){e.kind===u.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(u.Base.Logger.debug(u.Base.LoggerTags.MEDIA_ENGINE,"addVideoTracksToStream added a track."+e.id),i.addTrack(e),a&&a.isRTCRtpSenderSupported()?a.replaceLocalMediaTrack(e,i).then(function(){n.resolve(i)},function(e){n.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}):n.resolve(i))})):n.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))},function(e){n.reject(e)}),n},e.prototype._buildMediaConstraints=function(e,t){var i={};return i.audio=e||!1,i.video=!!t&&t.constraints,i},e.prototype._createAudioConstraints=function(e,t,i){var a;return e?t?(a={deviceId:{exact:t}},i&&(a=Object.assign(a,i))):a=i||!0:a=!1,a},e.prototype._createVideoConstraintList=function(t,i){function a(e){e={resolution:e,constraints:{width:{},height:{}}};return i&&(e.constraints.deviceId={exact:i}),e}function r(e,t){var i=a(e);return i.constraints.width.exact=e.getWidth(),i.constraints.height.exact=e.getHeight(),t?480===e.getHeight()?i.constraints.frameRate={min:t,max:25}:i.constraints.frameRate={min:t}:(480===e.getHeight()?i.constraints.frameRate={max:25}:i.resolution._fps=T,u.Base.Utils.getBrowserType()===u.Base.BrowserType.SAFARI&&(i.constraints.width=e.getWidth(),i.constraints.height=e.getHeight())),i}var s,n,o,e,c,l=(n=[],o=[],s=u.Base.VideoResolution,Object.keys(s).map(function(e){return s[e]}).forEach(function(e){e&&e.getHeight()<=t.getHeight()&&(n.push(r(e,u.Config.CallUserConfiguration.minPreferredVideoFPS||u.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS)),o.push(r(e)))}),n.concat(o));return l.push((e=a(t),c="max",u.Base.Utils.getBrowserType()!==u.Base.BrowserType.CHROME&&(c="ideal"),e.constraints.width[c]=t.getWidth(),e.constraints.height[c]=t.getHeight(),e)),l},e.prototype.createRTCVideoConstraints=function(e,t){var i={};return 180===e.getHeight()?u.Base.Utils.getBrowserType()===u.Base.BrowserType.CHROME?i.video={width:{max:e.getWidth()},height:{max:e.getHeight()}}:i.video={width:{ideal:e.getWidth()},height:{ideal:e.getHeight()}}:u.Base.Utils.getBrowserType()===u.Base.BrowserType.FIREFOX&&360<=e.getHeight()&&e.getHeight()<=480?i.video={width:640,height:360}:i.video={width:e.getWidth(),height:e.getHeight()},t&&(i.deviceId={exact:t}),i},e.prototype.adjustVideoResolution=function(e,t,i){if(!e||!t||t.getMinBandwidth()<=e)return new u.Base.VideoResolutionDetails(t.getWidth(),t.getHeight(),t.getMinBandwidth(),e,t.getFPS());var a,r=E.map(i||u.Base.VideoResolution,function(e){return e}),s=0;if(t)for(a=0;a<r.length;a++)if(r[a].getHeight()===t.getHeight()){s=a;break}for(var n=s;n<r.length;n++)if(r[n].getMinBandwidth()<=e&&r[n].getMaxBandwidth()>e)return new u.Base.VideoResolutionDetails(r[n].getWidth(),r[n].getHeight(),r[n].getMinBandwidth(),e,r[n].getFPS());return u.Base.VideoResolution.resolution180p},e.prototype.adjustVideoResolutionForDimensions=function(e,t,i,a){var r,s=E.map(a||u.Base.VideoResolution,function(e){return e}),n=0;if(i)for(r=0;r<s.length;r++)if(s[r].getHeight()===i.getHeight()){n=r;break}for(r=n;r<s.length;r++)if((u.Base.Utils.isUndefined(t)||0===t||s[r].getWidth()<=t)&&(u.Base.Utils.isUndefined(e)||0===e||s[r].getHeight()<=e))return i&&s[r].getHeight()===i.getHeight()?i:s[r];return u.Base.VideoResolution.resolution180p},e.prototype.updateStreamUsingApplyConstraints=function(i,a,r,s,n){n=n||E.Deferred();var e=u.Base.UserMedia.prototype.createRTCVideoConstraints(a,s);return i.muted?(i.onunmute||(i.onunmute=function(){setTimeout(this.adjustVideoConstraints.bind(this,i,a,r,s,n),0)}.bind(this)),n.reject("Found video track issues. Can't apply constraints to the video track").promise()):(i.applyConstraints(e).then(function(){r._updateVideoResolution(a),n.resolve()},function(e){var t=r._nextLowerVideoResolution(a);t===T?n.reject(e):this.updateStreamUsingApplyConstraints(i,t,r,s,n)}.bind(this)),n.promise())},e.prototype._checkIfBrowserIsChrome=function(){return u.Base.Utils.getBrowserType()===u.Base.BrowserType.CHROME},e.prototype.getVideoBackgroundCapability=function(){return this._videoBackgroundCapability},e.prototype._recalculateVideoBackgroundCapability=function(){var e=u.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._isChromeBrowser?window.navigator.hardwareConcurrency&&window.navigator.hardwareConcurrency<2?e=u.Base.CapabilityDenialReason.CAPABILITY_HARDWARE_NOT_SUPPORTED:this._hasMediaPipeVideoProcessorFailed?e=u.Base.CapabilityDenialReason.CAPABILITY_NOT_INSTALLED:this._isWebGLEnabled?this._isSoftwareGPU&&(e=u.Base.CapabilityDenialReason.CAPABILITY_HARDWARE_GPU_NOT_AVAILABLE):e=u.Base.CapabilityDenialReason.CAPABILITY_WEBGL_NOT_SUPPORTED:e=u.Base.CapabilityDenialReason.CAPABILITY_BROWSER_NOT_SUPPORTED,this._videoBackgroundCapability._updateIfChanged(e===u.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e)},e.prototype.addOnVideoBackgroundStarted=function(e){this._onVideoBackgroundStartedCallbacks.add(e)},e.prototype.removeOnVideoBackgroundStarted=function(e){this._onVideoBackgroundStartedCallbacks.remove(e)},e.prototype.addOnVideoBackgroundFailed=function(e){this._onVideoBackgroundFailedCallbacks.add(e)},e.prototype.removeOnVideoBackgroundFailed=function(e){this._onVideoBackgroundFailedCallbacks.remove(e)},u.Base.UserMedia=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){this._kind=a.Base.MediaTypes.VIDEO_INPUT,this._deviceId=e,this._groupId=t,this._label=i}e.prototype={getDeviceId:function(){return this._deviceId},getGroupId:function(){return this._groupId},getLabel:function(){return this._label},toString:function(){return"Camera device [name: "+this._label+"; id: "+this._deviceId+"; groupId: "+this._groupId+"]"}},a.Base.VideoDevice=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Base.MediaInterface.call(this,e),this._videoInterfaceService=e}(e.prototype=Object.create(t.Base.MediaInterface.prototype)).getRemoteMediaStream=function(e){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getRemoteMediaStream(e);throw new Error("VideoInterface.getRemoteMediaStream(): Capability not allowed")},e.prototype.getLocalMediaStream=function(e){if(this._mediaAccessCapability.isAllowed)return this._videoInterfaceService.getLocalMediaStream(e);throw new Error("VideoInterface.getLocalMediaStream(): Capability not allowed")},e.prototype.getVideoBackgroundCapability=function(){return this._videoInterfaceService.getVideoBackgroundCapability()},e.prototype.addOnVideoBackgroundStarted=function(e){return this._videoInterfaceService.addOnVideoBackgroundStarted(e)},e.prototype.removeOnVideoBackgroundStarted=function(e){return this._videoInterfaceService.removeOnVideoBackgroundStarted(e)},e.prototype.addOnVideoBackgroundFailed=function(e){return this._videoInterfaceService.addOnVideoBackgroundFailed(e)},e.prototype.removeOnVideoBackgroundFailed=function(e){return this._videoInterfaceService.removeOnVideoBackgroundFailed(e)},e.prototype.toString=function(){return"Camera"},t.Base.VideoInterface=e}(AvayaClientServices),function(a){"use strict";function e(e){a.Base.MediaInterfaceService.call(this),this._deviceIdentifier=a.Base.MediaTypes.VIDEO_INPUT,this._localStreamMap={},this._remoteStreamMap={},this._currentChannelId=1,this._userMedia=e}(e.prototype=Object.create(a.Base.MediaInterfaceService.prototype))._buildDevice=function(e){return new a.Base.VideoDevice(e.deviceId,e.groupId,e.label)},e.prototype.createVideoChannel=function(){return this._currentChannelId++},e.prototype.getRemoteMediaStream=function(e){return this._remoteStreamMap[e]},e.prototype.getLocalMediaStream=function(e){return this._localStreamMap[e]},e.prototype.setRemoteMediaStream=function(e,t){this._remoteStreamMap[e]=t},e.prototype.localMediaStreamCreated=function(e,t){var i;0<t.getVideoTracks().length&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(i=new MediaStream,t.getVideoTracks().forEach(function(e){e instanceof MediaStreamTrack&&"live"===e.readyState&&i.addTrack(e)}),this._localStreamMap[e]=i):this._localStreamMap[e]=t)},e.prototype.removeMediaStreams=function(e){delete this._localStreamMap[e],delete this._remoteStreamMap[e]},e.prototype.removeLocalMediaStream=function(e){delete this._localStreamMap[e]},e.prototype.removeRemoteMediaStream=function(e){delete this._remoteStreamMap[e]},e.prototype.replaceLocalMediaStream=function(e,t){var i;this._localStreamMap.hasOwnProperty(e)&&(a.Base.Utils.getBrowserType()!==a.Base.BrowserType.EDGE?(i=new MediaStream,t.getVideoTracks().forEach(function(e){e instanceof MediaStreamTrack&&"live"===e.readyState&&i.addTrack(e)}),this._localStreamMap[e]=i):this._localStreamMap[e]=t)},e.prototype.getVideoBackgroundCapability=function(){return this._userMedia.getVideoBackgroundCapability()},e.prototype.addOnVideoBackgroundStarted=function(e){return this._userMedia.addOnVideoBackgroundStarted(e)},e.prototype.removeOnVideoBackgroundStarted=function(e){return this._userMedia.removeOnVideoBackgroundStarted(e)},e.prototype.addOnVideoBackgroundFailed=function(e){return this._userMedia.addOnVideoBackgroundFailed(e)},e.prototype.removeOnVideoBackgroundFailed=function(e){return this._userMedia.removeOnVideoBackgroundFailed(e)},a.Base.VideoInterfaceService=e}(AvayaClientServices),function(i){"use strict";function e(e,t){this._origTrack=e,this._propagatingTrack=t,this._propApplyConstraints=this._propagatingTrack.applyConstraints,this._propStop=this._propagatingTrack.stop,this._propGetConstraints=this._propagatingTrack.getConstraints,this._propagatingTrack.proppedLabel=this._origTrack.label,this._propagatingTrack.applyConstraints=function(){var e,t=E.Deferred();return this._origTrack?this._origTrack.applyConstraints.apply(this._origTrack,e=arguments).then(function(){this._propApplyConstraints&&0!==e.length?(e[0]=this._filterConstraints(e[0]),this._propApplyConstraints.apply(this._propagatingTrack,e).then(function(){t.resolve.apply(t,e)},function(e){t.reject(e)})):t.reject("propagated applyConstraints is undefined")}.bind(this),function(e){t.reject(e)}.bind(this)):t.reject("Track is no longer available"),t.promise()}.bind(this),this._propagatingTrack.stop=function(){if(this._origTrack&&this._origTrack.stop.apply(this._origTrack,arguments),this._propStop)return this._propStop.apply(this._propagatingTrack,arguments)}.bind(this),this._propagatingTrack.getConstraints=function(){if(this._origTrack)return this._origTrack.getConstraints.apply(this._origTrack,arguments)}.bind(this)}e.prototype.cleanup=function(){this._origTrack=T,this._propagatingTrack=T,this._propApplyConstraints=T,this._propStop=T},e.prototype._filterConstraints=function(e){var t=i.Base.Utils.deepMerge({},e);return["deviceId"].forEach(function(e){t.hasOwnProperty(e)&&delete t[e]}),t},i.Base.VideoTrackPropagator=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkErrorCodes={HTTP_REDIRECTION:300,HTTP_MOVED_PERMANENTLY:301,HTTP_FOUND:302,HTTP_SEE_OTHER:303,HTTP_NOT_MODIFIED:304,HTTP_USE_PROXY:305,HTTP_TEMPORARY_REDIRECT:307,HTTP_PERMANENT_REDIRECT:308,HTTP_BAD_REQUEST:400,HTTP_UNAUTHORIZED:401,HTTP_PAYMENT_REQUIRED:402,HTTP_FORBIDDEN:403,HTTP_NOT_FOUND:404,HTTP_METHOD_NOT_ALLOWED:405,HTTP_NOT_ACCEPTABLE:406,HTTP_PROXY_AUTHENTICATION_REQUIRED:407,HTTP_REQUEST_TIMEOUT:408,HTTP_CONFLICT:409,HTTP_GONE:410,HTTP_LENGTH_REQUIRED:411,HTTP_PRECONDITION_FAILED:412,HTTP_PAYLOAD_TO_LARGE:413,HTTP_URI_TOO_LONG:414,HTTP_UNSUPPORTED_MEDIA_TYPE:415,HTTP_RANGE_NOT_SATISFIABLE:416,HTTP_EXPECTATION_FAILED:417,HTTP_MISDIRECTED_REQUEST:421,HTTP_UNPROCESSABLE_ENTITY:422,HTTP_LOCKED:423,HTTP_FAILED_DEPENDENCY:424,HTTP_UPGRADE_REQUIRED:426,HTTP_PRECONDITION_REQUIRED:428,HTTP_TOO_MANY_REQUESTS:429,HTTP_REQUEST_HEADERS_TOO_LARGE:431,HTTP_NGINX_NO_RESPONSE:444,HTTP_UNAVAILABLE_FOR_LEGAL:451,HTTP_NGINX_SSL_CERTIFICATE_ERROR:495,HTTP_NGINX_SSL_CERTIFICATE_REQUIRED:496,HTTP_NGINX_HTTP_TO_HTTPS:444,HTTP_NGINX_CLIENT_CLOSED_REQUEST:499,HTTP_INTERNAL_SERVER_ERROR:500,HTTP_NOT_IMPLEMENTED:501,HTTP_BAD_GATEWAY:502,HTTP_SERVICE_UNAVAILABLE:503,HTTP_GATEWAY_TIMEOUT:504,HTTP_NETWORK_AUTHENTICATION_REQUIRED:511,HTTP_NETWORK_ERROR:400001,WEBSOCKET_CLOSE_NORMAL:1e3,WEBSOCKET_UNAUTHORIZED:1006}}(),function(i){"use strict";function e(e,t,i,a,r){this._retryHelper=e,this._deferred=t,this._status=i,this._responseText=a,this._retryAfter=this._parseRetryAfter(r)}e.prototype={getRequestRetryHelper:function(){return this._retryHelper},getStatus:function(){return this._status},getResponseText:function(){return this._responseText},getDeferred:function(){return this._deferred},getRetryAfter:function(){return this._retryAfter},_parseRetryAfter:function(e){if(i.Base.Utils.isDefined(e)&&null!==e){var t=parseInt(e);return isNaN(t)?new Date(e)-new Date:1e3*t}}},i.Base.NetworkErrorEvent=e}(AvayaClientServices),function(o){"use strict";function e(e,t){this._parentLoggerTag=e,this._blackList=[],this._disableOptionsLogging=!1,this._aggregateBinaryMessages=t||!1,this._binaryBytesSend=[],this._binaryBytesRecv=[]}e.prototype.registerBlackList=function(e){this._blackList=e},e.prototype.logBinaryMessages=function(i){var e=function(){var e,t=this._binaryBytesSend.splice(0);0<t.length&&((e=["PROVIDER:",i.type]).push("Bytes sent in the last second:\n"+t.join()),this._log(o.Base.Logger.debug,e))}.bind(this),t=function(){var e,t=this._binaryBytesRecv.splice(0);0<t.length&&((e=["PROVIDER:",i.type]).push("Bytes recv in the last second:\n"+t.join()),this._log(o.Base.Logger.debug,e))}.bind(this);e(),t()},e.prototype.logSendMessage=function(e,t,i){var a,r,s=["PROVIDER:",i.type],n=t;if(i.type&&i.type!==o.Base.ProviderTypes.WEB_SOCKET_PROVIDER&&(n=E.extend({},i.defaultOptions,t),i=i._getServerURL(n),s.push("URL:",i)),e instanceof ArrayBuffer)this._aggregateBinaryMessages?this._binaryBytesSend.push(e.byteLength):s.push("BYTES SENT:",e.byteLength);else{try{a=this._generateLoggedMessage(e)}catch(e){a="Failed to generate sent message "+e}s.push("\nMESSAGE SENT:",a)}if(!this._disableOptionsLogging){try{r=this._generateLoggedMessage(n)}catch(e){r="Failed to generate sent options "+e}s.push("\nOPTIONS SENT:",r)}this._aggregateBinaryMessages||this._log(o.Base.Logger.debug,s)},e.prototype.logRecvMessage=function(e,t,i){if(e&&e.data instanceof ArrayBuffer){var a,r;this._aggregateBinaryMessages?(r=e.data.byteLength,i&&i.receivedTime&&(r+=":"+(Date.now()-i.receivedTime)),this._binaryBytesRecv.push(r)):(a="BYTE LENGTH RECV: "+e.data.byteLength+". ",i&&(i.receivedTime&&(a+="PrTime: "+(r=(new Date).getTime())+". TimeDiff: "+(r-i.receivedTime)+". "),i.wsConnectionId&&(a+="wsConnId: "+i.wsConnectionId)),this._log(o.Base.Logger.debug,a))}else{var s;try{s=this._generateLoggedMessage(e)}catch(e){s="Failed to generate received message "+e}t&&t.getAllResponseHeaders?(t=t.getAllResponseHeaders(),this._log(o.Base.Logger.debug,"\nMESSAGE RECEIVED:",s,"\nHEADERS RECEIVED:",t)):this._log(o.Base.Logger.debug,"\nMESSAGE RECEIVED:",s)}},e.prototype.disableOptionsLogging=function(e){this._disableOptionsLogging=e},e.prototype._generateLoggedMessage=function(e){var t,i,a;if(e)return"string"==typeof(e=e.data||e)?(a=this._blackList.join("|"),this._isXML(e)?(t=new RegExp("("+a+')="(.*?)"',"mig"),i=e.replace(t,'$1="REMOVED"'),this._blackList.reduce(function(e,t){return-1<i.indexOf("<"+t)&&e.push(t),e},[]).forEach(function(e){e=new RegExp("(?:(<"+e+"(?:[\\s\\S]*?))(\\/>))|(?:(<"+e+"(?:[\\s\\S]*?)>)([\\s\\S]*?)(</"+e+">))","mig");i=i.replace(e,"$1$2$3$5")})):i=this._isJSON(e)?(i=JSON.parse(e),this._removeFromObject(i),JSON.stringify(i,T,2)):(a=new RegExp("((?:"+a+")=)(.*?)([&]|$)","mig"),e.replace(a,"$1REMOVED$3"))):e instanceof Uint8Array?i="Uint8Array["+e.length+"]":"object"==typeof e&&(i=E.extend(!0,{},e),this._removeFromObject(i),i=JSON.stringify(i,T,2)),i},e.prototype._isXML=function(e){return 0===(e=e.trim()).indexOf("<?xml")},e.prototype._isJSON=function(e){return 0===(e=e.trim()).indexOf("{")||0===e.indexOf("[")},e.prototype._removeFromObject=function(a){Object.keys(a).forEach(function(t){if(this._removeFromLogs(t))a[t]="REMOVED";else if("string"!=typeof a[t]&&null!==a[t]&&Object.keys(a[t]).length){var i;this._blackList.forEach(function(e){-1<e.indexOf(t)&&(e=JSON.parse(e),i=e[0])}),i&&Object.values(i).forEach(function(e){a[t].hasOwnProperty(e)&&(a[t][e]="REMOVED")}),this._removeFromObject(a[t])}else if("string"==typeof a[t]&&this._isJSON(a[t]))try{var e=JSON.parse(a[t]);this._removeFromObject(e),a[t]=JSON.stringify(e)}catch(e){}}.bind(this))},e.prototype._removeFromLogs=function(e){return-1<this._blackList.indexOf(e)},e.prototype._log=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this._parentLoggerTag),e.call(T,o.Base.LoggerTags.NETWORK_PROVIDER,t)},o.Base.NetworkLogger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.NetworkProviderEvents={UNAUTHORIZED:"UNAUTHORIZED",AUTHORIZED:"AUTHORIZED",RETRYING:"RETRYING"}}(),function(e){"use strict";function t(e){this._retryCallback=e,this._retryCounter=0}t.prototype={getRetryCallback:function(){return this._retryCallback},getRetryCounter:function(){return this._retryCounter},incrementCounter:function(){this._retryCounter++}},e.Base.NetworkRequestRetryHelper=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProvidersEventTypes={PING:"Ping"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="NetworkError"}e.prototype=Object.create(i.Base.BaseError.prototype),i.Base.NetworkError=e}(AvayaClientServices),function(e){"use strict";function t(){this._listeners={}}t.prototype={on:function(e,t){return"function"!=typeof t||(this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)),this},off:function(e,t){if("function"!=typeof t)return this;if(this._listeners[e]===T)throw new Error("There is no such handler for event with name: "+e+".");t=this._listeners[e].indexOf(t);if(-1===t)throw new Error("There is no such handler for event with name: "+e+".");return this._listeners[e].splice(t,1),this},trigger:function(e,i){e=this._listeners[e];e!==T&&(i=i||[],E.each(e,function(e,t){t.apply(window,i)}))},hasListeners:function(e){e=this._listeners[e];return e!==T&&e.length},_removeListeners:function(){for(var e in this._listeners)if(this._listeners.hasOwnProperty(e))for(var t=this._listeners[e].length-1;0<=t;t--)this.off(e,this._listeners[e][t])}},e.Base.Observable=t}(AvayaClientServices),function(n){"use strict";function e(e){this._servers=[],this._config=e,this._performanceManagerProfile=T,this._callService=T,this._contentSharingService=T,this._screenCapturers=[],this._isMonitoringAdjustment=!1,this._cameraDeallocated=!1,this._lastCpuUsageWarning=T,this._lastLowBandwidthWarning=T,this._lastBandwidthAvailableWarning=T,this._lastPerformanceAdjustment=0,this._isAdjustmentInProgress=!1,this._performanceAdjustmentsReleaseWindow=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.performanceAdjustmentsReleaseWindowDuration")||60,this._interval=4e3,this._isAdjustmentBlocked=!1,this._checkForLowCpuUsage=function(){},this._lastWarnReason=T,this._lastWarnReport=T,this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionReductionInterval")||10,this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME=n.Base.Utils.queryJSONObject(this._config,"mediaConfiguration.voipConfigurationVideo.minVideoResolutionIncrementInterval")||60,this.CONTENT_SHARING_LOW_QUALITY_PROFILE=1,this.CONTENT_SHARING_HIGH_QUALITY_PROFILE=5,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH=400,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH=800}e.prototype.setCallService=function(e){this._callService=e,this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,function(e){this._updatePerformanceManagerProfile(e)}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,function(e){e?this._cameraDeallocated=e:this._cameraDeallocated&&(this._cameraDeallocated=!this._cameraDeallocated,this._startMonitoringAdjustment())}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,function(e,t){this._onPerformanceMonitorAlert(e,t)}.bind(this)),this._callService.on(n.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,function(){this._startMonitoringAdjustment()}.bind(this))},e.prototype.registerScreenCapturer=function(e){this._screenCapturers.push(e),e.setPerformanceManagerProfile(this._performanceManagerProfile),e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype.setContentSharingService=function(e){this._contentSharingService=e,this._contentSharingService.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype.registerServer=function(e){this._servers.push(e),e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),e._onStart=function(){}.bind(this),e._onStop=function(){this._lastBandwidthAvailableWarning=0,this._lastLowBandwidthWarning=0,this._servers.splice(this._servers.indexOf(e),1),this._increaseContentSharingQuality(),this._startMonitoringAdjustment()}.bind(this)},e.prototype.registerPerformanceSource=function(e){e.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this)},e.prototype._stepDownVideoResolution=function(e,t){var i,a,r=1e3*this.STEP_DOWN_VIDEO_RESOLUTION_WAIT_TIME,s=this._callService.getActiveCall();n.Base.Utils.isDefined(s)?this._callService.hasVideoTracks(s)?this._isAdjusmentBlocked(r)||(this._isAdjustmentInProgress=!0,a=this._callService.getVideoSendResolution(s),r=(i=this._callService._nextLowerVideoResolution(s,a)).getHeight()<a.getHeight(),a=360<=i.getHeight(),r&&a?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Lowering video resolution to "+i+". Reason: "+e),this._setVideoResolution(s,i).then(function(){this._startMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Lowered video resolution: ",i)}.bind(this),function(e){n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to lower video resolution: ",e)}.bind(this))):(t&&this._decreaseContentSharingQuality(),this._isAdjustmentInProgress=!1)):t&&this._decreaseContentSharingQuality():(t&&this._decreaseContentSharingQuality(),this._stopMonitoringAdjustment())},e.prototype._stepUpVideoResolution=function(){var e,t,i,a=1e3*this.STEP_UP_VIDEO_RESOLUTION_WAIT_TIME,r=this._callService.getActiveCall();n.Base.Utils.isDefined(r)?this._callService.hasVideoTracks(r)&&(this._isAdjusmentBlocked(a)||(this._isAdjustmentInProgress=!0,i=this._callService.getVideoSendResolution(r),e=this._getPreferredResolution(r)||this._callService.getVideoResolution(r),a=(t=this._callService._nextHigherVideoResolution(r,i)).getHeight()>i.getHeight(),i=t.getHeight()<=e.getHeight(),a&&i?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Increasing video resolution to "+t),this._setVideoResolution(r,t).then(function(){this._lastCpuUsageWarning=Date.now(),t===e&&this._stopMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Video resolution increased to: ",t)}.bind(this),function(e){this._stopMonitoringAdjustment(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to increase video resolution: ",e)}.bind(this))):this._isAdjustmentInProgress=!1)):this._stopMonitoringAdjustment()},e.prototype._getPreferredResolution=function(e){try{var t=this._callService.getServerSentPreferredResolution(e),i=n.Providers.Call.CPUtils.getClientPreferredResolution(e,this._callService.getVideoResolutionsTable(e));return null===t||null===i?t||i||null:i.getHeight()<t.getHeight()?i:t}catch(e){return null}},e.prototype._increaseContentSharingQuality=function(){this._setContentSharingQuality(this.CONTENT_SHARING_HIGH_QUALITY_PROFILE,this.CONTENT_SHARING_HIGH_QUALITY_BANDWIDTH)},e.prototype._decreaseContentSharingQuality=function(){this._contentSharingService&&this._contentSharingService.isContentSharingActive()&&this._setContentSharingQuality(this.CONTENT_SHARING_LOW_QUALITY_PROFILE,this.CONTENT_SHARING_LOW_QUALITY_BANDWIDTH)},e.prototype._setContentSharingQuality=function(e,t){this._contentSharingService.getMaxUploadSpeed()!==t?(n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Setting content sharing quality to ("+e+", "+t+"kbps)"),this._contentSharingService.setImageQuality(e),this._contentSharingService.setMaxUploadSpeed(t),this._lastPerformanceAdjustment=Date.now()):n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Content sharing quality remains unchanged, current max upload speed:"+t+"kbps")},e.prototype._setVideoResolution=function(e,t){return this._callService.setVideoSendResolution(e,t,!0).then(function(){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),this._startMonitoringAdjustment(),n.Base.Logger.info(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Setting video resolution to: ",t)}.bind(this),function(e){this._isAdjustmentInProgress=!1,this._lastPerformanceAdjustment=Date.now(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Failed to set video resolution: ",e)}.bind(this))},e.prototype._throttleAdjustment=function(e){this._isAdjustmentBlocked||(this._isAdjustmentBlocked=!0,e.apply(this,arguments),setTimeout(function(){this._isAdjustmentBlocked=!1}.bind(this),1e3))},e.prototype._isAdjusmentBlocked=function(e){e=Date.now()-this._lastPerformanceAdjustment<e;return this._isAdjustmentInProgress||e},e.prototype._startMonitoringAdjustment=function(){this._isMonitoringAdjustment||(this._isMonitoringAdjustment=!0,this._lastCpuUsageWarning=Date.now(),this._lastLowBandwidthWarning=Date.now(),this._lastBandwidthAvailableWarning=Date.now(),this._lastWarnReason="Monitoring starting",this._lastWarnReport=Date.now(),this._checkForLowCpuUsage=function(){var e=(Date.now()-this._lastLowBandwidthWarning)/1e3,t=(Date.now()-this._lastCpuUsageWarning)/1e3,i=(Date.now()-this._lastBandwidthAvailableWarning)/1e3;t>this._performanceAdjustmentsReleaseWindow&&e>this._performanceAdjustmentsReleaseWindow&&i>this._performanceAdjustmentsReleaseWindow?this._throttleAdjustment(this._stepUpVideoResolution):(Date.now()-this._lastWarnReport)/1e3>this._performanceAdjustmentsReleaseWindow&&(this._lastWarnReport=Date.now(),n.Base.Logger.debug(n.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"Resolution not increased because: "+this._lastWarnReason))},this._setInterval=setInterval(this._checkForLowCpuUsage.bind(this),this._interval))},e.prototype._stopMonitoringAdjustment=function(){this._isMonitoringAdjustment&&(this._isMonitoringAdjustment=!1,this._lastCpuUsageWarning=T,this._lastLowBandwidthWarning=T,this._lastBandwidthAvailableWarning=T,this._lastWarnReason=T,clearInterval(this._setInterval))},e.prototype._onPerformanceMonitorAlert=function(e,t){switch(e){case n.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED:this._throttleAdjustment(this._stepDownVideoResolution.bind(this,t,!0));break;case n.Base.PerformanceAlertType.CPU_USAGE_WARNING:this._lastCpuUsageWarning=Date.now(),this._lastWarnReason=t;break;case n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD:this._lastLowBandwidthWarning=Date.now(),this._throttleAdjustment(this._stepDownVideoResolution.bind(this,t,!1));break;case n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING:this._lastBandwidthAvailableWarning=Date.now(),this._lastWarnReason=t}},e.prototype._updatePerformanceManagerProfile=function(e){this._performanceManagerProfile=n.Providers.ContentSharing.PerformanceManagerProfiles[e]},n.Base.CallPerformanceManager=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.PerformanceAlertType={CPU_USAGE_OVERLOADED:"CPU_USAGE_OVERLOADED",CPU_USAGE_WARNING:"CPU_USAGE_WARNING",BANDWIDTH_UNAVAILABLE_OVERLOAD:"BANDWIDTH_UNAVAILABLE_OVERLOAD",BANDWIDTH_UNAVAILABLE_WARNING:"BANDWIDTH_UNAVAILABLE_WARNING"}}(),function(e){"use strict";function t(){}t.prototype.onPerformanceMonitorAlert=function(e,t){},e.Base.PerformanceSource=t}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={state:function(){},always:function(e){},done:function(e){},fail:function(e){},progress:function(e){},then:function(e,t,i){}},e.Base.Promise=t}(AvayaClientServices),function(a){"use strict";function e(){this.messagingProviders=[],this.conferenceProviders=[],this.callProviders=[],this.collaborationProviders=[],this._ammProviderFactory={},this._ammProvider={},this._wcsProviderFactory={},this._wcsProvider={},this._contactsProviders=[],this._directorySearchProviders=[],this._acsProviderFactory={},this._acsContactsProvider={},this._acsDirectorySearchProvider={},this._presenceProviders=[],this._csgProviderFactory={},this._csgPresenceProvider={},this._scopiaProvider={},this._sgCallProvider={},this._scopiaConferenceProviderFactory={},this._rtcConnectionProviderFactory={},this._remoteLoggerProvider=T}e.prototype={getMessagingProviders:function(e){if(0<this.messagingProviders.length)return this.messagingProviders;e=this._getAMMProvider(this._getAMMProviderConfiguration(e));return E.isEmptyObject(e)||this.messagingProviders.push(e),this.messagingProviders},getContactsProviders:function(e){var t;return 0===this._contactsProviders.length&&(t=this._getACSContactsProvider(),E.isEmptyObject(t)||this._contactsProviders.push(t)),this._contactsProviders},_getACSContactsProvider:function(){return E.isEmptyObject(this._acsContactsProvider)&&(E.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new a.Providers.ACS.ACSProviderFactory),this._acsContactsProvider=this._acsProviderFactory.getACSContactsProvider()),this._acsContactsProvider},getDirectorySearchProviders:function(e){var t;return 0===this._directorySearchProviders.length&&(t=this._getACSDirectorySearchProvider(),E.isEmptyObject(t)||this._directorySearchProviders.push(t)),this._directorySearchProviders},_getACSDirectorySearchProvider:function(){return E.isEmptyObject(this._acsDirectorySearchProvider)&&(E.isEmptyObject(this._acsProviderFactory)&&(this._acsProviderFactory=new a.Providers.ACS.ACSProviderFactory),this._acsDirectorySearchProvider=this._acsProviderFactory.getACSDirectorySearchProvider()),this._acsDirectorySearchProvider},getPresenceProviders:function(e){return 0===this._presenceProviders.length&&(e=this._getCSGPresenceProvider(e),E.isEmptyObject(e)||this._presenceProviders.push(e)),this._presenceProviders},_getCSGPresenceProvider:function(e){return E.isEmptyObject(this._csgPresenceProvider)&&(this._csgPresenceProvider=this._getCSGProviderFactory().getCSGPresenceProvider(e)),this._csgPresenceProvider},getConferenceProviders:function(e){if(0<this.conferenceProviders.length)return this.conferenceProviders;e=this._getScopiaConferenceProvider(e.uccpConfiguration);return E.isEmptyObject(e)||this.conferenceProviders.push(e),this.conferenceProviders},getCallProviders:function(e,t,i){return 0<this.callProviders.length||e.sgConfiguration!==T&&!a.Base.Utils.isBool(e.sgConfiguration.enabled)||(i=this._getSGCallProvider(e.sgConfiguration,t,i),E.isEmptyObject(i)||this.callProviders.push(i)),this.callProviders},getVoiceMessagingProvider:function(e){var t=e.networkProviderConfiguration.restConfig,e=t.isSecure?a.Base.Utils.isDefined(t.port)?t.port:"443":a.Base.Utils.isDefined(t.port)?t.port:"80",e=t.hostName+":"+e;return this._getCSGProviderFactory().getCSGCallsProvider(e)},_getAMMProvider:function(e){return E.isEmptyObject(this._ammProvider)&&(E.isEmptyObject(this._ammProviderFactory)&&(this._ammProviderFactory=new a.Providers.AMM.AMMProviderFactory),this._ammProvider=this._ammProviderFactory.getAMMProvider(e)),this._ammProvider},_getWCSProvider:function(e){return E.isEmptyObject(this._wcsProvider)&&(E.isEmptyObject(this._wcsProviderFactory)&&(this._wcsProviderFactory=new a.Providers.WCS.WCSProviderFactory),this._wcsProvider=this._wcsProviderFactory.getWCSProvider(e)),this._wcsProvider},_getWCSProviderConfiguration:function(e){return e.wcsConfiguration},_getScopiaConferenceProvider:function(e){return E.isEmptyObject(this._scopiaProvider)&&(E.isEmptyObject(this._scopiaConferenceProviderFactory)&&(this._scopiaConferenceProviderFactory=new a.Providers.Scopia.ScopiaConferenceProviderFactory),this._scopiaProvider=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(e)),this._scopiaProvider},_getSGCallProvider:function(e,t,i){return E.isEmptyObject(this._sgCallProvider)&&(this._sgCallProvider=new a.Providers.Call.CallProvider(this._getCSGProviderFactory(),t,i,this._getRTCConnectionProviderFactory())),this._sgCallProvider},_getCSGProviderFactory:function(){return E.isEmptyObject(this._csgProviderFactory)&&(this._csgProviderFactory=new a.Providers.CallServiceGateway.CallServiceGatewayProviderFactory),this._csgProviderFactory},_getRTCConnectionProviderFactory:function(){return E.isEmptyObject(this._rtcConnectionProviderFactory)&&(this._rtcConnectionProviderFactory=new a.Base.RTCConnectionProviderFactory),this._rtcConnectionProviderFactory},_getAMMProviderConfiguration:function(e){return e.ammConfiguration},getCollaborationProviders:function(e){if(0<this.collaborationProviders.length)return this.collaborationProviders;e=this._getWCSProvider(this._getWCSProviderConfiguration(e));return E.isEmptyObject(e)||this.collaborationProviders.push(e),this.collaborationProviders},createCollaborationProviders:function(e){return[(new a.Providers.WCS.WCSProviderFactory).getWCSProvider(this._getWCSProviderConfiguration(e))]},getRemoteLoggerProvider:function(){return a.Base.Utils.isUndefined(this._remoteLoggerProvider)&&(this._remoteLoggerProvider=new a.Providers.RemoteLogger.RemoteLoggerProvider),this._remoteLoggerProvider}},a.Base.ProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.ProviderTypes={REST_PROVIDER:"RestProvider",WEB_SOCKET_PROVIDER:"WebSocketProvider",SSE_PROVIDER:"SSEProvider",WCS_COMET_PROVIDER:"WCSCometProvider",UCCP_LONG_POLLING_PROVIDER:"UCCPLongPollingProvider"}}(),function(e){"use strict";function t(e,t,i,a){this._width=i,this._height=a,this._x=e,this._y=t}t.prototype={getX:function(){return this._x},getY:function(){return this._y},getWidth:function(){return this._width},getHeight:function(){return this._height},toString:function(){return"x:"+this._x+" y:"+this._y+" width:"+this._width+" height:"+this._height}},e.Base.Rect=t}(AvayaClientServices),function(_){"use strict";var t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection,h=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.msRTCSessionDescription,a=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})) \d+ typ .*/,r=/candidate:\w{1,32} \d{1,5} (tcp|TCP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/,s=/candidate:\w{1,32} \d{1,5} (udp|UDP) \d{1,10} (?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4}) \d+ typ .*/;function e(e,t,i,a,r){_.Base.Observable.call(this),this.isAvailable()&&(this._rtcConfig=e,this._dtmfSender=T,this._iceNegotiatedCallback=T,this._updateSdpCallback=T,this._sdpErrorCallback=T,this._iceGatheringTimeoutId=T,this._relayCandidatesTimeoutId=T,this._relayIceCandidateCountTimeoutId=T,this._waitForIceGatheringTimeoutId=T,this._localMediaCount=0,this._mediaStreams=[],this._iceCandidates=[],this._iceRelayCandidatesCounter={},this._hasGatheredIceCandidates=!1,this._isApplyingVideoConstraints=!1,this._lookupRelayCandidates=!!e&&!!e.iceTransportPolicy&&"relay"===e.iceTransportPolicy,this._RELAY_CANDIDATES_TIMEOUT=t,this._LAST_RELAY_CANDIDATE_TIMEOUT=i,this._ICE_GATHERING_TIMEOUT=i,this._ICE_RESTART_INTERVAL=a,this._MAX_ICE_RECOVERY_TIME=r,this._statsParser=new _.Base.AbstractRTCStatsReportParser,this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks=E.Callbacks())}(e.prototype=Object.create(_.Base.Observable.prototype)).isAvailable=function(){return t&&h},e.prototype.addStream=function(e){_.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig)},e.prototype.removeStream=function(e){},e.prototype.createPeerConnection=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Closing the peer connection and re-creating it with new config.",e),this.close(),_.Base.Utils.isDefined(e)&&!E.isEmptyObject(e)||(e=null),this._pc=new t(e)},e.prototype.updatePeerConfiguration=function(e,t){this._lookupRelayCandidates=!!e&&!!e.iceTransportPolicy&&"relay"===e.iceTransportPolicy,this._rtcConfig=e,t=t||!1,(this._lookupRelayCandidates||t)&&(this._iceCandidates=[],this._hasGatheredIceCandidates=!1)},e.prototype.updatePeerConnection=function(e,t){if(this.isRTCRtpSenderSupported()){var a=[],r=!1;this._pc.getTransceivers().forEach(function(e){var t,i=e.sender;i.track&&(i.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||i.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=i.track,e=e.currentDirection,t.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED||e!==_.Services.Call.MediaDirection.INACTIVE))&&(i.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(r=!0),a.push(i.track),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Found track to propagate to the new peer connection.",i.track.id,i.track.type,i.track.readyState))}.bind(this)),this.createPeerConnection(e);var i=new MediaStream;t&&!r&&this.addTransceiverIfNeeded(_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,_.Services.Call.MediaDirection.SEND_RECV);for(var s=0;s<a.length;++s)this.addTrack(a[s],i)}else{t=this._pc.getLocalStreams();this.createPeerConnection(e),t.forEach(function(e){this.addStream(e)}.bind(this))}},e.prototype._haveLiveTrack=function(e){return null!==e.track&&e.track!==T&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE},e.prototype.rollbackLocalOfferState=function(){},e.prototype.createOffer=function(r,s,n,o,c,l,e,t){var d=0;e=!!_.Base.Utils.isDefined(e)&&e,_.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(d=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._pc.onnegotiationneeded=this._oniceNegotiationNeeded.bind(this),this._lookupRelayCandidates?this.createRelayOffer(r,s,n,o,this._rtcConfig,d,c,l,t):d&&this._rtcConfig._turnOfferType&&"hostOnly"===this._rtcConfig._turnOfferType?this.createHostOnlyOffer(r,s,n,o,this._rtcConfig,d,c,l,e,t):(!d||this._hasGatheredIceCandidates||this.hasICECandidates()||(this._rtcConfig._turnOfferType&&"relayOnly"===this._rtcConfig._turnOfferType&&(this._rtcConfig.iceTransportPolicy="relay"),this.updatePeerConnection(this._rtcConfig,t)),this._localMediaCount=this.getLocalMediaCount(),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),t=this._createOfferOptions(o),c&&(t.iceRestart=c),this._pc.createOffer(t).then(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp;"function"==typeof n&&(i=n(i));var a=function(){this._iceNegotiatedCallback=r,this._updateSdpCallback=n,this._sdpErrorCallback=s;var e=Math.max(d,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),e)},t={type:t,sdp:i};this._pc.setLocalDescription(new h(t)).then(function(){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),function(){a.call(this),this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}.call(this)}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),c&&Date.now()-l<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,c,l)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),c&&Date.now()-l<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,c,l)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this)))},e.prototype.createRelayOffer=function(a,r,s,n,o,c,l,d,e){var t,i,C,u;0===o.iceServers[0].urls.length||c<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?_.Base.Logger.info("Creating Relay Offer using "+o.iceServers[0].urls[0]):(t=E.extend(!0,{},o),i=t.iceServers[0].urls.shift(),t.iceServers[0].urls=[i],this.updatePeerConnection(t,e),_.Base.Logger.info("Creating Relay Offer using "+i)),u=function(){this._iceNegotiatedCallback=a,this._updateSdpCallback=s,this._sdpErrorCallback=r,C=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),c);var e=0===o.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(c-=e,o.iceServers[0].urls.shift(),_.Base.Logger.info("No relay candidates found  with "+i+". Remaining turn servers to try: "+o.iceServers[0].urls.length),this.createRelayOffer(a,r,s,n,o,c,l,d))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),e)},this._pc.onicecandidate=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),c-=Date.now()-C,o.iceServers[0].urls.shift(),_.Base.Logger.info("No relay candidates found  with "+i+". Remaining turn servers to try: "+o.iceServers[0].urls.length),this.createRelayOffer(a,r,s,n,o,c,l,d))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),e=this._createOfferOptions(n),l&&(e.iceRestart=l),this._pc.createOffer(e).then(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp,t={type:t,sdp:i="function"==typeof s?s(i):i};this._pc.setLocalDescription(new h(t)).then(function(){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),function(){u.call(this),this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}.call(this)}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,r,s,n,o,c,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):r(e)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create relay offer for ICE media recovery"),this.createRelayOffer(a,r,s,n,o,c,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):r(e)}.bind(this),e))},e.prototype._isHostOnlyUdpCandidate=function(t,e){var i=!0;try{(a.test(t)||r.test(t)||s.test(t)&&!e)&&(i=!1)}catch(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to parse ICE candidate: ",t)}return i},e.prototype.createHostOnlyOffer=function(r,s,n,o,c,e,l,d,C,t){_.Base.Logger.info("Creating host only Offer"),this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection({},t),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._isHostOnlyUdpCandidate(e.candidate.candidate,C)&&this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length||this._hasGatheredIceCandidates?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),_.Base.Logger.info("No host only candidates found. Trying relay only servers: "+c.iceServers[0].urls.length),c._turnOfferType="relayOnly",this.createOffer(r,s,n,o,l,d,C))}.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this);t=this._createOfferOptions(o);l&&(t.iceRestart=l),this._pc.createOffer(t).then(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createOffer");var t=e.type,i=e.sdp;"function"==typeof n&&(i=n(i));var a=function(){this._iceNegotiatedCallback=r,this._updateSdpCallback=n,this._sdpErrorCallback=s,this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(_.Base.Logger.info("No host only candidates found. Trying relay only servers: "+c.iceServers[0].urls.length),c._turnOfferType="relayOnly",this.createOffer(r,s,n,o,l,d,C))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),this._ICE_GATHERING_TIMEOUT)},t={type:t,sdp:i};this._pc.setLocalDescription(new h(t)).then(function(){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createOffer.setLocalDescription"),function(){a.call(this),this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}.call(this)}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting local description for offer: "+e),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Problem SDP:\n"+i),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error creating offer: "+e),l&&Date.now()-d<this._MAX_ICE_RECOVERY_TIME?setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Retrying create offer for ICE media recovery"),this.createOffer(r,s,n,o,l,d)}.bind(this),this._ICE_RESTART_INTERVAL):s(e)}.bind(this))},e.prototype.receiveAnswer=function(e,t,i){this._pc.setRemoteDescription(new h({type:"answer",sdp:e})).then(t).catch(i)},e.prototype.createAnswer=function(s,n,o,c){var t,l=0;_.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this._rtcConfig.iceServers&&0!==this._rtcConfig.iceServers.length&&0!==this._rtcConfig.iceServers[0].urls.length&&(l=this._lookupRelayCandidates?(this._rtcConfig.iceServers[0].urls.length-1)*this._RELAY_CANDIDATES_TIMEOUT+this._LAST_RELAY_CANDIDATE_TIMEOUT:this._LAST_RELAY_CANDIDATE_TIMEOUT),this._pc.onnegotiationneeded=this._oniceNegotiationNeeded.bind(this),this._lookupRelayCandidates?this.createRelayAnswer(s,n,o,c,this._rtcConfig,l):(["SCM-W09","RVL-AL09"].forEach(function(e){navigator.userAgent.includes(e)&&(s=_.Base.SDPUtil.updateProfileLevelId(s,"42E01F"))}),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createAnswer offer SDP:\n"+s),!l||this._hasGatheredIceCandidates||this.hasICECandidates()||this.updatePeerConnection(this._rtcConfig),this._localMediaCount=this.getLocalMediaCount(),(t=function(e,t){return this._pc.setRemoteDescription(new h({type:e,sdp:t})).then(function(){this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this),this._pc.createAnswer().then(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var t=e.type,i=e.sdp,a=_.Base.SDPUtil.getProfileLevelId(s),e=_.Base.SDPUtil.getProfileLevelId(i);a&&e&&(a=a.toUpperCase(),e=e.toUpperCase(),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",a),a===e||"424028"!==a&&"42401F"!==a||(i=_.Base.SDPUtil.updateProfileLevelId(i,a))),"function"==typeof c&&(i=c(i));var r=function(){this._iceNegotiatedCallback=n,this._updateSdpCallback=c,this._sdpErrorCallback=o;var e=Math.max(l,this._ICE_GATHERING_TIMEOUT);this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),e)};this._pc.setLocalDescription(new h({type:t,sdp:i})).then(function(){!function(){r.call(this),this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}.call(this)}.bind(this),function(e){this._answerError(e,o)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+e),o(e)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e)}.bind(this))}.bind(this))("offer",s).catch(function(e){"42401F"===_.Base.SDPUtil.getProfileLevelId(s)?(_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Trying to set profile-level-id to 42E01F"),s=_.Base.SDPUtil.updateProfileLevelId(s,"42E01F"),t("offer",s).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e)})):(_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),o(e))}))},e.prototype.createRelayAnswer=function(s,i,n,o,a,c){var e,l;_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"createRelayAnswer offer SDP:\n"+s),0===a.iceServers[0].urls.length||c<1?this._handleIceGatheringTimeoutError():(0!==this._iceCandidates.length||this._hasGatheredIceCandidates?_.Base.Logger.info("Creating Relay Answer using "+a.iceServers[0].urls[0]):(e=E.extend(!0,{},a),l=e.iceServers[0].urls.shift(),e.iceServers[0].urls=[l],this.updatePeerConnection(e),_.Base.Logger.info("Creating Relay Answer using "+l)),this._pc.setRemoteDescription(new h({type:"offer",sdp:s})).then(function(){var t,r=function(){this._iceNegotiatedCallback=i,this._updateSdpCallback=o,this._sdpErrorCallback=n,t=Date.now(),this._iceGatheringTimeoutId=setTimeout(this._iceGatheringTimeoutHandler.bind(this),c);var e=0===a.iceServers[0].urls.length?this._LAST_RELAY_CANDIDATE_TIMEOUT:this._RELAY_CANDIDATES_TIMEOUT;this._relayCandidatesTimeoutId=setTimeout(function(){0===this._iceCandidates.length?(clearTimeout(this._iceGatheringTimeoutId),this._hasGatheredIceCandidates?this._sendUpdatedSdp():(c-=e,a.iceServers[0].urls.shift(),_.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+a.iceServers[0].urls.length),this.createRelayAnswer(s,i,n,o,a,c))):this._relayCandidatesTimeoutHandler.call(this)}.bind(this),e)};this._pc.onicecandidate=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?this._iceCandidates.push(e.candidate.candidate):0<this._iceCandidates.length?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):this._hasGatheredIceCandidates||(clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._iceGatheringTimeoutId),c-=Date.now()-t,a.iceServers[0].urls.shift(),_.Base.Logger.info("No relay candidates found  with "+l+". Remaining turn servers to try: "+a.iceServers[0].urls.length),this.createRelayAnswer(s,i,n,o,a,c))}.bind(this),this._pc.onicegatheringstatechange=this._oniceGatheringStateChange.bind(this),this._pc.oniceconnectionstatechange=this._oniceConnectionStateChange.bind(this,i),this._pc.createAnswer().then(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"after createAnswer");var t=e.type,i=e.sdp,a=_.Base.SDPUtil.getProfileLevelId(s),e=_.Base.SDPUtil.getProfileLevelId(i);a&&e&&(a=a.toUpperCase(),e=e.toUpperCase(),_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"offer profile-level-id; ",a),a===e||"424028"!==a&&"42401F"!==a||(i=_.Base.SDPUtil.updateProfileLevelId(i,a))),"function"==typeof o&&(i=o(i)),this._pc.setLocalDescription(new h({type:t,sdp:i})).then(function(){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"After createAnswer.setLocalDescription"),function(){r.call(this),this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED&&this._pc.iceConnectionState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED||this._pc.iceGatheringState!==_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_COMPLETE||(this._waitForIceGatheringTimeoutId=setTimeout(function(){this._sendUpdatedSdp()}.bind(this),1e3))}.call(this)}.bind(this),function(e){this._answerError(e,n)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while creating answer for offer: "+e),n(e)}.bind(this))}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error setting remote description while creating answer: "+e),n(e)}.bind(this)))},e.prototype._answerError=function(e,t){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+e),t(e)},e.prototype._iceGatheringTimeoutHandler=function(){var e;clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayCandidatesTimeoutId=T,this._relayIceCandidateCountTimeoutId=T,this._iceGatheringTimeoutId=T,this._pc.onicecandidate=function(e){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),_.Base.Utils.isDefined(this._pc)&&(_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),0===this._iceCandidates.length?this._handleIceGatheringTimeoutError():(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering.  Using current SDP"),_.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T))},e.prototype._handleIceGatheringTimeoutError=function(){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice candidate gathering. No candidates found"),_.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=T),_.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T),this._throwSdpError(),this._iceNegotiatedCallback=T,this._updateSdpCallback=T,this._sdpErrorCallback=T},e.prototype._throwSdpError=function(){this._sdpErrorCallback({errorCode:_.Services.Call.CallError.TRANSPORT_ERROR,protocolType:_.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},e.prototype._relayCandidatesTimeoutHandler=function(){var e;_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Timed out ice host only or relay candidates gathering: "+this._iceCandidates.length),this._relayCandidatesTimeoutId=T,0<this._iceCandidates.length&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T,this._pc.onicecandidate=function(e){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._pc.oniceconnectionstatechange=function(){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring oniceConnectionStateChange"),_.Base.Utils.isDefined(this._pc)&&(_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER," ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]))}.bind(this),_.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T))},e.prototype.close=function(){this._pc&&((_.Base.Utils.isDefined(this._pc.connectionState)?this._pc.connnectionState:this._pc.signalingState)!==_.Base.AbstractRTCConnectionProvider.Constants.RTC_PEER_CONNECTION_STATE_CLOSED&&this._pc.close(),this._mediaStreams=[],clearTimeout(this._iceGatheringTimeoutId),clearTimeout(this._relayCandidatesTimeoutId),clearTimeout(this._relayIceCandidateCountTimeoutId),clearTimeout(this._waitForIceGatheringTimeoutId))},e.prototype.hasICECandidates=function(){return 0<this._iceCandidates.length},e.prototype.onAddStream=function(e){},e.prototype.onAddRemoteTrack=function(e){},e.prototype.onRemoveRemoteTrack=function(e){},e.prototype.onAddTrackInternal=function(e){e=e.track;e&&this.onAddRemoteTrack&&this.onAddRemoteTrack(e)},e.prototype.onRemoveTrackInternal=function(e){e=e.track;e&&this.onRemoveRemoteTrack&&this.onRemoveRemoteTrack(e)},e.prototype.onTrackInternal=function(t){var e,i;this.onAddStream&&(0<t.streams.length?(e=this._mediaStreams.findIndex(function(e){return e.id===t.streams[0].id}),(i=t.streams[0])&&(i.onaddtrack=this.onAddTrackInternal.bind(this),i.onremovetrack=this.onRemoveTrackInternal.bind(this),-1===e?(this._mediaStreams.push(i),this.onAddStream(i)):this._mediaStreams[e].active||(this._mediaStreams[e]=i,this.onAddStream(i)))):t.track&&t.track.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&this.onAddRemoteTrack&&(0<(i=this._pc.getRemoteStreams()).length&&(i[0].addTrack(t.track),i[0].onaddtrack=this.onAddTrackInternal.bind(this),i[0].onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddRemoteTrack(t.track))))},e.prototype._getDTMFSender=function(){},e.prototype._sendUpdatedSdp=function(){var e;_.Base.Utils.isDefined(this._iceNegotiatedCallback)&&(e="function"==typeof this._updateSdpCallback?(e=this._updateSdpCallback(this._pc.localDescription.sdp),{type:this._pc.localDescription.type,sdp:e}):{type:this._pc.localDescription.type,sdp:this._pc.localDescription.sdp},_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"local SDP:\n"+e.sdp),this._iceNegotiatedCallback(e),this._iceNegotiatedCallback=T,this._updateSdpCallback=T),_.Base.Utils.isDefined(this._relayCandidatesTimeoutId)&&(clearTimeout(this._relayCandidatesTimeoutId),this._relayCandidatesTimeoutId=T),_.Base.Utils.isDefined(this._relayIceCandidateCountTimeoutId)&&(clearTimeout(this._relayIceCandidateCountTimeoutId),this._relayIceCandidateCountTimeoutId=T),_.Base.Utils.isDefined(this._iceGatheringTimeoutId)&&(clearTimeout(this._iceGatheringTimeoutId),this._iceGatheringTimeoutId=T)},e.prototype._onIceCandidate=function(e){var t,i;_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"onIceCandidate "+this._pc.iceGatheringState+" Candidate: "+(null===e.candidate?null:e.candidate.candidate)),null!==e.candidate?(this._iceCandidates.push(e.candidate.candidate),this._lookupRelayCandidates||-1===e.candidate.candidate.indexOf("relay")||(!(t=this.parseIceRelayCandidate(e.candidate.candidate,e.candidate))||"1"!==t.component&&"rtp"!==t.component||(i=0,e=t.networkId||"0",e=t.foundation+":"+e,this._iceRelayCandidatesCounter.hasOwnProperty(e)&&(i=this._iceRelayCandidatesCounter[e]),this._iceRelayCandidatesCounter[e]=++i,i===this._localMediaCount&&_.Base.Utils.isUndefined(this._relayIceCandidateCountTimeoutId)&&(_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Short circuiting relay candidates"),this._relayIceCandidateCountTimeoutId=setTimeout(function(){this._pc.onicecandidate=function(e){_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Already timed out.  Ignoring Candidate: "+(null===e.candidate?null:e.candidate.candidate))},this._sendUpdatedSdp()}.bind(this),2e3))))):0<this._iceCandidates.length?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"NO more ICE candidate. GatheringState: "+this._pc.iceGatheringState),this._sendUpdatedSdp()):(i=this._hasGatheredIceCandidates?1e3:0,setTimeout(function(){0===this._iceCandidates.length&&(this._hasGatheredIceCandidates?this._sendUpdatedSdp():this._handleIceGatheringTimeoutError())}.bind(this),i))},e.prototype._oniceGatheringStateChange=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> oniceGatheringStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this._pc.iceGatheringState===_.Base.AbstractRTCConnectionProvider.Constants.ICE_GATHERING_STATE_GATHERING&&(clearTimeout(this._waitForIceGatheringTimeoutId),this._waitForIceGatheringTimeoutId=T,this._hasGatheredIceCandidates||(this._hasGatheredIceCandidates=0!==this._iceCandidates.length),this._iceCandidates=[])},e.prototype._oniceConnectionStateChange=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< oniceConnectionStateChange ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]"),this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[this._pc.iceConnectionState]),this._pc.iceConnectionState===_.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CLOSED&&(this._iceCandidates=[],this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[]))},e.prototype._oniceNegotiationNeeded=function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< oniceNegotiationNeeded ["+this._pc.iceConnectionState+", "+this._pc.iceGatheringState+"]")},e.prototype.stopAllStreams=function(){},e.prototype.enableAllStreams=function(){this.enableLocalStreams(),this.enableRemoteStreams()},e.prototype.enableRemoteStreams=function(){this._enableDisableRemoteStreams(!0)},e.prototype.disableRemoteStreams=function(){this._enableDisableRemoteStreams(!1)},e.prototype._enableDisableRemoteStreams=function(e){},e.prototype.enableLocalStreams=function(){this._enableDisableLocalStreams(!0)},e.prototype.disableLocalStreams=function(){this._enableDisableLocalStreams(!1)},e.prototype._enableDisableLocalStreams=function(e){},e.prototype.enableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!0)},e.prototype.disableLocalAudioStreams=function(){this._enableDisableLocalAudioStreams(!1)},e.prototype._enableDisableLocalAudioStreams=function(e){},e.prototype.enableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!0)},e.prototype.disableLocalVideoStreams=function(){this._enableDisableLocalVideoStreams(!1)},e.prototype._enableDisableLocalVideoStreams=function(e){},e.prototype.enableRemoteAudioStream=function(){this._enableDisableRemoteAudioStream(!0)},e.prototype.enableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!0)},e.prototype.disableRemoteVideoStreams=function(){this._enableDisableRemoteVideoStreams(!1)},e.prototype._enableDisableRemoteAudioStream=function(e){},e.prototype._enableDisableRemoteVideoStreams=function(e){},e.prototype.limitOutgoingVideoBitRate=function(i){this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(e){var t;e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Limiting outgoing video bitrate "+e.track.id+" to "+i),(t=e.getParameters()).encodings.forEach(function(e){e.maxBitRate=1024*i}),e.setParameters(t).catch(function(e){_.Base.Logger.warn("Failed to limit outgoing video bitrate",e)}))})},e.prototype.enableRemoteVideoTrack=function(t,i){t.getVideoTracks().forEach(function(e){e.id===i.id?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Enabling video track: "+e.id+" for "+t.id),e.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(t.removeTrack(e),t.addTrack(i)):e.enabled=!0):(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Disabling old video track: "+e.id+" for "+t.id),e.enabled=!1,e.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.removeTrack(e))}.bind(this))},e.prototype.sendDTMF=function(e){var t=this._getDTMFSender();return!!_.Base.Utils.isDefined(t)&&(t.insertDTMF(e),!0)},e.prototype.isPlaying=function(e){return!!(0<e.currentTime&&!e.paused&&!e.ended&&2<e.readyState)},e.prototype.stopStream=function(e){_.Base.Utils.isDefined(e)&&null!==e&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping stream "+e.id),e.getTracks().forEach(function(e){e.stop()}))},e.prototype.hasVideo=function(e){return e&&0<e.getVideoTracks().length},e.prototype._createOfferOptions=function(e){return _.Base.Utils.isDefined(e)?this.addVideoTransceiverIfNeeded(e)?{offerToReceiveAudio:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:e!==_.Services.Call.MediaDirection.INACTIVE}:{}},e.prototype.isRTCRtpSenderSupported=function(){return!1},e.prototype.addTrack=function(e,t){_.Base.Utils.isUndefined(this._pc)&&this.createPeerConnection(this._rtcConfig),this.monitorAudioTrack(e),this.monitorVideoTrack(e)},e.prototype.monitorAudioTrack=function(i){i&&i.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(i.onended=function(e){var t=i?i.id:T;_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"*** Local audio track ended "+t),this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,[i])}.bind(this))},e.prototype.monitorVideoTrack=function(t){t&&t.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&t.addEventListener("ended",function(){var e=t?t.id:T;_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"*** Local video track ended "+e),this.trigger(_.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_VIDEO_TRACK_ENDED,[t])}.bind(this))},e.prototype.removeLocalAudioTrack=function(t){var i;return this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local audio track: "+e.track.id),e.track.stop(),t.removeTrack(e.track),i=e.track)}.bind(this)),i},e.prototype.removeLocalVideoTrack=function(t){var i;return this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local video track: "+e.track.id),e.track.stop(),t.removeTrack(e.track),i=e.track)}.bind(this)),i},e.prototype.removeIfDoesNotSupportReplaceTrack=function(e){},e.prototype.nullifyLocalMediaTrack=function(t,i){var a,r=E.Deferred();return this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===t&&(a=e.track,_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Nullify local "+a+" track  "+a.id),e.replaceTrack(null).then(function(){a.stop(),i.removeTrack(a),r.resolve()}.bind(this)).catch(function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to nullify "+t+" track due to "+e),r.reject(e)}))}.bind(this)),a||r.resolve(),r.promise()},e.prototype.replaceLocalMediaTrack=function(i,a){var r=E.Deferred(),s=0,n=function(e){e&&this._pc.removeTrack(e),a?(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local "+i.kind+" track  "+i.id),this.addTrack(i,a),a.addTrack(i),this.monitorAudioTrack(i),r.resolve(!0)):(_.Base.Logger.warn(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to add local "+i.kind+" track  "+i.id+" due to missing media stream"),r.reject("Missing local media stream"))}.bind(this);return this._pc.getTransceivers().forEach(function(e){var t;e.stopped||(t=e.sender.track&&e.sender.track.kind===i.kind||e.receiver.track&&e.receiver.track.kind===i.kind?e.sender:t)&&"function"==typeof t.replaceTrack&&(s++,e=t.track?t.track.id:null,_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local "+i.kind+" track  "+e+" with "+i.id),t.replaceTrack(i).then(function(){a&&(a.addTrack(i),this.monitorAudioTrack(i));r.resolve(!1)}.bind(this)).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Adding "+i.kind+" track instead due to "+e),t.track.stop(),n(t)}))}.bind(this)),0===s&&n(),r.promise()},e.prototype.setLocalAudioDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.currentDirection!==t&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local audio track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t)}.bind(this))},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t)}.bind(this))},e.prototype.logTransceivers=function(){this.isRTCRtpSenderSupported()&&this._pc.getTransceivers().forEach(function(e){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Transceiver:  "+e.mid+":"+e.currentDirection+":"+e.direction+":"+e.stopped),e.sender.track?_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Sender: "+e.sender.track.kind+":"+e.sender.track.id+":"+e.sender.track.readyState):_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,">>> Null sender: ")})},e.prototype.isSetLocalVideoDirectionSupported=function(){return!!this._pc&&"getTransceivers"in this._pc},e.prototype.hasLiveTrack=function(t,e){return this.isRTCRtpSenderSupported()?this._pc.getSenders().some(function(e){return!!e.track&&e.track.kind===t&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE}.bind(this)):!!e&&e.getTracks().some(function(e){return e.kind===t&&e.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE})},e.prototype.hasVideoTrackStopStreaming=function(t){return this.isRTCRtpSenderSupported()?0!==this._pc.getSenders().filter(function(e){return!!e.track&&e.track.id===t.id&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED}.bind(this)).length:!!t&&t.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED},e.prototype.hasVideoTracks=function(e){return this.isRTCRtpSenderSupported()?0!==this._pc.getSenders().filter(function(e){return!!e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK}.bind(this)).length:!!e&&0<e.getVideoTracks().length},e.prototype.getStats=function(){return this._getStats([_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},e.prototype.getVideoStats=function(){return this._getStats([_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK])},e.prototype._getStats=function(t){if(this.isRTCRtpSenderSupported()){var i=E.Deferred(),a=new _.Base.AudioStatistics,r=new _.Base.VideoStatistics,s={},n=[],o=!t.includes(_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK);return this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.includes(e.track.kind)&&n.push(e.getStats().then(function(e){o?this._statsParser.parseVideoStats(e,r):this._statsParser.parse(e,a,r,s)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&t.includes(e.track.kind)&&n.push(e.getStats().then(function(e){o?this._statsParser.parseVideoStats(e,r):this._statsParser.parse(e,a,r,s)}.bind(this)))}.bind(this)),E.when.apply(this,n).then(function(){i.resolve({audioStatistics:a,videoStatistics:r,iceCandidateStatistics:s})},function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),i.reject(e)}),i.promise()}return this._pc.getStats(null).then(function(e){return this._statsParser.parse(e)}.bind(this)).catch(function(e){return _.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),Promise.reject(e)})},e.prototype.adjustVideoConstraints=function(e,t,i,a,r){var s=E.Deferred();return e&&t?(r=this._createVideoConstraintsList(e,t,i,a,r),this._applyVideoConstraints(s,r)):s.reject("Undefined video width or height"),s.promise()},e.prototype.adjustAudioConstraints=function(e){var t=E.Deferred(),i=navigator.mediaDevices.getSupportedConstraints();return _.Base.Utils.isDefined(e)&&i.noiseSuppression?this._applyAudioConstraints(t,{noiseSuppression:e}):t.reject("Unsupported constraints"),t.promise()},e.prototype.updateMediaConstraints=function(e,t){var i,a=!1;for(i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&t[i]===e[i]||(t[i]=e[i],a=!0));return a},e.prototype._applyAudioConstraints=function(i,a){this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(t){var e;t.track&&t.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&t.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=t.track.getConstraints(),this.updateMediaConstraints(a,e)?(_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",e),t.track.applyConstraints(e).then(function(){var e=t.track.getConstraints();_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",e),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",e),i.reject("Failed to apply audio constraints")}.bind(this))):i.resolve())}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(t){var e;t.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e=t.getConstraints(),this.updateMediaConstraints(a,e)?(_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting audio constraints: ",a),t.applyConstraints(e).then(function(){var e=t.getConstraints();_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting audio constraints: ",e),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust audio constraints: ",e),i.reject("Failed to apply audio constraints")}.bind(this))):i.resolve())}.bind(this))}.bind(this))},e.prototype._applyVideoConstraints=function(i,a){var r=a.shift(),e=!1;r?this.isRTCRtpSenderSupported()?(this._pc.getSenders().forEach(function(t){if(t.track&&t.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&t.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(e=!0,_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",r),t.track.muted)return t.track.onunmute||(t.track.onunmute=function(){t.track.applyConstraints(r).then(function(){var e=t.track.getConstraints();_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",e),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(r),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}),_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),i.reject("Video track is muted. Can't apply constraints to the video track");t.track.applyConstraints(r).then(function(){var e=t.track.getConstraints();_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints: ",e),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}}.bind(this)),e||i.resolve()):this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){if(e.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE){if(_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adjusting video constraints: ",r),e.muted)return e.onunmute||(e.onunmute=function(){e.applyConstraints(r).then(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.fire(r),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}),_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video track is muted. Can't apply constraints to the video track"),i.reject("Video track is muted. Can't apply constraints to the video track");e.applyConstraints(r).then(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully adjusting video constraints"),i.resolve()}).catch(function(e){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to adjust video constraints: ",e),this._applyVideoConstraints(i,a)}.bind(this))}}.bind(this))}.bind(this)):i.reject("Unsupported constraints")},e.prototype.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(e){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.add(e)},e.prototype.removeOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks=function(e){this._onAppliedVideoConstraintsAfterTrackUnmutedCallbacks.remove(e)},e.prototype._createVideoConstraintsList=function(e,t,a,r,i){function s(e,t){var i={width:{exact:e.getWidth()},height:{exact:e.getHeight()}};return r&&(i.deviceId={exact:r}),t?(i.frameRate={min:t},a&&(i.frameRate.max=a)):_.Base.Utils.getBrowserType()===_.Base.BrowserType.SAFARI&&(i.width=e.getWidth(),i.height=e.getHeight()),i}var n=[],o=[],c=i||_.Base.VideoResolution,l=_.Config.CallUserConfiguration.minPreferredVideoFPS||_.Config.CallUserConfiguration.DefaultValues.MIN_PREFERRED_VIDEO_FPS;Object.keys(c).filter(function(e){e=c[e];e&&e.getHeight()<=t&&(n.push(s(e,l)),o.push(s(e)))});var d=n.concat(o);return _.Base.Utils.getBrowserType()!==_.Base.BrowserType.CHROME?(i={width:{ideal:e},height:{ideal:t}},r&&(i.deviceId={exact:r}),d.push(i)):(e={width:{max:e},height:{max:t}},r&&(e.deviceId={exact:r}),d.push(e)),d},e.prototype.addVideoTransceiverIfNeeded=function(e){return!1},e.prototype.getIceConnectionState=function(){return this._pc?this._pc.iceConnectionState:T},e.prototype.isApplyingVideoConstraints=function(){return this._isApplyingVideoConstraints},e.prototype.parseIceRelayCandidate=function(e,t){return T},e.prototype.getLocalMediaCount=function(){var t=0;return this.isRTCRtpSenderSupported()?this._pc.getSenders().forEach(function(e){!e.track||e.track.kind!==_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.kind!==_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||e.track.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||t++}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.kind!==_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.kind!==_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK||e.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||t++})}),t},e.prototype.addOnSelectedCandidatePairIdChanged=function(e){this._statsParser&&this._statsParser.addOnSelectedCandidatePairIdChanged(e)},e.prototype.removeOnSelectedCandidatePairIdChanged=function(e){this._statsParser&&this._statsParser.removeOnSelectedCandidatePairIdChanged(e)},e.prototype._updateVideoParameters=function(e,t,i,a){var r=E.Deferred(),s=e.getParameters();return s.encodings||(s.encodings=[{}]),s.encodings[0].scaleResolutionDownBy=1<=t?t:1,i&&(s.encodings[0].maxBitrate=1e3*i),a&&(s.encodings[0].maxFramerate=a),e.setParameters(s).then(function(){_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Updated video send parameters: ",s),r.resolve()}.bind(this),function(e){_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send parameters failed - error: "+e.name),r.reject()}.bind(this)),r.promise()},e.prototype.getVideoSendBandwidth=function(){var t;return this.isRTCRtpSenderSupported()&&this._pc.getSenders().forEach(function(e){!e.track||e.track.kind!==_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK||e.track.readyState!==_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE||(e=e.getParameters()).encodings&&e.encodings[0]&&_.Base.Utils.isDefined(e.encodings[0].maxBitrate)&&(t=e.encodings[0].maxBitrate)}.bind(this)),t},e.prototype.setVideoSendResolutionAndBandwidth=function(o,c,l,d,C){var u=E.Deferred(),h=!1;return this.isRTCRtpSenderSupported()?(this._pc.getSenders().forEach(function(t){var i,e,a,r,s,n;t.track&&t.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&t.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(h=!0,_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting video send resolution to at most "+o+"x"+c),t.track.muted?(this._isApplyingVideoConstraints=!1,u.reject("Set video send resolution failed: Video track is muted")):(i=t.track.getConstraints(),n=t.track.getSettings().height||(s=i.height,_.Base.Utils.isDefined(s)&&("number"==typeof s?n=s:"number"==typeof s.max?n=s.max:"number"==typeof s.exact?n=s.exact:"number"==typeof c.ideal&&(n=s.ideal)),n),1<=(e=n?720===n&&480===c?n/488:n/c:0)&&!C?this._updateVideoParameters(t,e,d,l).then(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send bandwidth set to at most ",d,"kbps; preferred resolution ",c,"p. Scaled by ",e),u.resolve()},function(e){u.reject(e)}).always(function(){this._isApplyingVideoConstraints=!1}.bind(this)):(this._isApplyingVideoConstraints=!0,a=i.height,r=i.width,i.height={ideal:c,max:c},i.width={ideal:o,max:o},l&&(i.frameRate=this.getFrameRateConstraint(l)),t.track.applyConstraints(i).then(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send resolution constraints set to at most "+o+"x"+c,i),this._isApplyingVideoConstraints=!1,this._updateVideoParameters(t,0,d).then(function(){_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Video send bandwidth set to at most ",d,"kbps; preferred resolution ",c,"p"),u.resolve()},function(e){u.reject(e)})}.bind(this),function(e){t.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Set video send resolution failed: ",e,".  Recovering using old constraints: ",i,". Track readyState: ",t.track.readyState," muted: ",t.track.muted),this._rollbackConstraints(t.track,r,a).always(function(){this._isApplyingVideoConstraints=!1,u.reject("Failed to rollback constraints: "+e.name)})):(this._isApplyingVideoConstraints=!1,u.reject("Failed to applyConstraints - track ended"))}.bind(this)))))}.bind(this)),h||u.reject("No live video track found")):u.reject("Reducing video resolution isn't supported on this browser"),u.promise()},e.prototype._rollbackConstraints=function(e,t,i){var a=e.getConstraints();return a.height=i,a.width=t,e.applyConstraints(a).then(function(){this._isApplyingVideoConstraints=!1,_.Base.Logger.info(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Successfully recovered using old constraints. Track readyState: ",e.readyState," muted: ",e.muted)}.bind(this),function(){this._isApplyingVideoConstraints=!1,_.Base.Logger.error(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to recover using old constraints.",a)}.bind(this))},e.prototype.getFrameRateConstraint=function(e){return{ideal:e,max:e}},e.prototype.stopLocalAudioTrack=function(){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping local audio track: "+e.track.id),e.track.stop())}.bind(this))},e.prototype.stopLocalVideoTrack=function(){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(_.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping local video track: "+e.track.id),e.track.stop())}.bind(this))},e.prototype.isLocalAudioTrackEnded=function(){return this.isLocalMediaTrackEnded(_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK)},e.prototype.isLocalVideoTrackEnded=function(){return this.isLocalMediaTrackEnded(_.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK)},e.prototype.hasMediaTrack=function(t,e){return this.isRTCRtpSenderSupported()?this._pc.getSenders().some(function(e){return!!e.track&&e.track.kind===t}):e?t===_.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK?0!==e.getAudioTracks().length:0!==e.getVideoTracks().length:void 0},e.prototype.isLocalMediaTrackEnded=function(t){var i=!0,a=0;return!!this.isRTCRtpSenderSupported()&&(this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===t&&(a++,e.track.readyState===_.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(i=!1))}.bind(this)),0!==a&&i)},e.prototype.addTransceiverIfNeeded=function(t,e){if(this.isRTCRtpSenderSupported()){var i=!1;if(this._pc.getTransceivers().forEach(function(e){e.receiver&&e.receiver.track&&e.receiver.track.kind===t&&(i=!0),e.sender&&e.sender.track&&e.sender.track.kind===t&&(i=!0)}),!i)return _.Base.Logger.debug(_.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding transceiver for ",t,":",e),this._pc.addTransceiver(t,{direction:e}),!0}return!1},e.prototype.replaceTransceiverVideoTrackIfNeeded=function(e){},_.Base.AbstractRTCConnectionProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.Constants={ICE_GATHERING_STATE_COMPLETE:"complete",ICE_GATHERING_STATE_GATHERING:"gathering",ICE_CONNECTION_STATE_COMPLETED:"completed",ICE_CONNECTION_STATE_CONNECTED:"connected",ICE_CONNECTION_STATE_CHECKING:"checking",ICE_CONNECTION_STATE_FAILED:"failed",ICE_CONNECTION_STATE_DISCONNECTED:"disconnected",ICE_CONNECTION_STATE_NEW:"new",ICE_CONNECTION_STATE_CLOSED:"closed",RTC_PEER_CONNECTION_STATE_CLOSED:"closed",MEDIA_STREAM_TRACK_READY_STATE_LIVE:"live",MEDIA_STREAM_TRACK_READY_STATE_ENDED:"ended",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",RTC_STATS_TYPE:{INBOUND_RTP:"inbound-rtp",REMOTE_OUTBOUND_RTP:"remote-outbound-rtp",OUTBOUND_RTP:"outbound-rtp",REMOTE_INBOUND_RTP:"remote-inbound-rtp",TRACK:"track",CANDIDATE_PAIR:"candidate-pair",LOCAL_CANDIDATE:"local-candidate",REMOTE_CANDIDATE:"remote-candidate",MEDIA_SOURCE:"media-source",CODEC:"codec",TRANSPORT:"transport"},RTC_STATS_MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"}}}(),function(o){"use strict";function e(){this._inboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUND_RTP,this._outboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP,this._remoteInboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_INBOUND_RTP,this._remoteOutboundStatsType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_OUTBOUND_RTP,this._trackType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRACK,this._candidatePairType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CANDIDATE_PAIR,this._localCandidateType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.LOCAL_CANDIDATE,this._remoteCandidateType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.REMOTE_CANDIDATE,this._mediaSourceType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.MEDIA_SOURCE,this._codec=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.CODEC,this._transportType=o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.TRANSPORT,this._localCandidates={},this._remoteCandidates={},this._selectedCandidatePairId=T,this._audioTransportId=T,this._videoTransportId=T,this._selectedCandidatePairIdChangedCallbacks=E.Callbacks()}e.prototype.processOutboundGenericStats=function(e,t){o.Base.Utils.isDefined(e.timestamp)&&(t.timestamp=e.timestamp),o.Base.Utils.isDefined(e.packetsSent)&&(t.packetsTransmitted=e.packetsSent),o.Base.Utils.isDefined(e.bytesSent)&&(t.bytesTransmitted=e.bytesSent),o.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalTransmitted=e.packetsLost),o.Base.Utils.isDefined(e.roundTripTime)&&(t.roundTripTimeMilliseconds=e.roundTripTime)},e.prototype.processInboundGenericStats=function(e,t){o.Base.Utils.isDefined(e.timestamp)&&(t.timestamp=e.timestamp),o.Base.Utils.isDefined(e.packetsReceived)&&(t.packetsReceived=e.packetsReceived),o.Base.Utils.isDefined(e.bytesReceived)&&(t.bytesReceived=e.bytesReceived),o.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalReceived=e.packetsLost),o.Base.Utils.isDefined(e.jitter)&&(t.jitterMillisecondsReceived=1e3*e.jitter),o.Base.Utils.isDefined(e.fractionLost)&&(t.packetsLossFractionReceived=e.fractionLost)},e.prototype.processOutboundVideoStats=function(e,t){o.Base.Utils.isDefined(e.framesEncoded)&&(t.framesEncoded=e.framesEncoded),o.Base.Utils.isDefined(e.totalEncodeTime)&&(t.totalEncodeTime=e.totalEncodeTime),o.Base.Utils.isDefined(e.firCount)&&(t.firCountTransmitted=e.firCount),o.Base.Utils.isDefined(e.pliCount)&&(t.pliCountTransmitted=e.pliCount),o.Base.Utils.isDefined(e.nackCount)&&(t.nackCountTransmitted=e.nackCount)},e.prototype.processInboundVideoStats=function(e,t){o.Base.Utils.isDefined(e.framesDecoded)&&(t.framesDecoded=e.framesDecoded),o.Base.Utils.isDefined(e.totalDecodeTime)&&(t.totalDecodeTime=e.totalDecodeTime),o.Base.Utils.isDefined(e.firCount)&&(t.firCountReceived=e.firCount),o.Base.Utils.isDefined(e.pliCount)&&(t.pliCountReceived=e.pliCount),o.Base.Utils.isDefined(e.nackCount)&&(t.nackCountReceived=e.nackCount)},e.prototype.processInboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:o.Base.Utils.isDefined(e.transportId)&&(this._audioTransportId=e.transportId),this.processInboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:o.Base.Utils.isDefined(e.transportId)&&(this._videoTransportId=e.transportId),this.processInboundGenericStats(e,i),this.processInboundVideoStats(e,i)}},e.prototype.processRemoteOutboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processInboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processInboundGenericStats(e,i),this.processInboundVideoStats(e,i)}},e.prototype.processOutboundStats=function(e,t,i,a){switch(this.getMediaType(e,a)){case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:this.processOutboundGenericStats(e,t);break;case o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:this.processOutboundGenericStats(e,i),this.processOutboundVideoStats(e,i)}},e.prototype.processRemoteInboundStats=function(e,t,i,a){this.processOutboundStats(e,t,i,a)},e.prototype.processVideoTrackStats=function(e,t){o.Base.Utils.isDefined(e.remoteSource)&&(e.remoteSource?(o.Base.Utils.isDefined(e.framesPerSecond)&&(t.actualFrameRateReceived=e.framesPerSecond),o.Base.Utils.isDefined(e.frameHeight)&&(t.heightReceived=e.frameHeight),o.Base.Utils.isDefined(e.frameWidth)&&(t.widthReceived=e.frameWidth),o.Base.Utils.isDefined(e.framesReceived)&&(t.framesReceived=e.framesReceived)):(o.Base.Utils.isDefined(e.framesPerSecond)&&(t.actualFrameRateTransmitted=e.framesPerSecond),o.Base.Utils.isDefined(e.frameHeight)&&(t.heightTransmitted=e.frameHeight),o.Base.Utils.isDefined(e.frameWidth)&&(t.widthTransmitted=e.frameWidth),o.Base.Utils.isDefined(e.framesSent)&&(t.framesTransmitted=e.framesSent)))},e.prototype.processAudioTrackStats=function(e,t){o.Base.Utils.isDefined(e.remoteSource)&&(e.remoteSource?(o.Base.Utils.isDefined(e.totalAudioEnergy)&&(t.totalAudioEnergyReceived=e.totalAudioEnergy),o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelReceived=e.audioLevel)):o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelTransmitted=e.audioLevel))},e.prototype.processTrackStats=function(e,t,i){switch(e.kind){case o.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK:this.processVideoTrackStats(e,i);break;case o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK:this.processAudioTrackStats(e,t)}},e.prototype.processAudioMediaSourceStats=function(e,t){o.Base.Utils.isDefined(e.totalAudioEnergy)&&(t.totalAudioEnergyTransmitted=e.totalAudioEnergy),o.Base.Utils.isDefined(e.audioLevel)&&(t.audioLevelTransmitted=e.audioLevel)},e.prototype.processMediaSourceStats=function(e,t,i){e.kind===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO&&this.processAudioMediaSourceStats(e,t)},e.prototype.processCodecGenericStats=function(e,t){o.Base.Utils.isDefined(e.mimeType)&&(t.codec=e.mimeType)},e.prototype.processCodecStats=function(e,t,i){this.getCodecMediaType(e)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO?this.processCodecGenericStats(e,t):this.processCodecGenericStats(e,i)},e.prototype.getMediaType=function(e){return e.mediaType},e.prototype.processRTCStats=function(e,t,i,a,r){switch(e.type){case this._inboundStatsType:this.processInboundStats(e,t,i,r);break;case this._outboundStatsType:this.processOutboundStats(e,t,i,r);break;case this._remoteInboundStatsType:this.processRemoteInboundStats(e,t,i,r);break;case this._remoteOutboundStatsType:this.processRemoteOutboundStats(e,t,i,r);break;case this._trackType:this.processTrackStats(e,t,i);break;case this._candidatePairType:this.processCandidatePairStats(e,t,i,a);break;case this._localCandidateType:this.processLocalCandidateStats(e);break;case this._remoteCandidateType:this.processRemoteCandidateStats(e);break;case this._mediaSourceType:this.processMediaSourceStats(e,t,i);break;case this._codec:this.processCodecStats(e,t,i);break;case this._transportType:this.processTransportStats(e,t)}},e.prototype.processVideoRTCStats=function(e,t,i){if(this.getMediaType(e,i)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO)switch(e.type){case this._inboundStatsType:this.processInboundGenericStats(e,t),this.processInboundVideoStats(e,t);break;case this._outboundStatsType:this.processOutboundGenericStats(e,t),this.processOutboundVideoStats(e,t)}},e.prototype.processVideoCandidatePairStats=function(e,t){o.Base.Utils.isDefined(e.currentRoundTripTime)&&(t.roundTripTimeMillis=1e3*e.currentRoundTripTime),o.Base.Utils.isDefined(e.availableOutgoingBitrate)&&(t.availableTransmitBitrate=e.availableOutgoingBitrate),o.Base.Utils.isDefined(e.availableIncomingBitrate)&&(t.availableReceiveBitrate=e.availableIncomingBitrate)},e.prototype.processCandidatePairStats=function(e,t,i,a){var r,s,n;"succeeded"===e.state&&(r=this._localCandidates[e.localCandidateId],s=this._remoteCandidates[e.remoteCandidateId],n=e.ID||e.id,r&&s&&(a[n]=new o.Base.CandidatePairStatistics(r,s)),this.getCandidatePairMediaType(e)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(e,i))},e.prototype.getCandidatePairMediaType=function(e){if(o.Base.Utils.isDefined(e.transportId))return-1!==e.transportId.search("audio")||this._audioTransportId===e.transportId?"audio":-1!==e.transportId.search("video")||this._videoTransportId===e.transportId?"video":void 0},e.prototype.getCodecMediaType=function(e){if(o.Base.Utils.isDefined(e.mimeType))return-1!==e.mimeType.search("audio")?"audio":-1!==e.mimeType.search("video")?"video":void 0},e.prototype.processLocalCandidateStats=function(e){var t=e.address||e.ip||"localhost",i=e.ID||e.id;this._localCandidates[i]=new o.Base.CandidateStatistics(t,e.port,e.protocol,e.candidateType)},e.prototype.processRemoteCandidateStats=function(e){var t=e.address||e.ip,i=e.ID||e.id;this._remoteCandidates[i]=new o.Base.CandidateStatistics(t,e.port,e.protocol,e.candidateType)},e.prototype.processTransportStats=function(e,t){var i=e.id||e.rtcpTransportStatsId;!i||-1===i.search("audio")&&i!==this._audioTransportId||(this._selectedCandidatePairId&&this._selectedCandidatePairId!==e.selectedCandidatePairId&&this._selectedCandidatePairIdChangedCallbacks.fire(e.selectedCandidatePairId),this._selectedCandidatePairId=e.selectedCandidatePairId,t.transportBytesReceived=e.bytesReceived)},e.prototype.calculateStats=function(e,t){o.Base.Utils.isDefined(e.packetsReceived)&&(o.Base.Utils.isUndefined(e.packetLossTotalReceived)?e.fractionLostLocal=T:0===e.packetsReceived?e.fractionLostLocal=0:e.fractionLostLocal=e.packetLossTotalReceived/(e.packetsReceived+e.packetLossTotalReceived)),this.calculateVideoStats(t)},e.prototype.calculateVideoStats=function(e){o.Base.Utils.isUndefined(e.packetsLossFractionTransmitted)&&(o.Base.Utils.isUndefined(e.packetsTransmitted)||o.Base.Utils.isUndefined(e.packetLossTotalTransmitted)?e.packetsLossFractionTransmitted=T:0===e.packetsTransmitted?e.packetsLossFractionTransmitted=0:e.packetsLossFractionTransmitted=e.packetLossTotalTransmitted/(e.packetsTransmitted+e.packetLossTotalTransmitted)),o.Base.Utils.isUndefined(e.packetsLossFractionReceived)&&(o.Base.Utils.isUndefined(e.packetsReceived)||o.Base.Utils.isUndefined(e.packetLossTotalReceived)?e.packetsLossFractionReceived=T:0===e.packetsReceived?e.packetsLossFractionReceived=0:e.packetsLossFractionReceived=e.packetLossTotalReceived/(e.packetsReceived+e.packetLossTotalReceived))},e.prototype.parse=function(t,i,a,r){i=i||new o.Base.AudioStatistics,a=a||new o.Base.VideoStatistics,r=r||{};return o.Base.Utils.forEach(t,function(e){this.processRTCStats(e,i,a,r,t)},this),this.calculateStats(i,a),{audioStatistics:i,videoStatistics:a,iceCandidateStatistics:r}},e.prototype.parseVideoStats=function(t,i){i=i||new o.Base.VideoStatistics;return o.Base.Utils.forEach(t,function(e){this.processVideoRTCStats(e,i,t)},this),this.calculateVideoStats(i),{videoStatistics:i}},e.prototype.addOnSelectedCandidatePairIdChanged=function(e){this._selectedCandidatePairIdChangedCallbacks.add(e)},e.prototype.removeOnSelectedCandidatePairIdChanged=function(e){this._selectedCandidatePairIdChangedCallbacks.remove(e)},o.Base.AbstractRTCStatsReportParser=e}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.AudioStatistics=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h){this.bytesTransmitted=t,this.bytesReceived=e,this.packetsTransmitted=a,this.packetsReceived=i,this.roundTripTimeMilliseconds=r,this.packetLossTotalTransmitted=s,this.packetLossTotalReceived=n,this.jitterMillisecondsReceived=o,this.totalAudioEnergyTransmitted=l,this.totalAudioEnergyReceived=c,this.audioLevelTransmitted=C,this.audioLevelReceived=d,this.codec=u,this.fractionLostLocal=h,this.transportBytesReceived=0}}(),function(a){"use strict";function e(e){this._previousAudioStatistics=T,this._previousVideoStatistics=T,this._call=e,this.isStarted=!1,this._interval=T,this._statisticsLog=T,this._config=a.Base.CallStatisticsLoggerConfig}e.prototype.start=function(){this.isStarted?a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger has already started"):(this._initialize(),this.isStarted=!0,this._logStatistics(),this._interval=setInterval(this._logStatistics.bind(this),this._config.INTERVAL_IN_MILLIS))},e.prototype._logStatistics=function(){var e,t;a.Base.Utils.isDefined(this._call)?(e=this._call.getAudioDetails(),t=this._call.getVideoDetails(),E.when(e,t).done(function(e,t){this._processStatistics(e,t),this._saveStatistics(e,t),this._logStats()}.bind(this)),E.when(e,t).fail(function(){this.stop(),a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"Statistics of call ("+this._call.getCallId()+") are unavailable, stopping CallStatisticLogger")}.bind(this))):(this.stop(),a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"Statistics cannot be processed because the call is not longer available, stopping CallStatisticLogger"))},e.prototype._processStatistics=function(t,i){var a;this._statisticsLog.forEach(function(e){e.mediaType===this._config.MEDIA_TYPE.AUDIO?a=t[e.key]:e.mediaType===this._config.MEDIA_TYPE.VIDEO&&(a=i[e.key]),this._processStatistic(e,a)},this)},e.prototype._processStatistic=function(e,t){a.Base.Utils.isDefined(t)?e.valueType===this._config.VALUE_TYPE.INSTANT?e.value=t:e.valueType===this._config.VALUE_TYPE.CALCULATED&&(this._statHasPreviousValue(e)?e.value=0===t?0:this._calculateStatValue(e,t):e.value=T):e.value=T},e.prototype._calculateStatValue=function(e,t){var i;return e.mediaType===this._config.MEDIA_TYPE.AUDIO?i=this._previousAudioStatistics[e.key]:e.mediaType===this._config.MEDIA_TYPE.VIDEO&&(i=this._previousVideoStatistics[e.key]),t-i},e.prototype._logStats=function(){var e=(new Date).getTime(),i='{"ID":"'+this._call.getCallId().slice(0,4)+'",';i+='"TS":"'+e+'",';this._statisticsLog.forEach(function(e,t){i+=e.getAlias()+":"+e.getValue();t=t===this._statisticsLog.length-1;i+=t?"}":","}.bind(this)),a.Base.Logger.debug(a.Base.LoggerTags.CALL_STATISTICS,i)},e.prototype.stop=function(){this.isStarted?(this.isStarted=!1,this._cleanStatistics(),clearInterval(this._interval)):a.Base.Logger.warn(a.Base.LoggerTags.CALL_STATISTICS,"CallStatisticLogger is already stopped")},e.prototype._saveStatistics=function(e,t){this._previousAudioStatistics=e,this._previousVideoStatistics=t},e.prototype._cleanStatistics=function(){this._previousAudioStatistics=T,this._previousVideoStatistics=T,this._statisticsLog.forEach(function(e){e.value=T})},e.prototype._statHasPreviousValue=function(e){return e.mediaType===this._config.MEDIA_TYPE.AUDIO?!!a.Base.Utils.isDefined(this._previousAudioStatistics)&&a.Base.Utils.isDefined(this._previousAudioStatistics[e.key]):e.mediaType===this._config.MEDIA_TYPE.VIDEO?!!a.Base.Utils.isDefined(this._previousVideoStatistics)&&a.Base.Utils.isDefined(this._previousVideoStatistics[e.key]):void 0},e.prototype._initialize=function(){a.Base.Utils.isDefined(this._statisticsLog)||(this._statisticsLog=[],Object.keys(this._config.CALCULATED_AUDIO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.CALCULATED_AUDIO_STATS[e],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_AUDIO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.INSTANT_AUDIO_STATS[e],this._config.MEDIA_TYPE.AUDIO,this._config.VALUE_TYPE.INSTANT))},this),Object.keys(this._config.CALCULATED_VIDEO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.CALCULATED_VIDEO_STATS[e],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.CALCULATED))},this),Object.keys(this._config.INSTANT_VIDEO_STATS).forEach(function(e){this._statisticsLog.push(new a.Base.StatisticLog(e,this._config.INSTANT_VIDEO_STATS[e],this._config.MEDIA_TYPE.VIDEO,this._config.VALUE_TYPE.INSTANT))},this))},a.Base.CallStatisticsLogger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.CallStatisticsLoggerConfig={INTERVAL_IN_MILLIS:1e4,MEDIA_TYPE:{AUDIO:"audio",VIDEO:"video"},VALUE_TYPE:{INSTANT:"instant",CALCULATED:"calculated"},CALCULATED_AUDIO_STATS:{packetsReceived:"AI_PR",bytesReceived:"AI_BR",packetLossTotalReceived:"AI_PL",totalAudioEnergyReceived:"AI_TE",packetsTransmitted:"AO_PT",bytesTransmitted:"AO_BT",totalAudioEnergyTransmitted:"AO_TE"},CALCULATED_VIDEO_STATS:{packetsReceived:"VI_PR",bytesReceived:"VI_BR",packetLossTotalReceived:"VI_PL",framesReceived:"VI_FR",firCountReceived:"VI_FC",pliCountReceived:"VI_PC",nackCountReceived:"VI_NC",packetsTransmitted:"VO_PT",bytesTransmitted:"VO_BT",framesTransmitted:"VO_FT",firCountTransmitted:"VO_FC",pliCountTransmitted:"VO_PC",nackCountTransmitted:"VO_NC"},INSTANT_AUDIO_STATS:{jitterMillisecondsReceived:"AI_JR",audioLevelReceived:"AI_LR",audioLevelTransmitted:"AO_LT",roundTripTimeMilliseconds:"AO_RT"},INSTANT_VIDEO_STATS:{jitterMillisecondsReceived:"VI_JR",widthReceived:"VI_WR",heightReceived:"VI_HR",availableReceiveBitrate:"VI_AB",widthTransmitted:"VO_WT",heightTransmitted:"VO_HT",availableTransmitBitrate:"VO_AB",roundTripTimeMillis:"VO_RT",totalEncodeTime:"VO_TE",totalDecodeTime:"VI_TD",framesEncoded:"VO_FE",framesDecoded:"VI_FD"}}}(),function(){"use strict";(AvayaClientServices||{}).Base.CandidatePairStatistics=function(e,t){this.local=e,this.remote=t}}(),function(e){"use strict";function t(e,t,i,a){this.address=e,this.port=t,this.protocol=i,this.type=a}t.prototype={toString:function(){return"[address: "+this.address+"; port: "+this.port+"; protocol: "+this.protocol+"; type: "+this.type+"]"}},e.Base.CandidateStatistics=t}(AvayaClientServices||{}),function(a){"use strict";function e(e,t,i){this._tlsOrTcpFound=!1,a.Base.RTCConnectionProvider.call(this,e,t,i),this._statsParser=new a.Base.EdgeRTCStatsReportParser}(e.prototype=Object.create(a.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(e){a.Base.RTCConnectionProvider.prototype.addStream.call(this,e)},e.prototype.removeStream=function(e){a.Base.RTCConnectionProvider.prototype.removeStream.call(this,e)},e.prototype.createPeerConnection=function(e){var t;e&&!E.isEmptyObject(e)?(e.bundlePolicy="max-compat",this._tlsOrTcpFound=!1,0<e.iceServers.length&&(Array.isArray(e.iceServers[0].urls)?(e.iceServers[0].urls.length>(t=e.iceServers[0].urls.filter(function(e){return e.includes("turn:")&&e.includes("?transport=udp")})).length&&(this._tlsOrTcpFound=!0),e.iceServers[0].urls=t):e.iceServers[0].urls.includes("stun:")&&(e.iceServers[0].urls=[])),a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,e)):a.Base.RTCConnectionProvider.prototype.createPeerConnection.call(this,{bundlePolicy:"max-compat",iceTransportPolicy:"all",iceServers:[]}),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this)},e.prototype.onAddStreamInternal=function(e){a.Base.RTCConnectionProvider.prototype.onAddStreamInternal.call(this,e)},e.prototype._getDTMFSender=function(){return null},e.prototype.stopStream=function(e){a.Base.RTCConnectionProvider.prototype.stopStream.call(this,e)},e.prototype.stopAllStreams=function(){a.Base.RTCConnectionProvider.prototype.stopAllStreams.call(this)},e.prototype._enableDisableRemoteStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteStreams.call(this,e)},e.prototype._enableDisableLocalStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalStreams.call(this,e)},e.prototype._enableDisableLocalAudioStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalAudioStreams.call(this,e)},e.prototype._enableDisableLocalVideoStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableLocalVideoStreams.call(this,e)},e.prototype._enableDisableRemoteVideoStreams=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteVideoStreams.call(this,e)},e.prototype._enableDisableRemoteAudioStream=function(e){a.Base.RTCConnectionProvider.prototype._enableDisableRemoteAudioStream.call(this,e)},e.prototype._throwSdpError=function(){this._tlsOrTcpFound?this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found. This browser doesn't support TCP or TLS TURN."}):this._sdpErrorCallback({errorCode:a.Services.Call.CallError.TRANSPORT_ERROR,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"No ice candidates found in allocated time"})},e.prototype._answerError=function(e,t){var i;0===this._iceCandidates.length&&this._tlsOrTcpFound?(i={errorCode:a.Services.Call.CallError.TCP_TLS_TURN_NOT_SUPPORTED,protocolType:a.Services.Call.CallProtocolType.APPLICATION,errorMsg:"Error while setting answer as local description: this browser doesn't support TCP or TLS TURN."},a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+i),t(i)):(a.Base.Logger.error(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error while setting answer as local description: "+e),t(e))},e.prototype.addTrack=function(e,t){a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id),a.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t),t.addTrack(e)},e.prototype.removeLocalAudioTrack=function(){this._pc.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(e){e.stop(),t.removeTrack(e)})})},e.prototype.isRTCRtpSenderSupported=function(){return!1},e.prototype.adjustVideoConstraints=function(e,t,i){return E.Deferred().reject("Video constraints is NOT support by Edge").promise()},a.Base.EdgeRTCConnectionProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.EdgeRTCConnectionProvider.Constants={RTC_STATS_TYPE:{INBOUNDRTP:"inboundrtp",OUTBOUNDRTP:"outboundrtp"}}}(),function(r){"use strict";function e(){r.Base.AbstractRTCStatsReportParser.call(this),this._inboundStatsType=r.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.INBOUNDRTP,this._outboundStatsType=r.Base.EdgeRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUNDRTP}(e.prototype=Object.create(r.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(e,t,i){0<e.frameHeight||-1!==e.trackIdentifier.search("video")?this.processVideoTrackStats(e,i):this.processAudioTrackStats(e,t)},e.prototype.processInboundGenericStats=function(e,t){r.Base.Utils.isDefined(e.packetsReceived)&&(t.packetsReceived=e.packetsReceived),r.Base.Utils.isDefined(e.bytesReceived)&&(t.bytesReceived=e.bytesReceived),r.Base.Utils.isDefined(e.packetsLost)&&(t.packetLossTotalReceived=e.packetsLost),r.Base.Utils.isDefined(e.jitter)&&(t.jitterMillisecondsReceived=1e3*e.jitter),r.Base.Utils.isDefined(e.fractionLost)&&(t.packetsLossFractionReceived=e.fractionLost),r.Base.Utils.isDefined(e.codecId)&&(t.codec=e.codecId)},e.prototype.processInboundStats=function(e,t,i,a){e.isRemote||(r.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,e,t,i,a),t.bytesReceived=T,i.bytesReceived=T)},e.prototype.processOutboundStats=function(e,t,i,a){e.isRemote||(r.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,e,t,i,a),t.bytesTransmitted=T,i.bytesTransmitted=T)},e.prototype.processAudioTrackStats=function(e,t){},e.prototype.getMediaType=function(e,t){return e.codecId?"H264"===e.codecId?r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:"H264"===t[e.associateStatsId].codecId?r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO:r.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO},r.Base.EdgeRTCStatsReportParser=e}(AvayaClientServices),function(s){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) (udp|UDP) \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+/;function e(e,t,i){s.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this._statsParser=new s.Base.FirefoxRTCStatsReportParser}(e.prototype=Object.create(s.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(t){s.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this))},e.prototype.removeStream=function(e){this._pc&&this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this))},e.prototype.createPeerConnection=function(e){s.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),this._pc.ontrack=this.onTrackInternal.bind(this)},e.prototype._getDTMFSender=function(){return s.Base.Utils.isDefined(this._dtmfSender)||this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=e.dtmf)}.bind(this)),this._dtmfSender},e.prototype.stopAllStreams=function(){var t;this._pc&&(t=!1,this._pc.getSenders().forEach(function(e){e.track&&(e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.track.stop(),this._pc.removeTrack(e))}.bind(this)),t||this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.stop()})}),this._pc.getReceivers().forEach(function(e){e.track&&e.track.stop()}.bind(this)))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling remote ":"Disabling remote ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalAudioStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableLocalVideoStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?e.track.enabled===t&&!t||(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id+":"+e.track.readyState),e.track.enabled=t):s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(e.sender.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t):s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+e.sender.track.id+":"+e.sender.track.readyState))}.bind(this))},e.prototype.isSetLocalVideoDirectionSupported=function(){return!0},e.prototype.hasVideoTrackStopStreaming=function(t){return 0!==this._pc.getTransceivers().filter(function(e){return!!e.sender.track&&e.sender.track.id===t.id&&(e.stopped||e.sender.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED)}.bind(this)).length},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype._enableDisableRemoteAudioStream=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype.addTrack=function(e,t){s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id+":"+e.readyState),s.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===s.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&s.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.id===t.id&&(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+e.track.id),e.track.stop())}.bind(this))},e.prototype.enableRemoteVideoTrack=function(e,t){var i=0;this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(i++,e.track.id!==t.id&&e.track.readyState===s.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(e.track.stop(),s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing remote video track  "+e.track.id+" with "+t.id)))}),0===i?(s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding remote video track  "+t.id),this.addTrack(t,e)):0===e.getVideoTracks().length&&e.addTrack(t)},e.prototype.isRTCRtpSenderSupported=function(){return!0},e.prototype.rollbackLocalOfferState=function(){"stable"!==this._pc.signalingState&&this._pc.setLocalDescription({type:"rollback"})},e.prototype.adjustVideoConstraints=function(e,t,i,a,r){return 360<=t&&t<=480&&(e=640,t=360),s.Base.AbstractRTCConnectionProvider.prototype.adjustVideoConstraints.call(this,e,t,i,a,r)},e.prototype.getFrameRateConstraint=function(e){return{ideal:e}},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?{foundation:e[1],component:e[2],networkId:T}:T},e.prototype.addVideoTransceiverIfNeeded=function(e){if(e){var t=!1;if(this._pc.getTransceivers().forEach(function(e){e.receiver&&e.receiver.track&&e.receiver.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.sender&&e.sender.track&&e.sender.track.kind===s.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0)}),!t)return s.Base.Logger.debug(s.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+e),this._pc.addTransceiver("video",{direction:e}),!0}return!1},s.Base.FirefoxRTCConnectionProvider=e}(AvayaClientServices),function(r){"use strict";function e(){r.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(r.Base.AbstractRTCStatsReportParser.prototype)).processOutboundVideoStats=function(e,t){r.Base.AbstractRTCStatsReportParser.prototype.processOutboundVideoStats.call(this,e,t),r.Base.Utils.isDefined(e.bitrateMean)&&(t.actualBitRateTransmitted=e.bitrateMean),r.Base.Utils.isDefined(e.framerateMean)&&(t.actualFrameRateTransmitted=e.framerateMean),r.Base.Utils.isDefined(e.roundTripTime)&&(t.roundTripTimeMillis=1e3*e.roundTripTime)},e.prototype.processInboundVideoStats=function(e,t){r.Base.AbstractRTCStatsReportParser.prototype.processInboundVideoStats.call(this,e,t),r.Base.Utils.isDefined(e.bitrateMean)&&(t.actualBitRateReceived=e.bitrateMean),r.Base.Utils.isDefined(e.framerateMean)&&(t.actualFrameRateReceived=e.framerateMean)},e.prototype.processOutboundStats=function(e,t,i,a){!0!==e.isRemote&&r.Base.AbstractRTCStatsReportParser.prototype.processOutboundStats.call(this,e,t,i,a)},e.prototype.processInboundStats=function(e,t,i,a){!0===e.isRemote?this.processOutboundStats(e,t,i,a):r.Base.AbstractRTCStatsReportParser.prototype.processInboundStats.call(this,e,t,i,a)},r.Base.FirefoxRTCStatsReportParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Base.AbstractRTCConnectionProvider.ObservableRTCEvents={ICE_CONNECTION_STATE_CHANGED:"rtcProvider.iceConnectionStateChanged",LOCAL_AUDIO_TRACK_ENDED:"rtcProvider.localAudioTrackEnded",LOCAL_VIDEO_TRACK_ENDED:"rtcProvider.localVideoTrackEnded"}}(),function(o){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .* network-id (\d+)/;function e(e,t,i){o.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this.isAvailable()&&(this._statsParser=new o.Base.RTCStatsReportParser,this._iceDisconnectedTimeoutId=T,this._iceConnectionStateFailed=!1)}(e.prototype=Object.create(o.Base.AbstractRTCConnectionProvider.prototype)).updatePeerConfiguration=function(e,t){o.Base.AbstractRTCConnectionProvider.prototype.updatePeerConfiguration.call(this,e,t)},e.prototype.addStream=function(t){o.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),this._isRTCRtpSenderSupported?t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this)):this._pc.addStream(t)},e.prototype.addTrack=function(e,t){o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id+":"+e.readyState),o.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&o.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.removeStream=function(e){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this)):this._pc.removeStream(e))},e.prototype.createPeerConnection=function(e){o.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),"ontrack"in this._pc?this._pc.ontrack=this.onTrackInternal.bind(this):this._pc.onaddstream=this.onAddStreamInternal.bind(this),this._isRTCRtpSenderSupported="function"==typeof this._pc.getSenders},e.prototype.onAddStreamInternal=function(e){var t=e.stream;t&&(t.onaddtrack=this.onAddTrackInternal.bind(this),t.onremovetrack=this.onRemoveTrackInternal.bind(this),this.onAddStream&&this.onAddStream(e.stream))},e.prototype._getDTMFSender=function(){return o.Base.Utils.isDefined(this._dtmfSender)||(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(this._dtmfSender=e.dtmf)}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e=e.getAudioTracks()[0];o.Base.Utils.isDefined(e)&&(this._dtmfSender=this._pc.createDTMFSender(e))}.bind(this))),this._dtmfSender},e.prototype.stopAllStreams=function(){this._pc&&(this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&(e.track.stop(),this._pc.removeTrack(e))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.stop()}),e.getVideoTracks().forEach(function(e){e.stop()}),this._pc.removeStream(e)}.bind(this)),this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.stop()}),e.getVideoTracks().forEach(function(e){e.stop()})}))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.id),e.enabled=t)}),e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)}):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.id),e.enabled=t)}),e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalAudioStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableLocalVideoStreams=function(t){this._isRTCRtpSenderSupported?this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===o.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(e.track.enabled=t,o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id+":"+e.track.readyState)):(e.track.enabled=t,o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState)))}.bind(this)):this._pc.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.id),e.enabled=t)})})},e.prototype._enableDisableRemoteAudioStream=function(t){this._pc.getRemoteStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.readyState!==o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote audio track: "+e.id),e.enabled=t)})})},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.id===t.id&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Removing local track: "+e.track.id),e.track.stop(),"function"!=typeof e.replaceTrack&&this._pc.removeTrack(e))}.bind(this))},e.prototype.replaceTransceiverVideoTrackIfNeeded=function(i){if(!this.isRTCRtpSenderSupported())return E.Deferred().reject("RTCRtpSender is not supported").promise();var a,r=E.Deferred(),s=this._pc.getTransceivers().filter(function(e){return null===e.mid&&"inactive"!==e.direction&&e.sender.track&&"video"===e.sender.track.kind});return 0<s.length?(a=0,this._pc.getTransceivers().forEach(function(e){var t;e.stopped||null===e.mid||(t=null===e.sender.track&&e.receiver.track&&"video"===e.receiver.track.kind?e.sender:t)&&"function"==typeof t.replaceTrack&&(o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing null local video track with "+s[0].sender.track.id),a++,t.replaceTrack(s[0].sender.track).then(function(){e.direction=i,s[0].direction="inactive",r.resolve()}.bind(this)).catch(function(e){o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Failed to replace local video track: ",e),r.reject(e)}))}.bind(this)),0===a&&r.reject()):r.reject(),r.promise()},e.prototype.getStats=function(){if(this.isRTCRtpSenderSupported()){var t=E.Deferred(),i=new o.Base.AudioStatistics,a=new o.Base.VideoStatistics,r={},s=[];return this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&s.push(e.getStats().then(function(e){this._statsParser.parse(e,i,a,r)}.bind(this)))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&s.push(e.getStats().then(function(e){this._statsParser.parse(e,i,a,r)}.bind(this)))}.bind(this)),E.when.apply(this,s).then(function(){t.resolve({audioStatistics:i,videoStatistics:a,iceCandidateStatistics:r})},function(e){o.Base.Logger.error(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),t.reject(e)}),t.promise()}if(0===RTCPeerConnection.prototype.getStats.length)return this._pc.getStats().then(function(e){return this._statsParser.parse(e)}.bind(this)).catch(function(e){return o.Base.Logger.error(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Error getting stats report from RTCPeerConnection: "+e),Promise.reject(e)});var n=E.Deferred();return this._pc.getStats(function(e){e=this._statsParser.fallback(e);n.resolve(e)}),n.promise()},e.prototype.isRTCRtpSenderSupported=function(){return this._isRTCRtpSenderSupported},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?t?{foundation:t.foundation||e[1],component:t.component||e[2],networkId:e[3]}:{foundation:e[1],component:e[2],networkId:e[3]}:T},e.prototype.close=function(){o.Base.AbstractRTCConnectionProvider.prototype.close.call(this),clearTimeout(this._iceDisconnectedTimeoutId)},e.prototype._oniceConnectionStateChange=function(e){o.Base.AbstractRTCConnectionProvider.prototype._oniceConnectionStateChange.call(this,e),this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?(clearTimeout(this._iceDisconnectedTimeoutId),this._iceDisconnectedTimeoutId=setTimeout(function(){o.Base.Logger.debug(o.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"<<< Forced iceConnectionState to failed ["+this._pc.iceGatheringState+"]"),this._iceConnectionStateFailed=!0,this.trigger(o.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,[o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED])}.bind(this),15e3)):this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED?clearTimeout(this._iceDisconnectedTimeoutId):this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED&&(clearTimeout(this._iceDisconnectedTimeoutId),this._iceConnectionStateFailed=!1)},e.prototype.getIceConnectionState=function(){return this._pc?!0===this._iceConnectionStateFailed&&this._pc.iceConnectionState===o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_DISCONNECTED?o.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED:this._pc.iceConnectionState:T},o.Base.RTCConnectionProvider=e}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={create:function(e,t,i){var a=r.Base.Utils.getBrowserType();return a===r.Base.BrowserType.CHROME?new r.Base.RTCConnectionProvider(e,t,i):a===r.Base.BrowserType.EDGE?new r.Base.EdgeRTCConnectionProvider(e,t,i):a===r.Base.BrowserType.SAFARI?new r.Base.SafariRTCConnectionProvider(e,t,i):a===r.Base.BrowserType.FIREFOX?new r.Base.FirefoxRTCConnectionProvider(e,t,i):T}},r.Base.RTCConnectionProviderFactory=e}(AvayaClientServices),function(c){"use strict";function e(){c.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(c.Base.AbstractRTCStatsReportParser.prototype)).fallback=function(e){var i,a,r,s,t,n,o;return e.result().forEach(function(e){var t=e.stat("mediaType");"ssrc"===e.type&&-1<e.id.indexOf("send")&&"audio"===t&&(i=e),"ssrc"===e.type&&-1<e.id.indexOf("send")&&"video"===t&&(r=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"audio"===t&&(a=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"video"===t&&(s=e)}),a&&i&&(t={bytesReceived:parseInt(a.stat("bytesReceived")),packetsReceived:parseInt(a.stat("packetsReceived")),packetsLost:parseInt(a.stat("packetsLost")),googJitterReceived:parseInt(a.stat("googJitterReceived"))},n={bytesSent:parseInt(i.stat("bytesSent")),packetsSent:parseInt(i.stat("packetsSent")),googRtt:parseInt(i.stat("googRtt")),packetsLost:parseInt(i.stat("packetsLost"))},""===i.stat("packetsLost")&&(n.packetsLost=0),""===i.stat("googRtt")&&(n.googRtt=0),n=new c.Base.AudioStatistics(t.bytesReceived,n.bytesSent,t.packetsReceived,n.packetsSent,n.googRtt,n.packetsLost,t.packetsLost,t.googJitterReceived)),s&&r&&(o={bytesReceived:parseInt(s.stat("bytesReceived")),actualBitRateReceived:T,packetsReceived:parseInt(s.stat("packetsReceived")),packetsLost:parseInt(s.stat("packetsLost")),googFrameRateReceived:parseInt(s.stat("googFrameRateReceived"))},c.Base.Utils.isUndefined(o.packetsLost)&&(o.packetsLost=0),c.Base.Utils.isUndefined(o.packetsReceived)&&(o.packetsReceived=0),0===o.packetsReceived?o.packetsLossFractionReceived=0:o.packetsLossFractionReceived=s.stat("packetsLost")/s.stat("packetsReceived"),t={bytesSent:parseInt(r.stat("bytesSent")),actualBitRateTransmitted:T,packetsSent:parseInt(r.stat("packetsSent")),packetsLost:parseInt(r.stat("packetsLost")),googFrameRateSent:parseInt(r.stat("googFrameRateSent"))},c.Base.Utils.isUndefined(t.packetsLost)&&(t.packetsLost=0),c.Base.Utils.isUndefined(t.packetsSent)&&(t.packetsSent=0),0===t.packetsSent?t.packetsLossFractionTransmitted=0:t.packetsLossFractionTransmitted=r.stat("packetsLost")/r.stat("packetsSent"),o=new c.Base.VideoStatistics(t.bytesSent,o.bytesReceived,t.actualBitRateTransmitted,o.actualBitRateReceived,t.packetsSent,o.packetsReceived,t.packetsLost,o.packetsLost,t.packetsLossFractionTransmitted,o.packetsLossFractionReceived,t.googFrameRateSent,o.googFrameRateReceived)),{audioStatistics:n,videoStatistics:o}},c.Base.RTCStatsReportParser=e}(AvayaClientServices),function(a){"use strict";var i=/candidate:(\w{1,32}) (\d{1,5}) udp \d{1,10} (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){7}[a-fA-F0-9]{0,4})) \d+ typ relay raddr (?:(?:(?:\d{1,3}.){3}\d{1,3})|(?:(?:[a-fA-F0-9]{0,4}:){2,7}[a-fA-F0-9]{0,4})) rport \d+ .*/;function e(e,t,i){this._sdkStream=T,this._foundCandidates=!1,a.Base.AbstractRTCConnectionProvider.call(this,e,t,i),this._statsParser=new a.Base.SafariRTCStatsReportParser}(e.prototype=Object.create(a.Base.AbstractRTCConnectionProvider.prototype)).addStream=function(t){a.Base.AbstractRTCConnectionProvider.prototype.addStream.call(this,t),t.getTracks().forEach(function(e){this.addTrack(e,t)}.bind(this))},e.prototype.removeStream=function(e){this._pc&&this._pc.getSenders().forEach(function(t){e.getTracks().forEach(function(e){t&&t.track&&e.id===t.track.id&&(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Stopping and removing track: "+e.kind+" : "+e.id),e.stop(),this._pc.removeTrack(t))}.bind(this))}.bind(this))},e.prototype.createPeerConnection=function(e){a.Base.AbstractRTCConnectionProvider.prototype.createPeerConnection.call(this,e),this._pc.ontrack=this.onTrackInternal.bind(this)},e.prototype._getDTMFSender=function(){return this._dtmfSender!==T&&this._pc.getSenders().forEach(function(e){e.track!==T&&e.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(this._dtmfSender=e.dtmf)}),this._dtmfSender},e.prototype.stopAllStreams=function(){this._pc&&(this._pc.getSenders().forEach(function(e){e.track&&(e.track.stop(),this._pc.removeTrack(e))}.bind(this)),this._pc.getReceivers().forEach(function(e){e.track&&e.track.stop()}.bind(this)))},e.prototype._enableDisableRemoteStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling remote ":"Disabling remote ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling local ":"Disabling local ")+e.track.kind+" track: "+e.track.id),e.track.enabled=t)})},e.prototype._enableDisableLocalAudioStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&(e.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local audio track: "+e.track.id),e.track.enabled=t):a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local audio track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableLocalVideoStreams=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(e.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" local video track: "+e.track.id),e.track.enabled=t):a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+' local video track was skipped because the track is no longer "live": '+e.track.id+":"+e.track.readyState))}.bind(this))},e.prototype._enableDisableRemoteVideoStreams=function(t){this._pc.getReceivers().forEach(function(e){e.track&&e.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,(t?"Enabling":"Disabling")+" remote video track: "+e.track.id),e.track.enabled=t)}.bind(this))},e.prototype.addTrack=function(e,t){a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding local track: "+e.kind+" : "+e.id),a.Base.AbstractRTCConnectionProvider.prototype.addTrack.call(this,e,t);t=this._pc.addTrack(e,t);e.kind===a.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&a.Base.Utils.isDefined(t.dtmf)&&(this._dtmfSender=t.dtmf)},e.prototype.replaceLocalVideoTrack=function(t){this._pc.getSenders().forEach(function(e){e.track&&e.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Replacing local video track "+e.track.id+" with "+t.id),e.track.stop(),e.replaceTrack(t))})},e.prototype.isRTCRtpSenderSupported=function(){return!0},e.prototype.addVideoTransceiverIfNeeded=function(e){if(e){var t=!1;if(this._pc.getTransceivers().forEach(function(e){e.receiver&&e.receiver.track&&e.receiver.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0),e.sender&&e.sender.track&&e.sender.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&(t=!0)}),!t)return a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Adding video transceiver: "+e),this._pc.addTransceiver("video",{direction:e}),!0}return!1},e.prototype.parseIceRelayCandidate=function(e,t){e=i.exec(e);return e?{foundation:e[1],component:e[2],networkId:T}:T},e.prototype.setLocalVideoDirection=function(t){this._pc.getTransceivers().forEach(function(e){!e.stopped&&e.sender.track&&e.sender.track.kind===a.Base.AbstractRTCConnectionProvider.Constants.VIDEO_TRACK&&e.currentDirection!==t&&(e.sender.track.readyState===a.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE?(a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Setting local video track direction "+t+":"+e.sender.track.id+":"+e.sender.track.readyState),e.direction=t):a.Base.Logger.debug(a.Base.LoggerTags.RTC_CALL_CONNECTION_PROVIDER,"Skipped setting local video track direction because the track is ended "+e.sender.track.id+":"+e.sender.track.readyState))}.bind(this))},e.prototype.isSetLocalVideoDirectionSupported=function(){return!0},e.prototype.removeIfDoesNotSupportReplaceTrack=function(t){this._pc.getTransceivers().forEach(function(e){e.sender.track&&e.sender.track.id===t.id&&e.sender.track.stop()})},a.Base.SafariRTCConnectionProvider=e}(AvayaClientServices),function(o){"use strict";function e(){o.Base.AbstractRTCStatsReportParser.call(this)}(e.prototype=Object.create(o.Base.AbstractRTCStatsReportParser.prototype)).processTrackStats=function(e,t,i){e.frameHeight!==T?this.processVideoTrackStats(e,i):this.processAudioTrackStats(e,t)},e.prototype.processCandidatePairStats=function(e,t,i,a){var r,s,n;"succeeded"===e.state&&(r=this._localCandidates[e.localCandidateId],s=this._remoteCandidates[e.remoteCandidateId],n=e.ID||e.id,r&&s&&(a[n]=new o.Base.CandidatePairStatistics(r,s)),this.getCandidatePairMediaType(e,t,i)===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO&&this.processVideoCandidatePairStats(e,i))},e.prototype.getMediaType=function(e,t){return e.type===o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_TYPE.OUTBOUND_RTP?e.mediaType:-1!==e.id.indexOf("Audio")?o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.AUDIO:o.Base.AbstractRTCConnectionProvider.Constants.RTC_STATS_MEDIA_TYPE.VIDEO},e.prototype.getCandidatePairMediaType=function(e,t,i){if(o.Base.Utils.isDefined(e.transportId))return this._audioTransportId===e.transportId?"audio":this._videoTransportId===e.transportId?"video":void 0},o.Base.SafariRTCStatsReportParser=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.key=e,this.value=T,this.valueType=a,this.mediaType=i,this.alias=t}t.prototype.getValue=function(){return e.Base.Utils.isDefined(this.value)?'"'+this.value+'"':'"undefined"'},t.prototype.getAlias=function(){return'"'+this.alias+'"'},e.Base.StatisticLog=t}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Base.VideoStatistics=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S,f,E,A,P,T,y,b,m,R,I,D,N,O,L){this.bytesTransmitted=e,this.bytesReceived=t,this.actualBitRateTransmitted=i,this.actualBitRateReceived=a,this.packetsTransmitted=r,this.packetsReceived=s,this.packetLossTotalTransmitted=n,this.packetLossTotalReceived=o,this.packetsLossFractionTransmitted=c,this.packetsLossFractionReceived=l,this.actualFrameRateTransmitted=d,this.actualFrameRateReceived=C,this.framesEncoded=u,this.framesDecoded=h,this.codec=_,this.roundTripTimeMillis=v,this.heightTransmitted=g,this.heightReceived=p,this.widthTransmitted=f,this.widthReceived=S,this.firCountTransmitted=A,this.firCountReceived=E,this.pliCountTransmitted=T,this.pliCountReceived=P,this.framesTransmitted=y,this.framesReceived=b,this.nackCountTransmitted=R,this.nackCountReceived=m,this.availableTransmitBitrate=I,this.availableReceiveBitrate=D,this.jitterMillisecondsReceived=N,this.totalEncodeTime=O,this.totalDecodeTime=L}}(),function(a){"use strict";function e(e){this._isStarted=!1,this._initialDelay=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,this._evaluationWindowDuration=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this._delayOverloadThreshold=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorOverloadThreshold")||200,this._delayWarningThreshold=a.Base.Utils.queryJSONObject(e,"mediaConfiguration.voipConfigurationVideo.runtimePerformanceMonitorWarningThreshold")||40,this._evaluateInterval=500,this._accumulatedMeasurements=0,this._measurements=[],this._minimumMeasurements=T,this._setInterval=T,this.onPerformanceMonitorAlert=function(){}}e.prototype.start=function(){this._isStarted||(a.Base.Logger.debug(a.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor starting in - "+this._initialDelay+"s"),setTimeout(function(){this._isStarted=!0,this._minimumMeasurements=this._evaluationWindowDuration/this._evaluateInterval*1e3,this._setInterval=setInterval(this._measureRuntimeDelay.bind(this),this._evaluateInterval)}.bind(this),1e3*this._initialDelay))},e.prototype._measureRuntimeDelay=function(){var t,e;this._isStarted&&document.hasFocus()&&(e=Date.now(),setTimeout(function(e){t=Date.now(),t=t-e,this._registerMeasure(t)}.bind(this,e),0))},e.prototype._registerMeasure=function(e){this._measurements.push(e),this._accumulatedMeasurements+=e,this._measurements.length>=this._minimumMeasurements&&this._evaluate(this._measurements)},e.prototype._evaluate=function(e){var t=this._accumulatedMeasurements/e.length,i=e[e.length-1];i>this._delayWarningThreshold&&(i="Latest JS Scheduling delay exceeded threshold - delay= "+Math.round(i)+"ms",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.CPU_USAGE_WARNING,i)),t>this._delayOverloadThreshold&&(t="Average JS Scheduling delay exceeds threshold - delay= "+Math.round(t)+"ms",this.onPerformanceMonitorAlert(a.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,t));e=e.shift();this._accumulatedMeasurements-=e},e.prototype.stop=function(){this._isStarted&&(this._isStarted=!1,this._measurements=[],clearInterval(this._setInterval),a.Base.Logger.debug(a.Base.LoggerTags.CALL_PERFORMANCE_MONITOR,"RuntimePerformanceMonitor stopped"))},a.Base.RuntimePerformanceMonitor=e}(AvayaClientServices),function(a){"use strict";var s="m=audio",n="m=video",t="a=recvonly",i="a=sendonly",r="a=sendrecv",o="a=inactive",c="profile-level-id";a.Base.SDPUtil={updateAudioSdpInactive:function(e){return a.Base.SDPUtil.updateSdp(e,s,o)},updateAudioSdpRecvOnly:function(e){return a.Base.SDPUtil.updateSdp(e,s,t)},updateAudioSdpSendOnly:function(e){return a.Base.SDPUtil.updateSdp(e,s,i)},updateAudioSdpSendRecv:function(e){return a.Base.SDPUtil.updateSdp(e,s,r)},updateVideoSdpInactive:function(e){return a.Base.SDPUtil.updateSdp(e,n,o)},updateVideoSdpRecvOnly:function(e){return a.Base.SDPUtil.updateSdp(e,n,t)},updateVideoSdpSendOnly:function(e){return a.Base.SDPUtil.updateSdp(e,n,i)},updateVideoSdpSendRecv:function(e){return a.Base.SDPUtil.updateSdp(e,n,r)},updateSdp:function(e,t,i){if(-1===e.indexOf(t))return e;var a=e.indexOf(s),r=e.indexOf(n);return t===s?a<r?e.substring(0,a)+e.substring(a,r).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)+e.substring(r):e.substring(0,a)+e.substring(a).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i):r<a?e.substring(0,r)+e.substring(r,a).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)+e.substring(a):e.substring(0,r)+e.substring(r).replace(/a=inactive|a=sendrecv|a=recvonly|a=sendonly/,i)},rejectMedia:function(e,t){return-1===e.indexOf(t)?e:t===s?e.replace(/(m=audio)\s+(\d+)\s+(.*)/,"m=audio 0 $3"):t===n?e.replace(/(m=video)\s+(\d+)\s+(.*)/,"m=video 0 $3"):e},updateProfileLevelId:function(e,t){var i=e.indexOf(c);return-1<i&&((i=e.substring(i+c.length+1,i+c.length+1+6))!==t&&(e=e.replace(i,t),a.Base.Logger.debug(a.Base.LoggerTags.UTILS,"CHANGED the profile-level-id value of the SDP from:",i,"to:",t))),e},getProfileLevelId:function(e){var t=e.indexOf(c);return-1<t?e.substring(t+c.length+1,t+c.length+1+6):T},hasH264:function(e){var t=e.indexOf(n);if(-1===t)return!1;var i=e.indexOf(s);return null!==(t<i?e.substring(t,i):e.substring(t)).match(/a=rtpmap:\d+ H264\/\d+/)}}}(AvayaClientServices),function(o){"use strict";function e(e,t,i){this._data="",this._currentLineIndex=0,this._getSettingsFileVariable="function"==typeof e?e:T,this._setSettingsFileVariable="function"==typeof t?t:T,this._onAdditionalSettingsFileRequested="function"==typeof i?i:T}e.prototype.parse=function(e){return"string"!=typeof e||0===e.length||(this._data=e,this._currentLineIndex=0,this.proceed())},e.prototype.proceed=function(){for(var e,t=this._splitByLines(this._data),i=t.length,a=!0;this._currentLineIndex<i;this._currentLineIndex++)if(0!==(r=t[this._currentLineIndex].trim()).length&&"#"!==r.charAt(0)){var r=this._getLineArr(r);if(r.length){var s=r[0].toUpperCase(),n=r.slice(1);switch(s){case"SET":this._processSET(n);break;case"GOTO":0<=(e=this._processGOTO(n))&&(this._currentLineIndex=e);break;case"IF":0<=(e=this._processIF(n))&&(this._currentLineIndex=e);break;case"GET":this._currentLineIndex++,a=this._processGET(n);break;default:o.Base.Logger.warn(o.Base.LoggerTags.SETTINGS_FILE_PARSER,"SettingsFileParser: Unknown command",s)}}if(!a)return!1}return!0},e.prototype._splitByLines=function(e){return e.split(/\r\n|\r|\n/g)},e.prototype._trimSharp=function(e){return e.trim().replace(/^#+|#+$/g,"").trim()},e.prototype._getLineArr=function(e){var a=e.match(/("([^"]*)"|([^"\s]+))+(?=(\s*|\s*$))/g)||[];return a.length&&a.forEach(function(e,t,i){a[t]=e.replace(/"/g,"")}),a},e.prototype._processSET=function(e){var t,i;!this._setSettingsFileVariable||(t=e.length)&&(i=e[0],e=1<t?e[1]:"",this._setSettingsFileVariable(i,e))},e.prototype._processGET=function(e){return!this._onAdditionalSettingsFileRequested||(!e.length||(this._onAdditionalSettingsFileRequested(e[0]),!1))},e.prototype._processGOTO=function(e){var t=-1;if(e.length)for(var i,a=e[0],r=this._splitByLines(this._data),s=r.length,n=0;n<s;n++)if("#"===(i=r[n].trim()).charAt(0)&&"#"!==i.charAt(1)&&a===this._trimSharp(i)){t=n;break}return t},e.prototype._processIF=function(e){if(!this._getSettingsFileVariable)return-1;if(e.length<5)return-1;var t=e[0],i=e[1],a=e[2],r=e[3],e=e[4];if(t.toString().length<=1||"$"!==t.charAt(0))return-1;if("SEQ"!==i.toUpperCase())return-1;if(0===a.toString().length)return-1;if("GOTO"!==r.toUpperCase())return-1;t=t.substr(1).toUpperCase();return this._getSettingsFileVariable(t)===a?this._processGOTO([e]):-1},o.Base.SettingsFileParser=e}(AvayaClientServices),function(i){"use strict";function e(){this._handlers={},this.currentState=null}i.Base.SimpleFsm=function(){},e.prototype={handleEvent:function(e){var t;e.stringValue?this.currentState&&this._handlers?this._handlers[this.currentState.stringValue]&&this._handlers[this.currentState.stringValue][e.stringValue]?(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Executing handler for state "+this.currentState.stringValue+" and event "+e.stringValue+" "+this._handlers[this.currentState.stringValue][e.stringValue].name),t=this._handlers[this.currentState.stringValue][e.stringValue](e),i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Executed handler "+this._handlers[this.currentState.stringValue][e.stringValue].name),t&&t.nextState&&(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Next state: "+t.nextState.stringValue),this.currentState=t.nextState),t&&t.nextEvent&&(i.Base.Logger.debug(i.Base.LoggerTags.FSM,"Next event: "+t.nextEvent.stringValue),this.handleEvent(t.nextEvent))):i.Base.Logger.error(i.Base.LoggerTags.FSM,"No handler bound for state "+this.currentState.stringValue+" and event "+e.stringValue):i.Base.Logger.error(i.Base.LoggerTags.FSM,"State machine's state was not initialized"):i.Base.Logger.error(i.Base.LoggerTags.FSM,"Unknown event: "+e)},registerHandler:function(e,t,i){if(this._handlers[e.stringValue]||(this._handlers[e.stringValue]={}),this._handlers[e.stringValue][t.stringValue])throw"Duplicate FSM registration state "+e.stringValue+" event "+t.stringValue;this._handlers[e.stringValue][t.stringValue]=i},registerNoOpHandler:function(e,t){this.registerHandler(e,t,function(){})},start:function(e){this.currentState=e}},i.Base.SimpleFsm.SimpleFsm=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.stringValue=e,this.data=t}t.prototype={},e.Base.SimpleFsm.SimpleFsmEvent=t}(AvayaClientServices),function(e){"use strict";function t(e){this.stringValue=e}t.prototype={},e.Base.SimpleFsm.SimpleFsmState=t}(AvayaClientServices),function(e){"use strict";var r="AVAYA_JSCSDK_1.0";e.Base.Storage={TYPES:{LOCAL:function(){try{return window.localStorage}catch(e){return}}(),SESSION:function(){try{return window.sessionStorage}catch(e){return}}()},KEYS:{VIDEO_RESOLUTIONS:"videoResolutions"},get:function(e,t){return e?(e[r]||this._initNamespace(e),JSON.parse(e[r])[t]):T},set:function(e,t,i){if(!e)return!1;e[r]||this._initNamespace(e);var a=JSON.parse(e[r]);return a[t]=i,e[r]=JSON.stringify(a),!0},remove:function(e,t){if(!e||!e[r])return!1;var i=JSON.parse(e[r]);return delete i[t],e[r]=JSON.stringify(i),!0},_initNamespace:function(e){return e[r]=JSON.stringify({}),!0}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){Error.call(this,e),this.message=e,this.validatedObject=t,this.violatedRule=i,this.name="ValidationError"}t.prototype=Object.create(Error.prototype),e.Base.ValidationError=t}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={validate:function(){throw new Error("Function is not implemented!")},_processCondition:function(e,t,i,a){if(e)return!0;e=i.message||this.defaultMessage;return this._handleValidationError(e,t,i,a)},_handleValidationError:function(e,t,i,a){if(a)return!1;throw new r.Base.ValidationError(e,t,i)}},r.Base.Validators.BaseValidator=e}(AvayaClientServices),function(e){"use strict";function t(){this.defaultMessage="Provided element is not defined."}(t.prototype=Object.create(e.Base.Validators.BaseValidator.prototype)).validate=function(e,t,i){return this._processCondition(void 0!==e,e,t,i)},e.Base.Validators.DefinedValidator=t}(AvayaClientServices),function(e){"use strict";function t(){this.defaultMessage="Provided element is not compatible with required type."}(t.prototype=Object.create(e.Base.Validators.BaseValidator.prototype)).validate=function(e,t,i){var a=typeof e===t.expected||"object"==typeof e&&e instanceof t.expected;return this._processCondition(a,e,t,i)},e.Base.Validators.TypeValidator=t}(AvayaClientServices),function(a){"use strict";function e(e,t,i,a,r,s){this._width=e,this._height=t,this._fps=r||30,this._minBandwidth=i,this._maxBandwidth=a,this._hpMaxBandwidth=s}(e.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getFPS:function(){return this._fps},getMinBandwidth:function(){return this._minBandwidth},getMaxBandwidth:function(){return this._maxBandwidth},getHpMaxBandwidth:function(){return this._hpMaxBandwidth},toString:function(){return this._width+"x"+this._height+" (bandwidth: min. "+this._minBandwidth+"kbps, max. "+this._maxBandwidth+"kbps)"}}).convertToConfigVideoResolution=function(e){var t,i;for(i in a.Base.VideoResolution)a.Base.VideoResolution.hasOwnProperty(i)&&a.Base.VideoResolution[i].getHeight()===e.getHeight()&&(t=i);return t},a.Base.VideoResolutionDetails=e}(AvayaClientServices),function(e){"use strict";function t(){this._onInvalidCredentialsProvidedCallbacks=E.Callbacks()}t.prototype={onAuthenticationChallenge:function(e,t){},addOnInvalidCredentialsCallback:function(e){this._onInvalidCredentialsProvidedCallbacks.add(e)},removeOnInvalidCredentialsCallback:function(e){this._onInvalidCredentialsProvidedCallbacks.remove(e)}},e.Config.AbstractCredentialProvider=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.credentialProvider=new e.Config.AbstractCredentialProvider,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration}t.prototype={},e.Config.ACSConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.pollingIntervalInMinutes=0,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.AMMConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.AnalyticsConfiguration=function(){this.enabled=!1}}(),function(){"use strict";function e(e,t){return e+" "+t}AvayaClientServices.Config.Authentication.Header={basic:function(e,t){return"Basic "+btoa(e+":"+t)},bearer:e}}(),function(){"use strict";AvayaClientServices.Config.Authentication.Scheme={BASIC:"Basic",BEARER:"Bearer"}}(),function(){"use strict";AvayaClientServices.Config.Authentication.TokenType={BEARER:"Bearer",UPTOKEN:"UPToken",ESGTOKEN:"ESGToken"}}(),function(e){"use strict";var t={INCOMING_VIDEO_REQUEST_TIMEOUT:15e3,VIDEO_MAX_BANDWIDTH_ANY_NETWORK:1024,TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT:5e3,ICE_CANDIDATES_GATHERING_TIMEOUT:12e3,ICE_CONNECTION_RETRY_INTERVAL:5e3,MIN_PREFERRED_VIDEO_FPS:15};e.Config.CallUserConfiguration=function(){this.incomingCall=!1,this.videoEnabled=!1,this.startRingingOnIncomingCall=!0,this.incomingVideoRequestTimeout=t.INCOMING_VIDEO_REQUEST_TIMEOUT,this.videoMaxBandwidthAnyNetwork=t.VIDEO_MAX_BANDWIDTH_ANY_NETWORK,this.iceCandidatesGatheringTimeout=t.ICE_CANDIDATES_GATHERING_TIMEOUT,this.turnRelayCandidatesGatheringTimeout=t.TURN_RELAY_CANDIDATES_GATHERING_TIMEOUT,this.iceConnectionRestartInterval=t.ICE_CONNECTION_RETRY_INTERVAL,this.minPreferredVideoFPS=t.MIN_PREFERRED_VIDEO_FPS},e.Config.CallUserConfiguration.DefaultValues=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.CollaborationConfiguration=function(){this.contentSharingWorkerPath=T,this.imageQuality=1}}(),function(a){"use strict";function e(e,t,i){a.Config.AbstractCredentialProvider.call(this),this.username=e,this.password=t,this.domain=i,this.displayName="",this.isGuest=!1}(e.prototype=Object.create(a.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t({username:this.username,password:this.password,domain:this.domain,isGuest:this.isGuest,displayName:this.displayName})},a.Config.CredentialProvider=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Config.AbstractCredentialProvider.call(this),this.token=e,this.bearer="string"==typeof t?t.trim():T}(e.prototype=Object.create(i.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t({bearer:this.bearer,token:this.token})},i.Config.CredentialTokenProvider=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Config.CredentialProvider.call(this),this.username=this._createGuestUser(),this.password="",this.domain="",this.displayName=e,this.isGuest=!0}(e.prototype=Object.create(t.Config.CredentialProvider.prototype)).getDisplayName=function(){return this.displayName},e.prototype.setDisplayName=function(e){this.displayName=e},e.prototype._generateUUID=function(){var i=window.crypto||window.msCrypto;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=i.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"===e?t:3&t|8).toString(16)})},e.prototype._createGuestUser=function(){return"csaGuest/jsg-"+this._generateUUID()},t.Config.GuestCredentialProvider=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._failureCount=e,this._retryCallback=t,this._cancelCallback=i}t.prototype={getFailureCount:function(){return this._failureCount},retry:function(e){this._retryCallback(e)},cancel:function(){this._cancelCallback()}},e.Config.InvalidCredentialsEvent=t}(AvayaClientServices),function(e){"use strict";function t(){this.voipConfigurationAudio=new e.Config.VoIPConfigurationAudio,this.voipConfigurationVideo=new e.Config.VoIPConfigurationVideo,this.mediaEngineEnabled=!0,this.retrieveDeviceLabelsEnabled=!0,this.virtualBackgroundConfiguration=new e.Config.VirtualBackgroundConfiguration}t.prototype={},e.Config.MediaConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.MediaServiceConfiguration=function(){this.sessionId=T,this.sessionToken=T,this.userAgentURL=T,this.userAgentWSSURL=T,this.userAgentNotifyURL=T}}(),function(a){"use strict";function e(e,t,i){a.Config.CredentialTokenProvider.call(this,e,t),this.expiresIn=i,this._unauthorizedCount=0,this._onTokenRefreshedCallbacks=E.Callbacks()}(e.prototype=Object.create(a.Config.CredentialTokenProvider.prototype)).setToken=function(e){try{var t=JSON.parse(atob(e));return this.token=t.sessionToken,"number"==typeof t.expiresIn&&(this.expiresIn=t.expiresIn),this._onTokenRefreshedCallbacks.fire(this),!0}catch(e){return a.Base.Logger.error(a.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to parse session token: ",e),!1}},e.prototype._triggerRefreshToken=function(t){var i=E.Deferred(),e=new a.Config.InvalidCredentialsEvent(this._unauthorizedCount++,function(e){e!==T&&(this.token=e.token,this.expiresIn=e.expiresIn),t?(a.Base.Logger.info(a.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Restart with refreshed session token "),t().then(function(e){this._unauthorizedCount=0,i.resolve(e)}.bind(this),function(e){a.Base.Logger.error(a.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Failed to restart with refreshed session token"),i.reject(new a.Base.NetworkError(a.Base.ErrorReasons.NETWORK_UNAUTHORIZED,e))})):(this._unauthorizedCount=0,i.resolve())}.bind(this),function(){a.Base.Logger.warn(a.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Client cancelled session token refresh"),i.reject(new a.Base.NetworkError(a.Base.ErrorReasons.NETWORK_AUTHORIZATION_CANCELED))}.bind(this));return this._onInvalidCredentialsProvidedCallbacks.fire(e),i.promise()},e.prototype.addOnTokenRefreshedCallback=function(e){this._onTokenRefreshedCallbacks.add(e)},e.prototype.removeOnTokenRefreshedCallback=function(e){this._onTokenRefreshedCallbacks.remove(e)},a.Config.MPCCredentialProvider=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.webSocketConfig=t,this.sseConfig=i,this.restConfig=e,this.maxConnectionErrorCount=a||5}t.prototype={},e.Config.NetworkProviderConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this.frametimeThreshold=e,this.overloadsThreshold=t,this.evaluateInterval=i}t.prototype={},e.Config.PerformanceManagerConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.PresenceConfiguration=function(){this.enabled=!1}}(),function(){"use strict";AvayaClientServices.Config.SecurityPolicy={BEST_EFFORT:"BEST_EFFORT",DISABLED:"DISABLED",REQUIRED:"REQUIRED"}}(),function(e){"use strict";function t(e,t,i,a,r,s){this.hostName=e||"",this.port=t,this.isSecure=!!i,this.path=a||"",this.credentials=r||"",this.query=s||""}t.prototype={getUrl:function(e){e=e?"ws":"http";return this.isSecure&&(e+="s"),e+="://",this.credentials&&(e+=this.credentials+"@"),e+=this.hostName,this.port&&(e+=":"+this.port),e+=this.path,e+=this.query}},e.Config.ServerInfo=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider,this.maxCallStartReconnectionAttempts=-1,this._disableWebRTCForTheseBrowsers=[]}t.prototype={},e.Config.SGConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.UCCPConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.applicationBuildNumber="",this.applicationProductName="",this.applicationProductVersion="",this.ammConfiguration=new e.Config.AMMConfiguration,this.acsConfiguration=new e.Config.ACSConfiguration,this.uccpConfiguration=new e.Config.UCCPConfiguration,this.sgConfiguration=new e.Config.SGConfiguration,this.callUserConfiguration=new e.Config.CallUserConfiguration,this.presenceConfiguration=new e.Config.PresenceConfiguration,this.wcsConfiguration=new e.Config.WCSConfiguration,this.mediaConfiguration=new e.Config.MediaConfiguration,this.collaborationConfiguration=new e.Config.CollaborationConfiguration,this.analyticsConfiguration=new e.Config.AnalyticsConfiguration,this.mediaServiceContext="",this._mediaServiceConfiguration=null}t.prototype={},e.Config.UserConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.VideoResolution={RESOLUTION_1080p:"resolution1080p",RESOLUTION_720p:"resolution720p",RESOLUTION_480p:"resolution480p",RESOLUTION_360p:"resolution360p",RESOLUTION_240p:"resolution240p",RESOLUTION_180p:"resolution180p"}}(),function(e){"use strict";function t(){this.libraryLocation=T,this.mediaPipeModelType=T,this.backgroundBlurAmount=T,this.maskProcessingThreshold=T}t.prototype={},e.Config.VirtualBackgroundConfiguration=t}(AvayaClientServices),function(e){"use strict";function t(){this.bgnMode=!1,this.codecList=[],this.echoMode=!1,this.mediaMode=!1,this.mobileEchoMode=!1,this.noiseSupMode=!1,this.opusMode=!1,this.receiveGainMode=!1,this.receiveSupMode=!1,this.transmitGainMode=!1,this.vadMode=!1}t.prototype={},e.Config.VoIPConfigurationAudio=t}(AvayaClientServices),function(e){"use strict";function t(){this.anyNetworkBandwidthMode=!1,this.congestionControlAlgorithm=!1,this.videoResolution=e.Config.VideoResolution.RESOLUTION_720p,this.presentationHigherPriorityThanPeopleVideo=!1,this.maxAvgVideoEncodingTime=35,this.maxAvgVideoDecodingTime=40,this.maxWarningVideoEncodingTime=15,this.maxWarningVideoDecodingTime=18,this.performanceMonitorGracePeriod=5,this.performanceMonitorWindowDuration=10,this.performanceAdjustmentsReleaseWindowDuration=60,this.minVideoResolutionReductionInterval=10,this.minVideoResolutionIncrementInterval=60,this.runtimePerformanceMonitorOverloadThreshold=200,this.runtimePerformanceMonitorWarningThreshold=40,this.konvaSharingGracePeriod=15,this.konvaSharingMeasurementsInterval=.5,this.konvaSharingMeasurementsWindowDuration=10,this.konvaSharingFramesAverageLimit=2.5,this.konvaSharingFramesWarningLimit=1}t.prototype={},e.Config.VoIPConfigurationVideo=t}(AvayaClientServices),function(e){"use strict";function t(){this.enabled=!1,this.networkProviderConfiguration=new e.Config.NetworkProviderConfiguration,this.credentialProvider=new e.Config.CredentialProvider}t.prototype={},e.Config.WCSConfiguration=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Config.WCSCredentials=function(e,t,i,a,r){this.token=e,this.username=t,this.participantId=i,this.sessionId=a,this.mode=r}}(),function(s){"use strict";function e(e,t,i,a,r){s.Config.AbstractCredentialProvider.call(this),this.token=e,this.username=t,this.attendeeId=i,this.sessionId=a,this.mode=r}(e.prototype=Object.create(s.Config.AbstractCredentialProvider.prototype)).onAuthenticationChallenge=function(e,t){t(new s.Config.WCSCredentials(this.token,this.username,this.attendeeId,this.sessionId,this.mode))},s.Config.WCSCredentialTokenProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSConstants={SVC_GET_CONTACTS:"getContacts",SVC_SEARCH_CONTACTS:"searchContacts",TERMINAL_TYPE:"TERMINAL",PROVENANCE_TYPE_AVAYA:"Avaya",PROVENANCE_SUBTYPE_ADMINISTERED:"Administered"}}(),function(i){"use strict";function e(){this._quickSerachCache=new i.Base.SimpleIMDB(["searchString","searchScope"],{maxElements:250,timeToLive:1728e5,auditInterval:5e3})}e.prototype.addQuickSearchResultsToCache=function(e){for(var t,i=[],a=this._quickSerachCache.getCacheMaxSize(),r=this._trimToCacheMaxSize(e,a),s=0;s<r.length;s++)t={keys:{searchString:[r[s].searchString],searchScope:[r[s].searchScope]},element:r[s]},i.push(t);this._quickSerachCache.addElements(i)},e.prototype.getQuickSearchResultsFromCache=function(e,t){return this._quickSerachCache.searchByKeys({searchString:[e],searchScope:[t]},i.Base.IMDBSearchOptions.EXACT_MATCH)},e.prototype._trimToCacheMaxSize=function(e,t){e=t&&e.length>t?e.slice(-t):e.slice();return e},i.Providers.ACS.ACSContactsCache=e}(AvayaClientServices),function(y){"use strict";function e(){}e.prototype={convertACSContactArraytoContactArray:function(e){var t=[];if(e&&0<e.length)for(var i=0;i<e.length;i++)t.push(this.convertACSContactV1toContact(e[i]));return t},convertACSContactV1toContact:function(e){var r=y.Base.Utils,t=new y.Services.Contacts.Contact;if(r.isDefined(e)){r.isDefined(e.id)&&r.isDefined(e.id.value)&&(t.id=e.id),r.isDefined(e.contactUrl)&&r.isDefined(e.contactUrl.value)?t._uniqueAddressForMatching=e.contactUrl.value:r.isDefined(e.loginID)&&e.loginID?t._uniqueAddressForMatching=e.loginID:r.isDefined(e.terminalId)&&e.terminalId&&(t._uniqueAddressForMatching=e.terminalId);var i,s=new y.Base.Capability(y.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),n=new y.Base.Capability(y.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),a=function(e,t,i){var a;r.isDefined(e)&&e&&(r.isDefined(e.value)?("string"===i?a=e.value:"boolean"===i?a="true"===e.value:"float"===i&&(a=parseFloat(e.value)),t()._value=a,a=r.isDefined(e)&&r.isDefined(e.editable)&&!e.editable,t()._setWriteCapability(a?s:n)):"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e={value:a=e,editable:!1,provenance:[]},t()._value=a,t()._setWriteCapability(s)))};if(a(e.surName||e.lastName,t.getLastName.bind(t),"string"),a(e.givenName||e.firstName||e.name,t.getFirstName.bind(t),"string"),a(e.displayName||e.name,t.getDisplayName.bind(t),"string"),a(e.asciiSurName,t.getASCIILastName.bind(t),"string"),a(e.asciiGivenName,t.getASCIIFirstName.bind(t),"string"),a(e.asciiDisplayName,t.getASCIIDisplayName.bind(t),"string"),a(e.alias,t.getAlias.bind(t),"string"),a(e.location,t.getLocation.bind(t),"string"),a(e.workRoomNo,t.getWorkRoomNumber.bind(t),"string"),a(e.streetAddress,t.getStreetAddress.bind(t),"string"),a(e.city,t.getCity.bind(t),"string"),a(e.state,t.getState.bind(t),"string"),a(e.country,t.getCountry.bind(t),"string"),a(e.postalCode,t.getPostalCode.bind(t),"string"),a(e.company,t.getCompany.bind(t),"string"),a(e.manager,t.getManager.bind(t),"string"),a(e.department,t.getDepartment.bind(t),"string"),a(e.preferredLanguage,t.getLanguage.bind(t),"string"),a(e.notes,t.getNotes.bind(t),"string"),a(e.scopiaUserId||e.userId,t.getScopiaUserId.bind(t),"string"),a(e.scopiaLoginId||e.loginID,t.getScopiaLoginId.bind(t),"string"),a(e.rank,t.getRank.bind(t),"float"),a(e.isBuddy,t.isBuddy.bind(t),"boolean"),a(e.favourite,t.isFavorite.bind(t),"boolean"),a(e.videoCapable,t.isVideoCapable.bind(t),"boolean"),r.isDefined(e.pictureUrl)&&e.pictureUrl)if("string"==typeof e.pictureUrl?i=e.pictureUrl:r.isDefined(e.pictureUrl.value)&&""!==e.pictureUrl.value&&(i=e.pictureUrl.value),i)for(var o in y.Services.Contacts.ContactPictureSize)y.Services.Contacts.ContactPictureSize.hasOwnProperty(o)&&t.addPictureUrl(o,i+"?size="+y.Services.Contacts.ContactPictureSize[o].toLowerCase());if(r.isDefined(e.emailAddresses))for(var c=e.emailAddresses.length,l=0;l<c;l++){var d=new y.Services.Contacts.ContactEmailAddressField;r.isDefined(e.emailAddresses[l].value)&&(d._address=e.emailAddresses[l].value),r.isDefined(e.emailAddresses[l].type)&&(d._emailAddressType=this._convertACSEmailAddressTypeToContactEmailAddressType(e.emailAddresses[l].type)),e.emailAddresses[l].editable?d._setWriteCapability(n):d._setWriteCapability(s),t.getEmailAddresses().getValues().push(d)}if(r.isDefined(e.email)&&e.email&&((v=new y.Services.Contacts.ContactEmailAddressField)._address=e.email,v._setWriteCapability(s),t.getEmailAddresses().getValues().push(v)),r.isDefined(e.phoneNumberList)){var C=e.phoneNumberList.length;for(l=0;l<C;l++){var u=new y.Services.Contacts.ContactPhoneField;r.isDefined(e.phoneNumberList[l].phoneNumber)&&(u._phoneNumber=e.phoneNumberList[l].phoneNumber),r.isDefined(e.phoneNumberList[l].label1)&&(u._label1=e.phoneNumberList[l].label1),r.isDefined(e.phoneNumberList[l].label2)&&(u._label2=e.phoneNumberList[l].label2),r.isDefined(e.phoneNumberList[l].type)&&(u._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(e.phoneNumberList[l].type)),r.isDefined(e.phoneNumberList[l].speedDialEnabled)&&(u._speedDialEnabled="true"===e.phoneNumberList[l].speedDialEnabled),r.isDefined(e.phoneNumberList[l].isPrimary)&&(u._default="true"===e.phoneNumberList[l].isPrimary),e.phoneNumberList[l].editable?u._setWriteCapability(n):u._setWriteCapability(s);var h=e.phoneNumberList[l].provenance;if(h)for(var _=0;_<h.length;_++)h[_].type===y.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&h[_].subType===y.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&u.setAvayaAdministered(!0);t.getPhoneNumbers().getValues().push(u)}}var v,p,g,S=[];for(e.telephoneMobile&&S.push(e.telephoneMobile),e.telephoneOffice&&S.push(e.telephoneOffice),l=0;l<S.length;l++){var f=new y.Services.Contacts.ContactPhoneField;f._phoneNumber=S[l],f._setWriteCapability(s),t.getPhoneNumbers().getValues().push(f)}if(r.isDefined(e.type)&&e.type===y.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(v=!1,(p=new y.Services.Contacts.ContactPhoneField)._setWriteCapability(s),e.protocol&&(p._phoneNumberType=this._convertACSPhoneNumberTypeToContactPhoneNumberType(e.protocol),v=!0),e.description&&(p._label1=e.description,v=!0),e.number&&(p._phoneNumber=e.number,v=!0),v&&t.getPhoneNumbers().getValues().push(p)),r.isDefined(e.imaddresses)){var E=e.imaddresses.length;for(l=0;l<E;l++){var A=new y.Services.Contacts.ContactIMAddressField;r.isDefined(e.imaddresses[l].value)&&(A._address=e.imaddresses[l].value),r.isDefined(e.imaddresses[l].type)&&(A._imAddressType=this._convertACSHandleTypeToContactHandleType(e.imaddresses[l].type)),e.imaddresses[l].editable?A._setWriteCapability(n):A._setWriteCapability(s);var P=e.imaddresses[l].provenance;if(P)for(var T=0;T<P.length;T++)P[T].type===y.Providers.ACS.ACSConstants.PROVENANCE_TYPE_AVAYA&&P[T].subType===y.Providers.ACS.ACSConstants.PROVENANCE_SUBTYPE_ADMINISTERED&&A.setAvayaAdministered(!0);t.getIMAddresses().getValues().push(A)}}r.isDefined(e.custom1)&&r.isDefined(e.custom1.value)&&((p=new y.Services.Contacts.ContactStringField)._value=e.custom1.value,p._setWriteCapability(s),t.getCustom1().getValues().push(p)),t.getCustom1()._setWriteCapability(s),r.isDefined(e.custom2)&&r.isDefined(e.custom2.value)&&((g=new y.Services.Contacts.ContactStringField)._value=e.custom2.value,g._setWriteCapability(s),t.getCustom2().getValues().push(g)),t.getCustom2()._setWriteCapability(s),r.isDefined(e.custom3)&&r.isDefined(e.custom3.value)&&((g=new y.Services.Contacts.ContactStringField)._value=e.custom3.value,g._setWriteCapability(s),t.getCustom3().getValues().push(g)),t.getCustom3()._setWriteCapability(s),r.isDefined(e.type)&&e.type===y.Providers.ACS.ACSConstants.TERMINAL_TYPE&&(e.contactIdentifier?t.getTerminal()._terminalId=e.contactIdentifier.value:t.getTerminal()._terminalId=e.terminalId,e.givenName?t.getTerminal()._terminalName=e.givenName.value:t.getTerminal()._terminalName=e.name)}return t},convertQuickSearchResults:function(e,t,i){for(var a=[],r=0;r<e.length;r++){var s=t[e[r].correlationId],n=this.convertACSContactArraytoContactArray(e[r].contacts),n=new y.Services.Contacts.ResolveContactResult(s,i,n);a.push(n)}return a},convertContactToACSContactV1:function(e){return this.mergeContactWithACSContactV1(e,new y.Providers.ACS.ContactV1)},mergeContactWithACSContactV1:function(e,t){if(e&&t){var i=new y.Providers.ACS.ContactV1;e._getUniqueAddressWithoutChanges()&&(i.contactUrl.value=e._getUniqueAddressWithoutChanges()),i.id.value=t.id.value,y.Base.Utils.isDefined(e._terminal)&&""!==e.getTerminal().getTerminalId()?i.contactIdentifier.value=e.getTerminal().getTerminalId():i.contactIdentifier.value=t.contactIdentifier.value,i.pictureUrl.value=t.pictureUrl.value,i.asciiSurName.value=e.getASCIILastName().getValue(),i.asciiGivenName.value=e.getASCIIFirstName().getValue(),i.asciiDisplayName.value=e.getASCIIDisplayName().getValue(),i.surName.value=e.getLastName().getValue(),i.givenName.value=e.getFirstName().getValue(),i.displayName.value=e.getDisplayName().getValue(),i.alias.value=e.getAlias().getValue(),i.location.value=e.getLocation().getValue(),i.workRoomNo.value=e.getWorkRoomNumber().getValue(),i.streetAddress.value=e.getStreetAddress().getValue(),i.city.value=e.getCity().getValue(),i.state.value=e.getState().getValue(),i.country.value=e.getCountry().getValue(),i.postalCode.value=e.getPostalCode().getValue(),i.company.value=e.getCompany().getValue(),i.manager.value=e.getManager().getValue(),i.department.value=e.getDepartment().getValue(),i.preferredLanguage.value=e.getLanguage().getValue(),i.notes.value=e.getNotes().getValue(),y.Base.Utils.isDefined(e._scopiaUserId)&&(i.scopiaUserId.value=e.getScopiaUserId().getValue()),y.Base.Utils.isDefined(e._scopiaLoginId)&&(i.scopiaLoginId.value=e.getScopiaLoginId().getValue()),i.rank.value=e.getRank().getValue().toString(),i.isBuddy.value=e.isBuddy().getValue().toString(),i.favourite.value=e.isFavorite().getValue().toString(),i.videoCapable.value=e.isVideoCapable().getValue().toString();for(var a=[],r=e.getEmailAddresses().getValues(),s=0;s<r.length;s++){var n=new y.Providers.ACS.ContactEmailData;n.value=r[s].getAddress(),n.type=this._convertContactEmailAddressTypeToACSEmailAddressType(r[s].getEmailAddressType()),a.push(n)}i.emailAddresses=a;var o=[],c=e.getPhoneNumbers().getValues();for(s=0;s<c.length;s++){var l=new y.Providers.ACS.ContactPhoneData;l.phoneNumber=c[s].getPhoneNumber(),l.label1=c[s].getLabel1(),l.label2=c[s].getLabel2(),l.type=this._convertContactPhoneNumberTypeToACSPhoneType(c[s].getPhoneNumberType()),l.speedDialEnabled=c[s].isSpeedDialEnabled().toString(),l.isPrimary=c[s].isDefault().toString(),o.push(l)}i.phoneNumberList=o;var d=[],C=e.getIMAddresses().getValues();for(s=0;s<C.length;s++){var u=new y.Providers.ACS.ContactHandleData;u.value=C[s].getAddress(),u.type=this._convertContactHandleTypeToACSHandleType(C[s].getIMAddressType()),d.push(u)}i.imaddresses=d}return i},_convertACSPhoneNumberTypeToContactPhoneNumberType:function(e){if(!e)return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;switch(e){case y.Providers.ACS.ACSPhoneNumberType.WORK:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK;case y.Providers.ACS.ACSPhoneNumberType.HOME:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME;case y.Providers.ACS.ACSPhoneNumberType.HANDLE:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE;case y.Providers.ACS.ACSPhoneNumberType.MOBILE:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE;case y.Providers.ACS.ACSPhoneNumberType.FAX:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX;case y.Providers.ACS.ACSPhoneNumberType.PAGER:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER;default:return y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}},_convertContactPhoneNumberTypeToACSPhoneType:function(e){if(!e)return y.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK;switch(e){case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK:return y.Providers.ACS.ACSPhoneNumberType.WORK;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HANDLE:return y.Providers.ACS.ACSPhoneNumberType.HANDLE;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_HOME:return y.Providers.ACS.ACSPhoneNumberType.HOME;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_MOBILE:return y.Providers.ACS.ACSPhoneNumberType.MOBILE;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_FAX:return y.Providers.ACS.ACSPhoneNumberType.FAX;case y.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_PAGER:return y.Providers.ACS.ACSPhoneNumberType.PAGER;default:return y.Providers.ACS.ACSPhoneNumberType.PHONE_NUMBER_WORK}},_convertACSEmailAddressTypeToContactEmailAddressType:function(e){return e?e!==y.Providers.ACS.ACSEmailAddressType.WORK?(y.Providers.ACS.ACSEmailAddressType.OTHER,y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER):y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK:y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER},_convertContactEmailAddressTypeToACSEmailAddressType:function(e){return e?e!==y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_WORK?(y.Services.Contacts.ContactEmailAddressType.EMAIL_ADDRESS_OTHER,y.Providers.ACS.ACSEmailAddressType.OTHER):y.Providers.ACS.ACSEmailAddressType.WORK:y.Providers.ACS.ACSEmailAddressType.OTHER},_convertACSHandleTypeToContactHandleType:function(e){return e?e!==y.Providers.ACS.ACSHandleType.WORK?(y.Providers.ACS.ACSHandleType.OTHER,y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER):y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK:y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER},_convertContactHandleTypeToACSHandleType:function(e){return e?e!==y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK?(y.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER,y.Providers.ACS.ACSHandleType.OTHER):y.Providers.ACS.ACSHandleType.WORK:y.Providers.ACS.ACSHandleType.OTHER},extendAcsContact:function(e){var t=y.Base.Utils.deepMerge;if((e=t(new y.Providers.ACS.ContactV1,e)).emailAddresses)for(var i=e.emailAddresses.length,a=0;a<i;a++)e.emailAddresses[a]=t(new y.Providers.ACS.ContactEmailData,e.emailAddresses[a]);if(e.phoneNumberList){var r=e.phoneNumberList.length;for(a=0;a<r;a++)e.phoneNumberList[a]=t(new y.Providers.ACS.ContactPhoneData,e.phoneNumberList[a])}if(e.imaddresses){var s=e.imaddresses.length;for(a=0;a<s;a++)e.imaddresses[a]=t(new y.Providers.ACS.ContactHandleData,e.imaddresses[a])}return e}},y.Providers.ACS.ACSContactsConverter=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSContentsActions={ADD:"ADD",UPDATE:"UPDATE",DELETE:"DELETE",REFRESH:"refreshContactList"}}(),function(i){"use strict";function e(){this._acsRequestBuilder=null,this._acsContactsConverter=null,this._acsNetworkProvider=null,this._acsContactsProvider=null,this._acsDirectorySearchProvider=null,this._contactsAnalyticsService=new i.Services.Analytics.ContactsAnalyticsService,this._acsContactsCache=new i.Providers.ACS.ACSContactsCache}e.prototype={getACSContactsProvider:function(){var e;return this._acsContactsProvider||(e=this._createACSContactsProviderV1(),this._acsContactsProvider=new i.Providers.ACS.ACSContactsProvider,this._acsContactsProvider.registerACSContactsProvider(1,e)),this._acsContactsProvider},getACSDirectorySearchProvider:function(){var e;return this._acsDirectorySearchProvider||(e=this._createACSDirectorySearchProviderV1(),this._acsDirectorySearchProvider=new i.Providers.ACS.ACSDirectorySearchProvider,this._acsDirectorySearchProvider.registerACSDirectorySearchProvider(1,e)),this._acsDirectorySearchProvider},_createACSContactsProviderV1:function(){return new i.Providers.ACS.ACSContactsProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder())},_createACSDirectorySearchProviderV1:function(){return new i.Providers.ACS.ACSDirectorySearchProviderV1(this._getACSNetworkProvider(),this._getACSContactsConverter(),this._getACSRequestBuilder(),this._contactsAnalyticsService,this._acsContactsCache)},_getACSContactsConverter:function(){return this._acsContactsConverter||(this._acsContactsConverter=new i.Providers.ACS.ACSContactsConverter),this._acsContactsConverter},_getACSRequestBuilder:function(){return this._acsRequestBuilder||(this._acsRequestBuilder=new i.Providers.ACS.ACSRequestBuilder),this._acsRequestBuilder},_getACSNetworkProvider:function(){var e,t;return this._acsNetworkProvider||(t=[i.Providers.ACS.ACSEventTypes.CAS_NOTIFICATION,i.Providers.ACS.ACSEventTypes.PING],e=new i.Base.SSEProvider(t),t=new i.Base.RESTProvider,t=new i.Base.SSEIntegrationProvider(t,e),e=new i.Base.WebSocketProvider,e=new i.Base.NetworkProvider(e,t,i.Base.LoggerTags.ACS_CONTACTS_PROVIDER),t=new i.Base.NetworkProvider(new i.Base.RESTProvider,T,i.Base.LoggerTags.ACS_CONTACTS_PROVIDER),this._acsNetworkProvider=new i.Providers.ACS.ACSNetworkProvider(this._getACSRequestBuilder(),t,e,this._contactsAnalyticsService)),this._acsNetworkProvider}},i.Providers.ACS.ACSProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSProviderStates={STARTING:"STARTING",STARTED:"STARTED",STOPPING:"STOPPING",STOPPED:"STOPPED"}}(),function(o){"use strict";function e(){this._acsResources={},this._endpoints={},this._contentTypes={resourcesV1:"application/vnd.avaya.acs.resources.v1+json",resourcesV2:"application/vnd.avaya.acs.resources.v2+json",resourcesV7:"application/vnd.avaya.acs.resources.v7+json",errorV1:"application/vnd.avaya.acs.error.v1+json",contactsV1:"application/vnd.avaya.acs.contacts.v1+json",contactV1:"application/vnd.avaya.acs.contact.v1+json",searchV1:"application/vnd.avaya.acs.search.v1+json",searchresultV1:"application/vnd.avaya.acs.searchresult.v1+json",quicksearchV1:"application/vnd.avaya.acs.quicksearch.v1+json",searchresultiviewV1:"application/vnd.avaya.acs.searchresult-iview.v1+json"},this._usedIds={}}(e.prototype={}).setResources=function(e){this._acsResources=e,this._endpoints.searchContactsIView="",this._acsResources.resources.contacts&&(this._acsResources.resources.contacts.GET&&(this._acsResources.resources.contacts.GET.getContacts&&(this._endpoints.getContacts=this._acsResources.resources.contacts.GET.getContacts.href,this._endpoints.searchContacts=this._endpoints.getContacts+"/searches",this._endpoints.quickSearchContacts=this._endpoints.getContacts+"/quicksearches"),this._acsResources.resources.contacts.GET.searchIViewContacts&&(this._endpoints.searchContactsIView=this._acsResources.resources.contacts.GET.searchIViewContacts.href)),this._acsResources.resources.contacts.POST&&(this._acsResources.resources.contacts.POST.addUpdateContact&&(this._endpoints.addUpdateContact=this._acsResources.resources.contacts.POST.addUpdateContact.href),this._acsResources.resources.contacts.POST.performUnifiedSearch&&(this._endpoints.searchContacts=this._acsResources.resources.contacts.POST.performUnifiedSearch.href),this._acsResources.resources.contacts.POST.performQuickSearch&&(this._endpoints.quickSearchContacts=this._acsResources.resources.contacts.POST.performQuickSearch.href))),this._acsResources&&this._acsResources.sessionManagement&&this._acsResources.sessionManagement.href&&(this._endpoints.refreshRestSession=this._acsResources.sessionManagement.href)},e.prototype.setNotificationResources=function(e){e&&e.sessionManagement&&e.sessionManagement.href&&(this._endpoints.refreshNotificationSession=e.sessionManagement.href)},e.prototype.buildResourcesOptions=function(e,t){var i=[this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "),i={urlSuffix:"/acs/resources",sendType:"GET",dataType:"JSON",crossDomain:!0,headers:{Accept:i=t?[this._contentTypes.resourcesV7,this._contentTypes.resourcesV2,this._contentTypes.resourcesV1,this._contentTypes.errorV1].join(", "):i}};return e&&(i.headers["X-Avaya-Requested-With"]="XMLHttpRequest"),i},e.prototype.buildInvalidateSessionOptions=function(){return{urlSuffix:"/acs/session",sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildRefreshRestSessionOptions=function(){return this._endpoints.refreshRestSession?{url:this._endpoints.refreshRestSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/acs/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildRefreshNotificationSessionOptions=function(){return this._endpoints.refreshNotificationSession?{url:this._endpoints.refreshNotificationSession,sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}:{urlSuffix:"/notification/session",sendType:"GET",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildGetContactsOptions=function(e){if(o.Base.Utils.isUndefined(this._endpoints.getContacts))return T;var t={headers:{}},i=this._acsResources.resources.contacts&&this._acsResources.resources.contacts.GET.getContacts&&this._acsResources.resources.contacts.GET.getContacts.limits&&this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal?this._acsResources.resources.contacts.GET.getContacts.limits.maxSearchResultsTotal:250;return t.url=this._endpoints.getContacts+"?count="+i,e&&(t.url+="&after="+e),t.sendType="GET",t.dataType="JSON",t.headers.Accept=[this._contentTypes.contactsV1,this._contentTypes.errorV1].join(", "),t},e.prototype.buildGetContactOptions=function(e){return{url:e,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", ")}}},e.prototype.buildAddContactOptions=function(){return o.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?T:{url:this._endpoints.addUpdateContact,sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},e.prototype.buildUpdateContactOptions=function(){return o.Base.Utils.isUndefined(this._endpoints.addUpdateContact)?T:{url:this._endpoints.addUpdateContact,sendType:"PUT",dataType:"JSON",headers:{Accept:[this._contentTypes.contactV1,this._contentTypes.errorV1].join(", "),"Content-Type":this._contentTypes.contactsV1}}},e.prototype.buildAddUpdateContactData=function(e){return JSON.stringify({userEmail:this._acsResources.self,contacts:[e]},this._stringifyReplacer)},e.prototype.buildDeleteContactOptions=function(e){return{url:e,sendType:"DELETE",headers:{Accept:this._contentTypes.errorV1}}},e.prototype.buildSearchContactsData=function(e){var t,i=e.getSearchString(),a=e.getSearchField();a===o.Services.Contacts.SearchFieldType.NAME?t=["Displayname,"+i]:a===o.Services.Contacts.SearchFieldType.HANDLE?t=["EmailAddress,"+i]:a===o.Services.Contacts.SearchFieldType.LOGIN_ID?t=["LoginID,"+i]:a===o.Services.Contacts.SearchFieldType.TERMINAL?t=["Terminal,"+i]:a===o.Services.Contacts.SearchFieldType.ALL&&(t=["ALL,"+i]);e=e.getMaxResults();return 0===e&&(e=T),JSON.stringify({searchCriteria:t,maxResults:e})},e.prototype.buildSearchContactsIViewOnlyData=function(e){var t=e.getSearchString();o.Base.Utils.getBrowserType()!==o.Base.BrowserType.IE&&o.Base.Utils.getBrowserType()!==o.Base.BrowserType.EDGE||(t=encodeURIComponent(t));var i=e.getSearchField();i===o.Services.Contacts.SearchFieldType.NAME?a="displayname="+t:i===o.Services.Contacts.SearchFieldType.HANDLE?a="emailAddress="+t:i===o.Services.Contacts.SearchFieldType.LOGIN_ID?a="loginID="+t:i===o.Services.Contacts.SearchFieldType.TERMINAL?a="terminal="+t:i===o.Services.Contacts.SearchFieldType.ALL&&(a="all="+t);var a=[a],e=e.getMaxResults();return(e=0===e?T:e)&&a.push("maxResults="+e),a.join("&")},e.prototype.buildQuickSearchContactsOptions=function(){return{url:this._endpoints.quickSearchContacts+"?maxResults=100",sendType:"POST",dataType:"text",headers:{Accept:[this._contentTypes.searchresultV1,this._contentTypes.errorV1],"Content-Type":this._contentTypes.quicksearchV1}}},e.prototype.buildQuickSearchContactsData=function(e,t){var i,a=[],r=o.Services.Contacts.ResolveContactsFieldType;switch(t){case r.HANDLE:i="Handle";break;case r.PHONE_NUMBER:i="PhoneNumber";break;default:o.Base.Logger.warn(o.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Invalid field type of resolving contacts",t)}if(i)for(var s=0;s<e.length;s++){var n={correlationId:String(s),criteria:{}};n.criteria[i]=e[s],a.push(n)}return JSON.stringify({filter:["EmailAddress","FirstName","LastName","PhoneNumber","IMHandle"],searchCriteria:a})},e.prototype.buildSearchContactsOptions=function(){return{url:this._endpoints.searchContacts+"?searchDirectory=true",sendType:"POST",dataType:"JSON",headers:{Accept:[this._contentTypes.searchV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},e.prototype.buildSearchContactsIViewOnlyOptions=function(){return{url:this._endpoints.searchContactsIView,sendType:"GET",dataType:"JSON",headers:{Accept:[this._contentTypes.searchresultiviewV1,this._contentTypes.errorV1].join(", "),"Content-Type":"application/json"}}},e.prototype.buildNotificationsOptions=function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},e.prototype.buildSubscribeForACSNotifications=function(e){return{subscribe:{requestId:"subscribe-"+this._generateId(),resources:[{application:"acs",service:e,resource:this._endpoints[e]}],version:"1"}}},e.prototype.buildUnsubscribeFromACSNotifications=function(e){return{unsubscribe:{requestId:"unsubscribe-"+this._generateId(),resources:[{application:"acs",service:e,resource:this._endpoints[e]}],version:"1"}}},e.prototype._stringifyReplacer=function(e,t){return t&&t.hasOwnProperty("value")&&t.value===T?T:t},e.prototype._generateId=function(e,t){for(var i;i=o.Base.Utils.makeId(),this._usedIds[i];);return i},o.Providers.ACS.ACSRequestBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEmailAddressType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSEventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSHandleType={WORK:"work",OTHER:"other"}}(),function(){"use strict";AvayaClientServices.Providers.ACS.ACSPhoneNumberType={WORK:"work",HANDLE:"handle",MOBILE:"mobile",HOME:"home",FAX:"fax",PAGER:"pager"}}(),function(e){"use strict";function t(){this.value=T,this.editable=T}t.prototype={equals:function(e){return this.value===e.value&&this.editable===e.editable}},e.Providers.ACS.ContactAttribute=t}(AvayaClientServices),function(e){"use strict";function t(){this.value=T,this.type=e.Providers.ACS.ACSEmailAddressType.OTHER,this.editable=T}t.prototype={equals:function(e){return this.value===e.value&&this.type===e.type&&this.editable===e.editable}},e.Providers.ACS.ContactEmailData=t}(AvayaClientServices),function(e){"use strict";function t(){this.value=T,this.type=e.Providers.ACS.ACSHandleType.OTHER,this.editable=T,this.provenance=T}t.prototype={equals:function(e){return this.value===e.value&&this.type===e.type&&this.editable===e.editable&&this.provenance===e.provenance}},e.Providers.ACS.ContactHandleData=t}(AvayaClientServices),function(e){"use strict";function t(){this.phoneNumber=T,this.label1=T,this.label2=T,this.type=e.Providers.ACS.ACSPhoneNumberType.WORK,this.speedDialEnabled=!1,this.isPrimary=!1,this.editable=T}t.prototype={equals:function(e){return this.phoneNumber===e.phoneNumber&&this.label1===e.label1&&this.label2===e.label2&&this.type===e.type&&this.speedDialEnabled===e.speedDialEnabled&&this.isPrimary===e.isPrimary&&this.editable===e.editable}},e.Providers.ACS.ContactPhoneData=t}(AvayaClientServices),function(e){"use strict";function t(){this.userEmail="",this.contacts=[],this.hasMoreResults=!1}t.prototype={},e.Providers.ACS.ContactsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.id=new e.Providers.ACS.ContactAttribute,this.contactIdentifier=new e.Providers.ACS.ContactAttribute,this.contactUrl=new e.Providers.ACS.ContactAttribute,this.surName=new e.Providers.ACS.ContactAttribute,this.givenName=new e.Providers.ACS.ContactAttribute,this.displayName=new e.Providers.ACS.ContactAttribute,this.alias=new e.Providers.ACS.ContactAttribute,this.company=new e.Providers.ACS.ContactAttribute,this.location=new e.Providers.ACS.ContactAttribute,this.workRoomNo=new e.Providers.ACS.ContactAttribute,this.streetAddress=new e.Providers.ACS.ContactAttribute,this.city=new e.Providers.ACS.ContactAttribute,this.state=new e.Providers.ACS.ContactAttribute,this.country=new e.Providers.ACS.ContactAttribute,this.postalCode=new e.Providers.ACS.ContactAttribute,this.manager=new e.Providers.ACS.ContactAttribute,this.department=new e.Providers.ACS.ContactAttribute,this.asciiGivenName=new e.Providers.ACS.ContactAttribute,this.asciiSurName=new e.Providers.ACS.ContactAttribute,this.asciiDisplayName=new e.Providers.ACS.ContactAttribute,this.pictureUrl=new e.Providers.ACS.ContactAttribute,this.isBuddy=new e.Providers.ACS.ContactAttribute,this.favourite=new e.Providers.ACS.ContactAttribute,this.videoCapable=new e.Providers.ACS.ContactAttribute,this.preferredLanguage=new e.Providers.ACS.ContactAttribute,this.notes=new e.Providers.ACS.ContactAttribute,this.rank=new e.Providers.ACS.ContactAttribute,this.custom1=new e.Providers.ACS.ContactAttribute,this.custom2=new e.Providers.ACS.ContactAttribute,this.custom3=new e.Providers.ACS.ContactAttribute,this.scopiaUserId=new e.Providers.ACS.ContactAttribute,this.scopiaLoginId=new e.Providers.ACS.ContactAttribute,this.phoneNumberList=[],this.emailAddresses=[],this.imaddresses=[]}t.prototype={equals:function(e){if(!(this.id.equals(e.id)&&this.contactIdentifier.equals(e.contactIdentifier)&&this.contactUrl.equals(e.contactUrl)&&this.surName.equals(e.surName)&&this.givenName.equals(e.givenName)&&this.displayName.equals(e.displayName)&&this.alias.equals(e.alias)&&this.company.equals(e.company)&&this.location.equals(e.location)&&this.workRoomNo.equals(e.workRoomNo)&&this.streetAddress.equals(e.streetAddress)&&this.city.equals(e.city)&&this.state.equals(e.state)&&this.country.equals(e.country)&&this.postalCode.equals(e.postalCode)&&this.manager.equals(e.manager)&&this.department.equals(e.department)&&this.asciiGivenName.equals(e.asciiGivenName)&&this.asciiSurName.equals(e.asciiSurName)&&this.asciiDisplayName.equals(e.asciiDisplayName)&&this.pictureUrl.equals(e.pictureUrl)&&this.isBuddy.equals(e.isBuddy)&&this.favourite.equals(e.favourite)&&this.videoCapable.equals(e.videoCapable)&&this.preferredLanguage.equals(e.preferredLanguage)&&this.notes.equals(e.notes)&&this.rank.equals(e.rank)&&this.custom1.equals(e.custom1)&&this.custom2.equals(e.custom2)&&this.custom3.equals(e.custom3)&&this.scopiaUserId.equals(e.scopiaUserId)&&this.scopiaLoginId.equals(e.scopiaLoginId))||this.phoneNumberList.length!==e.phoneNumberList.length||this.emailAddresses.length!==e.emailAddresses.length||this.imaddresses.length!==e.imaddresses.length)return!1;for(var t=0;t<this.phoneNumberList.length;t++)if(!this.phoneNumberList[t].equals(e.phoneNumberList[t]))return!1;for(t=0;t<this.emailAddresses.length;t++)if(!this.emailAddresses[t].equals(e.emailAddresses[t]))return!1;for(t=0;t<this.imaddresses.length;t++)if(!this.imaddresses[t].equals(e.imaddresses[t]))return!1;return!0}},e.Providers.ACS.ContactV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.displayMsg="",this.errorMsg=""}t.prototype={},e.Providers.ACS.ErrorV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}t.prototype={},e.Providers.ACS.NotificationResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.resources={avayaRequestTimeout:{maximum:T,minimum:T,recommended:T},capabilities:[],contactSearchCapabilities:[],resources:{notification:{websocket:{href:T},sse:{href:T}},contacts:{POST:{addUpdateContact:{href:T}},GET:{getContacts:{href:T,limits:{maxSearchResultsPerPage:T,maxSearchResultsTotal:T}},searchIViewContacts:{href:T,limits:{maxSearchResultsTotal:T}}}},pictures:{GET:{getUserPicture:{href:T}}}},self:T,sessionManagement:{href:T,timeout:T}}}t.prototype={},e.Providers.ACS.ResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.ACS.ResourcesV1.call(this),this.version=2,this.v2MediaType=!0}t.prototype={},e.Providers.ACS.ResourcesV2=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ACS.ObservableEvents={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMM3EventTypes={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStateActions={TYPING:"typing",RECORDING_AUDIO:"recordingAudio",RECORDING_VIDEO:"recordingVideo",ATTACHING_FILE:"attachingFile",TAKING_PICTURE:"takingPicture",OTHER:"other"}}(),function(s){"use strict";s.Providers.AMM.AMMChatStateNotification=function(e,t,i,a,r){this.action=e.action,this.state=e.state,this.self=t,this.timeout=setTimeout(function(){t?r(e):(e.action="",e.state=s.Providers.AMM.ChatStates.PAUSED,i.fire(e))},a)}}(AvayaClientServices),function(s){"use strict";function e(){this._chatStateNotifications=[],this._conversationId="",this._localComposingInactivityTimeout=15e3,this._remoteComposingInactivityTimeout=6e4,this._composingRefreshTimeout=5e3,this._chatStateRefresh=!1,this._chatStateRefreshTimeout={}}e.prototype={setConversationId:function(e){this._conversationId=e},getConversationId:function(){return this._conversationId},setChatStateNotification:function(e,t,i){e.state===s.Providers.AMM.ChatStates.COMPOSING?this._setTypingNotification(e,t,i):this._chatStateNotifications[e.address]&&e.state===s.Providers.AMM.ChatStates.PAUSED&&(clearTimeout(this._chatStateNotifications[e.address].timeout),delete this._chatStateNotifications[e.address])},setChatStateRefreshTimeout:function(){this._chatStateRefresh=!0,this._chatStateRefreshTimeout=setTimeout(function(){this._chatStateRefresh=!1}.bind(this),this._composingRefreshTimeout)},getChatNotification:function(e){return this._chatStateNotifications[e]},clearChatStateRefreshTimeout:function(){this._chatStateRefresh=!1,clearTimeout(this._chatStateRefreshTimeout)},clearChatStateNotifications:function(){this._chatStateNotifications=[]},isChatStateAdded:function(){return this._chatStateRefresh},onPauseChatState:function(e,t){return E.Deferred().reject().promise()},_setTypingNotification:function(e,t,i){var a=t?this._localComposingInactivityTimeout:this._remoteComposingInactivityTimeout,r=function(e){this._localTimeoutEvent(e,i)}.bind(this);this._chatStateNotifications[e.address]?(clearTimeout(this._chatStateNotifications[e.address].timeout),this._chatStateNotifications[e.address].timeout=setTimeout(function(){t?this._localTimeoutEvent(e,i):this._remoteTimeoutEvent(e,i)}.bind(this),a)):this._chatStateNotifications[e.address]=new s.Providers.AMM.AMMChatStateNotification(e,t,i,a,r)},_localTimeoutEvent:function(t,i){this.onPauseChatState(t.action,this._conversationId).fail(function(e){s.Base.Logger.error(s.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"An attempt to update typing status was failed.",e),this._remoteTimeoutEvent(t,i)}.bind(this))},_remoteTimeoutEvent:function(e,t){e.action="",e.state=s.Providers.AMM.ChatStates.PAUSED,t.fire(e)}},s.Providers.AMM.AMMChatStateNotifications=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ChatStates={COMPOSING:"composing",PAUSED:"paused"}}(),function(i){"use strict";function e(){this._parsers=[]}e.prototype={register:function(e,t){this._parsers[e]=t},unregister:function(e){this._parsers[e]=T},parse:function(e,t){return this._parsers[e]?this._delegateParser(e,t):t},_delegateParser:function(e,t){if(this._parsers[e]!==T)return this._parsers[e].parse(t);i.Base.Logger.error(i.Base.LoggerTags.AMM_MESSAGING_PROVIDER,"No parser specified!",e)}},i.Providers.AMM.AMMMessagesParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.MessagesService={CONVERSATION:"conversation",CHAT_STATE:"chatState"}}(),function(s){"use strict";function e(){this._ammProvider={}}e.prototype={getAMMProvider:function(e){if(s.Base.Utils.isDefined(e)&&e.enabled)return E.isEmptyObject(this._ammProvider)&&(this._ammProvider=new s.Providers.AMM.AMMProvider,this._ammProvider.registerAMMProvider(2.1,this._createAMM2_1Provider()),this._ammProvider.registerAMMProvider(3,this._createAMM3_XProvider("AMM3Provider")),this._ammProvider.registerAMMProvider(3.2,this._createAMM3_XProvider("AMM3_2Provider"))),this._ammProvider},_createAMM2_1Provider:function(){var e=new s.Base.RESTProvider,t=new s.Base.NetworkProvider(e,T,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),e=this._createEventsV2Parser();return new s.Providers.AMM.AMM2_1Provider(t,e)},_createEventsV2Parser:function(){var e=new s.Providers.AMM.AMMMessagesParser;return e.register(s.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new s.Providers.AMM.GetConversationsParser),e.register(s.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new s.Providers.AMM.ValidateUsersParser),e.register(s.Providers.AMM.AMMResponsesTypes.SEND,new s.Providers.AMM.SendParser),e.register(s.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new s.Providers.AMM.GetMessagesParser),e.register(s.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new s.Providers.AMM.AddParticipantsParser),e.register(s.Providers.AMM.AMMResponsesTypes.CLOSE,new s.Providers.AMM.CloseParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new s.Providers.AMM.NotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFIED,new s.Providers.AMM.NotifiedParser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY,new s.Providers.AMM.DiscoveryV2Parser),e.register(s.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new s.Providers.AMM.SubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new s.Providers.AMM.UnsubscribedParser),e},_createAMM3_XProvider:function(e){var t=[s.Providers.AMM.AMM3EventTypes.CAS_NOTIFICATION,s.Providers.AMM.AMM3EventTypes.PING],i=new s.Base.SSEProvider(t),a=new s.Base.RESTProvider,r=new s.Base.SSEIntegrationProvider(a,i),t=new s.Base.WebSocketProvider,a=new s.Base.NetworkProvider(t,r,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),i=new s.Base.RESTProvider,t=new s.Base.NetworkProvider(i,T,s.Base.LoggerTags.AMM_MESSAGING_PROVIDER),r=this._createEventsV3Parser(),i=new s.Providers.AMM.AMMChatStateNotifications;return new s.Providers.AMM[e](t,a,i,r)},_createEventsV3Parser:function(){var e=new s.Providers.AMM.AMMMessagesParser;return e.register(s.Providers.AMM.AMMResponsesTypes.GET_CONVERSATIONS,new s.Providers.AMM.GetConversationsParser),e.register(s.Providers.AMM.AMMResponsesTypes.VALIDATE_USERS,new s.Providers.AMM.ValidateUsersParser),e.register(s.Providers.AMM.AMMResponsesTypes.SEND,new s.Providers.AMM.SendParser),e.register(s.Providers.AMM.AMMResponsesTypes.GET_MESSAGES,new s.Providers.AMM.GetMessagesParser),e.register(s.Providers.AMM.AMMResponsesTypes.ADD_PARTICIPANTS,new s.Providers.AMM.AddParticipantsParser),e.register(s.Providers.AMM.AMMResponsesTypes.CLOSE,new s.Providers.AMM.CloseParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFICATION,new s.Providers.AMM.NotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.NOTIFIED,new s.Providers.AMM.NotifiedParser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY,new s.Providers.AMM.DiscoveryV3Parser),e.register(s.Providers.AMM.AMMResponsesTypes.DISCOVERY_NOTIFICATION,new s.Providers.AMM.DiscoveryNotificationParser),e.register(s.Providers.AMM.AMMResponsesTypes.SUBSCRIBED,new s.Providers.AMM.SubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.UNSUBSCRIBED,new s.Providers.AMM.UnsubscribedParser),e.register(s.Providers.AMM.AMMResponsesTypes.RESOURCE_STATE,new s.Providers.AMM.ResourceStateParser),e}},s.Providers.AMM.AMMProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.ProviderStates={AVAILABLE:"available",UNAVAILABLE:"unavailable"}}(),function(){"use strict";AvayaClientServices.Providers.AMM.AMMResponsesTypes={ADD_PARTICIPANTS:"AddParticipants",GET_CONVERSATIONS:"GetConversations",VALIDATE_USERS:"ValidateUsers",SEND:"Send",GET_MESSAGES:"GetMessages",CLOSE:"Close",NOTIFICATION:"Notification",NOTIFIED:"Notified",DISCOVERY:"Discovery",DISCOVERY_NOTIFICATION:"DiscoveryNotification",SUBSCRIBED:"Subscribed",UNSUBSCRIBED:"Unsubscribed",RESOURCE_STATE:"ResourceState"}}(),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")}},e.Providers.AMM.AbstractParser=t}(AvayaClientServices),function(r){"use strict";function e(){}(e.prototype=Object.create(r.Providers.AMM.AbstractParser.prototype)).parse=function(e){for(var t={participants:[]},i=0;i<e.participants.length;i++){var a=new r.Providers.AMM.AddParticipantsResponse(e.participants[i].address,e.participants[i].givenName,e.participants[i].language,e.participants[i].modalities,e.participants[i].nativeGivenName,e.participants[i].nativeSurname,e.participants[i].surname,e.participants[i].type);t.participants.push(a)}return t},r.Providers.AMM.AddParticipantsParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.CloseResponse(e.closed,e.href,e.sensitivity)},t.Providers.AMM.CloseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryNotificationResponse(e.applications,e.capabilities,e.sessionManagement,e.version,e.commandURL)},t.Providers.AMM.DiscoveryNotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryV2Response(e.addresses,e.avayaRequestTimeout,e.capabilities,e.conversationsResource,e.domains,e.limits,e.messages,e.outbox,e.self,e.services)},t.Providers.AMM.DiscoveryV2Parser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.DiscoveryV3Response(e.avayaRequestTimeout,e.contacts,e.conversationsResource,e.domains,e.messages,e.notificationService,e.notifications,e.outbox,e.picture,e.self,e.services,e.sessionManagement,e.users)},t.Providers.AMM.DiscoveryV3Parser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.GetConversationsResponse(e.conversations,e.href,e.lastUpdated,e.moreSearchResults)},t.Providers.AMM.GetConversationsParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.GetMessagesResponse(e.attachmentCount,e.counts,e.flags,e.href,e.id,e.lastAccessedTime,e.lastUpdated,e.latestEntryTimestamp,e.messages,e.participants,e.subject,e.totalCount,e.type,e.unreadAttachmentCount,e.unreadCount)},t.Providers.AMM.GetMessagesParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.NotificationResponse(e.application,e.contents,e.resource,e.service,e.version)},t.Providers.AMM.NotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.NotifiedResponse(e.requestId,e.results,e.version)},t.Providers.AMM.NotifiedParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.ResourceStateResponse(e.results,e.version)},t.Providers.AMM.ResourceStateParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.SendResponse(e.body,e.event,e.flags,e.from,e.href,e.id,e.lastModifiedDate,e.parts,e.receivedDate,e.subject,e.threadId,e.to,e.inReplyTo)},t.Providers.AMM.SendParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.SubscribedResponse(e.results,e.version)},t.Providers.AMM.SubscribedParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.AMM.AbstractParser.prototype)).parse=function(e){return new t.Providers.AMM.UnsubscribedResponse(e.results,e.version)},t.Providers.AMM.UnsubscribedParser=e}(AvayaClientServices),function(r){"use strict";function e(){}(e.prototype=Object.create(r.Providers.AMM.AbstractParser.prototype)).parse=function(e){for(var t={validatedAddresses:[]},i=0;i<e.validatedAddresses.length;i++){var a=new r.Providers.AMM.ValidateUsersResponse(e.validatedAddresses[i].addresses,e.validatedAddresses[i].query);t.validatedAddresses.push(a)}return t},r.Providers.AMM.ValidateUsersParser=e}(AvayaClientServices),function(e){"use strict";function t(){this.active=!1,this.closed=!1,this.href="",this.sensitivity=""}t.prototype={},e.Providers.AMM.ConversationFlagsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.conversationIds=[],this.href="",this.lastUpdated=""}t.prototype={},e.Providers.AMM.ConversationIdsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.href="",this.id="",this.lastAccessedTime="",this.lastUpdated=""}t.prototype={},e.Providers.AMM.ConversationIdV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.conversations=[],this.href="",this.lastUpdated="",this.moreSearchResults=!1}t.prototype={},e.Providers.AMM.ConversationsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.attachmentCount=0,this.href="",this.id="",this.flags=new e.Providers.AMM.ConversationFlagsV1,this.lastAccessedTime="",this.lastUpdated="",this.latestEntryTimestamp="",this.messages=[],this.name="",this.owner="",this.participants={href:""},this.totalCount=0,this.type="",this.unreadAttachmentCount=0,this.unreadCount=0,this.counts={eventCount:0,eventUnreadMessage:0,messageAttachment:0,messageCount:0,messageUnreadAttachment:0,messageUnreadMessage:0}}t.prototype={},e.Providers.AMM.ConversationV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.address="",this.givenName="",this.language="",this.modalities=[],this.nativeGivenName="",this.nativeSurname="",this.picture="",this.surname="",this.subType="",this.type=""}t.prototype={},e.Providers.AMM.EntityV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.displayMsg="",this.errorMsg="",this.errorCode=0}t.prototype={},e.Providers.AMM.ErrorV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.participants=[],this.reason="",this.type="",this.units="",this.value=0}t.prototype={},e.Providers.AMM.EventV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.doNotForward=!1,this.href="",this.importance="",this.read=!1,this.sensitivity=""}t.prototype={},e.Providers.AMM.MessageFlagsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.body="",this.event=new e.Providers.AMM.EventV1,this.flags=new e.Providers.AMM.MessageFlagsV1,this.from=new e.Providers.AMM.EntityV1,this.href="",this.id="",this.inReplyTo="",this.lastModifiedDate="",this.parts=[],this.receivedDate="",this.subject="",this.threadId="",this.to=[]}t.prototype={},e.Providers.AMM.MessageV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=1,this.applications=[],this.capabilities=[],this.commandURL="",this.sessionManagement={}}t.prototype={},e.Providers.AMM.NotificationResourcesV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.action="",this.address="",this.state="",this.timestamp=""}t.prototype={},e.Providers.AMM.NotificationContentsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.participants=[]}t.prototype={},e.Providers.AMM.ParticipantsV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.disposition="",this.duration=0,this.media="",this.mimeType="",this.partId="",this.size=0}t.prototype={},e.Providers.AMM.PartV1=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=2,this.addresses="",this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.services={markAsReadIf:"",validateAddress:""}}t.prototype={},e.Providers.AMM.ResourcesV2=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=3,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.conversationsResource={href:"",maxIdsLimit:0,maxMessageCount:0},this.domains=[],this.limits={maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0},this.messages="",this.outbox="",this.self="",this.picture="",this.contacts="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}}}t.prototype={},e.Providers.AMM.ResourcesV3=t}(AvayaClientServices),function(e){"use strict";function t(){this.version=4,this.avayaRequestTimeout={recommended:0,maximum:0,minimum:0},this.capabilities={richContent:!1},this.contacts={href:""},this.conversationsResource={href:"",capabilities:{automaticLastAccessedDate:!1,postSessionEvent:!1,subjectChange:!1},limits:{maxMessageCount:0,maxIdsLimit:0}},this.domains=[],this.messages={href:"",capabilities:{html:!1}},this.notifications={href:""},this.outbox={href:"",capabilities:{richContent:!1},limits:{maxAudioSize:0,maxGenericAttachmentSize:0,maxImageSize:0,maxTextLength:0,maxVideoSize:0}},this.picture={href:""},this.self="",this.services={markAsReadIf:{href:""},validateAddresses:{href:""},markAsReadBatch:{href:"",limits:{maxBatchSize:0}}},this.notificationService={sse:{href:""},websocket:{href:""}},this.users={href:""},this.sessionManagement={href:"",timeout:0,username:""}}t.prototype={},e.Providers.AMM.ResourcesV4=t}(AvayaClientServices),function(e){"use strict";function t(){this.query="",this.addresses=[]}t.prototype={},e.Providers.AMM.ValidatedAddressesV1=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.AMM.AddParticipantsResponse=function(e,t,i,a,r,s,n,o){this._address=e,this.givenName=t,this.language=i,this.modalities=a,this.nativeGivenName=r,this.nativeSurname=s,this.surname=n,this.type=o}}(),function(){"use strict";AvayaClientServices.Providers.AMM.CloseResponse=function(e,t,i){this.closed=e,this.href=t,this.sensitivity=i}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryNotificationResponse=function(e,t,i,a,r){this.applications=e,this.capabilities=t,this.sessionManagement=i,this.version=a,this.commandURL=r}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV2Response=function(e,t,i,a,r,s,n,o,c,l){this.addresses=e,this.avayaRequestTimeout=t,this.capabilities=i,this.conversationsResource=a,this.domains=r,this.limits=s,this.messages=n,this.outbox=o,this.self=c,this.services=l}}(),function(){"use strict";AvayaClientServices.Providers.AMM.DiscoveryV3Response=function(e,t,i,a,r,s,n,o,c,l,d,C,u){this.avayaRequestTimeout=e,this.contacts=t,this.conversationsResource=i,this.domains=a,this.messages=r,this.notificationService=s,this.notifications=n,this.outbox=o,this.picture=c,this.self=l,this.services=d,this.sessionManagement=C,this.users=u}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetConversationsResponse=function(e,t,i,a){this.conversations=e,this.href=t,this.lastUpdated=i,this.moreSearchResults=a;for(var r=0;r<this.conversations.length;r++)for(var s=0;s<this.conversations[r].messages.length;s++){this.conversations[r].messages[s].from._address=this.conversations[r].messages[s].from.address,delete this.conversations[r].messages[s].from.address;for(var n=0;n<this.conversations[r].messages[s].to.length;n++)this.conversations[r].messages[s].to[n]._address=this.conversations[r].messages[s].to[n].address,delete this.conversations[r].messages[s].to[n].address}}}(),function(){"use strict";AvayaClientServices.Providers.AMM.GetMessagesResponse=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_){this.attachmentCount=e,this.counts=t,this.flags=i,this.href=a,this.id=r,this.lastAccessedTime=s,this.lastUpdated=n,this.latestEntryTimestamp=o,this.messages=c,this.participants=l,this.subject=d,this.totalCount=C,this.type=u,this.unreadAttachmentCount=h,this.unreadCount=_}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotificationResponse=function(e,t,i,a,r){this.application=e,this.contents=t,this.resource=i,this.service=a,this.version=r}}(),function(){"use strict";AvayaClientServices.Providers.AMM.NotifiedResponse=function(e,t,i){this.requestId=e,this.results=t,this.version=i}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ResourceStateResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SendResponse=function(e,t,i,a,r,s,n,o,c,l,d,C,u){this.body=e,this.event=t,this.flags=i,this.from=a,this.href=r,this.id=s,this.lastModifiedDate=n,this.parts=o,this.receivedDate=c,this.subject=l,this.threadId=d,this.to=C,this.inReplyTo=u}}(),function(){"use strict";AvayaClientServices.Providers.AMM.SubscribedResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.UnsubscribedResponse=function(e,t){this.results=e,this.version=t}}(),function(){"use strict";AvayaClientServices.Providers.AMM.ValidateUsersResponse=function(e,t){this.addresses=[],this.query=t;for(var i=0;i<e.length;i++){var a={_address:e[i].address,givenName:e[i].givenName,language:e[i].language,modalities:e[i].modalities,nativeGivenName:e[i].nativeGivenName,nativeSurname:e[i].nativeSurname,surname:e[i].surname,type:e[i].type};this.addresses.push(a)}}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCategories={CLIENT:"Client",USER:"User",SERVICES:"Services",PROVIDERS:"Providers",ANALYTICS:"Analytics",MESSAGING:"Messaging",CONTACTS:"Contacts",CALLS:"Calls",COLLABORATIONS:"Collaborations",CALL_FEATURES:"Call Features"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsCustomDimensions={PRODUCT_VENDOR:1,PRODUCT_NAME:2,PRODUCT_VERSION:3,PROVIDER_TYPE:4,MIME_TYPE:5}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsProvidersTypes={CONTACTS:"AADS",MESSAGING:"AMM",CALLS:"AAWG",PRESENCE:"AAWG",VOICE_MESSAGING:"AAWG",COLLABORATION:"WCS",CONFERENCE:"UCCP"}}(),function(){"use strict";AvayaClientServices.Providers.Analytics.AnalyticsServicesNames={CALL:"CALL",COLLABORATION:"COLLAB",CONTACT:"CONTACT",MESSAGING:"MSG",PRESENCE:"PRES",VOICE_MESSAGING:"VM"}}(),function(f){"use strict";function e(e,t,i,a){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Initializing"),f.Base.Observable.call(this),this._config=T,this._csgwProviderFactory=e,this._configCallGwProvider=T,this._mediaServiceFactory=t,this._cpCalls={},this._sdpMediaOfferNotifications={},this._callFailureNotificationsQueue={},this._callEstablishedNotificationsQueue={},this._rtcConfiguration={},this._videoResolution={},this._consultConferencePromises={},this._callsAnalyticsService=i,this._rtcConnectionProviderFactory=a,this._isVideoAllowed=!0,this._browserType=f.Base.Utils.getBrowserType(),this._isServerSupportsNailedUpVideoConnection=T,this._activeCallVideoTrack=T,this._pendingVideoMuteState=T,this._pendingAudioMuteState=T,this._pendingSpeakerMuteState=T,f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Initialized")}(e.prototype=Object.create(f.Base.Observable.prototype)).start=function(e,t){if(this._config=e,this._updateVideoLicense(),!this._isBrowserSupported()&&!this._isConfiguredForMPaaSCollabCall())return E.Deferred().resolve().promise();if(this._config.sgConfiguration===T||!1===this._config.sgConfiguration.enabled)return f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Call gateway provider started without config"),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),E.Deferred().resolve().promise();this._videoResolution=t;var i=this._getHost(),a=!1;if(this._config.sgConfiguration&&this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest){if(!this._config.mediaServiceContext||!this._config._mediaServiceConfiguration)return this._configCallGwProvider=this._csgwProviderFactory.getCSGCallsProvider(i),f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Created default call gateway provider for Guest user"),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),E.Deferred().resolve().promise();this._configCallGwProvider=this._csgwProviderFactory.getCSGCallsProvider(i,this._config._mediaServiceConfiguration);e="csaGuest/sessionId-"+this._getMediaServiceSessionId();this._config.sgConfiguration.credentialProvider.username=e,a=!0}else if(this._configCallGwProvider=this._csgwProviderFactory.getCSGCallsProvider(i,this._config._mediaServiceConfiguration,this._config.sgConfiguration.credentialProvider),this._configCallGwProvider._isExternalGateway){if(this._configCallGwProvider._started)return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Registered user CANNOT be assigned to an external call gateway provider."),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[]),E.Deferred().reject("CANNOT be assigned to an external call gateway provider").promise();this._configCallGwProvider._isExternalGateway=!1}i=!this._config.callUserConfiguration.presentationOnly&&!this._config.mediaServiceContext&&this._config.callUserConfiguration.incomingCall;return this._startCallGwProvider(this._configCallGwProvider,this._config.sgConfiguration,i,t,a)},e.prototype._isConfiguredForMPaaSCollabCall=function(){var e=!!this._config.sgConfiguration&&!!this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest,t=!!this._config.wcsConfiguration&&this._config.wcsConfiguration.enabled;return e&&!!this._config.mediaServiceContext&&t},e.prototype.supportsMPaaSCollabCall=function(){var e=!!this._config._mediaServiceConfiguration&&this._config._mediaServiceConfiguration.sessionId;return this._isConfiguredForMPaaSCollabCall()&&e},e.prototype.detectIPv6OnlySupport=function(){var i=E.Deferred(),a=this._rtcConnectionProviderFactory.create();return a._pc.onicecandidate=function(e){var t;e.candidate?(e=(t=e.candidate.candidate).indexOf(e="candidate:")+e.length,null!==(e=t.substr(e).split(" ")[4].match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))&&5===e.length&&e[1]<=255&&e[2]<=255&&e[3]<=255&&e[4]<=255&&(a.close(),i.reject())):(a.close(),i.resolve())},a._pc.onicegatheringstatechange=function(){"complete"===a._pc.iceGatheringState&&(a.close(),i.resolve())},a._pc.createOffer({offerToReceiveAudio:1}).then(function(e){a._pc.setLocalDescription(e)},function(e){a.close(),i.reject()}),i.promise()},e.prototype._startCallGwProvider=function(e,t,i,a,r){if(e._removeListeners(),e.on(f.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,this._answerCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,this._callRingingHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,this._createMediaRequestHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,this._remoteCallEndedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,this._incomingCallHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,this._callFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,this._callStateFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,this._makeCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._callsServiceActivatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._callsServiceDeactivatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._networkFailureHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._networkAvailabilityHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.MAX_NETWORK_RECONNECTION_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,this._updateTransferStatusHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,this._updateConsultConferenceStatusHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,this._updateCallDataHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,this._updateCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.ICE_CONFIG_UPDATES,this._iceConfigUpdatesHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,this._terminateCallRequestedHandler.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.SUPPORTED_CALL_ENHANCEMENTS,function(e){e&&e.includes("mediaChannelGuidelines")?(this._isServerSupportsNailedUpVideoConnection=!0,this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,[])):(this._isServerSupportsNailedUpVideoConnection=!1,this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,[]))}.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.UPLOAD_LOGS_UPDATE,function(e,t,i){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,[e,t,i])}.bind(this)),e.on(f.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,function(e){this.trigger(f.Providers.CallServiceGateway.ObservableEvents.IVIEW_TOKEN_UPDATE,[e])}.bind(this)),e.on(f.Base.NetworkProviderEvents.UNAUTHORIZED,function(){this.trigger(f.Base.NetworkProviderEvents.UNAUTHORIZED,[])}.bind(this)),e.on(f.Base.NetworkProviderEvents.AUTHORIZED,function(){this.trigger(f.Base.NetworkProviderEvents.AUTHORIZED,[])}.bind(this)),this.isNailedUpVideoConnectionRequired()){var s={};return this.isVideoAllowed()?s.requiredDirection=f.Services.Call.MediaDirection.RECV_ONLY:s.permittedDirection=f.Services.Call.MediaDirection.INACTIVE,e.start(this,t,i,a,s,r)}return e.start(this,t,i,a,T,r)},e.prototype._stopCallGwProvider=function(i,t){var e,a=[],r=this._csgwProviderFactory.getCSGCallsProviderAsArray(),s=[];t?0<(e=r.filter(function(e){return e._host===t})).length&&(s.push(e[0]),a.push(e[0].stop())):r.forEach(function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Stopping call gateway provider for "+e._host),s.push(e),a.push(e.stop())}),E.when.apply(E,a).then(function(){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Stopped call gateway provider(s)");for(var e=0;e<s.length;e++)s[e]._removeListeners(),s[e]._cpCalls={};i.resolve()}.bind(this),function(e){f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Error encountered while stopping call gateway provider(s)",e);for(var t=0;t<s.length;t++)s[t]._removeListeners(),s[t]._cpCalls={};i.reject(e)}.bind(this)).always(function(){for(var e=0;e<s.length;e++)delete this._csgwProviderFactory._csgCallsProviderMap[s[e]._host]}.bind(this))},e.prototype.stop=function(e){if(!this._isBrowserSupported())return E.Deferred().resolve().promise();this._triggerEndCalls(e);var t=E.Deferred();return this._stopCallGwProvider(t,e),t.promise()},e.prototype.stopImmediately=function(){var t=E.Deferred(),i=[];return this._csgwProviderFactory.getCSGCallsProviderAsArray().forEach(function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Force stopping call gateway provider for "+e._host),i.push(e.stopImmediately())}),E.when.apply(E,i).then(function(){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Force stopped call gateway provider(s)"),t.resolve()}.bind(this),function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Failed to force stop call gateway provider(s)"),t.reject()}.bind(this)),t.promise()},e.prototype.startCall=function(e,t,i,a,r,s,n,o){var c,l,d,C,u,h,_=E.Deferred();return e._isGuestUser?(u=this._config.sgConfiguration.networkProviderConfiguration.restConfig,c=this._configCallGwProvider._host,l=this._csgwProviderFactory.getCSGCallsProvider(c),d=new f.Config.ServerInfo(u.hostName,u.port,u.isSecure,u.path),C=this._config.sgConfiguration.credentialProvider.getDisplayName()):f.Base.Utils.isDefined(e._callCreationInfo)&&f.Base.Utils.isDefined(e._callCreationInfo.getServiceGatewayURL())&&(u=e._callCreationInfo.getServiceGatewayURL(),h=f.Base.Utils.parseUrl(u),c=f.Base.Utils.getHost(h),l=this._csgwProviderFactory.getCSGCallsProvider(c),u=c.split(":"),d=new f.Config.ServerInfo(u[0],u[1],h.isSecure,h.path),h=e._callCreationInfo.getAuthorizationToken(),C=e._callCreationInfo.getMeetMeUserName()),l?l._started&&!l._isExternalGateway?(f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Guest user cannot be assigned non external gateway provider"),_.reject("CANNOT assign guest to non external gateway provider")):this._getGatewayCalls(e,c).length||l._isExternalGateway?this._startNewCall(e,t,i,a,r,s,n,_,l,o):this._startExternalGwCall(l,d,C,h,e,t,i,a,r,s,n,_,o):this._startNewCall(e,t,i,a,r,s,n,_,T,o),_.promise()},e.prototype._startExternalGwCall=function(e,t,i,a,r,s,n,o,c,l,d,C,u){var h=new f.Config.SGConfiguration;a!==T?h.credentialProvider=new f.Config.CredentialTokenProvider(a,f.Config.Authentication.TokenType.ESGTOKEN):(h.credentialProvider=new f.Config.GuestCredentialProvider(i),h.credentialProvider.username=this._config.sgConfiguration.credentialProvider.username),h.enabled=!0,h.networkProviderConfiguration=new f.Config.NetworkProviderConfiguration,h.networkProviderConfiguration.restConfig=t,this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.maxCallStartReconnectionAttempts?h.maxCallStartReconnectionAttempts=this._config.sgConfiguration.maxCallStartReconnectionAttempts:h.maxCallStartReconnectionAttempts=-1,this._startCallGwProvider(e,h,!1,d,!0).then(function(){this.isNailedUpVideoConnectionRequired()&&!this.isServerSupportsNailedUpVideoConnection()?C.reject():(this._startNewCall(r,s,n,o,c,l,d,C,e,u),C.resolve())}.bind(this),function(e){C.reject(e)})},e.prototype._startNewCall=function(e,t,i,a,r,s,n,o,c,l){this._createCPCall(e,T,T,n,c).startCall(r,s,t,i,a,l,this._config.applicationProductName,this._config.applicationProductVersion),o.resolve()},e.prototype._createCPCall=function(e,t,i,a,r){r=f.Base.Utils.isDefined(r)?r:this._configCallGwProvider,a=new f.Providers.Call.CPCall(e,this,r,a);return a.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),a.callId=t,a.incomingCallInfo=i,e&&(a.backgroundBlur=e.isBackgroundBlur(),a.backgroundImage=e.getBackgroundImage()),a},e.prototype.updateCpCall=function(e,t){e.call.getCallId()!==t&&(delete this._cpCalls[e.call.getCallId()],e.call._setCallId(t),this._cpCalls[t]=e)},e.prototype.updateDevices=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){if(i.isMPaaSCollabCall())return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.updateDevice(e,a,t)}return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.startContentVideoSharing=function(e,t){var i=this._cpCalls[e];if(i){e=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice();return i.startContentVideoSharing(t,e)}return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.stopContentVideoSharing=function(e){e=this._cpCalls[e];return e?e.stopContentVideoSharing():E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.updateAudioSourceForVideoSharing=function(e,t){e=this._cpCalls[e];return e?e.updateAudioSourceForVideoSharing(t):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.stopCall=function(e,t){var i=E.Deferred(),a=this._cpCalls[e.getCallId()];return a?(a.end(t),this.stopExternalGatewayProvider(e).always(function(){i.resolve()})):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.stopExternalGatewayProvider=function(e){var t,i,a=E.Deferred();return e._isGuestUser&&f.Base.Utils.isUndefined(e._sessionId)?i=this._configCallGwProvider._host:e._callCreationInfo!==T&&e._callCreationInfo.getServiceGatewayURL()!==T&&e._callCreationInfo.getAuthorizationToken()!==T&&(t=e._callCreationInfo.getServiceGatewayURL(),t=f.Base.Utils.parseUrl(t),i=f.Base.Utils.getHost(t)),i&&0===this._getGatewayCalls(e,i).length?this._stopCallGwProvider(a,i):a.reject(),a.promise()},e.prototype.isExternalGatewayCall=function(e,t){var i;return e._isGuestUser?i=this._configCallGwProvider._host:e._callCreationInfo&&f.Base.Utils.isDefined(e._callCreationInfo.getServiceGatewayURL())&&f.Base.Utils.isDefined(e._callCreationInfo.getAuthorizationToken())&&(e=e._callCreationInfo.getServiceGatewayURL(),e=f.Base.Utils.parseUrl(e),i=f.Base.Utils.getHost(e)),t===i},e.prototype.accept=function(e,t,i){var a=E.Deferred(),r=this._cpCalls[e.getCallId()];return r?(r.call.getVideoChannels().length||this.setVideoMode(e,f.Services.Call.VideoMode.DISABLE,i,!1),r.acceptCall(t,i),a.resolve()):a.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),a.promise()},e.prototype.acceptSendVideo=function(e,t,i){var a=this._cpCalls[e.getCallId()];if(a){if(a.isMPaaSCollabCall())return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var r,e=a.call.getVideoChannels();return 0<e.length?(e[0]._setRequestedDirection(f.Providers.Call.Utils.getVideoDirection(i)),r=e[0]):(r=this._createVideoChannel_VideoMode(i),a.call.getVideoChannels().push(r)),this.triggerVideoChannelUpdate(a.call),a.acceptSendVideo(t,r)}return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype.denySendVideo=function(e){var t=E.Deferred(),e=this._cpCalls[e.getCallId()];if(e){if(e.isMPaaSCollabCall())return t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));e.denySendVideo(),t.resolve()}else t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND));return t.promise()},e.prototype.registerIncomingOrRemoteCall=function(e){var t,i=this._cpCalls[e.getCallId()];i&&(f.Base.Utils.isUndefined(e.getAudioChannel())&&(t=this.createAudioChannel_AudioMode(f.Services.Call.AudioMode.SEND_RECEIVE),e._audioChannel=t),i.call=e,this.registerCall(e.getCallId(),e,i))},e.prototype.getCalls=function(e){return f.Base.Utils.isDefined(e)?this._csgwProviderFactory.getCSGCallsProvider(e).getCalls():E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getClients=function(e){return f.Base.Utils.isDefined(e)?this._csgwProviderFactory.getCSGCallsProvider(e).getClients():E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getCall=function(e,t){return f.Base.Utils.isDefined(t)?this._csgwProviderFactory.getCSGCallsProvider(t).getCall(e):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.getClient=function(e,t){return f.Base.Utils.isDefined(t)?this._csgwProviderFactory.getCSGCallsProvider(t).getClient(e):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.NOT_FOUND)).promise()},e.prototype.lookupCall=function(e){return this._cpCalls.hasOwnProperty(e)?this._cpCalls[e].call:T},e.prototype.muteAudio=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.muteAudio(),e.isConference()&&e.getConference()._sendLocalMuteEvent(!0),E.Deferred().resolve().promise()):(this._pendingAudioMuteState=e._audioMuteState,E.Deferred().resolve("Queued").promise())},e.prototype.unmuteAudio=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.unmuteAudio(),e.isConference()&&e.getConference()._sendLocalMuteEvent(!1),E.Deferred().resolve().promise()):(this._pendingAudioMuteState=e._audioMuteState,E.Deferred().resolve("Queued").promise())},e.prototype.enableMic=function(e){e=this._cpCalls[e.getCallId()];return e?e.enableLocalMicrophone():E.Deferred().resolve("Queued").promise()},e.prototype.disableMic=function(e){e=this._cpCalls[e.getCallId()];return e?e.disableLocalMicrophone():E.Deferred().resolve("Queued").promise()},e.prototype.muteVideo=function(e){e=this._cpCalls[e.getCallId()];return e?e.muteVideo():(this._pendingVideoMuteState=f.Services.Call.MediaMuteStates.MUTED,E.Deferred().resolve("Queued").promise())},e.prototype.unmuteVideo=function(e){e=this._cpCalls[e.getCallId()];return e?e.unmuteVideo():(this._pendingVideoMuteState=f.Services.Call.MediaMuteStates.UNMUTED,E.Deferred().resolve("Queued").promise())},e.prototype.muteSpeaker=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.muteSpeaker(),E.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=e._speakerMuteState,E.Deferred().resolve("Queued").promise())},e.prototype.unmuteSpeaker=function(e){var t=this._cpCalls[e.getCallId()];return t?(t.unmuteSpeaker(),E.Deferred().resolve().promise()):(this._pendingSpeakerMuteState=e._speakerMuteState,E.Deferred().resolve("Queued").promise())},e.prototype.hold=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.hold();E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.unhold=function(e){e=this._cpCalls[e.getCallId()];return e?e.unhold():E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.transfer=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.transfer(t):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.attendedTransfer=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.attendedTransfer(t.getCallId()):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.join=function(e,t){e=this._cpCalls[e.getCallId()];return e?e.join(t):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.sendDTMF=function(e,t){var i=E.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(e.sendDTMF(t),i.resolve()):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.setVideoMode=function(e,t,i,a){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"setVideoMode direction: "+t);var r,s=this._cpCalls[e.getCallId()];return 0===e.getVideoChannels().length&&(r=this._createVideoChannel_VideoMode(e,t),t===f.Services.Call.VideoMode.DISABLE&&(e.isIncoming()?r._setVideoDisabledReason(f.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER):r._setVideoDisabledReason(f.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),e._videoChannels.push(r)),f.Base.Utils.isDefined(s)&&e.getState()!==f.Services.Call.CallStates.IDLE&&e.getState()!==f.Services.Call.CallStates.ALERTING&&e.getState()!==f.Services.Call.CallStates.IGNORED?s.updateVideoMode(t,i,a):(this.triggerVideoChannelUpdate(e),E.Deferred().resolve())},e.prototype.setVideoSendResolution=function(e,t,i){return this._cpCalls[e.getCallId()].setVideoSendResolution(t,i)},e.prototype.getVideoSendBandwidth=function(e){return this._cpCalls[e.getCallId()].getVideoSendBandwidth()},e.prototype.getVideoBandwidth=function(e){return this._cpCalls[e.getCallId()].getVideoBandwidth()},e.prototype.getVideoResolution=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.getVideoResolution()},e.prototype.getNegotiatedVideoResolution=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.getNegotiatedVideoResolution()},e.prototype.getVideoSendResolution=function(e){e=this._cpCalls[e.getCallId()];if(e)return e.getVideoSendResolution()},e.prototype.getVideoResolutionsTable=function(e){e=this._cpCalls[e.getCallId()];return e===T?T:e.getVideoResolutionsTable()},e.prototype._nextLowerVideoResolution=function(e,t){e=this._cpCalls[e.getCallId()];return e===T?T:e._nextLowerVideoResolution(t)},e.prototype._nextHigherVideoResolution=function(e,t){e=this._cpCalls[e.getCallId()];return e===T?T:e._nextHigherVideoResolution(t)},e.prototype.hasVideoTracks=function(e){if(f.Base.Utils.isDefined(e)){e=this._cpCalls[e.getCallId()];if(e)return e.hasVideoTracks()}return!1},e.prototype.setAudioMode=function(e,t){var i,a,r=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e.getAudioChannel())||(a=this.createAudioChannel_AudioMode(t),e._audioChannel=a),f.Base.Utils.isDefined(r)?(i=E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.FAILED)),f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"set audio is not supported")):(f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"audio is set: "+t),i=E.Deferred().resolve()),i},e.prototype.setWebCollaboration=function(e,t){var i,e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(i=E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.FAILED)),f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"set web collaboration is not supported")):(f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"web collaboration is set: "+t),i=E.Deferred().resolve()),i},e.prototype.addParticipantFromCall=function(e,t){var i=this._cpCalls[e];if(f.Base.Utils.isDefined(i)){if(i.call.getConference().getAddParticipantFromCallCapability(t).isAllowed){e=t.getCallId();return this._consultConferencePromises[e]=E.Deferred(),i.addParticipantFromCall(t),this._consultConferencePromises[e]}return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}return E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype.getCallStatistics=function(e){var t,i=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(i)?(t=e.getAudioChannel(),e=e.getVideoChannels(),t=!!t&&t.getRequestedDirection()!==f.Services.Call.MediaDirection.DISABLE&&t._getNegotiatedDirection()!==f.Services.Call.MediaDirection.DISABLE,e=!!e&&0!==e.length&&e[0].getRequestedDirection()!==f.Services.Call.MediaDirection.DISABLE&&e[0].getNegotiatedDirection()!==f.Services.Call.MediaDirection.DISABLE,t||e?i.getCallStatistics():E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.STATISTICS_UNAVAILABLE)).promise()):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)).promise()},e.prototype._triggerEndCalls=function(e){for(var t in this._cpCalls)!this._cpCalls.hasOwnProperty(t)||this._cpCalls[t]._callGatewayProvider._host!==e&&e||((t=this._cpCalls[t]).stopAllStreams(),this.unRegisterCall(t.call)&&this._triggerAsyncEndCall(t.call))},e.prototype._triggerAsyncEndCall=function(e){setTimeout(function(){this.triggerCallEnded(e)}.bind(this),0)},e.prototype.getMediaServiceFactory=function(){return this._mediaServiceFactory},e.prototype.startRinging=function(e){var t=E.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?(e.startRinging(),t.resolve()):t.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),t.promise()},e.prototype.acceptAnswerCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},e.prototype.acceptUpdateCallRequest=function(e,t){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,t)},e.prototype.acceptTerminateCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},e.prototype.acceptMakeCallRequest=function(e){return this._acceptCallRequest(e,f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},e.prototype._acceptCallRequest=function(e,t,i){var a=E.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?e.acceptCallRequest(a,t,i):a.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),a.promise()},e.prototype.rejectAnswerCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED)},e.prototype.rejectUpdateCallRequest=function(e,t){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED)},e.prototype.rejectTerminateCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED)},e.prototype.rejectMakeCallRequest=function(e){return this._rejectCallRequest(e,f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED)},e.prototype._rejectCallRequest=function(e,t){var i=E.Deferred(),e=this._cpCalls[e.getCallId()];return f.Base.Utils.isDefined(e)?e.rejectCallRequest(i,t):i.reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)),i.promise()},e.prototype.getOfferSDP=function(e,t,i,a,r,s,n,o,c,l){var d=this._cpCalls[e];d&&d.isReadyToReceiveMediaRequest()?d.getOfferSDP(t,i,a,r,T,T,s,n,o,c,l):this._sdpMediaOfferNotifications[e]={action:t,audioStream:i,videoStreams:a,videoBandwidth:r,turnData:s,restartTurnGathering:n,useIPv6Candidates:o,videoResolutions:c,serverSentResolution:l}},e.prototype.getQueuedMediaOfferNotification=function(e){var t=this._sdpMediaOfferNotifications[e];return t&&delete this._sdpMediaOfferNotifications[e],t},e.prototype.getQueuedCallFailure=function(e){var t=this._callFailureNotificationsQueue[e];return t&&delete this._callFailureNotificationsQueue[e],t},e.prototype.getQueuedVideoMuteState=function(){var e=this._pendingVideoMuteState;return this._pendingVideoMuteState=T,e},e.prototype.getQueuedAudioMuteState=function(){var e=this._pendingAudioMuteState;return this._pendingAudioMuteState=T,e},e.prototype.getQueuedSpeakerMuteState=function(){var e=this._pendingSpeakerMuteState;return this._pendingSpeakerMuteState=T,e},e.prototype.queueCallEstablishedNotification=function(e,t,i,a,r,s,n,o,c,l,d,C){this._callEstablishedNotificationsQueue[e]={address:t,displayName:i,audioStream:a,videoStreams:r,isConference:s,uccpUrl:n,webCollabUrl:o,ucid:l,parentUcid:d,contextId:C}},e.prototype.getQueuedCallEstablishedNotification=function(e){var t=this._callEstablishedNotificationsQueue[e];return t&&delete this._callEstablishedNotificationsQueue[e],t},e.prototype.offerSDP=function(e,t,i,a,r,s,n){var o=this._cpCalls[e];o&&o.isReadyToReceiveMediaRequest()?o.offerSDP(i,t,a,r,s,n):this._sdpMediaOfferNotifications[e]={action:t,audioStream:a,videoStreams:r,offer:i,videoBandwidth:s,turnData:n}},e.prototype.callRinging=function(e,t,i,a,r,s,n,o,c,l,d,C){var u=this._cpCalls[e];u?(u.call._isEarlyMedia&&!n&&this.stopEarlyMedia(u.call),u.callRinging(t,i,a,r,s,n,o,c,l,d,C)):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.answerSDP=function(e,t,i,a,r,s,n,o){var c=this._cpCalls[e];c?c.answerSDP(i,t,a,r,s,n,o):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.answerSdpAck=function(e,t,i,a){var r=this._cpCalls[e];r?r.answerSdpAck(t,i,a):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.callEstablished=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g){var S=this._cpCalls[e];if(f.Base.Utils.isDefined(c)&&this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[c]),S)f.Base.Utils.isDefined(v)?S.callEstablished(t,i,l,d,C,u,h,r,v,p,g):S.callEstablished(t,i,l,d,C,u,h,r);else{if(!r)return f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Queue established because call is not found: ",e),void this.queueCallEstablishedNotification(e,t,i,l,d,C,u,h,_,v,p,g);this._isWebRTCSupportedBrowser()?(_=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(_,this._videoResolution)||this._videoResolution,S=this._createCPCall(null,e,{remoteAddress:t,remoteDisplayName:i,isAuraAsserted:o,isPrivate:s,alertType:n,audioStream:l,videoStreams:d,videoResolution:_},_),this.isSolutionSupportsNailedUpConnection()&&S.setNailedUpVideoConnectionSupported(!0),this._cpCalls[e]=S,this.triggerRemoteCallCreated(e,t,i,o,s,this._isVideoCall(d),n,a)):f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Remote call is not supported: ",e)}},e.prototype.callEndedRemotely=function(e,t){var i=this._cpCalls[e];i?i.callEndedRemotely(t):f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.callStateFailure=function(e,t){e=this._cpCalls[e];e&&e.callStateFailure(t)},e.prototype.callFailure=function(e,t,i,a,r){var s=this._cpCalls[e];s?s.callFailure(t,i,a,r):this._callFailureNotificationsQueue[e]={errorCode:t,protocolType:i,protocolErrorCode:a,failureReason:r}},e.prototype.stopEarlyMedia=function(e){var t,i=this._cpCalls[e];i?(t=this.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),i.stopEarlyMedia(t)):f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Call not found: "+e)},e.prototype.triggerCallStarted=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,[e])},e.prototype.triggerCallRinging=function(e,t,i,a,r){t=!!f.Base.Utils.isDefined(t)&&t;this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,[e,t,i,a,r])},e.prototype.triggerCallEstablished=function(e,t,i,a,r,s,n,o){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,[e,t,r,s,n,o]),this.triggerConferenceEscalation(e,i,a,t)},e.prototype.triggerCallEstablishing=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,[e])},e.prototype.triggerRemoteStreamAdded=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_STREAM_ADDED,[e,t])},e.prototype.triggerCallEnded=function(e,t,i){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,[e,t,i])},e.prototype.triggerRemoteCallCreated=function(e,t,i,a,r,s,n,o){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,[e,t,i,a,r,s,n,o])},e.prototype.triggerIncomingCall=function(e,t,i,a,r,s,n,o,c,l,d,C){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,[e,t,i,a,r,s,n,o,c,l,d,C])},e.prototype.triggerIncomingAddVideoRequest=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,[e,t])},e.prototype.triggerIncomingAddVideoAccepted=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,[e])},e.prototype.triggerIncomingAddVideoDenied=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,[e])},e.prototype.triggerIncomingAddVideoTimedout=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,[e])},e.prototype.triggerVideoChannelUpdate=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,[e,t])},e.prototype.triggerConferenceEscalation=function(e,t,i,a){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,[e,t,i,a])},e.prototype.triggerVideoEscalationRejected=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_ESCALATION_REJECTED,[e])},e.prototype.triggerCallFailure=function(e,t,i,a,r){e=this._cpCalls[e];e&&this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[e.call,t,i,a,r])},e.prototype.triggerCallServiceUnavailable=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[e])},e.prototype.triggerRemoteHold=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,[e])},e.prototype.triggerRemoteUnhold=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,[e])},e.prototype.triggerRemoteAddressChanged=function(e,t,i,a,r,s){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,[e,t,i,a,r,s])},e.prototype.triggerAllowedNailedUpVideoModes=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,[e,t])},e.prototype.triggerMediaConnectionUpdate=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,[e,t])},e.prototype.triggerCallMediaFailed=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,[e])},e.prototype.triggerMediaRecoveryInitiated=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,[e])},e.prototype.registerCall=function(e,t,i){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"register call: "+e),t._setCallId(e),this._cpCalls[e]=i},e.prototype.unRegisterCall=function(e){if(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"unregister call: "+e.getCallId());var t=this._cpCalls[e.getCallId()];if(t)return t.cleanupImmediately(),delete this._cpCalls[e.getCallId()],!0}return!1},e.prototype.isVideoConfigurationEnabled=function(){return this._config.callUserConfiguration.videoEnabled},e.prototype._callRingingHandler=function(e,t,i,a,r,s,n,o,c,l,d,C){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Ringing"),this.callRinging(e,t,i,a,r,s,n,o,c,l,d,C)},e.prototype._callEstablishedHandler=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Established"),this.callEstablished(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S)},e.prototype._createMediaRequestHandler=function(e,t,i,a,r,s,n){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Create Media Request"),this.getOfferSDP(e,t,i,a,r,s,!1,n)},e.prototype._remoteCallEndedHandler=function(e,t){var i="Received Remote Call Ended";t&&(i=i+": ["+t.getProtocol()+","+t.getCause()+","+t.getText()+"]"),f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,i),this.callEndedRemotely(e,t)},e.prototype._incomingCallHandler=function(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p){var g=this._mediaServiceFactory.getMediaServicesService().getUserMedia().adjustVideoResolution(C,this._videoResolution)||this._videoResolution;f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"Received Incoming Call");g=this._createCPCall(null,e,{remoteAddress:t,remoteDisplayName:i,isAuraAsserted:a,isPrivate:r,alertType:s,sdp:o,audioStream:c,videoStreams:l,turnData:v},g);g.determineIfNailedUpVideoConnectionSupported(l),g._isReadyToReceiveMediaRequest=!0,g._updateVideoBandwidth(C),this._cpCalls[e]=g,this.triggerIncomingCall(e,t,i,a,r,this._isVideoCall(l),s,d,u,h,_,p)},e.prototype._callFailureHandler=function(e,t,i,a,r){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Failure: ["+t+":"+i+":"+a+":"+r+"]"),this.callFailure(e,t,i,a,r)},e.prototype._callStateFailureHandler=function(e,t,i,a,r){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call State Failure: ["+t+":"+i+":"+a+":"+r+"]"),this.callStateFailure(e,t)},e.prototype._networkFailureHandler=function(e,t,i){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Network Failure: ["+e+":"+t+":"+i+"]");var a,r,s=!1;for(a in this._cpCalls)!this._cpCalls.hasOwnProperty(a)||(r=this._cpCalls[a])&&r.call&&r._callGatewayProvider&&r._callGatewayProvider._host===e&&(r.setCallServiceAvailable(!1),this.triggerCallServiceUnavailable(r.call),this._callsAnalyticsService.sendUnavailableEvent(f.Services.Analytics.AnalyticsErrorCode.NETWORK_ERROR),s=!0);s||(this.triggerCallServiceUnavailable(),this._callsAnalyticsService.sendUnavailableEvent(f.Services.Analytics.AnalyticsErrorCode.NO_CALL_WAS_CREATED_ERROR))},e.prototype._maxNetworkRecoveryAttemptedHandler=function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Maximum Network Recover Attempted: "+e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,[e])},e.prototype._callsServiceDeactivatedHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Calls Service Deactivated: "+e+":"+t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,[e,t])},e.prototype._networkAvailabilityHandler=function(s){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Network Availability: "+s),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[]),this.getCalls(s).then(function(e){for(var t in this._cpCalls)if(this._cpCalls.hasOwnProperty(t)){var i=this._cpCalls[t];if(i._callGatewayProvider&&i._callGatewayProvider._host===s){for(var a=!1,r=0;r<e.length;r++)e[r].callId===t&&(i.setCallServiceAvailable(a=!0),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,[i.call]));a||i.triggerCallMediaFailed()}}}.bind(this),function(e){f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Failed to get list of active calls from server",e)}.bind(this))},e.prototype._callsServiceActivatedHandler=function(e){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Calls Service Activated: "+e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,[e])},e.prototype._updateTransferStatusHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Transfer Status Update: "+t),this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e])._transferPromise.notify(t),t===f.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_DONE?e.transferCompleted():t===f.Providers.Call.CallProvider.Constants.TRANSFER_STATUS_FAILED&&e.transferFailed())},e.prototype._updateConsultConferenceStatusHandler=function(e,t){f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Consult Conference Status Update: "+t),this._consultConferencePromises.hasOwnProperty(e)&&(this._consultConferencePromises[e].notify(t),t===f.Providers.Call.CallProvider.Constants.CONSULT_CONFERENCE_STATUS_DONE?(this._consultConferencePromises[e].resolve(),delete this._consultConferencePromises[e]):(t===f.Providers.Call.CallProvider.CONSULT_CONFERENCE_STATUS_FAILED||-1<t.indexOf(f.Providers.Call.CallProvider.Constants.ERROR))&&(f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Failed to add "+e+" to Consult Conference: "+t),this._consultConferencePromises[e].reject(t),delete this._consultConferencePromises[e]))},e.prototype._updateCallDataHandler=function(e,t,i,a,r,s,n,o,c,l,d){var C,u,h,_,v;f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Received Call Data Update: ["+e+":"+t+":"+i+":"+r+":"+s+":"+n+"]"),this._cpCalls.hasOwnProperty(e)&&(v=(h=(u=(C=this._cpCalls[e]).call).isConference())&&u.getConference(),_=h&&v._isConferenceStarted(),e=h&&v._isStarting,v=h?v._getType():"unknown",f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,(h?"Conference":"Non-Conference")+" Data Update: [Existing conference call? "+h+"; Is conference started? "+_+"; Is conference starting? "+e+"; Conference type="+v+"; uucpUrl="+r+"; webCollabUrl="+s+"]"),f.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(this,u,t,i,n,o,c),a&&C.hasReceivedCallEstablishedEvent()&&(!h||!_&&!e||r||s)&&(!r&&!s||r&&r!==u._uccpUrl||s&&s!==u._webCollabUrl)&&this.triggerConferenceEscalation(C.call,r,s,a),!0===Array.isArray(l)&&0<l.length&&d!==T&&null!==d&&(null!==(l=C.setServerSentPreferredResolution(d))&&(null===(d=f.Providers.Call.CPUtils.getClientPreferredResolution(C.call,C.getVideoResolutionsTable()))||l.getHeight()<d.getHeight()==!0?C.setVideoSendResolution(l,!1):C.setVideoSendResolution(d,!1))))},e.prototype._iceConfigUpdatesHandler=function(e){if(e&&0<e.length){this._rtcConfiguration={iceServers:[{urls:""}]};if(1===e.length)this._rtcConfiguration.iceServers[0].urls="stun:"+e[0];else{for(var t=[],i=0;i<e.length;i++)t.push("stun:"+e[i]);this._rtcConfiguration.iceServers[0].urls=t}}},e.prototype._videoLicenseUpdatedHandler=function(e){this._updateVideoLicense(e),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,[e])},e.prototype._createVideoChannel_VideoMode=function(e,t){e=new f.Services.Call.VideoChannel(e);return e._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),e._setRequestedDirection(f.Providers.Call.Utils.getVideoDirection(t)),e},e.prototype.createAudioChannel_AudioMode=function(e){var t=new f.Services.Call.AudioChannel;return t._setRequestedDirection(f.Providers.Call.Utils.getAudioDirection(e)),t},e.prototype.createVideoChannel_MediaDirection=function(e,t){e=new f.Services.Call.VideoChannel(e);return e._setChannelId(this._mediaServiceFactory.getVideoInterfaceService().createVideoChannel()),e._setRequestedDirection(t),e},e.prototype.hasVideoDevices=function(){return this._mediaServiceFactory.getVideoInterface().hasAvailableDevices()},e.prototype.isNailedUpVideoConnectionRequired=function(){return this._browserType===f.Base.BrowserType.EDGE},e.prototype.isServerSupportsNailedUpVideoConnection=function(){return!f.Base.Utils.isDefined(this._isServerSupportsNailedUpVideoConnection)||this._isServerSupportsNailedUpVideoConnection},e.prototype.isSolutionSupportsNailedUpConnection=function(){return this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()},e.prototype.isVideoAllowed=function(){return this._isVideoAllowed},e.prototype._isVideoCall=function(e){if(f.Base.Utils.isDefined(e)&&0<e.length&&e[0].enabled){var t=e[0].direction;return this.isSolutionSupportsNailedUpConnection()?!f.Services.Call.MediaDirection._isDisabled(t)&&e[0].logicalDirection!==f.Services.Call.MediaDirection.INACTIVE:!f.Services.Call.MediaDirection._isDisabled(t)&&t!==f.Services.Call.MediaDirection.INACTIVE}return!1},e.prototype._ringbackToneURLsChangedHandler=function(e){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,[e])},e.prototype._isBrowserSupported=function(){var e=f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers");return f.Base.Utils.isWebRTC_SupportedBrowser(e)},e.prototype._isTurnTlsHasHighestPriority=function(){return f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._setTurnTlsToHighestPriority")},e.prototype._answerCallRequestedHandler=function(e,t){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.ANSWER_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,[e.call]))},e.prototype._terminateCallRequestedHandler=function(e,t){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.TERMINATE_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,[e.call]))},e.prototype._updateCallRequestedHandler=function(e,t,i){this._cpCalls.hasOwnProperty(e)&&((e=this._cpCalls[e]).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.UPDATE_CALL_REQUESTED,t),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,[e.call,i]))},e.prototype._makeCallRequestedHandler=function(e,t,i,a,r,s){var n=this._createCPCall(null,e,T,this._videoResolution);(this._cpCalls[e]=n).setCallRequestedTransactionalId(f.Providers.Call.CallProvider.Constants.MAKE_CALL_REQUESTED,i),this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,[e,t,a,r,s])},e.prototype._updateVideoLicense=function(e){var t=f.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");f.Base.Utils.isDefined(t)&&(this._isVideoAllowed=this._isVideoAllowed&&t),e&&(this._isVideoAllowed=this._isVideoAllowed&&e)},e.prototype._isWebRTCSupportedBrowser=function(){var e=f.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),e=f.Base.Utils.isWebRTC_SupportedBrowser(e);return this.isNailedUpVideoConnectionRequired()?e&&this.isServerSupportsNailedUpVideoConnection():e},e.prototype.setActiveCallVideoTrack=function(e){this._activeCallVideoTrack=T,this.isNailedUpVideoConnectionRequired()&&this.isServerSupportsNailedUpVideoConnection()&&(!this._cpCalls.hasOwnProperty(e)||0<(e=this._cpCalls[e]).getVideoStreams().length&&e.localStream.getVideoTracks().forEach(function(e){e.readyState!==f.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_ENDED&&(this._activeCallVideoTrack=e)}.bind(this)))},e.prototype.getActiveCallVideoTrack=function(){return this._activeCallVideoTrack},e.prototype._getGatewayCalls=function(t,i){return t._callService._callManager.getAllCalls().filter(function(e){return!!e.getCallId()&&(!!this._cpCalls[e.getCallId()]&&(e.getCallId()!==t.getCallId()&&this._cpCalls[e.getCallId()]._callGatewayProvider._host===i))}.bind(this))},e.prototype._getHost=function(){var e=this._config.sgConfiguration.networkProviderConfiguration.restConfig,t=e.isSecure?f.Base.Utils.isDefined(e.port)?e.port:"443":f.Base.Utils.isDefined(e.port)?e.port:"80";return e.hostName+":"+t},e.prototype._getCsgCallsProvider=function(){var e=this._getHost();return this._csgwProviderFactory.getCSGCallsProvider(e)},e.prototype.setOnNetworkEvents=function(e,t){var i=this._getMediaServiceSessionId();if(!i){var a=new f.Services.Call.CallException(f.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE);return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,a),E.Deferred().reject(a).promise()}e={sessionId:i,acceptedEvents:e};return this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.setOnNetworkEvents(e,t)},e.prototype.isNetworkEventsUrlDefined=function(){var e=!1;return this._config&&this._config.sgConfiguration&&this._config.sgConfiguration.enabled&&(this._csgCallsProvider=this._getCsgCallsProvider(),e=this._csgCallsProvider.isNetworkEventsUrlDefined()),e},e.prototype.removeOnNetworkEvents=function(){var e=this._getMediaServiceSessionId();if(e)return this._csgCallsProvider=this._getCsgCallsProvider(),this._csgCallsProvider.removeOnNetworkEvents(e);e=new f.Services.Call.CallException(f.Services.Call.CallError.MEDIA_SERVICE_UNAVAILABLE);return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,e),E.Deferred().reject(e).promise()},e.prototype._getMediaServiceSessionId=function(){var e;return e=this._config._mediaServiceConfiguration?this._config._mediaServiceConfiguration.sessionId:e},e.prototype.isMediaConnected=function(e){e=this._cpCalls[e.getCallId()];return!!e&&e.isMediaConnected()},e.prototype.updatePreferredResolution=function(e,t){var i=this._cpCalls[e._call.getCallId()];return i===T?E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND)):i.updatePreferredResolution(e,t)},e.prototype.setPreferredReceiveResolution=function(e,t,i){e=this._cpCalls[e.getCallId()];return e?e.setPreferredReceiveResolution(t,i):E.Deferred().reject(new f.Services.Call.CallException(f.Services.Call.CallError.CALL_NOT_FOUND))},e.prototype._onPerformanceMonitorAlert=function(e,t){this.trigger(f.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,[e,t])},e.prototype.setBackgroundBlur=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.setBackgroundBlur(t,e,a)}return E.Deferred().resolve().promise()},e.prototype.setBackgroundImage=function(e,t){var i=this._cpCalls[e.getCallId()];if(i){var a=this.getMediaServiceFactory().getMediaServices().getVideoInterface().getSelectedDevice(),e=this.getMediaServiceFactory().getMediaServices().getAudioInterface().getInputInterface().getSelectedDevice();return i.setBackgroundImage(t,e,a)}return E.Deferred().resolve().promise()},e.prototype.getServerSentPreferredResolution=function(e){e=this._cpCalls[e.getCallId()];return e===T?null:e.getServerSentPreferredResolution()},f.Providers.Call.CallProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallProvider.Constants={DISABLE_STATE:"DISABLE",ENABLE_STATE:"ENABLE",ERROR:"ERROR",ADD_VIDEO:"ADD_VIDEO",UPDATE_VIDEO:"UPDATE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",HOLD:"HOLD",INCOMING_UNHOLD:"INCOMING_UNHOLD",UNHOLD:"UNHOLD",VIDEO_TRACK:"video",AUDIO_TRACK:"audio",ADD_PARTICIPANT_ACTION:"ADD_PARTICIPANT",ADD_VIDEO_ACTION:"ADD_VIDEO",HOLD_ACTION:"HOLD",UNHOLD_ACTION:"UNHOLD",INCOMING_ADD_VIDEO_ACTION:"INCOMING_ADD_VIDEO",INCOMING_REMOVE_VIDEO_ACTION:"INCOMING_REMOVE_VIDEO",INCOMING_UPDATE_VIDEO_ACTION:"INCOMING_UPDATE_VIDEO",INCOMING_HOLD_ACTION:"INCOMING_HOLD",INCOMING_UNHOLD_ACTION:"INCOMING_UNHOLD",TRANSFER_ACTION:"TRANSFER",TRANSFER_STATUS_DONE:"DONE",TRANSFER_STATUS_FAILED:"FAILED",CONSULT_CONFERENCE_STATUS_DONE:"DONE",CONSULT_CONFERENCE_STATUS_FAILED:"FAILED",END_CALL_BY_REMOTE:"remote",END_CALL_NORMAL:"normal",END_CALL_DENY_WITH_REASON:"denyWithReason",INITIAL_MEDIA:"INITIAL_MEDIA",DEFAULT_CALL_GW_PROVIDER:"DefaultCallGWProvider",ANSWER_CALL_REQUESTED:"AnswerCallRequested",MAKE_CALL_REQUESTED:"MakeCallRequested",TERMINATE_CALL_REQUESTED:"TerminateCallRequested",UPDATE_CALL_REQUESTED:"UpdateCallRequested",ICE_CANDIDATE_TYPE_RELAY_ONLY:"relayOnly",ICE_CANDIDATE_TYPE_HOST_ONLY:"hostOnly"}}(),function(e){"use strict";var t=e.Providers.Call.States={};t.INITIAL=new e.Base.SimpleFsm.SimpleFsmState("INITIAL"),t.STARTING=new e.Base.SimpleFsm.SimpleFsmState("STARTING"),t.ALERTING=new e.Base.SimpleFsm.SimpleFsmState("ALERTING"),t.MEDIA_RECOVERY=new e.Base.SimpleFsm.SimpleFsmState("MEDIA_RECOVERY"),t.ACTIVE=new e.Base.SimpleFsm.SimpleFsmState("ACTIVE"),t.ACTIVE_RENEGOTIATE=new e.Base.SimpleFsm.SimpleFsmState("ACTIVE_RENEGOTIATE"),t.FAILED=new e.Base.SimpleFsm.SimpleFsmState("FAILED"),t.ENDING=new e.Base.SimpleFsm.SimpleFsmState("ENDING"),t.ENDED=new e.Base.SimpleFsm.SimpleFsmState("ENDED")}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this._username=e,this._credential=t,this._address=i,this._transportTypes=a,this._iceTransportPolicy=r||"relay",this._expiryTime=s}t.prototype={getUsername:function(){return this._username},getCredential:function(){return this._credential},getAddress:function(){return this._address},getTransportTypes:function(){return this._transportTypes},getIceTransportPolicy:function(){return this._iceTransportPolicy},getExpiryTime:function(){return this._expiryTime}},e.Providers.Call.TurnData=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._address=e,this._protocol=t,this._transport=i,this._port=a,this._transportPrecedence=0,this._tlsHasHighestPriority=!1}t.prototype={getProtocol:function(){return this._protocol},getTransport:function(){return this._transport},getPort:function(){return this._port},getUrl:function(){return this._protocol+":"+this._address+":"+this._port+"?transport="+this._transport},_setTlsToHighestPriority:function(e){this._tlsHasHighestPriority=e},getTransportPrecedence:function(){if("udp"===this._transport)return 3;if("tcp"!==this._transport)return 0;var e=this._tlsHasHighestPriority?100:1;return"turn"===this._protocol?2:e}},e.Providers.Call.TurnTransportType=t}(AvayaClientServices),function(d){"use strict";d.Providers.Call.Utils={updateVideoSdp:function(e,t){switch(e.direction){case d.Services.Call.MediaDirection.SEND_ONLY:return d.Base.SDPUtil.updateVideoSdpSendOnly(t);case d.Services.Call.MediaDirection.SEND_RECV:return d.Base.SDPUtil.updateVideoSdpSendRecv(t);case d.Services.Call.MediaDirection.RECV_ONLY:return d.Base.SDPUtil.updateVideoSdpRecvOnly(t);default:return d.Base.SDPUtil.updateVideoSdpInactive(t)}},updateAudioSdp:function(e,t){switch(e.direction){case d.Services.Call.MediaDirection.SEND_ONLY:return d.Base.SDPUtil.updateAudioSdpSendOnly(t);case d.Services.Call.MediaDirection.SEND_RECV:return d.Base.SDPUtil.updateAudioSdpSendRecv(t);case d.Services.Call.MediaDirection.RECV_ONLY:return d.Base.SDPUtil.updateAudioSdpRecvOnly(t);default:return d.Base.SDPUtil.updateAudioSdpInactive(t)}},updateAndTriggerRemoteAddressChangedIfNeeded:function(e,t,i,a,r,s,n){var o=d.Base.Utils.isDefined(a)&&t.getRemoteDisplayName()!==a,c=d.Base.Utils.isDefined(i)&&t.getRemoteAddress()!==i,l=t.getUserToUserInfo(),l=d.Base.Utils.isDefined(r)&&(d.Base.Utils.isUndefined(l)||l.getUCID()!==r);(c||o||l)&&e.triggerRemoteAddressChanged(t,i,a,r,s,n)},getVideoDirection:function(e){switch(e){case d.Services.Call.VideoMode.SEND_RECEIVE:return d.Services.Call.MediaDirection.SEND_RECV;case d.Services.Call.VideoMode.SEND_ONLY:return d.Services.Call.MediaDirection.SEND_ONLY;case d.Services.Call.VideoMode.RECEIVE_ONLY:return d.Services.Call.MediaDirection.RECV_ONLY;case d.Services.Call.VideoMode.INACTIVE:return d.Services.Call.MediaDirection.INACTIVE;case d.Services.Call.VideoMode.DISABLE:return d.Services.Call.MediaDirection.DISABLE;default:return d.Services.Call.MediaDirection.UNDEFINED}},getAudioDirection:function(e){switch(e){case d.Services.Call.AudioMode.SEND_RECEIVE:case d.Services.Call.AudioMode.ENABLE:return d.Services.Call.MediaDirection.SEND_RECV;case d.Services.Call.AudioMode.DISABLE:return d.Services.Call.MediaDirection.DISABLE;default:return d.Services.Call.MediaDirection.UNDEFINED}},getVideoMode:function(e){switch(e){case d.Services.Call.MediaDirection.SEND_RECV:return d.Services.Call.VideoMode.SEND_RECEIVE;case d.Services.Call.MediaDirection.SEND_ONLY:return d.Services.Call.VideoMode.SEND_ONLY;case d.Services.Call.MediaDirection.RECV_ONLY:return d.Services.Call.VideoMode.RECEIVE_ONLY;case d.Services.Call.MediaDirection.INACTIVE:return d.Services.Call.VideoMode.INACTIVE;default:return d.Services.Call.VideoMode.DISABLE}}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._protocol=e,this._cause=t,this._text=i}t.prototype={getProtocol:function(){return this._protocol},getCause:function(){return this._cause},getText:function(){return this._text},_setCause:function(e){this._cause=e},_setProtocol:function(e){this._protocol=e}},e.Providers.Call.CallReason=t}(AvayaClientServices),function(u){"use strict";var n=window.AudioContext||window.webkitAudioContext;function e(e,t,i,a){this._callGatewayProvider=i,this._callProvider=t,this.call=e,this.localStream=null,this.remoteStream=null,this.remote=!1,this.callId=null,this.incomingCallInfo={},this.incomingVideoRequestTimer=T,this.mediaTransactionDfd=T,this.noMediaTransactionDfd=T,this.anyMediaTransactionDfd=T,this._mediaTransactionInitialEvent=T,this.audioStream=null,this.videoStreams=[],this._videoChannelId=T,this._audioDevice=T,this._videoDevice=T,this._videoSharingStream=T,this._videoSharingAudioContext=T,this._videoSharingAudioConstraints=T,this._videoSharingMicrophoneGainNode=T;var r=t._config?t._config.callUserConfiguration.turnRelayCandidatesGatheringTimeout:5e3,i=t._config?t._config.callUserConfiguration.iceCandidatesGatheringTimeout:15e3,e=t._config?t._config.callUserConfiguration.iceConnectionRestartInterval:5e3;this._rtConnection=t._rtcConnectionProviderFactory.create(t._rtcConfiguration,r,i,e,3e5),this._rtcConfiguration=t._rtcConfiguration,this._transferPromise=T,this._joinRemotePromise=T,this._isEarlyMedia=!1,this._videoResolution=a,this._videoBandwidth=T,this._videoSendResolution=T,this._videoResolutionsTable=u.Base.VideoResolution,this._resolutionsArray=[],this._resolutionsArray=[],this._serverSentPreferredResolution=null,this._activeRenegotiateEventQueue=[],this._queuedRemoteCallEstablishedEvent=T,this._isReadyToReceiveMediaRequest=!1,this._3pccRequestTransactionMap={},this._mediaAction=T,this._prevMediaAction=T,this._latestVideoModeDirection=T,this._latestNonHoldingVideoDirection=T,this._isNailedUpVideoConnectionSupported=!1,this._isRingingStarted=!1,this._isCallServiceAvailable=!0,this._iceConnectionRestartTimestamp=T,this._iceRestartTransactionDfd=T,this._iceRestartRelayType=u.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY,this._iceRestartAttempts=0,this._selectedCandidatePairChangedTimerId=T,this._selectedCandidatePairChangedTimestamp=T,this._serviceAvailableIceRecoveryTimerId=T,this._iceRecoveryDueToMigration=!1,this._pendingVideoMuteUnmuteFunctor=T,this._hasReceivedCallEstablishedEvent=!1,this._hasLoggedRelayICECandidates=!1,this._isMPaaSCollabCall=!1,this._videoStatsInterval=T,this._videoStatsTimer=T,this._videoStatsFloatingWindow=[],this._avgVideoEncodeMs=0,this._avgVideoDecodeMs=0,this._isMediaConnected=!1,this._hadMediaConnected=!1,this._hasInitiatedMediaConnection=!1,this._iceRestartInProgress=!1,this._hasTriggeredMediaFailed=!1,this._initialGetOfferEvent=T,this._browserType=u.Base.Utils.getBrowserType(),this._runtimePerformanceMonitor=new u.Base.RuntimePerformanceMonitor(t._config),this.onPerformanceMonitorAlert=function(){},this.backgroundImage=T,this.backgroundBlur=!1,this._resolutionsQueue=[],this._onApplyingVideoConstraintsFinishedCallbacks=E.Callbacks(),this._unmuteVideoRenogatiationNeeded=!1,this._delayedSendVideoResolution=T,this._localVideoStreamEnablementTime=T,this._getOfferSDPEventInMultipleHandler=new u.Providers.Call.GetOfferSDPEventInMultipleHandler,this._offerSDPEventInMultipleHandler=new u.Providers.Call.OfferSDPEventInMultipleHandler,this._escalateVideoGetOfferEventInActiveRenegotiateHandler=new u.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler,this._escalateVideoOfferEventInActiveRenegotiateHandler=new u.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler,this._fsm=new u.Base.SimpleFsm.SimpleFsm,this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.StartCallEvent,u.Providers.Call.StartCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AcceptCallEvent,u.Providers.Call.AcceptCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.JoinRemoteCallEvent,u.Providers.Call.JoinRemoteCallEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.StartRingingEvent,u.Providers.Call.StartRingingEventInInitialHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.INITIAL,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.StartCallResponseEvent,u.Providers.Call.StartCallResponseEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.GetOfferSDPEvent,u.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OfferSDPEvent,u.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallRingingEvent,u.Providers.Call.CallRingingEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdateLocalStreamEvent,u.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.StartContentVideoSharingEvent,u.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.STARTING,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallRingingEvent),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SendDTMFEvent,u.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.GetOfferSDPEvent,u.Providers.Call.GetOfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OfferSDPEvent,u.Providers.Call.OfferSDPEventInStartingHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnAddRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.OnRemoveRemoteTrackEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ALERTING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventPreActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.CallStateFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.BlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SendDTMFEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.MEDIA_RECOVERY,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingAddVideoEvent,u.Providers.Call.IncomingAddVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingRemoveVideoEvent,u.Providers.Call.IncomingRemoveVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingAddVideoTimedoutEvent,u.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AcceptSendVideoEvent,u.Providers.Call.AcceptSendVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DenySendVideoEvent,u.Providers.Call.DenySendVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.BlockCameraEvent,u.Providers.Call.BlockCameraEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.UnBlockCameraEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.EscalateVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.EscalateNailedUpVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.DeEscalateVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RejectOfferSDPEvent,u.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SendDTMFEvent,u.Providers.Call.SendDTMFEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateRemoteVideoEvent,u.Providers.Call.UpdateRemoteVideoEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.HoldEvent,u.Providers.Call.HoldEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UnHoldEvent,u.Providers.Call.UnHoldEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateLocalStreamEvent,u.Providers.Call.UpdateLocalStreamHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.StartContentVideoSharingEvent,u.Providers.Call.StartContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.StopContentVideoSharingEvent,u.Providers.Call.StopContentVideoSharingHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateContentVideoSharingAudioEvent,u.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AttendedTransferEvent,u.Providers.Call.AttendedTransferEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.TransferEvent,u.Providers.Call.TransferEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallRingingEvent,u.Providers.Call.CallRingingEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoRejectedEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AddParticipantFromExistingCallEvent,u.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.IncomingGenericOfferSDPEvent,u.Providers.Call.IncomingGenericOfferSDPEventInActive),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.AudioEndedEvent,u.Providers.Call.AudioEndedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ACTIVE,u.Providers.Call.CallStateFailureEvent),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.CallEstablishedEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.GetOfferSDPEvent,this._getOfferSDPEventInMultipleHandler.handleEvent.bind(this._getOfferSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OfferSDPEvent,this._offerSDPEventInMultipleHandler.handleEvent.bind(this._offerSDPEventInMultipleHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RejectOfferSDPEvent,u.Providers.Call.RejectOfferSDPEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AnswerSDPEvent,u.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AnswerSdpAckEvent,u.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteAudioEvent,u.Providers.Call.MuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteAudioEvent,u.Providers.Call.UnmuteAudioEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteVideoEvent,u.Providers.Call.MuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteVideoEvent,u.Providers.Call.UnmuteVideoEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.MuteSpeakerEvent,u.Providers.Call.MuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnmuteSpeakerEvent,u.Providers.Call.UnmuteSpeakerEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoGetOfferEvent,this._escalateVideoGetOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoGetOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoOfferEvent,this._escalateVideoOfferEventInActiveRenegotiateHandler.handleEvent.bind(this._escalateVideoOfferEventInActiveRenegotiateHandler)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoAnswerEvent,u.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoRejectedEvent,u.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RevertStateEvent,u.Providers.Call.RevertStateEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnAddStreamEvent,u.Providers.Call.OnAddStreamEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.DeviceRetrievalFailedEvent,u.Providers.Call.DevicesFailureHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnAddRemoteTrackEvent,u.Providers.Call.OnAddRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.OnRemoveRemoteTrackEvent,u.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallStateFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.CallFailureEvent,u.Providers.Call.CallFailureEventInActiveRenegotiateHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.IncomingGenericOfferSDPEvent,u.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AcceptCallRequestEvent,u.Providers.Call.AcceptCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.RejectCallRequestEvent,u.Providers.Call.RejectCallRequestEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdateLocalStreamEvent,this._queueUpdateLocalStreamEvent.bind(this)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.StartContentVideoSharingEvent,this._queueStartContentVideoSharingEvent.bind(this)),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.ServiceAvailableEvent,u.Providers.Call.ServiceAvailableEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdateIceRestartMediaEvent,u.Providers.Call.UpdateIceRestartMediaEventInActiveHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UpdatePreferredReceiveResolutionEvent,u.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.BlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.UnBlockCameraEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.EscalateNailedUpVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.DeEscalateVideoEvent,u.Providers.Call.RejectMidCallEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.SetBackgroundImageEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.SetBackgroundBlurEvent,u.Providers.Call.SetMediaProcessingEventInMultipleHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ACTIVE_RENEGOTIATE,u.Providers.Call.AudioEndedEvent),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EndCallEvent,u.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EndCallResponseEvent,u.Providers.Call.EndCallResponseEventInEndingHandler),this._fsm.registerHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallEstablishedEvent,u.Providers.Call.IncomingCallEstablishedEventInEndingHandler),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RejectOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.StopContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDING,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EndCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EndCallEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StartCallResponseEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.GetOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.OfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallRingingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AnswerSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteAudioEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.MuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnmuteSpeakerEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdateIceRestartMediaEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.ServiceAvailableEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.SetBackgroundBlurEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.SetBackgroundImageEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallEstablishedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.BlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnBlockCameraEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.EscalateNailedUpVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.DeEscalateVideoEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.RevertStateEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.OnAddStreamEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.HoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UnHoldEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.IncomingGenericOfferSDPEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallStateFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.CallFailureEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AcceptCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.RejectCallRequestEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdatePreferredReceiveResolutionEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.AudioEndedEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StartContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.StopContentVideoSharingEvent),this._fsm.registerNoOpHandler(u.Providers.Call.States.ENDED,u.Providers.Call.UpdateContentVideoSharingAudioEvent),this._fsm.start(u.Providers.Call.States.INITIAL),this._rtConnection&&(this._rtConnection.on(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.ICE_CONNECTION_STATE_CHANGED,function(e){this._processIceConnectionStateChange(e)}.bind(this)),this._rtConnection.on(u.Base.AbstractRTCConnectionProvider.ObservableRTCEvents.LOCAL_AUDIO_TRACK_ENDED,function(e){this.call.isMicrophoneDisabled()||this.recoverLocalAudio()}.bind(this))),this._selectedCandidatePairChangedCallback=function(e){e&&(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected ICE candidate pair updates "+e),this._selectedCandidatePairChangedTimestamp=Date.now(),this.initiateIceRecoveryIfSelectedCandidatePairChanged())}.bind(this),u.Base.Logger.debug(u.Base.LoggerTags.CALL_PROVIDER,"Initialized CPCall")}(e.prototype={}).prepareEvent=function(e){return e.data||(e.data={}),e.data.cpCall=this,e.data.callProvider=this._callProvider,e},e.prototype.handleEvent=function(e){this.prepareEvent(e),this._fsm.handleEvent(e)},e.prototype.revertFsmState=function(e){var t=new u.Providers.Call.RevertStateEvent;t.data={state:e},this.handleEvent(t)},e.prototype.startCall=function(e,t,i,a,r,s,n,o){this._audioDevice=e,this._videoDevice=t,a=a||!1,r=r||!1,this._rtConnection&&this._rtConnection.addOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback);var c=new u.Providers.Call.StartCallEvent;c.data={remoteAddress:this.call.getRemoteAddress(),audioDevice:e,videoDevice:t,video:i,videoResolution:this._videoResolution,webCollab:a,uccp:r,nailedUpVideoConnection:s,appType:n,appVersion:o},this.handleEvent(c)},e.prototype.generateTemporarilyCallId=function(){return"temp-"+u.Base.Utils.generateUUID()},e.prototype.getOfferSDP=function(e,t,i,a,r,s,n,o,c,l,d){var C=!1;l&&this.setVideoResolutionsTable(l),this._rtcConfiguration&&this._rtcConfiguration._expiryTime&&(C=Date.now()>=this._rtcConfiguration._expiryTime);n=this.updateIceServers(n);n&&(this._hasLoggedRelayICECandidates=!1,!o&&"relayOnly"===this.getIceRestartRelayType()&&C&&(o=!0)),this._prevMediaAction=this._mediaAction;C=new((this._mediaAction=e)===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?u.Providers.Call.EscalateVideoGetOfferEvent:u.Providers.Call.GetOfferSDPEvent),a=this.adjustVideoResolution(e,i,a);r=r||this._audioDevice,s=s||this._videoDevice,C.data={action:e,audioStream:t,videoStreams:i,audioDevice:r,videoDevice:s,videoResolution:a,iceServerChanged:n,restartTurnGathering:o,useIPv6Candidates:c,serverSentResolution:d},e!==u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&(this._initialGetOfferEvent=C),this.handleEvent(C)},e.prototype.offerSDP=function(e,t,i,a,r,s){var n,s=this.updateIceServers(s);s&&(this._hasLoggedRelayICECandidates=!1);var o={offer:e,action:t,audioStream:i,videoStreams:a,audioDevice:this._callProvider.getMediaServiceFactory().getAudioInterface().getInputInterface().getSelectedDevice(),videoDevice:this._callProvider.getMediaServiceFactory().getVideoInterface().getSelectedDevice(),iceServerChanged:s};switch(this._prevMediaAction=this._mediaAction,this._mediaAction=t,u.Base.Utils.isDefined(this.mediaTransactionDfd)&&this.mediaTransactionDfd.state()!==u.Base.DeferredStates.PENDING&&this.call.getState()===u.Services.Call.CallStates.ESTABLISHED&&this.call._setState(u.Services.Call.CallStates.FAR_END_RENEGOTIATING),t){case u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION:n=new(0===a.length||!1===a[0].enabled?u.Providers.Call.OfferSDPEvent:u.Providers.Call.EscalateVideoOfferEvent)(o);break;case u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:case u.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:n=new u.Providers.Call.IncomingGenericOfferSDPEvent(o);break;default:n=new u.Providers.Call.OfferSDPEvent(o)}if(0<this.videoStreams.length&&0<a.length){i=this.getStreamDirection(this.videoStreams[0]),s=this.getStreamDirection(a[0]);i!==u.Services.Call.MediaDirection.INACTIVE&&s===u.Services.Call.MediaDirection.INACTIVE&&this._browserType===u.Base.BrowserType.EDGE?(this.determineIfNailedUpVideoConnectionSupported(a),this.isNailedUpVideoConnectionSupported()?(n.data.videoBandwidth=r,n.data.videoResolution=this.adjustVideoResolution(t,a,r)):t===u.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?this.callFailure(u.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,u.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):this.callFailure(u.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,u.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser")):(n.data.videoBandwidth=r,n.data.videoResolution=this.adjustVideoResolution(t,a,r))}else if(this.isNailedUpVideoConnectionSupported()&&t===u.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Reject SDP Offer: "+t),void this.rejectOfferSDP(4880001,"Video escalation prohibited","Add video is not supported");this.handleEvent(n)},e.prototype.callRinging=function(e,t,i,a,r,s,n,o,c,l,d){var C=new u.Providers.Call.CallRingingEvent;C.data={address:e,displayName:t,isAuraAsserted:i,isPrivate:a,alertType:r,earlyMedia:s,audioStream:n,videoStreams:o,ucid:c,parentUcid:l,contextId:d},this.handleEvent(C)},e.prototype.answerSDP=function(e,t,i,a,r,s,n){var o=new(t===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION?u.Providers.Call.EscalateVideoAnswerEvent:u.Providers.Call.AnswerSDPEvent);this._updateVideoBandwidth(r),o.data={answer:e,action:t,audioStream:i,videoStreams:a,videoBandwidth:r,videoResolutions:s,serverSentResolution:n},this.handleEvent(o)},e.prototype.answerSdpAck=function(e,t,i){var a=new(e===u.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&(0===i.length||!1===i[0].enabled)?u.Providers.Call.EscalateVideoRejectedEvent:u.Providers.Call.AnswerSdpAckEvent);a.data={action:e,audioStream:t,videoStreams:i},this.handleEvent(a)},e.prototype.buildCallEstablishedEvent=function(e,t,i,a,r,s,n,o,c,l,d){this._hasReceivedCallEstablishedEvent=!0;var C=new u.Providers.Call.CallEstablishedEvent;return C.data={address:e,displayName:t,audioStream:i,videoStreams:a,isConf:r,isRemote:o},r&&(C.data.uccpUrl=s,C.data.webCollabUrl=n),c&&(C.data.ucid=c,C.data.parentUcid=l,C.data.contextId=d),C},e.prototype.callEstablished=function(e,t,i,a,r,s,n,o,c,l,d){this.startPerformanceMonitoring();d=this.buildCallEstablishedEvent(e,t,i,a,r,s,n,o,c,l,d);this.handleEvent(d)},e.prototype.muteAudio=function(){var e=new u.Providers.Call.MuteAudioEvent;this.handleEvent(e)},e.prototype.unmuteAudio=function(){var e=new u.Providers.Call.UnmuteAudioEvent;this.handleEvent(e)},e.prototype.recoverLocalAudio=function(){var e=new u.Providers.Call.AudioEndedEvent;this.handleEvent(e)},e.prototype.sendMuteUnmuteVideoNotification=function(){switch(this.call._videoMuteState){case u.Services.Call.MediaMuteStates.MUTED:this.muteVideo(!0);break;case u.Services.Call.MediaMuteStates.UNMUTED:this.unmuteVideo(!0)}},e.prototype.muteVideo=function(e){var t;return this.noMediaTransactionDfd=E.Deferred(),this.videoStreams.length?((t=new u.Providers.Call.MuteVideoEvent).data={sendNotificationOnly:e||!1},this.handleEvent(t)):this.noMediaTransactionDfd.resolve("Queued").promise(),this.noMediaTransactionDfd.promise()},e.prototype.unmuteVideo=function(e){var t;return this.anyMediaTransactionDfd=E.Deferred(),this._unmuteVideoRenogatiationNeeded?this.mediaTransactionDfd=this.anyMediaTransactionDfd:this.noMediaTransactionDfd=this.anyMediaTransactionDfd,this.videoStreams.length?((t=new u.Providers.Call.UnmuteVideoEvent).data={sendNotificationOnly:e||!1},this.handleEvent(t)):this.anyMediaTransactionDfd.resolve("Queued").promise(),this.anyMediaTransactionDfd.promise()},e.prototype.muteSpeaker=function(){var e=new u.Providers.Call.MuteSpeakerEvent;this.handleEvent(e)},e.prototype.unmuteSpeaker=function(){var e=new u.Providers.Call.UnmuteSpeakerEvent;this.handleEvent(e)},e.prototype.end=function(e){u.Base.Logger.debug(u.Base.LoggerTags.CALL_PROVIDER,"Local call ending: "+e),this.cleanup();var t=new u.Providers.Call.EndCallEvent;t.data={remote:!1,denialReason:e},-1===this.call.getCallId().indexOf("temp-")?this.handleEvent(t):this.call.getState()===u.Services.Call.CallStates.FAILED&&(this._callProvider.unRegisterCall(this.call),this._callProvider.triggerCallEnded(this.call))},e.prototype.cleanup=function(){this.stopAllStreams(),this.removeVideoSharingAudioContext(),clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),clearTimeout(this._firstSendResolutionTimeoutId),this.stopPerformanceMonitoring(),this._rtConnection&&this._rtConnection.removeOnSelectedCandidatePairIdChanged(this._selectedCandidatePairChangedCallback)},e.prototype.stopMonitoringVideoDelays=function(){clearTimeout(this._videoStatsTimer),clearInterval(this._videoStatsInterval)},e.prototype.cleanupImmediately=function(){this.cleanup(),this._rtConnection&&this._rtConnection.close()},e.prototype.callEndedRemotely=function(e){this.cleanup();var t=new u.Providers.Call.EndCallEvent;t.data={remote:!0,callReason:e},this.handleEvent(t)},e.prototype.incomingCall=function(){var e=new u.Providers.Call.IncomingCallEvent;this.handleEvent(e)},e.prototype.acceptCall=function(e,t){this._audioDevice=e,this._videoDevice=t;var i=new u.Providers.Call.AcceptCallEvent;i.data={audioDevice:e};e=this.call.getVideoChannels();0<e.length&&(i.data.videoDevice=t,i.data.videoChannel=e[0],i.data.videoResolution=this.getVideoResolution()),this.handleEvent(i)},e.prototype.acceptSendVideo=function(e,t){this.mediaTransactionDfd=E.Deferred(),this._videoDevice=e;var i=new u.Providers.Call.AcceptSendVideoEvent;i.data={videoChannel:t,videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=i;e=this.mediaTransactionDfd.promise();return this.handleEvent(i),e},e.prototype.denySendVideo=function(){var e=new u.Providers.Call.DenySendVideoEvent;this.handleEvent(e)},e.prototype.callFailed=function(e,t,i){var a=new u.Providers.Call.EndCallEvent;a.data={remote:!1,reason:i},this.handleEvent(a)},e.prototype.callStateFailure=function(e){!e||e!==u.Services.Call.CallError.CALL_STATE_MISMATCH||!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()?(e=new u.Providers.Call.CallStateFailureEvent,this.handleEvent(e)):this.triggerCallMediaFailed()},e.prototype.callFailure=function(e,t,i,a){a=new u.Providers.Call.CallFailureEvent({errorCode:e,protocolType:t,protocolErrorCode:i,failureReason:a});this.handleEvent(a)},e.prototype.rejectOfferSDP=function(e,t,i){i=new u.Providers.Call.RejectOfferSDPEvent({errorCode:e,errorMsg:t,displayMsg:i});this.handleEvent(i)},e.prototype.blockCamera=function(e){this.mediaTransactionDfd=E.Deferred(),e=!this.isNailedUpVideoConnectionSupported()&&e||!1;e=new u.Providers.Call.BlockCameraEvent({deallocateCamera:e});return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.unBlockCamera=function(e){this.mediaTransactionDfd=E.Deferred();var t=new u.Providers.Call.UnBlockCameraEvent;return t.data={videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.updateRemoteVideo=function(){this.mediaTransactionDfd=E.Deferred();var e=new u.Providers.Call.UpdateRemoteVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.updatePreferredResolution=function(e,t){var i=this.getVideoResolutionsTable()[t],t=e.getNegotiatedResolution();(!i||i.getHeight()>t.getHeight())&&(i?u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Given resolution exceeds negotiated, using "+t+" instead"):u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Given resolution were not provided with resolution table, using "+t+" instead"),i=t);var a,r,s=u.Base.VideoResolutionDetails.prototype.convertToConfigVideoResolution.call(T,i);return e._preferredResolution=s,e.getNegotiatedDirection()!==u.Services.Call.MediaDirection.SEND_ONLY&&(a=this.setPreferredReceiveResolution(e.getChannelId(),s)),e.getNegotiatedDirection()!==u.Services.Call.MediaDirection.RECV_ONLY&&e.getNegotiatedDirection()!==u.Services.Call.MediaDirection.INACTIVE&&(r=this.setVideoSendResolution(i,!0)),E.when(a,r).then(function(){return s})},e.prototype.setPreferredReceiveResolution=function(t,e){var i,a,r=this.getVideoResolutionsTable();return this.noMediaTransactionDfd=E.Deferred(),0<this.call.getVideoChannels().filter(function(e){return t===e.getChannelId()}).length?(i=new u.Providers.Call.UpdatePreferredReceiveResolutionEvent,a=r[e],r=new u.Base.VideoResolutionDetails,e=!a||a.getHeight()>this._videoResolution.getHeight()?r.convertToConfigVideoResolution(this._videoResolution):e,i.data={videoResolution:e},this.handleEvent(i)):this.noMediaTransactionDfd.reject(new u.Services.Call.CallException(u.Services.Call.CallError.NOT_FOUND)),this.noMediaTransactionDfd.promise()},e.prototype.setVideoSendResolution=function(t,i){if(u.Base.Utils.isUndefined(t))return u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"Undefined video resolution details"),E.Deferred().reject().promise();if(this.isLocalVideoMuted())return u.Base.Logger.debug(u.Base.LoggerTags.CALL_PROVIDER,"Not updating video resolution because video is muted."),E.Deferred().reject().promise();var a=E.Deferred(),e=t.getHeight(),r=t.getWidth(),s=t.getFPS(),n=t.getMinBandwidth();null!==this._serverSentPreferredResolution&&(e=Math.min(e,this._serverSentPreferredResolution.getHeight()),r=Math.min(r,this._serverSentPreferredResolution.getWidth()),s=Math.min(s,this._serverSentPreferredResolution.getFPS()),n=Math.min(n,this._serverSentPreferredResolution.getMinBandwidth()));var o,c=e===this.getNegotiatedVideoResolution().getHeight()?Math.min(this.getVideoBandwidth(),t.getMaxBandwidth()):n;return this._videoResolutionsTable!==u.Base.VideoResolution&&e===this.getNegotiatedVideoResolution().getHeight()&&(c=(this._videoResolutionsTable["resolution"+e+"p"]||t).getMinBandwidth()),this._rtConnection.isApplyingVideoConstraints()?(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Applying constraints is in progress, adding "+t.toString()+" to resolutions queue"),this._resolutionsQueue.push(t),o=function(){var e;this._resolutionsQueue.length&&(e=this._resolutionsQueue.shift(),u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Setting previously queued send resolution "+e.toString()),this.setVideoSendResolution(e,i).then(function(){a.resolve(e)},function(e){a.reject(e)}))}.bind(this),this.addOnApplyingVideoConstraintsFinishedCallbacks(o)):(n=u.Base.Utils.isDefined(this.call.getEstablishedTime())?Date.now()-this.call.getEstablishedTime():0,o=this.needUnmuteSendResolutionDelay(),i||3e4<=n&&-1===o?(clearTimeout(this._firstSendResolutionTimeoutId),this._firstSendResolutionTimeoutId=T,this._rtConnection.setVideoSendResolutionAndBandwidth(r,e,s,c,i).then(function(){this._updateVideoSendResolution(t),this._onApplyingVideoConstraintsFinishedCallbacks.fire(),a.resolve(t)}.bind(this),function(e){u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"Failed set video set video send resolution "+e),e&&("No live video track found"===e?this._updateVideoSendResolution(t):"Failed to applyConstraints - track ended"===e&&u.Providers.Call.CPUtils.updateVideoResolution(this,this._callProvider.getMediaServiceFactory(),t)),this._onApplyingVideoConstraintsFinishedCallbacks.fire(),a.reject(e)}.bind(this))):(n=Math.max(o,3e4-n),this.setVideoSendResolutionDelayed(t,i,n),a.resolve())),a.promise()},e.prototype.setVideoSendResolutionDelayed=function(e,t,i){this._delayedSendVideoResolution=e,this._firstSendResolutionTimeoutId||(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Delaying setVideoSendResolution: timeout "+i),this._firstSendResolutionTimeoutId=setTimeout(function(){this._firstSendResolutionTimeoutId=T,(this._delayedSendVideoResolution.getHeight()<this.getVideoSendResolution().getHeight()||30!==this._delayedSendVideoResolution.getFPS())&&(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Executing setVideoSendResolution: "+this._delayedSendVideoResolution.getHeight()+"p "+this._delayedSendVideoResolution.getFPS()+"fps"),this.setVideoSendResolution(this._delayedSendVideoResolution,t))}.bind(this),i))},e.prototype.needUnmuteSendResolutionDelay=function(){if(u.Base.Utils.isDefined(this._localVideoStreamEnablementTime)){var e=Date.now()-this._localVideoStreamEnablementTime;if(e<3e4)return clearTimeout(this._firstSendResolutionTimeoutId),this._firstSendResolutionTimeoutId=T,3e4-e}return-1},e.prototype.adjustVideoConstraints=function(e,t,i){if(this._videoResolution.getHeight()>t||this._videoResolution.getWidth()>e||this._videoResolution.getFPS()>i){var a=this.getVideoResolutionsTable();t=Math.min(this._videoResolution.getHeight(),t),e=Math.min(this._videoResolution.getWidth(),e),i=Math.min(this._videoResolution.getFPS(),i);var r=Object.keys(a).filter(function(e){return a[e].getHeight()===t})[0];this._rtConnection.addOnAppliedVideoConstraintsAfterTrackUnmutedCallbacks(function(){r&&this._updateVideoResolution(a[r])}.bind(this));var s=this._videoSharingStream?null:this._videoDevice.getDeviceId();return this._rtConnection.adjustVideoConstraints(e,t,i,s,this.getVideoResolutionsTable()).then(function(){r&&this._updateVideoResolution(a[r])}.bind(this)).fail(function(e){return E.Deferred().reject(e).promise()}.bind(this))}return E.Deferred().resolve().promise()},e.prototype.updateDevice=function(e,t,i){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Update to new device: ",i),!u.Base.Utils.isDefined(i))return u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"No device selected"),E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.FAILED)).promise();if(this._rtConnection.isRTCRtpSenderSupported())return this._replaceDeviceTrack(e,t,i);var a=new u.Providers.Call.UpdateLocalStreamEvent;return a.data={audioDevice:e,videoDevice:t,selectedDevice:i,videoResolution:this._videoResolution},this.mediaTransactionDfd=E.Deferred(),this._mediaTransactionInitialEvent=a,this.handleEvent(a),this.mediaTransactionDfd.promise()},e.prototype._replaceDeviceTrack=function(e,t,i){var a=E.Deferred();this._audioDevice=e,this._videoDevice=t;function r(){a.resolve()}function s(e){u.Base.Logger.error("Failed to update device:",e),a.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))}return i._kind===u.Base.MediaTypes.VIDEO_INPUT?(this._videoDevice=i,0<this.videoStreams.length&&(u.Base.Utils.isDefined(this._videoSharingStream)||this._getPreviousVideoDirection()===u.Services.Call.MediaDirection.RECV_ONLY)?a.reject(new u.Services.Call.CallException(u.Services.Call.CallError.CALL_STATE_MISMATCH)).promise():u.Providers.Call.CPUtils.updateDevices(T,this._videoDevice,this,this._callProvider.getMediaServiceFactory(),this.getVideoResolution(),r,s,this.getNoiseSuppressionConstraints())):(this._audioDevice=i,this.isScreenSharingUsingVideo()?u.Providers.Call.CPUtils.updateDevices(this._audioDevice,T,this,this._callProvider.getMediaServiceFactory(),this.getVideoResolution(),function(){var e=this.mixVideoSharingAudio(this.localStream);this._rtConnection.replaceLocalMediaTrack(e).fail(function(e){u.Base.Logger.error("Failed to replace new content video sharing audio track: ",e),a.reject(new u.Services.Call.CallException(u.Services.Call.CallError.MEDIA_CREATION_FAILURE))})},s,this.getNoiseSuppressionConstraints()):u.Providers.Call.CPUtils.updateDevices(this._audioDevice,T,this,this._callProvider.getMediaServiceFactory(),this.getVideoResolution(),r,s,this.getNoiseSuppressionConstraints())),a.promise()},e.prototype.startContentVideoSharing=function(e,t){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"startContentVideoSharing: replacing video by content"),t&&(this._videoDevice=t),0===this.call.getVideoChannels().length)return E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();this._videoSharingStream=e;t=new u.Providers.Call.StartContentVideoSharingEvent;return t.data={stream:e,videoResolution:this._videoResolution,videoResolutionChanged:!1},u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=E.Deferred()),this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.stopContentVideoSharing=function(){if(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),this.isScreenSharingUsingVideo()){var e=new u.Providers.Call.StopContentVideoSharingEvent;return u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=E.Deferred()),this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()}return E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.updateAudioSourceForVideoSharing=function(e){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"updateAudioSourceForVideoSharing: from microphone: "+e);var t=new u.Providers.Call.UpdateContentVideoSharingAudioEvent;return t.data={stream:this._videoSharingStream,fromMicrophone:e},u.Base.Utils.isUndefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd=E.Deferred()),this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.replaceContentWithVideo=function(){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"stopContentVideoSharing: replacing content by video"),u.Base.Utils.isDefined(this._videoDevice)?this.updateDevice(this._audioDevice,this._videoDevice,this._videoDevice):(u.Base.Logger.error(u.Base.LoggerTags.CALL_PROVIDER,"No device selected"),this.mediaTransactionDfd.reject(new u.Services.Call.CallException(u.Services.Call.CallError.FAILED)))},e.prototype.escalateVideo=function(e){this.mediaTransactionDfd=E.Deferred();var t=new u.Providers.Call.EscalateVideoEvent;return t.data={videoDevice:e,videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=t,this.handleEvent(t),this.mediaTransactionDfd.promise()},e.prototype.escalateNailedUpVideo=function(){this.mediaTransactionDfd=E.Deferred();var e=new u.Providers.Call.EscalateNailedUpVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.deEscalateVideo=function(){this.mediaTransactionDfd=E.Deferred();var e=new u.Providers.Call.DeEscalateVideoEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.resolveMediaTransaction=function(e){setTimeout(function(){u.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.resolve(e),this.mediaTransactionDfd=T)}.bind(this),0)},e.prototype.rejectMediaTransaction=function(e){u.Base.Utils.isDefined(this.mediaTransactionDfd)&&(this.mediaTransactionDfd.reject(e),this.mediaTransactionDfd=T)},e.prototype.sendDTMF=function(e){var t=new u.Providers.Call.SendDTMFEvent;t.data={dtmf:e},this.handleEvent(t)},e.prototype.incomingVideoRequestTimedout=function(){var e=new u.Providers.Call.IncomingAddVideoTimedoutEvent;this.handleEvent(e)},e.prototype.deviceRetrievalFailure=function(e){var t=new u.Providers.Call.DeviceRetrievalFailedEvent,e=u.Base.Utils.isDefined(e)?e:u.Services.Call.CallStates.FAILED;t.data={nextState:e},this.handleEvent(t)},e.prototype.hold=function(){this.mediaTransactionDfd=E.Deferred();var e=new u.Providers.Call.HoldEvent;return this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.unhold=function(){this.mediaTransactionDfd=E.Deferred();var e=new u.Providers.Call.UnHoldEvent;return e.data={videoResolution:this.getVideoResolution()},this._mediaTransactionInitialEvent=e,this.handleEvent(e),this.mediaTransactionDfd.promise()},e.prototype.transfer=function(e){this._transferPromise=E.Deferred();var t=new u.Providers.Call.TransferEvent;return t.data={targetRemoteAddress:e},this.handleEvent(t),this._transferPromise.promise()},e.prototype.attendedTransfer=function(e){this._transferPromise=E.Deferred();var t=new u.Providers.Call.AttendedTransferEvent;return t.data={targetCallId:e},this.handleEvent(t),this._transferPromise.promise()},e.prototype.addParticipantFromCall=function(e){var t=new u.Providers.Call.AddParticipantFromExistingCallEvent;t.data={participantCallId:e.getCallId()},this.handleEvent(t)},e.prototype.join=function(e){this._joinRemotePromise=E.Deferred();var t=new u.Providers.Call.JoinRemoteCallEvent;return t.data={audioDevice:e,videoResolution:this._videoResolution},this.handleEvent(t),this._joinRemotePromise.promise()},e.prototype.startRinging=function(){var e;this.isRingingStarted()?u.Base.Logger.warn("StartRinging request ignored: already started"):(e=new u.Providers.Call.StartRingingEvent,this.handleEvent(e))},e.prototype.acceptCallRequest=function(e,t){var i=new u.Providers.Call.AcceptCallRequestEvent;i.data={deferred:e,requestedType:t},this.handleEvent(i)},e.prototype.rejectCallRequest=function(e,t){var i=new u.Providers.Call.RejectAnswerCallRequestEvent;i.data={deferred:e,requestedType:t},this.handleEvent(i)},e.prototype.updateAudioVideoStreamsDirection=function(e,t,i){this.updateAudioStreamDirection(e,i),this.updateVideoStreamsDirection(t,i)},e.prototype.updateAudioNoiseReduction=function(e){e.serverNoiseReduction&&(this.audioStream.serverNoiseReduction=e.serverNoiseReduction)},e.prototype.updateAudioStreamDirection=function(e,t){if(e&&this.audioStream){switch(e.direction){case u.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.direction=u.Services.Call.MediaDirection.RECV_ONLY;break;case u.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.direction=u.Services.Call.MediaDirection.SEND_ONLY;break;case u.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.direction=e.direction);break;default:this.audioStream.direction=e.direction}this.isNailedUpVideoConnectionSupported()&&this._updateAudioStreamLogicalDirection(e,t)}},e.prototype._updateAudioStreamLogicalDirection=function(e,t){if(e)switch(e.logicalDirection){case u.Services.Call.MediaDirection.SEND_ONLY:this.audioStream.logicalDirection=u.Services.Call.MediaDirection.RECV_ONLY;break;case u.Services.Call.MediaDirection.RECV_ONLY:this.audioStream.logicalDirection=u.Services.Call.MediaDirection.SEND_ONLY;break;case u.Services.Call.MediaDirection.SEND_RECV:(this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION)&&(this.audioStream.logicalDirection=e.logicalDirection);break;default:this.audioStream.logicalDirection=e.logicalDirection}},e.prototype.updateVideoStreamsDirection=function(e,t){this._updateVideoStreamsDirection(e,t,this._calculateDirectVideoUpdateDirection.bind(this))},e.prototype.updateVideoStreamsDirectionBasedOnVideoMode=function(e,t){this._latestVideoModeDirection?this._updateVideoStreamsDirection(e,t,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoStreamsDirection(e,t)},e.prototype._updateVideoStreamsDirection=function(e,t,i){if(e){for(var a=0;a<this.videoStreams.length;a++)e[a]&&(e[a].enabled?this.isNailedUpVideoConnectionSupported()||this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[a].direction=i.call(this,e[a].direction,this.videoStreams[a].direction,!0,t):this.videoStreams[a].direction=u.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[a].enabled=!1,this.videoStreams[a].direction=u.Services.Call.MediaDirection.INACTIVE));this.isNailedUpVideoConnectionSupported()&&this._updateVideoStreamsLogicalDirection(e,t,i),0<this.videoStreams.length&&this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING&&t!==u.Providers.Call.CallProvider.Constants.HOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&t!==u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION&&(this._latestNonHoldingVideoDirection=this.getStreamDirection(this.videoStreams[0]))}},e.prototype._calculateDirectVideoUpdateDirection=function(e,t,i,a){if(!i)return u.Services.Call.MediaDirection.INACTIVE;switch(e){case u.Services.Call.MediaDirection.SEND_ONLY:return t===u.Services.Call.MediaDirection.SEND_ONLY?u.Services.Call.MediaDirection.INACTIVE:u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return t===u.Services.Call.MediaDirection.RECV_ONLY?u.Services.Call.MediaDirection.INACTIVE:u.Services.Call.MediaDirection.SEND_ONLY;case u.Services.Call.MediaDirection.SEND_RECV:return u.Base.Utils.isDefined(a)&&a===u.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION?this.call._videoChannels[0]._getInternalRequestedDirection():e;default:return e}},e.prototype._calculateVideoModeUpdateVideoDirection=function(e){switch(e){case u.Services.Call.MediaDirection.SEND_RECV:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:return u.Services.Call.MediaDirection.SEND_RECV;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return T}break;case u.Services.Call.MediaDirection.RECV_ONLY:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:return u.Services.Call.MediaDirection.SEND_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.INACTIVE;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return T}break;case u.Services.Call.MediaDirection.SEND_ONLY:switch(this._latestVideoModeDirection){case u.Services.Call.MediaDirection.SEND_RECV:case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.INACTIVE;default:return T}break;default:return T}},e.prototype._updateVideoStreamsLogicalDirection=function(e,t,i){if(e)for(var a=0;a<this.videoStreams.length;a++)e[a]&&(e[a].enabled?this.call.getState()!==u.Services.Call.CallStates.HELD&&this.call.getState()!==u.Services.Call.CallStates.HOLDING||t===u.Providers.Call.CallProvider.Constants.UNHOLD_ACTION?this.videoStreams[a].logicalDirection=this.videoStreams[a].logicalDirection=i.call(this,e[a].logicalDirection,this.videoStreams[a].logicalDirection,this.videoStreams[a].enabled,t):this.videoStreams[a].logicalDirection=u.Services.Call.MediaDirection.INACTIVE:(this.videoStreams[a].enabled=!1,this.videoStreams[a].logicalDirection=u.Services.Call.MediaDirection.INACTIVE))},e.prototype.getStreamDirection=function(e){var t;return t=e?this.isNailedUpVideoConnectionSupported()&&e.logicalDirection||e.direction:t},e.prototype.updateVideoChannelDirection=function(e){this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(e,this.getReversedVideoChannelDirection.bind(this)):this._updateVideoChannelDirection(e,this.getReversedVideoChannelDirection.bind(this))},e.prototype.updateVideoChannelDirectionBasedOnVideoMode=function(e){this._latestVideoModeDirection?this.isNailedUpVideoConnectionSupported()?this._updateVideoChannelLogicalDirection(e,this._calculateVideoModeUpdateVideoDirection.bind(this)):this._updateVideoChannelDirection(e,this._calculateVideoModeUpdateVideoDirection.bind(this)):this.updateVideoChannelDirection(e)},e.prototype._updateVideoChannelDirection=function(e,t){if(e)for(var i=this.call.getVideoChannels(),a=0;a<i.length;a++)e[a]&&(e[a].enabled?i[a]._setNegotiatedDirection(t.call(this,e[a].direction)):i[a]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype._updateVideoChannelLogicalDirection=function(e,t){if(e)for(var i,a=this.call.getVideoChannels(),r=0;r<a.length;r++)e[r]&&(e[r].enabled?(i=e[r].logicalDirection||e[r].direction,a[r]._setNegotiatedDirection(t.call(this,i))):a[r]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype.calculateUpdateVideoDirection=function(e){if(e&&0<this.videoStreams.length){e=this.getStreamDirection(e);return this._calculateVideoModeUpdateVideoDirection(e)}return T},e.prototype.getReversedVideoChannelDirection=function(e){switch(e){case u.Services.Call.MediaDirection.SEND_ONLY:return u.Services.Call.MediaDirection.RECV_ONLY;case u.Services.Call.MediaDirection.RECV_ONLY:return u.Services.Call.MediaDirection.SEND_ONLY;default:return e}},e.prototype.updateAudioChannelDirection=function(e){var t=this.call.getAudioChannel();t&&e&&(e.enabled?t._setNegotiatedDirection(e.direction):t._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE))},e.prototype.setAVStreams=function(e,t){this.audioStream=e,this.videoStreams=t},e.prototype.removeLocalVideoTracks=function(){var e=this.call.getVideoChannels();this.localStream&&0<e.length&&(this._callProvider.getMediaServiceFactory().getMediaServicesService().removeLocalVideoTracks(e[0].getChannelId(),this._rtConnection),this.localStream.getVideoTracks().forEach(function(e){this.localStream.removeTrack(e)}.bind(this)),this.setAVStreams(this.getAudioStream(),[]))},e.prototype.hasVideoTracks=function(){return this._rtConnection.hasVideoTracks(this.localStream)},e.prototype.getLocalVideoTrack=function(){if(this.localStream){var e=this.localStream.getVideoTracks();if(0<e.length)for(var t=0;t<e.length;t++)if(e[t].readyState===u.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE)return e[t]}return T},e.prototype.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty=function(e){0===this.getVideoStreams().length||0!==e.length&&e[0]||(this.call.getVideoChannels().forEach(function(e){e._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE),e._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}),this.removeLocalVideoTracks())},e.prototype.getAudioStream=function(){return this.audioStream},e.prototype.getVideoStreams=function(){return this.videoStreams},e.prototype.stopAllStreams=function(){var e=this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();e&&e.stopPlayingAudioStream(this.remoteStream),this._rtConnection&&(this._rtConnection.stopAllStreams(),this._rtConnection.removeStream(this.localStream)),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._callProvider.getMediaServiceFactory().getAudioInputInterfaceService().removeLocalMediaStream(this.call.getCallId()),this._callProvider.getMediaServiceFactory().getAudioOutputInterfaceService().removeRemoteMediaStream(this.call.getCallId())},e.prototype.getVideoChannelId=function(){return this._videoChannelId},e.prototype.setVideoChannelId=function(e){this._videoChannelId!==e&&u.Base.Utils.isDefined(this._videoChannelId)&&this._callProvider.getMediaServiceFactory().getVideoInterfaceService().removeMediaStreams(this._videoChannelId),this._videoChannelId=e},e.prototype.updateVideoMode=function(e,t,i){var a;if(!this._callProvider.hasVideoDevices()&&e!==u.Services.Call.VideoMode.DISABLE)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Camera not found"),E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.CAMERA_NOT_FOUND));if(0===this.videoStreams.length){var r=u.Providers.Call.Utils.getVideoDirection(e);this.call._videoChannels[0]._setRequestedDirection(r),this._latestVideoModeDirection=r,a=this.escalateVideo(t)}else{if(e===u.Services.Call.VideoMode.INACTIVE)return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Inactive video mode is not supported"),E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.UNHANDLED_VIDEO_DIRECTION)).promise();var s=this._getPreviousVideoDirection(),r=this._setNewVideoDirection(e);switch(this._latestVideoModeDirection=r,this.call._videoChannels[0]._setRequestedDirection(r),e){case u.Services.Call.VideoMode.SEND_RECEIVE:a=s===u.Services.Call.MediaDirection.SEND_ONLY?this.updateRemoteVideo():s===u.Services.Call.MediaDirection.INACTIVE?this.videoStreams[0].enabled||this.isNailedUpVideoConnectionSupported()?(this.videoStreams[0].enabled=!0,this.call.getVideoChannels()[0].isCameraAccessDenied()?this.escalateVideo():this.escalateNailedUpVideo()):(this.removeLocalVideoTracks(),this.escalateVideo()):this.unBlockCamera(t);break;case u.Services.Call.VideoMode.SEND_ONLY:a=s===u.Services.Call.MediaDirection.SEND_RECV?this.updateRemoteVideo():s===u.Services.Call.MediaDirection.RECV_ONLY?(this.videoStreams[0].direction=u.Services.Call.MediaDirection.INACTIVE,this.videoStreams[0].logicalDirection=u.Services.Call.MediaDirection.INACTIVE,this.updateRemoteVideo()):this.unBlockCamera(t);break;case u.Services.Call.VideoMode.RECEIVE_ONLY:a=s===u.Services.Call.MediaDirection.SEND_ONLY?this.deEscalateVideo():s!==u.Services.Call.MediaDirection.INACTIVE||this._rtConnection.hasVideo(this.localStream)?this.blockCamera(i):this.escalateVideo(t);break;case u.Services.Call.VideoMode.DISABLE:a=this.deEscalateVideo();break;default:return u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Unsupported video mode: "+e),E.Deferred().reject()}}return a},e.prototype._setNewVideoDirection=function(e){e=u.Providers.Call.Utils.getVideoDirection(e);return this.videoStreams[0].direction=e,this.isNailedUpVideoConnectionSupported()&&(this.videoStreams[0].logicalDirection=e),e},e.prototype._getPreviousVideoDirection=function(){return this.isNailedUpVideoConnectionSupported()&&this.videoStreams[0].logicalDirection||this.videoStreams[0].direction},e.prototype.notifyCallServiceOfMediaChanges=function(){this.isNailedUpVideoConnectionSupported()?this._notifyCallServiceOfLogicalMediaChanges():this._notifyCallServiceOfMediaChanges()},e.prototype._notifyCallServiceOfMediaChanges=function(){for(var e=this.call.getVideoChannels(),t=0;t<e.length&&t<this.videoStreams.length;t++){var i=this.videoStreams[t].direction;i!==u.Services.Call.MediaDirection.INACTIVE&&i!==u.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(e[t].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),i!==u.Services.Call.MediaDirection.SEND_RECV&&i!==u.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(i),e[t]._setNegotiatedDirection(i),this._callProvider.triggerVideoChannelUpdate(this.call,e[t])):(e[t]._setNegotiatedDirection(u.Services.Call.MediaDirection.INACTIVE),this.videoStreams[t].enabled||e[t].getRequestedDirection()===u.Services.Call.MediaDirection.DISABLE||e[t]._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this.disableLocalVideoStreams(),this._callProvider.triggerVideoChannelUpdate(this.call))}},e.prototype._notifyCallServiceOfLogicalMediaChanges=function(){for(var e=this.call.getVideoChannels(),t=0;t<e.length&&t<this.videoStreams.length;t++){var i=this.videoStreams[t].logicalDirection||this.videoStreams[t].direction;i!==u.Services.Call.MediaDirection.INACTIVE&&i!==u.Services.Call.MediaDirection.DISABLE?(this.setVideoChannelId(e[t].getChannelId()),this._callProvider.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(this.call.getVideoChannels()[0].getChannelId(),this.remoteStream),i!==u.Services.Call.MediaDirection.SEND_RECV&&i!==u.Services.Call.MediaDirection.SEND_ONLY||this.isLocalVideoMuted()||this.enableLocalVideoStreams(i),e[t]._setNegotiatedDirection(i),this._callProvider.triggerVideoChannelUpdate(this.call,e[t])):(e[t]._setNegotiatedDirection(u.Services.Call.MediaDirection.INACTIVE),this.videoStreams[t].enabled||e[t].getRequestedDirection()===u.Services.Call.MediaDirection.DISABLE||e[t]._setVideoDisabledReason(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),this._callProvider.triggerVideoChannelUpdate(this.call))}},e.prototype.transferCompleted=function(){u.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.resolve()},e.prototype.transferFailed=function(){u.Base.Utils.isDefined(this._transferPromise)&&this._transferPromise.reject()},e.prototype.isFirefoxBrowser=function(){return this._browserType===u.Base.BrowserType.FIREFOX},e.prototype.getCallStatistics=function(){var t=E.Deferred(),e=!!this.audioStream&&this.audioStream.enabled,i=0!==this.videoStreams.length&&this.videoStreams[0].enabled;return(e||i)&&u.Base.Utils.isDefined(this._rtConnection)&&null!==this._rtConnection&&u.Base.Utils.isDefined(this._rtConnection._pc)?this._rtConnection.getStats().then(function(e){this._logSelectedCandidates(e),this._checkCallStatisticReport(e,t)}.bind(this),function(){t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE))}):t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE)),t.promise()},e.prototype.monitorVideoDelays=function(){var e,i,a,r,s,n;0!==this.videoStreams.length&&this.videoStreams[0].enabled&&(e=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorGracePeriod")||5,i=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoDecodingTime")||40,a=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxAvgVideoEncodingTime")||35,r=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoDecodingTime")||13,s=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.maxWarningVideoEncodingTime")||13,n=u.Base.Utils.queryJSONObject(this._callProvider._config,"mediaConfiguration.voipConfigurationVideo.performanceMonitorWindowDuration")||10,this.stopMonitoringVideoDelays(),this._videoStatsTimer=setTimeout(function(){this._videoStatsInterval=setInterval(function(){this._rtConnection.getVideoStats().then(function(e){var t=this._videoStatsFloatingWindow.length;n<=t&&this._videoStatsFloatingWindow.shift(),this._videoStatsFloatingWindow.push(e.videoStatistics),n<=t&&(e=this._getLastVideoEncodingTime(this._videoStatsFloatingWindow),t=this._getLastVideoDecodingTime(this._videoStatsFloatingWindow),(s<e||r<t)&&this._onPerformanceMonitorAlert(u.Base.PerformanceAlertType.CPU_USAGE_WARNING,"Last video encoding/decoding above threshold: ["+e+", "+t+"]"),e=this._calculateAvgVideoEncodingTime(this._videoStatsFloatingWindow,n),t=this._calculateAvgVideoDecodingTime(this._videoStatsFloatingWindow,n),(i<=t||a<=e)&&this._onPerformanceMonitorAlert(u.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,"Average video encoding/decoding above threshold: ["+t+", "+e+"]"))}.bind(this))}.bind(this),1e3)}.bind(this),1e3*e))},e.prototype._calculateAvgVideoEncodingTime=function(e,t){if(0===e.length||e.length<t)this._avgVideoEncodeMs=0;else if(u.Base.Utils.isDefined(e[0].totalEncodeTime)){for(var i=0,a=1;a<e.length;a++){var r=e[a].framesEncoded-e[0].framesEncoded;0<r&&(i+=(e[a].totalEncodeTime-e[0].totalEncodeTime)/r)}this._avgVideoEncodeMs=i/(e.length-1)*1e3}return this._avgVideoEncodeMs},e.prototype._calculateAvgVideoDecodingTime=function(e,t){if(0===e.length||e.length<t)this._avgVideoDecodeMs=0;else if(u.Base.Utils.isDefined(e[0].totalDecodeTime)){for(var i=0,a=1;a<e.length;a++){var r=e[a].framesDecoded-e[0].framesDecoded;0<r&&(i+=(e[a].totalDecodeTime-e[0].totalDecodeTime)/r)}this._avgVideoDecodeMs=i/(e.length-1)*1e3}return this._avgVideoDecodeMs},e.prototype._getLastVideoDecodingTime=function(e){var t,i,a=0;return u.Base.Utils.isDefined(e[0].totalDecodeTime)&&2<=e.length&&(t=e[e.length-1].framesDecoded,i=e[e.length-2].framesDecoded,a=(e[e.length-1].totalDecodeTime-e[e.length-2].totalDecodeTime)/(t-i)*1e3),a},e.prototype._getLastVideoEncodingTime=function(e){var t,i,a=0;return u.Base.Utils.isDefined(e[0].totalEncodeTime)&&2<=e.length&&(t=e[e.length-1].framesEncoded,i=e[e.length-2].framesEncoded,a=(e[e.length-1].totalEncodeTime-e[e.length-2].totalEncodeTime)/(t-i)*1e3),a},e.prototype._onPerformanceMonitorAlert=function(e,t){this.onPerformanceMonitorAlert(e,t)},e.prototype.startPerformanceMonitoring=function(){this.monitorVideoDelays(),this._runtimePerformanceMonitor.onPerformanceMonitorAlert=this._onPerformanceMonitorAlert.bind(this),this._runtimePerformanceMonitor.start()},e.prototype.stopPerformanceMonitoring=function(){this.stopMonitoringVideoDelays(),this._runtimePerformanceMonitor.stop()},e.prototype._checkCallStatisticReport=function(e,t){e?t.resolve(e):t.reject(new u.Services.Call.CallException(u.Services.Call.CallError.STATISTICS_UNAVAILABLE))},e.prototype._logSelectedCandidates=function(e){if(!this._hasLoggedRelayICECandidates&&e.iceCandidateStatistics)for(var t in e.iceCandidateStatistics){var i;e.iceCandidateStatistics.hasOwnProperty(t)&&(i=e.iceCandidateStatistics[t].local,t=e.iceCandidateStatistics[t].remote,i&&t&&(this._hasLoggedRelayICECandidates=!0,u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected local ICE  candidate",i.toString()),u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"*** Selected remote ICE candidate",t.toString())))}},e.prototype.stopEarlyMedia=function(e){this._isEarlyMedia&&this.remoteStream&&e.isPlaying(this.remoteStream)&&(this._rtConnection.disableRemoteStreams(),e.stopPlayingAudioStream(this.remoteStream))},e.prototype.getVideoResolution=function(){return this._videoResolution},e.prototype.getNegotiatedVideoResolution=function(){return this._negotiatedVideoResolution||this._videoResolution},e.prototype.setNegotiatedVideoResolution=function(e){this._negotiatedVideoResolution=e},e.prototype.getVideoBandwidth=function(){return this._videoBandwidth},e.prototype.getVideoSendResolution=function(){return u.Base.Utils.isDefined(this._videoSendResolution)||this._updateVideoSendResolution(this._videoResolution),this._videoSendResolution},e.prototype.getVideoSendBandwidth=function(){var e=this._rtConnection.getVideoSendBandwidth();return e!==T?e/1e3:this.getVideoBandwidth()},e.prototype._updateVideoBandwidth=function(e){e!==T&&(this._videoBandwidth=e)},e.prototype._updateVideoResolution=function(e){this._videoResolution.getHeight()!==e.getHeight()&&(this._videoResolution=e,this._callProvider._videoResolution=e)},e.prototype._updateVideoSendResolution=function(e){this._videoSendResolution=e},e.prototype.popQueuedActiveRenegotiateEvent=function(){return this._activeRenegotiateEventQueue.shift()},e.prototype.setQueuedActiveRenegotiateEvent=function(e){this._activeRenegotiateEventQueue.push(e)},e.prototype.isReadyToReceiveMediaRequest=function(){return this._isReadyToReceiveMediaRequest},e.prototype.popQueuedRemoteCallEstablishedEvent=function(){var e=this._queuedRemoteCallEstablishedEvent;return this._queuedRemoteCallEstablishedEvent=T,e},e.prototype.setQueuedRemoteCallEstablishedEvent=function(e){this._queuedRemoteCallEstablishedEvent=e},e.prototype.getMediaTransactionInitialEvent=function(){return this._mediaTransactionInitialEvent},e.prototype.setMediaTransactionInitialEvent=function(e){this._mediaTransactionInitialEvent=e},e.prototype.adjustVideoResolution=function(e,t,i){var a=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(i,this._videoResolution,this.getVideoResolutionsTable())||this._videoResolution;return t&&t[0]&&(i=t[0].maxHeight,(t=t[0].maxWidth)&&i&&(a=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolutionForDimensions(i,t,a,this.getVideoResolutionsTable()))),a},e.prototype.setCallRequestedTransactionalId=function(e,t){this._3pccRequestTransactionMap[e]=t},e.prototype.getCallRequestedTransactionalId=function(e){return this._3pccRequestTransactionMap[e]},e.prototype.updateIceServers=function(e){var t,i=!1;return e&&(t=[],e.getTransportTypes().sort(function(e,t){return e.getTransportPrecedence()>t.getTransportPrecedence()?-1:e.getTransportPrecedence()<t.getTransportPrecedence()?1:0}),e.getTransportTypes().forEach(function(e){t.push(e.getUrl())}),i=this._addTurnServers(e.getUsername(),e.getCredential(),t,e.getIceTransportPolicy(),e.getExpiryTime())),i},e.prototype.isNailedUpVideoConnectionSupported=function(){return this._isNailedUpVideoConnectionSupported},e.prototype.setNailedUpVideoConnectionSupported=function(e){this._isNailedUpVideoConnectionSupported=e},e.prototype.determineIfNailedUpVideoConnectionSupported=function(e){e=!!e&&0<e.length&&!!e[0].logicalDirection;this._isNailedUpVideoConnectionSupported=this._callProvider.isSolutionSupportsNailedUpConnection()&&e},e.prototype.setRingingStarted=function(e){this._isRingingStarted=e},e.prototype.isRingingStarted=function(){return this._isRingingStarted},e.prototype.disableVideoStreamsAndChannels=function(e){0<this.videoStreams.length&&(this.videoStreams[0].enabled=!1,this.isNailedUpVideoConnectionSupported()?this.videoStreams[0].logicalDirection=u.Services.Call.MediaDirection.INACTIVE:this.videoStreams[0].direction=u.Services.Call.MediaDirection.INACTIVE);var t=this.call.getVideoChannels();0<t.length&&(t[0]._setNegotiatedDirection(u.Services.Call.MediaDirection.DISABLE),t[0]._setVideoDisabledReason(e))},e.prototype._addTurnServers=function(e,t,i,a,r){return!!(e&&t&&i)&&(this._rtcConfiguration={iceServers:[{username:e,credential:t,credentialType:"password",urls:i}],iceTransportPolicy:a},r&&(30<r&&(r-=30),this._rtcConfiguration._expiryTime=Date.now()+1e3*r),"relay"!==a&&this.isIceRecoverySupportedConference()&&(this._rtcConfiguration._turnOfferType=this.getIceRestartRelayType()||u.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY),!0)},e.prototype.resetAudioOnlyNailedUpConnection=function(){return!(!this._callProvider.isSolutionSupportsNailedUpConnection()||!this.hasNailedUpConnectionVideoChannel())&&(this.disableVideoStreamsAndChannels(u.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),this.disableLocalVideoStreams(),!0)},e.prototype.hasNailedUpConnectionVideoChannel=function(){return 0<this.call.getVideoChannels().filter(function(e){return e.getChannelId().toString().includes("NailedUp_")}).length},e.prototype._queueUpdateLocalStreamEvent=function(e){this.setQueuedActiveRenegotiateEvent(e)},e.prototype._queueStartContentVideoSharingEvent=function(e){this.setQueuedActiveRenegotiateEvent(e)},e.prototype.hasVideoTrackStopStreaming=function(e){return this._rtConnection.hasVideoTrackStopStreaming(e)},e.prototype.enableLocalAudioStreams=function(e){this.audioStream&&(this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()&&(e=e||u.Services.Call.MediaDirection.SEND_RECV,this._rtConnection.setLocalAudioDirection(e)),this.isLocalAudioMuted()||this._rtConnection.enableLocalAudioStreams())},e.prototype.disableLocalAudioStreams=function(){this._rtConnection.disableLocalAudioStreams()},e.prototype.disableLocalVideoStreams=function(e){this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()?(e=e||u.Services.Call.MediaDirection.INACTIVE,this._rtConnection.setLocalVideoDirection(e)):this._rtConnection.disableLocalVideoStreams()},e.prototype.enableLocalVideoStreams=function(e){0<this.videoStreams.length&&(this._rtConnection.isSetLocalVideoDirectionSupported()&&this.hasReceivedCallEstablishedEvent()&&(e=e||u.Services.Call.MediaDirection.SEND_RECV,this._rtConnection.setLocalVideoDirection(e)),this.isLocalVideoMuted()||(this._rtConnection.enableLocalVideoStreams(),u.Base.Utils.isUndefined(this._localVideoStreamEnablementTime)&&(this._localVideoStreamEnablementTime=Date.now())))},e.prototype.isSendingVideoDirection=function(){if(0<this.videoStreams.length){var e=this.getStreamDirection(this.videoStreams[0]);return e===u.Services.Call.MediaDirection.SEND_RECV||e===u.Services.Call.MediaDirection.SEND_ONLY}return!1},e.prototype.disableLocalMicrophone=function(){return this.localStream?this._rtConnection.isRTCRtpSenderSupported()?this._rtConnection.nullifyLocalMediaTrack(u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,this.localStream):(this._rtConnection.disableLocalAudioStreams(),E.Deferred().resolve().promise()):E.Deferred().resolve("Queued").promise()},e.prototype.enableLocalMicrophone=function(){if(!this.isSpeakersAvailable())return E.Deferred().reject(new u.Services.Call.CallException(u.Services.Call.CallError.SPEAKERS_NOT_FOUND)).promise();if(this.localStream){if(this._rtConnection.isRTCRtpSenderSupported()){var e=this.getNoiseSuppressionConstraints();return u.Providers.Call.CPUtils.replaceLocalAudioTrack(this,this._callProvider.getMediaServiceFactory(),!1,e).then(function(){this.call.getState()===u.Services.Call.CallStates.HELD||this.call.getState()===u.Services.Call.CallStates.HOLDING?this._rtConnection.disableLocalAudioStreams():this.isLocalAudioMuted()||this._rtConnection.enableLocalAudioStreams(),this._callProvider.trigger(u.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[this.call,this.localStream])}.bind(this))}this._rtConnection.enableLocalAudioStreams()}return E.Deferred().resolve().promise()},e.prototype.isSpeakersAvailable=function(){var e=this._callProvider.getMediaServiceFactory().getAudioInterface().getOutputInterface(),t=e.getSelectDeviceCapability().isAllowed,i=u.Base.Utils.getBrowserType(),e=i===u.Base.BrowserType.FIREFOX||i===u.Base.BrowserType.SAFARI||e.hasAvailableDevices();return!t||e},e.prototype.muteLocalVideo=function(){!this.isScreenSharingUsingVideo()&&this.hasReceivedCallEstablishedEvent()&&this._rtConnection.isRTCRtpSenderSupported()?this._rtConnection.stopLocalVideoTrack():this._rtConnection.disableLocalVideoStreams()},e.prototype.unmuteLocalVideo=function(){return!this.isScreenSharingUsingVideo()&&this.hasReceivedCallEstablishedEvent()&&this._rtConnection.isRTCRtpSenderSupported()?u.Providers.Call.CPUtils.unmuteLocalVideo(this,this.getVideoResolution(),this._callProvider.getMediaServiceFactory()).then(function(){this.enableLocalVideoStreams(this.call.getVideoChannels()[0].getNegotiatedDirection())}.bind(this)):(this._rtConnection.enableLocalVideoStreams(),E.Deferred().resolve().promise())},e.prototype.isLocalAudioMuted=function(){return this.call.isAudioMuted()},e.prototype.isLocalVideoMuted=function(){return this.call._videoMuteState===u.Services.Call.MediaMuteStates.MUTED},e.prototype.enableLocalStreams=function(){this.call.isAudioMuted()||this._rtConnection.enableLocalAudioStreams(),this.enableLocalVideoStreams()},e.prototype.disableLocalStreams=function(){this._rtConnection.disableLocalAudioStreams(),this.disableLocalVideoStreams()},e.prototype.queueMuteUnumteFunctor=function(e){this._pendingVideoMuteUnmuteFunctor=e},e.prototype.execQueuedVideoMuteUnmuteFunctor=function(){this._pendingVideoMuteUnmuteFunctor&&this._pendingVideoMuteUnmuteFunctor(this.callId,this.call._sessionId,this.getVideoStreams()),this._pendingVideoMuteUnmuteFunctor=T},e.prototype.hasReceivedCallEstablishedEvent=function(){return this._hasReceivedCallEstablishedEvent},e.prototype.isMPaaSCall=function(){return!!this.call._sessionId},e.prototype.isMPaaSCollabCall=function(){return this._isMPaaSCollabCall},e.prototype.isIceRecoverySupportedBrowser=function(){return this._browserType!==u.Base.BrowserType.EDGE},e.prototype.isIceRecoverySupportedConference=function(){return this.isMPaaSCall()&&this.isIceRecoverySupportedBrowser()&&!this.isMPaaSCollabCall()},e.prototype.iceConnectionFailedHandler=function(e){var t;clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this._selectedCandidatePairChangedTimerId=T,this._selectedCandidatePairChangedTimestamp=T,this.isIceRecoverySupportedConference()&&this.call.getState()!==u.Services.Call.CallStates.ENDING&&this.call.getState()!==u.Services.Call.CallStates.ENDED&&(t=!0,u.Base.Utils.isDefined(e)&&(this._iceRecoveryDueToMigration=e),u.Base.Utils.isUndefined(this.getIceConnectionRestartTimestamp())?(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Starting ICE media recovery"),this.setIceConnectionRestartTimestamp(Date.now()),this._callProvider.triggerMediaRecoveryInitiated(this.call)):this.hasIceRecoveryElapsed()?(t=!1,u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> ICE recovery has elapsed"),this.triggerCallMediaFailed()):(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Continuing ICE media recovery"),this._iceRecoveryDueToMigration&&(t=!1)),t&&(this.isCallServiceAvailable()&&this._iceRestartAttempts++,t=new u.Providers.Call.UpdateIceRestartMediaEvent,this.handleEvent(t)))},e.prototype.iceRecoveryCleanup=function(){this.isIceRecoverySupportedConference()&&(u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,">>> Cleanup ICE media recovery"),this.setIceRestartInProgress(!1),this.setIceConnectionRestartTimestamp(T),this._iceRecoveryDueToMigration=!1,this._iceRestartAttempts=0)},e.prototype.hasIceRecoveryElapsed=function(){return!this._iceConnectionRestartTimestamp||3e5<Date.now()-this._iceConnectionRestartTimestamp},e.prototype.setIceConnectionRestartTimestamp=function(e){this.isIceRecoverySupportedConference()&&(this._iceConnectionRestartTimestamp=e)},e.prototype.getIceConnectionRestartTimestamp=function(){return this._iceConnectionRestartTimestamp},e.prototype.setIceRestartRelayType=function(e){this._iceRestartRelayType=e},e.prototype.getIceRestartRelayType=function(){return this._iceRestartRelayType},e.prototype.getIceRestartAttemtps=function(){return this._iceRestartAttempts},e.prototype.initiateIceRecoveryIfSelectedCandidatePairChanged=function(){this._selectedCandidatePairChangedTimestamp&&this.isIceRecoverySupportedConference()&&!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(e){var i=e.audioStatistics.transportBytesReceived,a=function(t){this._selectedCandidatePairChangedTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){0<e.audioStatistics.transportBytesReceived&&(t++,e=e.audioStatistics.transportBytesReceived-i,!this.isIceRestartInProgress()&&this.hasIceRecoveryElapsed()&&0==e?(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=t&&this._isMediaConnected?(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after ICE candidatePair changes"),this.iceConnectionFailedHandler()):a(t)):0!=e&&(this._iceRestartAttempts=0,this._isMediaConnected||(this._isMediaConnected=!0,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected))))}.bind(this))}.bind(this),5e3)}.bind(this);a(0)}.bind(this)))},e.prototype.initiateIceRecoveryIfDetectedMediaPathProblem=function(){this.isIceRecoverySupportedConference()&&(clearTimeout(this._selectedCandidatePairChangedTimerId),clearTimeout(this._serviceAvailableIceRecoveryTimerId),this.getCallStatistics().then(function(e){var i=e.audioStatistics.transportBytesReceived,a=function(t){this._serviceAvailableIceRecoveryTimerId=setTimeout(function(){this.getCallStatistics().then(function(e){0<e.audioStatistics.transportBytesReceived&&(t++,e.audioStatistics.transportBytesReceived-i==0?(this._isMediaConnected&&(this._isMediaConnected=!1,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)),3<=t&&this._isMediaConnected?(u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"*** Initiating media recovery due to inactive audio after calls service available"),this.iceConnectionFailedHandler()):a(t)):(this._iceRestartAttempts=0,this._isMediaConnected||(this._isMediaConnected=!0,this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected))))}.bind(this))}.bind(this),5e3)}.bind(this);a(0)}.bind(this)))},e.prototype.setCallServiceAvailable=function(e){this._isCallServiceAvailable=e,this._isCallServiceAvailable&&(e=new u.Providers.Call.ServiceAvailableEvent,this.handleEvent(e))},e.prototype.isCallServiceAvailable=function(){return this._isCallServiceAvailable},e.prototype.triggerCallMediaFailed=function(){u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,">>> Failed to recovery media"),this.iceRecoveryCleanup(),!this._hasTriggeredMediaFailed&&this.isIceConnectionStateFailed()&&(this._hasTriggeredMediaFailed=!0,this._callProvider.triggerCallMediaFailed(this.call))},e.prototype.isIceConnectionStateFailed=function(){return!!this._rtConnection&&this._rtConnection.getIceConnectionState()===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED},e.prototype.getIceConnectionState=function(){var e;return e=this._rtConnection?this._rtConnection.getIceConnectionState():e},e.prototype.isMediaConnected=function(){return this._isMediaConnected},e.prototype.setIceRestartInProgress=function(e){(this._iceRestartInProgress=e)&&this.isLocalVideoMuted()&&(this.isFirefoxBrowser()||this.call.getState()===u.Services.Call.CallStates.HELD)&&(this._unmuteVideoRenogatiationNeeded=!0)},e.prototype.isIceRestartInProgress=function(){return this._iceRestartInProgress},e.prototype._recalculateMediaConnection=function(e){var t=this._isMediaConnected;this._isMediaConnected=e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_COMPLETED||e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CONNECTED,this._isMediaConnected&&(this._hadMediaConnected=!0),this._isMediaConnected!==t&&e!==u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_CHECKING&&this._callProvider.triggerMediaConnectionUpdate(this.call,this._isMediaConnected)},e.prototype._processIceConnectionStateChange=function(e,t){this._recalculateMediaConnection(e),this._isMediaConnected?this.iceRecoveryCleanup():(e===u.Base.AbstractRTCConnectionProvider.Constants.ICE_CONNECTION_STATE_FAILED||t&&!this.isIceRestartInProgress())&&this.iceConnectionFailedHandler()},e.prototype._replaceAudioTrackIfNeeded=function(e,t){return e=e||!1,this._rtConnection.isLocalAudioTrackEnded()||t?u.Providers.Call.CPUtils.replaceLocalAudioTrack(this,this._callProvider.getMediaServiceFactory(),e,this.getNoiseSuppressionConstraints()):E.Deferred().reject("Condition failed").promise()},e.prototype.getNoiseSuppressionConstraints=function(){var e,t=this.getAudioStream();if(t.serverNoiseReduction&&"ENABLE"===t.serverNoiseReduction)e={noiseSuppression:!1};else switch(this.call.getNoiseReductionSetting()){case u.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case u.Services.Call.NoiseReductionSetting.DISABLE_ALL:e={noiseSuppression:!1};break;case u.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case u.Services.Call.NoiseReductionSetting.ENABLED:e={noiseSuppression:!0}}return e},e.prototype.setVideoSharingAudioContext=function(e){this.removeVideoSharingAudioContext(),this._videoSharingAudioContext=e},e.prototype.removeVideoSharingAudioContext=function(){this._videoSharingAudioContext&&(this._videoSharingAudioContext.close(),this._videoSharingAudioContext=T,this._videoSharingAudioConstraints=T,this._videoSharingMicrophoneGainNode=T)},e.prototype.setVideoSharingAudioConstraints=function(e){this._videoSharingAudioConstraints=e},e.prototype.getVideoSharingAudioConstraints=function(){return this._videoSharingAudioConstraints},e.prototype.setVideoSharingMicrophoneGainNode=function(e){this._videoSharingMicrophoneGainNode=e},e.prototype.updateVideoSharingMicrophoneVolume=function(e){this._videoSharingAudioContext&&this._videoSharingMicrophoneGainNode?this._videoSharingMicrophoneGainNode.gain.setValueAtTime(e,this._videoSharingAudioContext.currentTime):this._rtConnection.disableLocalAudioStreams()},e.prototype.stopVideoSharingStream=function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(e){e.stop(),e.kind===u.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK&&this._rtConnection.replaceLocalMediaTrack(this.localStream.getAudioTracks()[0])}.bind(this)),this._videoSharingStream=T)},e.prototype.isScreenSharingUsingVideo=function(){return u.Base.Utils.isDefined(this._videoSharingStream)},e.prototype.mixVideoSharingAudio=function(e,t){this.removeVideoSharingAudioContext();var i=new n;this.setVideoSharingAudioContext(i),e.getAudioTracks().forEach(function(e){var t=e.getConstraints();t.echoCancellation=!0,t.autoGainControl=!1,e.applyConstraints(t).catch(function(e){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"Apply "+t+" constraints rejected: "+e)})}),t=t||this._videoSharingStream;var a=i.createMediaStreamSource(t),r=i.createMediaStreamSource(e),s=i.createMediaStreamDestination(),t=i.createGain();t.gain.setValueAtTime(.75,i.currentTime),a.connect(t),t.connect(s);i=i.createGain();return this.setVideoSharingMicrophoneGainNode(i),this.updateVideoSharingMicrophoneVolume(this.call.isAudioMuted()?0:1),r.connect(i),i.connect(s),e.getAudioTracks()[0].enabled=!0,s.stream.getAudioTracks()[0]},e.prototype.setBackgroundBlur=function(e,t,i){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"setBackgroundBlur: ",e),this.backgroundBlur=e,this.backgroundImage=e?T:this.backgroundImage;i=new u.Providers.Call.SetBackgroundBlurEvent({audioDevice:t,videoDevice:i});return this.mediaTransactionDfd=E.Deferred(),this._mediaTransactionInitialEvent=i,this.handleEvent(i),this.mediaTransactionDfd.promise()},e.prototype.setBackgroundImage=function(e,t,i){u.Base.Logger.info(u.Base.LoggerTags.CALL_PROVIDER,"setBackgroundImage: ",e),this.backgroundImage=e,this.backgroundBlur=!e&&this.backgroundBlur;i=new u.Providers.Call.SetBackgroundImageEvent({audioDevice:t,videoDevice:i});return this.mediaTransactionDfd=E.Deferred(),this._mediaTransactionInitialEvent=i,this.handleEvent(i),this.mediaTransactionDfd.promise()},e.prototype.setVideoResolutionsTable=function(e){if(e&&0<e.length){var t,i,a=u.Base.VideoResolution,r=Object.keys(a);this._videoResolutionsTable={};for(var s=0;s<r.length;s++){for(var n=r[s],o=a[n].getHeight(),c=!1,l=0;l<e.length;l++){var d=e[l];d.maxHeight===o&&(c=!0,i=d)}c?(t=e[s-1]!==T?e[s-1].maxBandwidth:9999,this._videoResolutionsTable[n]=new u.Base.VideoResolutionDetails(i.maxWidth,i.maxHeight,i.maxBandwidth,t,i.maxFrames,i.hpMaxBandwidth)):u.Base.Logger.warn(u.Base.LoggerTags.CALL_PROVIDER,"Because resolution "+n+" is not specified in the resolutions array, it will be not used")}this._resolutionsArray=this._resolutionsToArray(this._videoResolutionsTable)}},e.prototype.getVideoResolutionsTable=function(){return this._videoResolutionsTable===T?u.Base.VideoResolution:this._videoResolutionsTable},e.prototype._nextLowerVideoResolution=function(e){0===this._resolutionsArray.length&&(this._resolutionsArray=this._resolutionsToArray(this.getVideoResolutionsTable()));var t=this._resolutionsArray[this._resolutionsArrayId(e)-1];return t===T?e:t},e.prototype._nextHigherVideoResolution=function(e){0===this._resolutionsArray.length&&(this._resolutionsArray=this._resolutionsToArray(this.getVideoResolutionsTable()));var t=this._resolutionsArray[this._resolutionsArrayId(e)+1];return t===T?e:t},e.prototype._resolutionsToArray=function(e){var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push(e[t]);return i.sort(function(e,t){return e.getHeight()>t.getHeight()?1:-1}),i},e.prototype._resolutionsArrayId=function(e){0===this._resolutionsArray.length&&(this._resolutionsArray=this._resolutionsToArray(this.getVideoResolutionsTable()));for(var t=0;t<this._resolutionsArray.length;++t)if(e.getHeight()===this._resolutionsArray[t].getHeight())return t;return-1},e.prototype.setServerSentPreferredResolution=function(e){if(e!==T&&null!==e){var t=this.searchResolutionsMap(e.maxHeight);if(null!==t){var i=e.maxFrames||t.getFPS()||30;return this._serverSentPreferredResolution=new u.Base.VideoResolutionDetails(e.maxWidth,e.maxHeight,e.minBandwidth||t.getMinBandwidth(),e.maxBandwidth||t.getMaxBandwidth(),i,e.hpMaxBandwidth||t.getHpMaxBandwidth()),this._serverSentPreferredResolution}}},e.prototype.getServerSentPreferredResolution=function(){return this._serverSentPreferredResolution},e.prototype.addOnApplyingVideoConstraintsFinishedCallbacks=function(e){this._onApplyingVideoConstraintsFinishedCallbacks.add(e)},e.prototype.removeOnApplyingVideoConstraintsFinishedCallbacks=function(e){this._onApplyingVideoConstraintsFinishedCallbacks.remove(e)},e.prototype.searchResolutionsMap=function(e){for(var t=this._videoResolutionsTable||u.Base.VideoResolution,i=Object.keys(t),a=0;a<i.length;++a)if(t[i[a]].getHeight()===e)return t[i[a]];return null},u.Providers.Call.CPCall=e}(AvayaClientServices),function(h){"use strict";h.Providers.Call.CPUtils={createLocalMediaStream:function(e,t,r,s,i,n,a,o){h.Base.Logger.debug(h.Base.LoggerTags.CALL_PROVIDER,"The video resolution of the localStream has to be changed due to bandwidth management.");var c=E.Deferred(),l=e?e.getDeviceId():T,d=r.call.getVideoChannels(),C=this.getVideoOptions(d,t);return function(){r._rtConnection.stopStream(r.localStream),r._rtConnection.removeStream(r.localStream);var e=function(){var e=o?o.data.constraints:T;s.getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!0,C.enable,l,C.videoDeviceId,C.videoChannelId,i,e,r.backgroundBlur,r.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&r._updateVideoResolution(e.videoResolution);var i=r.getAudioStream(),a=[];t.getTracks().forEach(function(e){var t,i;e.kind===h.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&(i=(t=r.getVideoStreams()[0])?t.direction:h.Services.Call.MediaDirection.INACTIVE,i=new h.Providers.Interfaces.VideoStream(e.id,i),r.isNailedUpVideoConnectionSupported()&&(i.logicalDirection=t.logicalDirection),a.push(i))}),C.enable&&e.constraint&&0<d.length&&h.Providers.Call.CPUtils.updateVideoDeniedStreams(d,a,e.constraint),r.setAVStreams(i,a),r.localStream=t,r._rtConnection.addStream(r.localStream),s.getVideoInterfaceService().replaceLocalMediaStream(C.videoChannelId,r.localStream),r.isLocalAudioMuted()&&r.disableLocalAudioStreams(),0!==a.length&&r.isLocalVideoMuted()&&r.muteLocalVideo(),n.call(T,r,o),c.resolve(e.videoResolution)},function(e){a.call(T,r,e),c.reject(e)})}.bind(this);h.Base.Utils.getBrowserType()===h.Base.BrowserType.EDGE?setTimeout(function(){e()}.bind(this),500):e()}(),c.promise()},updateVideoResolutionFirefox:function(e,t,i,a,r,s){h.Base.Logger.debug("The video resolution of the localStream has to be changed due to bandwidth management.");var n=a.localStream.getVideoTracks()[0];n?t.getMediaServicesService().getUserMedia().updateStreamUsingApplyConstraints(n,i,a,e.getDeviceId()).always(function(){r.call(T,a)}):s.call(T,a,"Missing video track")},updateDevices:function(a,r,s,n,e,o,c,t){var i,l=!1,d=!1,C={videoDeviceId:T,videoChannelId:T},u=s.call.getVideoChannels();if(r){if(!(0<u.length&&u[0].getRequestedDirection()!==h.Services.Call.MediaDirection.DISABLE))return h.Base.Logger.debug("Ignoring. Video channels is empty or disabled"),o.call(T,s),E.Deferred().resolve().promise();l=!0,i=T,C=this.getVideoOptions(u,r),s._rtConnection.removeLocalVideoTrack(s.localStream),h.Base.Logger.debug("Changing to new video device: "+r.getLabel())}if(a){if(s.call.isMicrophoneDisabled())return h.Base.Logger.debug("Ignoring. Microphone is disabled"),o.call(T,s),E.Deferred().resolve().promise();d=!0,i=a.getDeviceId(),s._rtConnection.removeLocalAudioTrack(s.localStream),h.Base.Logger.debug("Changing to new audio device: "+a.getLabel())}return n.getMediaServicesService().createLocalMediaStream(s.call.getCallId(),d,l,i,C.videoDeviceId,C.videoChannelId,e,t,s.backgroundBlur,s.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&s._updateVideoResolution(e.videoResolution);var i=[];t.getTracks().forEach(function(e){i.push(s._rtConnection.replaceLocalMediaTrack(e,s.localStream))}),E.when.apply(this,i).then(function(){l&&(s._videoDevice=r,n.getVideoInterfaceService().replaceLocalMediaStream(C.videoChannelId,s.localStream),s.isLocalVideoMuted()&&s.muteLocalVideo(),s._callProvider.triggerVideoChannelUpdate(s.call,C.videoChannelId)),d&&(s._audioDevice=a,n.getAudioInputInterfaceService().replaceLocalMediaStream(s.call.getCallId(),s.localStream),s.isLocalAudioMuted()&&s.disableLocalAudioStreams()),o.call(T,s)},function(e){c.call(T,s,e)})},function(e){c.call(T,s,e)})},updateVideoResolution:function(r,a,e,s,n,o){var c=this.getVideoOptions(r.call.getVideoChannels(),r._videoDevice);return r._rtConnection.removeLocalVideoTrack(r.localStream),h.Base.Logger.debug("Updating video resolution: "+e.getWidth()+"x"+e.getHeight()),a.getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!1,!0,T,c.videoDeviceId,c.videoChannelId,e,T,r.backgroundBlur,r.backgroundImage).then(function(e){var t=e.stream;e.videoResolution&&r._updateVideoResolution(e.videoResolution);var i=[];t.getTracks().forEach(function(e){i.push(r._rtConnection.replaceLocalMediaTrack(e,r.localStream))}),E.when.apply(this,i).then(function(){a.getVideoInterfaceService().replaceLocalMediaStream(c.videoChannelId,r.localStream),r.isLocalVideoMuted()&&r.muteLocalVideo(),s.call(T,r,o)},function(e){n.call(T,r,e)})}.bind(this),function(e){var t=r.call.getVideoChannels(),i=r.getVideoStreams(),a=e.getError();0<t.length&&a&&(a===h.Services.Call.CallError.CAMERA_PERMISSION_DENIED||a===h.Services.Call.CallError.OVERCONSTRAINED)?(h.Providers.Call.CPUtils.updateVideoDeniedStreams(t,i,{error:a,reason:e.getProtocolErrorReason()}),s.call(T,r,o)):n.call(T,r,e)})},replaceLocalAudioTrack:function(t,i,a,e){h.Base.Logger.info("Replacing local audio track");var r=t._audioDevice?t._audioDevice.getDeviceId():T,s=E.Deferred();return i.getMediaServicesService().createLocalMediaStream(t.call.getCallId(),!0,!1,r,T,T,T,e).then(function(e){e=e.stream;t._rtConnection.removeLocalAudioTrack(t.localStream),e.getTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e,t.localStream).then(function(e){i.getAudioInputInterfaceService().replaceLocalMediaStream(t.call.getCallId(),t.localStream),t.isLocalAudioMuted()&&t.disableLocalAudioStreams(),e&&a?(h.Base.Logger.debug("Send media negotiation"),t._callGatewayProvider.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){s.resolve()},function(e){h.Base.Logger.error("Failed to send media negotiation: "+e),s.reject(e)})):s.resolve()},function(e){h.Base.Logger.error("Failed to replace audio track: "+e),s.reject(e)})})},function(e){h.Base.Logger.error("Failed to create new audio track: "+e),s.reject(e)}),s},unmuteLocalVideo:function(t,e,i){h.Base.Logger.info("Replacing local video track");var a=E.Deferred(),r=this.getVideoOptions(t.call.getVideoChannels(),t._videoDevice);return t._rtConnection.removeLocalVideoTrack(t.localStream),i.getMediaServicesService().createLocalMediaStream(t.call.getCallId(),!1,!0,T,r.videoDeviceId,r.videoChannelId,e,T,t.backgroundBlur,t.backgroundImage).then(function(e){e.stream.getTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e,t.localStream).then(function(){i.getVideoInterfaceService().replaceLocalMediaStream(r.videoChannelId,t.localStream),t._callProvider.triggerVideoChannelUpdate(t.call,r.videoChannelId),a.resolve()},function(e){h.Base.Logger.error("Failed to replace video track: "+e),a.reject(e)})})},function(e){a.reject(e)}),a},unmuteLocalAudio:function(t,i){h.Base.Logger.info("Replacing local video track");var a=E.Deferred();return t._rtConnection.removeLocalVideoTrack(t.localStream),i.getMediaServicesService().createLocalMediaStream(t.call.getCallId(),!0,!1).then(function(e){e.stream.getTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e,t.localStream).then(function(){i.getAudioInputInterfaceService().replaceLocalMediaStream(t.call.getCallId(),t.localStream),a.resolve()},function(e){h.Base.Logger.error("Failed to replace audio track: "+e),a.reject(e)})})},function(e){a.reject(e)}),a},updateVideoDeniedStreams:function(e,t,i){e[0]._setCameraConstraint(i);var a=e[0]._getInternalRequestedDirection();a===h.Services.Call.MediaDirection.SEND_RECV?(e[0]._setRequestedDirection(h.Services.Call.MediaDirection.RECV_ONLY),h.Base.Logger.warn(h.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY: "+i.error),0===t.length?t.push(new h.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",h.Services.Call.MediaDirection.RECV_ONLY)):t[0].direction=h.Services.Call.MediaDirection.RECV_ONLY):a===h.Services.Call.MediaDirection.SEND_ONLY&&(e[0]._setRequestedDirection(h.Services.Call.MediaDirection.INACTIVE),h.Base.Logger.warn(h.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE: "+i.error),0!==t.length&&(t[0].direction=h.Services.Call.MediaDirection.INACTIVE))},getVideoOptions:function(e,t){var i,a,r=!1;if(h.Base.Utils.isDefined(e))for(var s=0;s<e.length;s++)e[s]._getInternalRequestedDirection()!==h.Services.Call.MediaDirection.INACTIVE&&e[s].getNegotiatedDirection()!==h.Services.Call.MediaDirection.DISABLE&&(r=!0,i=e[s].getChannelId(),t&&(a=t.getDeviceId()));return{enable:r,videoChannelId:i,videoDeviceId:a}},saveServerSentConstraints:function(e,t,i){return!1===Array.isArray(t)||0===t.length||i===T||null===i?e.getServerSentPreferredResolution():e.setServerSentPreferredResolution(i)},useServerSentConstraints:function(e,t,i){var a;e instanceof h.Providers.Call.CPCall!=!1&&t instanceof h.Base.VideoResolutionDetails!=!1&&(a=!!(a=e._resolutionsArray[e._resolutionsArrayId(t)])&&!!a.getFPS()&&a.getFPS()<30,t.getHeight()===e.getVideoResolution().getHeight()&&!a||e.setVideoSendResolution(t,i))},getClientPreferredResolution:function(e,t){e=e.getVideoChannels();if(!1===Array.isArray(e))return null;var i=null;return e.forEach(function(e){e=e.getPreferredResolution();null!==e&&(null===i||e.getHeight()<i.getHeight())&&(i=e)}),null!==i&&!0===t.hasOwnProperty(i)?t[i]:null},getEffectivePreferredSendResolution:function(e){try{var t=e.getServerSentPreferredResolution(),i=h.Providers.Call.CPUtils.getClientPreferredResolution(e.call,e.getVideoResolutionsTable());return null===t||null===i?t||i||null:i.getHeight()<t.getHeight()?i:t}catch(e){return null}},getEffectiveSendResolution:function(e){var t=h.Providers.Call.CPUtils.getEffectivePreferredSendResolution(e),i=e.getVideoSendResolution(),e=i;return e=t&&(t.getHeight()<i.getHeight()||t.getHeight()===i.getHeight()&&t.getFPS()!==i.getFPS())?t:e}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.CallFsmEvent=function(e,t){i.Base.SimpleFsm.SimpleFsmEvent.call(this,e,t),this.data=t}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.CallFsmEventData=function(){this.cpCall=T,this.callProvider=T}}(),function(e){"use strict";function t(){e.Providers.Call.CallFsmEvent.call(this),this.audioDevice=T,this.videoDevice=T}t.prototype={},e.Providers.Call.ReplaceVideoStreamWithContentEventData=t}(AvayaClientServices),function(e){"use strict";function t(){this.event=T}t.prototype={handleEvent:function(e){throw new Error("Cannot call abstract method")}},e.Providers.Call.AbstractEventHandler=t}(AvayaClientServices),function(h){"use strict";h.Providers.Call.AcceptCallEventInInitialHandler=function(e){var t,i,o=e.data.cpCall,c=e.data.callProvider,l=o._callGatewayProvider,d=e.data.videoChannel,C=!1,u=!1,a=e.data.audioDevice?e.data.audioDevice.getDeviceId():T,r=e.data.videoResolution||o.getVideoResolution();c.hasVideoDevices()&&h.Base.Utils.isDefined(d)&&(d._getInternalRequestedDirection()===h.Services.Call.MediaDirection.INACTIVE||d.isDisabled()||(C=!0,i=d.getChannelId(),e.data.videoDevice&&(t=e.data.videoDevice.getDeviceId()))),o.isNailedUpVideoConnectionSupported()&&!h.Base.Utils.isDefined(d)&&(u=C=!0,t=e.data.videoDevice?e.data.videoDevice.getDeviceId():T,(d=c._createVideoChannel_VideoMode(h.Services.Call.VideoMode.DISABLE))._setChannelId("NailedUp_"+d.getChannelId()),i=d.getChannelId(),o.call._videoChannels.push(d)),c.triggerCallEstablishing(o.call);var s=e.data.audioDevice?e.data.audioDevice.toString():"Default Audio",e=e.data.videoDevice?e.data.videoDevice.toString():"Default Camera";return h.Base.Logger.info(h.Base.LoggerTags.CALL_PROVIDER,"Accepting call using",s,e),c.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(o.call.getCallId(),!0,C,a,t,i,r).then(function(e){var t=e.stream;e.videoResolution&&o._updateVideoResolution(e.videoResolution),h.Base.Logger.debug(h.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var i,a=null,r=null,s=[],n=h.Services.Call.MediaDirection.SEND_RECV;if(t.getTracks().forEach(function(e){if("audio"===e.kind)a=new h.Providers.Interfaces.AudioStream(e.id,h.Services.Call.MediaDirection.SEND_RECV);else if("video"===e.kind){var t;if(u)n=h.Services.Call.MediaDirection.RECV_ONLY,t=h.Services.Call.MediaDirection.INACTIVE;else if(o.incomingCallInfo.videoStreams&&0<o.incomingCallInfo.videoStreams.length){switch(o.incomingCallInfo.videoStreams[0].direction){case h.Services.Call.MediaDirection.SEND_ONLY:n=h.Services.Call.MediaDirection.RECV_ONLY;break;case h.Services.Call.MediaDirection.RECV_ONLY:n=h.Services.Call.MediaDirection.SEND_ONLY;break;default:n=o.incomingCallInfo.videoStreams[0].direction}t=n}r=new h.Providers.Interfaces.VideoStream(e.id,n),o.isNailedUpVideoConnectionSupported()&&(r.logicalDirection=t),s.push(r)}}),null===a)return h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.MICROPHONE_NOT_FOUND]);C&&0===s.length&&o.isNailedUpVideoConnectionSupported()&&(i=c.getActiveCallVideoTrack(),h.Base.Utils.isDefined(i)&&(t.addTrack(i.clone()),(r=new h.Providers.Interfaces.VideoStream(i.id,n)).logicalDirection=o.getReversedVideoChannelDirection(o.incomingCallInfo.videoStreams[0].logicalDirection),s.push(r))),(!C||0===s.length)&&d&&!d.isDisabled()&&o.incomingCallInfo.videoStreams&&0<o.incomingCallInfo.videoStreams.length&&o.incomingCallInfo.videoStreams[0].enabled&&(e.constraint&&o.call.getVideoChannels()[0]._setCameraConstraint(e.constraint),n=o.incomingCallInfo.videoStreams[0].direction===h.Services.Call.MediaDirection.INACTIVE||o.incomingCallInfo.videoStreams[0].direction===h.Services.Call.MediaDirection.RECV_ONLY?h.Services.Call.MediaDirection.INACTIVE:h.Services.Call.MediaDirection.RECV_ONLY,r=new h.Providers.Interfaces.VideoStream(1,n),o.isNailedUpVideoConnectionSupported()&&(r.logicalDirection=u?h.Services.Call.MediaDirection.INACTIVE:n),s.push(r)),o.setAVStreams(a,s),o.localStream=t;t=o._rtConnection;t&&(o.updateIceServers(o.incomingCallInfo.turnData)&&t.updatePeerConfiguration(o._rtcConfiguration),t.addStream(o.localStream),t.disableLocalStreams(),t.onAddStream=function(e){o.handleEvent(new h.Providers.Call.OnAddStreamEvent({newStream:e}))},0!==s.length&&s[0].enabled||(o.incomingCallInfo.sdp=h.Base.SDPUtil.rejectMedia(o.incomingCallInfo.sdp,"m=video")),t.createAnswer(o.incomingCallInfo.sdp,function(e){0<s.length&&!h.Base.SDPUtil.hasH264(e.sdp)&&o.isFirefoxBrowser()&&(h.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),o.disableVideoStreamsAndChannels(h.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),l.acceptCall(o.callId,e.type,e.sdp,o.getAudioStream(),o.getVideoStreams()).fail(function(e){h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Failed to send accept call",e),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.SEND_ERROR])})},function(e){h.Base.Utils.isDefined(e.errorCode)?(h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e),c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.INTERNAL_ERROR]))},function(e){return e=0<s.length&&s[0].enabled?h.Providers.Call.Utils.updateVideoSdp(s[0],e):e}))},function(e){var t="Error while retrieving local stream: "+JSON.stringify(e);h.Base.Logger.error(h.Base.LoggerTags.CALL_PROVIDER,t),e.getError&&e.getError()?o.callFailure(e.getError()):c.trigger(h.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[o.call,h.Services.Call.CallError.MEDIA_CREATION_FAILURE])}),{nextState:h.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AcceptCallRequestEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=e.data.deferred;i.acceptCallRequest(t.callId,t.getCallRequestedTransactionalId(e.data.requestedType),e.data.action).done(function(){a.resolve()},function(e){a.reject(e)})}}(),function(l){"use strict";l.Providers.Call.AcceptSendVideoEventInActiveHandler=function(e){var i=e.data.cpCall,t=e.data.callProvider,a=i._callGatewayProvider,r=i.call.getVideoChannels(),s=i.getVideoStreams();if(clearTimeout(i.incomingVideoRequestTimer),t.isVideoConfigurationEnabled()&&t.hasVideoDevices()){var n,o=r[0].getChannelId();l.Base.Utils.isDefined(e.data.videoDevice)&&(n=e.data.videoDevice.getDeviceId()),0===(s=i.getVideoStreams()).length&&(s.push(new l.Providers.Interfaces.VideoStream(0,l.Services.Call.MediaDirection.RECV_ONLY)),0!==r.length&&r[0]._setNegotiatedDirection(l.Services.Call.MediaDirection.RECV_ONLY));var c=function(){var e=i.incomingCallInfo;s=i.getVideoStreams(),i.updateIceServers(e.turnData)&&i._rtConnection.updatePeerConfiguration(i._rtcConfiguration),s[0].direction!==l.Services.Call.MediaDirection.SEND_ONLY&&s[0].direction!==l.Services.Call.MediaDirection.DISABLE&&(s[0].direction=l.Services.Call.MediaDirection.SEND_RECV,i.isNailedUpVideoConnectionSupported()&&(s[0].logicalDirection=l.Services.Call.MediaDirection.SEND_RECV)),i._latestVideoModeDirection=s[0].direction,i.isLocalVideoMuted()&&i.muteLocalVideo(),a.updateVideo(i.callId,i.getAudioStream(),i.getVideoStreams()).then(function(){i.notifyCallServiceOfMediaChanges()},function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+e),i.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.SEND_ERROR)),i.revertFsmState(l.Providers.Call.States.ACTIVE)})}.bind(this);return i.isNailedUpVideoConnectionSupported()?c():(0<(r=i.localStream.getVideoTracks()).length&&(r[0].stop(),i.localStream.removeTrack(r[0])),t.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(n,o,i.localStream,e.data.videoResolution,i._rtConnection,i.backgroundBlur,i.backgroundImage).then(function(){l.Base.Logger.debug(l.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success"),c()},function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to add video to local media stream: ",e);var t=l.Services.Call.CallError.MEDIA_CREATION_FAILURE;e.getError()===l.Services.Call.CallError.CAMERA_PERMISSION_DENIED&&(t=l.Services.Call.CallError.CAMERA_PERMISSION_DENIED),i.rejectMediaTransaction(new l.Services.Call.CallException(t)),i.revertFsmState(l.Providers.Call.States.ACTIVE)})),{nextState:l.Providers.Call.States.ACTIVE_RENEGOTIATE}}l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to accept send video - no video configured"),i.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.VIDEO_DENIED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.AddParticipantFromExistingCallEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider;i._callGatewayProvider.addParticipantFromCall(i.callId,t.data.participantCallId,i.getAudioStream(),i.getVideoStreams()).then(function(){},function(e){a._updateConsultConferenceStatusHandler(t.data.participantCallId,"ERROR: "+e.errorMsg,i.callId)})}}(),function(d){"use strict";d.Providers.Call.AnswerSdpAckEventInActiveRenegotiateHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=t.getVideoStreams(),r=e.data.videoStreams,s=e.data.audioStream,n=t.call.getVideoChannels(),o=r&&0<r.length?t.getStreamDirection(r[0]):T,s=t.getStreamDirection(s);if(o!==d.Services.Call.MediaDirection.INACTIVE&&t._rtConnection.enableRemoteVideoStreams(),s!==d.Services.Call.MediaDirection.INACTIVE&&t._rtConnection.enableRemoteAudioStream(),t.call.isAudioMuted()||e.data.action===d.Providers.Call.CallProvider.Constants.HOLD||t._rtConnection.enableLocalAudioStreams(),e.data.action===d.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)t.isNailedUpVideoConnectionSupported()||t.removeLocalVideoTracks(),(o===d.Services.Call.MediaDirection.INACTIVE||r&&0<r.length&&r[0].state===d.Providers.Call.CallProvider.Constants.DISABLE_STATE)&&(0<n.length&&(n[0]._setNegotiatedDirection(d.Services.Call.MediaDirection.INACTIVE),n[0]._setVideoDisabledReason(d.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)),i.triggerVideoChannelUpdate(t.call));else{t.updateVideoStreamsDirection(r,e.data.action),t.updateVideoChannelDirection(r);for(var c=0;c<a.length;c++){var l=t.getStreamDirection(a[c]);l===d.Services.Call.MediaDirection.INACTIVE||l===d.Services.Call.MediaDirection.DISABLE?(n[c]._setNegotiatedDirection(l),n[c]._setVideoDisabledReason(d.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER)):(t.setVideoChannelId(n[c].getChannelId()),l=n[c].getNegotiatedDirection(),e.data.action===d.Providers.Call.CallProvider.Constants.ADD_VIDEO_ACTION&&l!==d.Services.Call.MediaDirection.SEND_RECV&&l!==d.Services.Call.MediaDirection.SEND_ONLY?t.isNailedUpVideoConnectionSupported()||t.removeLocalVideoTracks():l!==d.Services.Call.MediaDirection.SEND_RECV&&l!==d.Services.Call.MediaDirection.SEND_ONLY||e.data.action===d.Providers.Call.CallProvider.Constants.HOLD?l!==d.Services.Call.MediaDirection.RECV_ONLY&&l!==d.Services.Call.MediaDirection.INACTIVE||t.disableLocalVideoStreams(l):t.enableLocalVideoStreams(l),t._rtConnection.hasVideo(t.remoteStream)?i.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(n[c].getChannelId(),t.remoteStream):i.getMediaServiceFactory().getVideoInterfaceService().removeRemoteMediaStream(n[c].getChannelId())),i.triggerVideoChannelUpdate(t.call);break}}return t.resolveMediaTransaction(),{nextState:d.Providers.Call.States.ACTIVE,nextEvent:t.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(l){"use strict";l.Providers.Call.AnswerSDPEventInActiveRenegotiateHandler=function(i){var a=i.data.cpCall,r=i.data.callProvider,e=a._rtConnection,s=a.getVideoStreams(),n=a.call.getVideoChannels(),o=a.call,c=l.Providers.Call.CPUtils.getEffectiveSendResolution(a);return a.updateAudioVideoStreamsDirection(i.data.audioStream,i.data.videoStreams,i.data.action),l.Base.Logger.debug(l.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+i.data.answer),e.receiveAnswer(i.data.answer,function(){if(a.notifyCallServiceOfMediaChanges(),i.data.action===l.Providers.Call.CallProvider.Constants.REMOVE_VIDEO)a.removeLocalVideoTracks(),r.triggerVideoChannelUpdate(a.call);else if(0<i.data.videoStreams.length&&i.data.videoStreams[0].maxHeight!==a._videoResolution._height)c?a.setVideoSendResolution(c,!1):a.adjustVideoConstraints.call(a,i.data.videoStreams[0].maxWidth,i.data.videoStreams[0].maxHeight,i.data.videoStreams[0].maxFrames);else if(c&&c.getHeight()!==a._videoResolution._height)c?a.setVideoSendResolution(c,!1):a.adjustVideoConstraints.call(a,i.data.videoStreams[0].maxWidth,i.data.videoStreams[0].maxHeight,i.data.videoStreams[0].maxFrames);else if(o.getState()===l.Services.Call.CallStates.HOLDING||o.isHeldRemotely())for(var e=0;e<s.length;e++){var t=a.getStreamDirection(s[e]);t!==l.Services.Call.MediaDirection.INACTIVE&&t!==l.Services.Call.MediaDirection.DISABLE||(n[e]._setNegotiatedDirection(t),n[e]._setVideoDisabledReason(l.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER))}a.resolveMediaTransaction()},function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+e),a.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:l.Providers.Call.States.ACTIVE,nextEvent:a.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.AnswerSDPEventInMultipleHandler=function(i){var a=i.data.cpCall,r=a._callGatewayProvider,e=a._rtConnection;if(n.Base.Logger.debug(n.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+i.data.answer),i.data.videoResolutions&&a.setVideoResolutionsTable(i.data.videoResolutions),0<(t=a.getVideoStreams()).length){var t=a.getStreamDirection(t[0]),s=a.getStreamDirection(i.data.videoStreams[0]);if(t!==n.Services.Call.MediaDirection.INACTIVE&&s===n.Services.Call.MediaDirection.INACTIVE&&n.Base.Utils.getBrowserType()===n.Base.BrowserType.EDGE)return void(i.data.action===n.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION?a.callFailure(n.Services.Call.CallError.VIDEO_DEESCALATION_NOT_SUPPORTED,n.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"):a.callFailure(n.Services.Call.CallError.VIDEO_REJECTION_NOT_SUPPORTED,n.Services.Call.CallProtocolType.APPLICATION,501,"Not supported by browser"))}(s=i.data.videoStreams)&&0<s.length&&(a.updateVideoChannelDirectionBasedOnVideoMode(s),a.updateVideoStreamsDirectionBasedOnVideoMode(s),s.forEach(function(e){var t=a.getStreamDirection(e);!n.Services.Call.MediaDirection._isDisabled(t)&&e.enabled||n.Base.Utils.getBrowserType()!==n.Base.BrowserType.EDGE&&a._hasReceivedCallEstablishedEvent&&a.removeLocalVideoTracks()})),i.data.audioStream&&!i.data.audioStream.enabled&&e.removeLocalAudioTrack(a.localStream),e.receiveAnswer(i.data.answer,function(){var e,t;r.answerSDPResponse(a.callId,a.getAudioStream(),a.getVideoStreams()),i.data.videoBandwidth!==T&&a._updateVideoBandwidth(i.data.videoBandwidth),!1!==Array.isArray(i.data.videoStreams)&&0!==i.data.videoStreams.length&&(e=!1,null!==(t=a.searchResolutionsMap(i.data.videoStreams[0].maxHeight))&&t.getHeight()!==a.getVideoResolution().getHeight()&&(a.setNegotiatedVideoResolution(t),t.getHeight()<a.getVideoResolution().getHeight()&&(e=!0,i.data.serverSentResolution===T||null===i.data.serverSentResolution))?a.adjustVideoConstraints(t.getWidth(),t.getHeight(),t.getFPS()):null!==(t=n.Providers.Call.CPUtils.saveServerSentConstraints(a,i.data.videoStreams,i.data.serverSentResolution))&&n.Providers.Call.CPUtils.useServerSentConstraints(a,t,e))},function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error receiving answer SDP: "+e)})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.AttendedTransferEventInActiveHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.attendedTransfer(t.callId,e.data.targetCallId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t._transferPromise.reject(new i.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg))})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.AudioEndedEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&t._replaceAudioTrackIfNeeded(!0).always(function(){e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream])})}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.BlockCameraEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;return t.disableLocalVideoStreams(a.Services.Call.MediaDirection.RECV_ONLY),e.data.deallocateCamera&&t._rtConnection.removeLocalVideoTrack(t.localStream),i.blockUnBlockCamera(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to block camera: "+e),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(d){"use strict";d.Providers.Call.CallEstablishedEventInMultipleHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;t.remoteStream&&t._rtConnection.enableRemoteStreams(),t.updateAudioStreamDirection(e.data.audioStream),t.updateAudioChannelDirection(t.getAudioStream()),t.execQueuedVideoMuteUnmuteFunctor(),t.call.isAudioMuted()||t.call.getAudioChannel().getRequestedDirection()===d.Services.Call.MediaDirection.DISABLE||t.call.getState()===d.Services.Call.CallStates.HELD||t._rtConnection.enableLocalAudioStreams();var a=t.getVideoStreams(),r=e.data.videoStreams,s=t.call.getVideoChannels();if(r&&0<r.length){t.updateVideoChannelDirectionBasedOnVideoMode(r),t.updateVideoStreamsDirectionBasedOnVideoMode(r);for(var n=0;n<s.length&&n<a.length;n++){var o=t.getStreamDirection(a[n]);if(!d.Services.Call.MediaDirection._isDisabled(o)){t.setVideoChannelId(s[n].getChannelId());var c=t.getStreamDirection(r[n]);d.Services.Call.MediaDirection._isDisabled(c)||!r[n].enabled?d.Base.Utils.getBrowserType()!==d.Base.BrowserType.EDGE&&t.removeLocalVideoTracks():(o!==d.Services.Call.MediaDirection.SEND_RECV&&o!==d.Services.Call.MediaDirection.SEND_ONLY||t.call.getState()===d.Services.Call.CallStates.HELD||t.enableLocalVideoStreams(),t._rtConnection.hasVideo(t.remoteStream)&&i.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(s[n].getChannelId(),t.remoteStream)),i.triggerVideoChannelUpdate(t.call,s[n]);break}}}t.isLocalVideoMuted()&&t.muteLocalVideo(),t.call.isMicrophoneDisabled()&&t.disableLocalMicrophone();var l=i.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return t.remoteStream&&!l.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())&&d.Base.Logger.info(d.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."),d.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),i.triggerCallEstablished(t.call,e.data.isConf,e.data.uccpUrl,e.data.webCollabUrl,e.data.isRemote,e.data.ucid,e.data.parentUcid,e.data.contextId),{nextState:d.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(l){"use strict";l.Providers.Call.CallFailureEventInActiveRenegotiateHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=i.getAudioStream(),s=i.getVideoStreams(),n=e.data.protocolErrorCode===l.Providers.CallServiceGateway.Constants.SEE_OTHER_RESOURCE;if(n&&(l.Base.Logger.info("Initiating ICE restart due to the 303 See Other"),i.iceConnectionFailedHandler(n)),i.getMediaTransactionInitialEvent())switch(i.getMediaTransactionInitialEvent().stringValue){case l.Providers.Call.EscalateVideoEvent.stringValue:i.removeLocalVideoTracks();break;case l.Providers.Call.DeEscalateVideoEvent.stringValue:case l.Providers.Call.BlockCameraEvent.stringValue:i.enableLocalVideoStreams();break;case l.Providers.Call.UnBlockCameraEvent.stringValue:i.disableLocalVideoStreams();break;case l.Providers.Call.HoldEvent.stringValue:i.enableLocalStreams(),r.direction=l.Services.Call.MediaDirection.SEND_RECV;for(var o=0;o<s.length;o++)i.call.getVideoChannels()[o]&&(s[o].direction=i.call.getVideoChannels()[o].getNegotiatedDirection());i.setAVStreams(r,s);break;case l.Providers.Call.UnHoldEvent.stringValue:i.disableLocalStreams(),r.direction=l.Services.Call.MediaDirection.SEND_ONLY;for(var c=0;c<s.length;c++)s[c].direction=l.Services.Call.MediaDirection.INACTIVE}return e.data.errorCode===l.Services.Call.CallError.MEDIA_PRESERVED&&i&&i.call&&(e.data.callProvider.triggerCallServiceUnavailable(i.call),e.data.callProvider._callsAnalyticsService.sendUnavailableEvent(l.Services.Analytics.AnalyticsErrorCode.MEDIA_PRESERVED_ERROR)),i.mediaTransactionDfd?(t=e.data.errorCode===l.Services.Call.CallError.VIDEO_DENIED?e.data.errorCode:l.Services.Call.CallError.CALL_STATE_MISMATCH,i.rejectMediaTransaction(new l.Services.Call.CallException(t))):n||a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason),{nextState:l.Providers.Call.States.ACTIVE,nextEvent:i.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(c){"use strict";function l(e){c.Base.Logger.info("Initiating ICE restart with relay only"),e.setIceRestartRelayType(c.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY),e.iceConnectionFailedHandler()}c.Providers.Call.CallFailureEventInMultipleHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=5e6===e.data.protocolErrorCode&&-1!==e.data.failureReason.indexOf("415 Media Failed"),s=422002===e.data.protocolErrorCode&&-1!==e.data.failureReason.indexOf("Notification rejected"),n=!c.Base.Utils.isUndefined(i.call.getEstablishedTime()),o=e.data.protocolErrorCode===c.Providers.CallServiceGateway.Constants.SEE_OTHER_RESOURCE;!n||r?(t="all"===i._rtcConfiguration.iceTransportPolicy,r=!!i._rtcConfiguration.iceServers&&0<i._rtcConfiguration.iceServers.length&&!!i._rtcConfiguration.iceServers[0].urls&&0<i._rtcConfiguration.iceServers[0].urls.length,r=i.isMPaaSCall()&&t&&r&&i.getIceRestartRelayType()!==c.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY,n?i._hadMediaConnected?(c.Base.Logger.error("Initiating ICE restart with "+i.getIceRestartRelayType()),i._processIceConnectionStateChange(i.getIceConnectionState(),!0)):r?l(i):s||a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason):i.isMPaaSCall()?r?l(i):(c.Base.Logger.error("Initiating ICE restart with "+i.getIceRestartRelayType()),i._processIceConnectionStateChange(i.getIceConnectionState(),!0)):a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason)):o?(c.Base.Logger.info("Initiating ICE restart due to the 303 See Other"),i.iceConnectionFailedHandler(o)):s||a.triggerCallFailure(i.callId,e.data.errorCode,e.data.protocolType,e.data.protocolErrorCode,e.data.failureReason)}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.CallRingingEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;a.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),t.call._isPrivateCallerID=!!a.Base.Utils.isDefined(e.data.isPrivate)&&e.data.isPrivate,t.call._isAuraAsserted=!!a.Base.Utils.isDefined(e.data.isAuraAsserted)&&e.data.isAuraAsserted,i.triggerCallRinging(t.call,e.data.earlyMedia)}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.CallRingingEventInStartingHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=t._rtConnection,r=i.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput();return s.Providers.Call.Utils.updateAndTriggerRemoteAddressChangedIfNeeded(i,t.call,e.data.address,e.data.displayName),t.call._isPrivateCallerID=!!s.Base.Utils.isDefined(e.data.isPrivate)&&e.data.isPrivate,t.call._isAuraAsserted=!!s.Base.Utils.isDefined(e.data.isAuraAsserted)&&e.data.isAuraAsserted,i.triggerCallRinging(t.call,e.data.earlyMedia,e.data.ucid,e.data.parentUcid,e.data.contextId),s.Base.Utils.isDefined(e.data.earlyMedia)&&(t._isEarlyMedia=e.data.earlyMedia,t._isEarlyMedia&&t.remoteStream&&!r.isPlaying(t.remoteStream)&&(a.enableRemoteStreams(),t.call.isAudioMuted()||a.enableLocalAudioStreams(),r.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())||s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not play remote audio."))),{nextState:s.Providers.Call.States.ALERTING}}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.DeEscalateVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,e=t._callGatewayProvider,a=t.call.getVideoChannels();t.disableLocalVideoStreams();for(var r=t.getVideoStreams(),s=0;s<r.length;s++)t.isNailedUpVideoConnectionSupported()?(r[s].direction=n.Services.Call.MediaDirection.RECV_ONLY,r[s].logicalDirection=n.Services.Call.MediaDirection.INACTIVE):r[s].direction=n.Services.Call.MediaDirection.INACTIVE,r[s].enabled=!1,i.triggerVideoChannelUpdate(t.call,a[s]);return e.deEscalateVideo(t.callId,t.getAudioStream(),r).then(function(){t.stopPerformanceMonitoring()},function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Failed to deescalate video: "+e),t.rejectMediaTransaction(new n.Services.Call.CallException(n.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(n.Providers.Call.States.ACTIVE)}),{nextState:n.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.DenySendVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;0<(e=t.getVideoStreams()).length&&(t._latestVideoModeDirection=e[0].direction,t._latestNonHoldingVideoDirection=e[0].direction),clearTimeout(t.incomingVideoRequestTimer),i.triggerIncomingAddVideoDenied(t.call)}}(),function(r){"use strict";r.Providers.Call.DevicesFailureHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,a=e.data.callError||r.Services.Call.CallError.DEVICES_NOT_FOUND;return i.trigger(r.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,a]),{nextState:e.data.nextState}}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.EndCallEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=new r.Providers.Call.EndCallResponseEvent;return a.data={},t.stopAllStreams(),t.setVideoChannelId(T),a.data.remote=e.data.remote,a.data.host=e.data.cpCall._callGatewayProvider._host,e.data.remote?(a.data.callReason=e.data.callReason,{nextState:r.Providers.Call.States.ENDING,nextEvent:t.prepareEvent(a)}):(i.endCall(t.callId,e.data.denialReason).then(function(){t.handleEvent(a)},function(e){t.handleEvent(a)}),{nextState:r.Providers.Call.States.ENDING})}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.EndCallResponseEventInEndingHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=i.popQueuedRemoteCallEstablishedEvent();i.localStream=null,i.remoteStream=null,i._rtConnection&&(i._rtConnection.close(),i._rtConnection=null),o.Base.Utils.isDefined(i.mediaTransactionDfd)&&"pending"===i.mediaTransactionDfd.state()&&i.mediaTransactionDfd.reject(new o.Services.Call.CallException(o.Services.Call.CallError.ENDED)),a.unRegisterCall(i.call)&&a.triggerCallEnded(i.call,e.data.remote,e.data.callReason),r&&(t=(n=r.data.cpCall).call,a.callEstablished(t.getCallId(),t.getRemoteAddress(),t.getRemoteDisplayName(),t.getSubject(),r.data.isRemote,t.isCallerIdentityPrivate(),t.getAlertType(),t._isAuraAsserted,n.getAudioStream(),n.getVideoStreams()));var s=i._callGatewayProvider._host,n=i.call._callService._callManager.getAllCalls().filter(function(e){return!!e.getCallId()&&(!!a._cpCalls[e.getCallId()]&&a._cpCalls[e.getCallId()]._callGatewayProvider._host===s)});return i.call._callCreationInfo&&i.call._callCreationInfo.getAuthorizationToken()!==T&&!n.length&&a.stop(e.data.host),{nextState:o.Providers.Call.States.ENDED}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.EscalateNailedUpVideoEventInActiveHandler=function(e){var t=e.data.cpCall,e=t._callGatewayProvider;return t.enableLocalVideoStreams(),e.escalateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t.disableLocalVideoStreams(),i.Base.Logger.error(i.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate nailedup video: "+e),t.rejectMediaTransaction(new i.Services.Call.CallException(i.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(i.Providers.Call.States.ACTIVE)}),{nextState:i.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.EscalateVideoAnswerEventInActiveRenegotiateHandler=function(a){var r=a.data.cpCall,e=r._rtConnection;return r.updateVideoStreamsDirection(a.data.videoStreams,a.data.action),s.Base.Logger.debug(s.Base.LoggerTags.CALL_PROVIDER,"Answer SDP received =>\n "+a.data.answer),a.data.videoResolutions&&r.setVideoResolutionsTable(a.data.videoResolutions),e.receiveAnswer(a.data.answer,function(){var e,t,i=r.getVideoStreams();0<i.length&&(t=!1,null!==(e=r.searchResolutionsMap(a.data.videoStreams[0].maxHeight))&&e.getHeight()!==r.getVideoResolution().getHeight()&&(r.setNegotiatedVideoResolution(e),t=!0),a.data.serverSentResolution===T||null===a.data.serverSentResolution?t&&r.adjustVideoConstraints(e.getWidth(),e.getHeight(),e.getFPS()).then(function(){s.Providers.Call.CPUtils.saveServerSentConstraints(r,i,e)}):s.Providers.Call.CPUtils.useServerSentConstraints(r,s.Providers.Call.CPUtils.saveServerSentConstraints(r,i,a.data.serverSentResolution),t),(t=r.getStreamDirection(i[0]))===s.Services.Call.MediaDirection.RECV_ONLY?r.disableLocalVideoStreams(t):t!==s.Services.Call.MediaDirection.SEND_RECV&&t!==s.Services.Call.MediaDirection.SEND_ONLY&&r.removeLocalVideoTracks()),r.notifyCallServiceOfMediaChanges(),r.resolveMediaTransaction(),r.sendMuteUnmuteVideoNotification()},function(e){s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Video escalation failed while receiving answer SDP: "+e),r.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.INTERNAL_ERROR))}),{nextState:s.Providers.Call.States.ACTIVE,nextEvent:r.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.EscalateVideoEventInActiveHandler=function(e){var t,a=e.data.cpCall,i=e.data.callProvider,r=a._callGatewayProvider,s=a.call.getVideoChannels(),n=s[0].getChannelId();return o.Base.Utils.isDefined(e.data.videoDevice)&&(t=e.data.videoDevice.getDeviceId()),a.setVideoChannelId(s[0].getChannelId()),i.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(t,n,a.localStream,e.data.videoResolution,a._rtConnection,a.backgroundBlur,a.backgroundImage).then(function(e){o.Base.Logger.debug(o.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var t=a.getAudioStream(),i=[];e.getTracks().forEach(function(e){var t;e.kind===o.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&e.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(t=s[0]._getInternalRequestedDirection(),i.push(new o.Providers.Interfaces.VideoStream(e.id,t)))}),a.setAVStreams(t,i),a.enableLocalVideoStreams(s[0]._getInternalRequestedDirection()),a.isLocalVideoMuted()&&a.muteLocalVideo(),r.escalateVideo(a.callId,a.getAudioStream(),a.getVideoStreams()).then(function(){a.startPerformanceMonitoring()},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to escalate video: "+e),a.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),a.removeLocalVideoTracks(),a.revertFsmState(o.Providers.Call.States.ACTIVE)})},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. "+e),e.getError()===o.Services.Call.CallError.CAMERA_PERMISSION_DENIED||e.getError()===o.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(a.rejectMediaTransaction(e),a.revertFsmState(o.Providers.Call.States.ACTIVE)):(s[0]._negotiatedDirection=o.Services.Call.MediaDirection.INACTIVE,a.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.MEDIA_CREATION_FAILURE)),a.deviceRetrievalFailure(o.Providers.Call.States.ACTIVE))}),{nextState:o.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(r){"use strict";function e(){r.Providers.Call.GetOfferSDPEventInMultipleHandler.call(this)}(e.prototype=Object.create(r.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){r.Providers.Call.GetOfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[e])},e.prototype.handleError=function(e){var t=this.event.data.cpCall,i=this.event.data.callProvider,a=t.call.getVideoChannels();t.removeLocalVideoTracks(),a[0]._setNegotiatedDirection(r.Services.Call.MediaDirection.DISABLE),a[0]._setVideoDisabledReason(r.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),i.triggerVideoChannelUpdate(t.call),t.rejectMediaTransaction(e),t.revertFsmState(r.Providers.Call.States.ACTIVE)},r.Providers.Call.EscalateVideoGetOfferEventInActiveRenegotiateHandler=e}(AvayaClientServices),function(a){"use strict";function e(){a.Providers.Call.OfferSDPEventInMultipleHandler.call(this)}(e.prototype=Object.create(a.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){a.Providers.Call.OfferSDPEventInMultipleHandler.prototype.handleEvent.apply(this,[e])},e.prototype.handleError=function(e){var t=this.event.data.cpCall,i=t.call.getVideoChannels();t.removeLocalVideoTracks(),i[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),i[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_LOCAL_USER),t.rejectMediaTransaction(e),t.revertFsmState(a.Providers.Call.States.ACTIVE)},a.Providers.Call.EscalateVideoOfferEventInActiveRenegotiateHandler=e}(AvayaClientServices),function(a){"use strict";a.Providers.Call.EscalateVideoRejectedEventInActiveRenegotiateHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider,e=t.call.getVideoChannels();return t.removeLocalVideoTracks(),e[0]._setNegotiatedDirection(a.Services.Call.MediaDirection.DISABLE),e[0]._setVideoDisabledReason(a.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER),i.triggerVideoChannelUpdate(t.call),t._rtConnection.rollbackLocalOfferState(),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.VIDEO_DENIED)),{nextState:a.Providers.Call.States.ACTIVE,nextEvent:t.popQueuedActiveRenegotiateEvent()}}}(AvayaClientServices),function(C){"use strict";function u(){C.Providers.Call.AbstractEventHandler.call(this)}(u.prototype=Object.create(C.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){var t=e.data.cpCall,i=null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&0<t.videoStreams.length&&t.videoStreams[0].enabled;t._replaceAudioTrackIfNeeded().always(function(){C.Providers.Call.CPUtils.saveServerSentConstraints(t,e.data.videoStreams,e.data.serverSentResolution),i&&e.data.videoResolution&&(t._videoResolution.getWidth()>e.data.videoResolution.getWidth()||t._videoResolution.getHeight()>e.data.videoResolution.getHeight())?t._rtConnection.isRTCRtpSenderSupported()?C.Providers.Call.CPUtils.updateVideoResolution(t,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,u.prototype.getOffer.bind(this),u.prototype.errorHandler.bind(this),e):C.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,u.prototype.getOffer.bind(this),u.prototype.errorHandler.bind(this),e):u.prototype.getOffer.call(this,t,e)}.bind(this))},u.prototype.getOffer=function(t,i){var a=i.data.callProvider,r=t._callGatewayProvider,e=t._rtConnection;i.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration,i.data.restartTurnGathering),e.onAddStream=function(e){t.handleEvent(new C.Providers.Call.OnAddStreamEvent({newStream:e,action:i.data.action}))};var s,n,o,c=t.getVideoStreams(),l=!1;switch(i.data.action){case C.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:a.triggerRemoteHold(t.call);break;case C.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:a.triggerRemoteUnhold(t.call);break;case C.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:0<i.data.videoStreams.length&&(i.data.videoStreams[0].direction===C.Services.Call.MediaDirection.SEND_RECV&&t._prevMediaAction===C.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?c[0].direction=C.Services.Call.MediaDirection.RECV_ONLY:(n=t.calculateUpdateVideoDirection(i.data.videoStreams[0]),C.Base.Utils.isDefined(n)&&(c[0].direction=n,t._latestNonHoldingVideoDirection=n)));break;case C.Providers.Call.CallProvider.Constants.UPDATE_VIDEO:s=t.getIceConnectionRestartTimestamp(),l=t.isCallServiceAvailable()&&!!s}var d=t.call.getVideoChannels();0<c.length?(t.getStreamDirection(c[0])===C.Services.Call.MediaDirection.RECV_ONLY||t.isLocalVideoMuted()&&t._mediaAction===C.Providers.Call.CallProvider.Constants.UNHOLD_ACTION&&!t.hasVideoTracks())&&(o=C.Services.Call.MediaDirection.RECV_ONLY):0<d.length&&d[0].getNegotiatedDirection()===C.Services.Call.MediaDirection.DISABLE&&(o=C.Services.Call.MediaDirection.INACTIVE),e.createOffer(function(e){r.offerSDPResponse(t.callId,e,i.data.action,t.getAudioStream(),t.getVideoStreams()).then(function(){t.isIceRestartInProgress()&&t.setIceRestartInProgress(!1),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t)},function(e){C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while sending offer: "+e),this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.SEND_ERROR),t),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t)}.bind(this))}.bind(this),function(e){C.Base.Utils.isDefined(e.errorCode)?(C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer",e.errorMsg),a.trigger(C.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"GetOfferSDPEventInMultipleHandler error while creating offer: "+e),this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.INTERNAL_ERROR),t)),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,t),l&&t.iceConnectionFailedHandler()}.bind(this),function(e){return e=0<c.length?C.Providers.Call.Utils.updateVideoSdp(c[0],e):C.Base.SDPUtil.rejectMedia(e,"m=video"),t.call.getState()===C.Services.Call.CallStates.HOLDING||t.call.getState()===C.Services.Call.CallStates.HELD||t.call.isHeldRemotely()?t.call.getState()!==C.Services.Call.CallStates.HELD&&t.call.getState()!==C.Services.Call.CallStates.HOLDING||(e=C.Providers.Call.Utils.updateAudioSdp(t.getAudioStream(),e)):e=C.Base.SDPUtil.updateAudioSdpSendRecv(e),e},o,l,s,i.data.useIPv6Candidates,t.call.isMicrophoneDisabled())},u.prototype.handleError=function(e,t){t.rejectMediaTransaction(e)},u.prototype.errorHandler=function(e){this.handleError(new C.Services.Call.CallException(C.Services.Call.CallError.MEDIA_CREATION_FAILURE),e),u.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,e)},u.prototype.resetFarEndRenegotiateStateIfNeeded=function(e){e.call.getState()===C.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.call._setState(C.Services.Call.CallStates.ESTABLISHED)},C.Providers.Call.GetOfferSDPEventInMultipleHandler=u}(AvayaClientServices),function(l){"use strict";l.Providers.Call.GetOfferSDPEventInStartingHandler=function(s){var e=s.data.cpCall,n=s.data.callProvider;e.setNailedUpVideoConnectionSupported(!1);var t=e.resetAudioOnlyNailedUpConnection();function i(e){e.deviceRetrievalFailure(l.Providers.Call.States.ACTIVE)}s.data.iceServerChanged&&e._rtConnection.updatePeerConfiguration(e._rtcConfiguration),e.updateAudioNoiseReduction(s.data.audioStream),e.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(s.data.videoStreams);var o=e.call.isMicrophoneDisabled(),c=function(i){var a=i._callGatewayProvider,e=i._rtConnection;i._hasInitiatedMediaConnection=!0,e.onAddStream=function(e){i.handleEvent(new l.Providers.Call.OnAddStreamEvent({newStream:e}))};var t,r=i.getVideoStreams();0<r.length&&i.getStreamDirection(r[0])===l.Services.Call.MediaDirection.RECV_ONLY&&(t=l.Services.Call.MediaDirection.RECV_ONLY),e.createOffer(function(e){0<r.length&&!l.Base.SDPUtil.hasH264(e.sdp)&&i.isFirefoxBrowser()&&l.Base.Logger.warn(">>> H.264 video codec plugin is NOT installed <<<");var t=i.isMPaaSCall()?i.isLocalVideoMuted():T;a.getOfferSDPResponse(i.callId,e,i.getAudioStream(),i.getVideoStreams(),t).fail(function(e){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Failed to send get offer response",e),n.trigger(l.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,l.Services.Call.CallError.SEND_ERROR])})},function(e){l.Base.Utils.isDefined(e.errorCode)?(l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e.errorMsg),n.trigger(l.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e),e.includes("Failed to set local video description recv parameters")&&0<r.length?(i.videoStreams[0].direction===l.Services.Call.MediaDirection.SEND_RECV?(l.Base.Logger.debug(l.Base.LoggerTags.CALL_PROVIDER,"Retrying with recvonly video"),i.disableLocalVideoStreams(),i.videoStreams[0].direction=l.Services.Call.MediaDirection.RECV_ONLY):(l.Base.Logger.debug(l.Base.LoggerTags.CALL_PROVIDER,"Retrying with audio only"),i.removeLocalVideoTrack(i.localStream)),c(i)):n.trigger(l.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,l.Services.Call.CallError.INTERNAL_ERROR]))},function(e){return 0<r.length&&(e=l.Providers.Call.Utils.updateVideoSdp(r[0],e),r[0].enabled||(e=l.Base.SDPUtil.rejectMedia(e,"m=video"))),e},t,!1,0,s.data.useIPv6Candidates,o)},a=!o&&l.Base.Utils.isDefined(e.getNoiseSuppressionConstraints());e._replaceAudioTrackIfNeeded(!1,a).always(function(){null!==e.localStream&&e._rtConnection.hasVideo(e.localStream)&&(t||s.data.videoResolution&&s.data.videoResolution.getWidth()!==e._videoResolution.getWidth()&&s.data.videoResolution.getHeight()!==e._videoResolution.getHeight())?e._rtConnection.isRTCRtpSenderSupported()?l.Providers.Call.CPUtils.updateVideoResolution(e,s.data.callProvider.getMediaServiceFactory(),s.data.videoResolution,c,i,s):l.Providers.Call.CPUtils.createLocalMediaStream(s.data.audioDevice,s.data.videoDevice,e,s.data.callProvider.getMediaServiceFactory(),s.data.videoResolution,c,i,s):c(e)}.bind(this))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.HoldEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;t._rtConnection.disableLocalAudioStreams(),t.disableLocalVideoStreams();var e=t.getAudioStream(),a=t.getVideoStreams();t.isNailedUpVideoConnectionSupported()?e.logicalDirection=s.Services.Call.MediaDirection.SEND_ONLY:e.direction=s.Services.Call.MediaDirection.SEND_ONLY;for(var r=0;r<a.length;r++)t.isNailedUpVideoConnectionSupported()?(a[r].direction=s.Services.Call.MediaDirection.RECV_ONLY,a[r].logicalDirection=s.Services.Call.MediaDirection.INACTIVE):a[r].direction=s.Services.Call.MediaDirection.INACTIVE;return t.setAVStreams(e,a),i.holdCall(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to hold: "+e),t.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(s.Providers.Call.States.ACTIVE)}),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(C){"use strict";C.Providers.Call.IncomingAddVideoEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=i._callGatewayProvider,e=i._rtConnection,s=a._config.callUserConfiguration.incomingVideoRequestTimeout,n=a.isVideoConfigurationEnabled();C.Base.Utils.isDefined(s)||(s=C.Config.CallUserConfiguration.DefaultValues.INCOMING_VIDEO_REQUEST_TIMEOUT);var o,c,l=i.getAudioStream(),d=i.getVideoStreams();n&&(0===d.length?d.push(new C.Providers.Interfaces.VideoStream(0,C.Services.Call.MediaDirection.RECV_ONLY)):(d[0].enabled=t.data.videoStreams[0].enabled,d[0].direction=C.Services.Call.MediaDirection.RECV_ONLY),t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_RECV&&t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_ONLY&&i.updateVideoStreamsDirection(t.data.videoStreams,t.data.action),i._latestVideoModeDirection=d[0].direction,i._latestNonHoldingVideoDirection=d[0].direction,i.isNailedUpVideoConnectionSupported()&&(d[0].logicalDirection=d[0].direction,e.enableRemoteVideoStreams()),0===(c=i.call.getVideoChannels()).length?((o=a.createVideoChannel_MediaDirection(i.call,t.data.videoStreams[0].direction))._setNegotiatedDirection(C.Services.Call.MediaDirection.RECV_ONLY),c.push(o)):c[0]._setNegotiatedDirection(C.Services.Call.MediaDirection.RECV_ONLY),t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_RECV&&t.data.videoStreams[0].direction!==C.Services.Call.MediaDirection.SEND_ONLY&&i.updateVideoChannelDirection(t.data.videoStreams),a.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(c[0].getChannelId(),i.remoteStream),a.triggerVideoChannelUpdate(i.call)),0!==d.length&&d[0].enabled||(t.data.offer=C.Base.SDPUtil.rejectMedia(t.data.offer,"m=video")),e.createAnswer(t.data.offer,function(e){r.offerSDPResponse(i.callId,e,t.data.action,l,d).then(function(){n&&(i.incomingCallInfo={offer:t.data.offer,audioStream:t.data.audioStream,videoStreams:t.data.videoStreams,action:t.data.action},i.incomingVideoRequestTimer=setTimeout(function(){i.incomingVideoRequestTimedout()},s),a.triggerIncomingAddVideoRequest(i.call))})},function(e){C.Base.Logger.error(C.Base.LoggerTags.CALL_PROVIDER,"IncomingAddVideo error while creating answer: "+e)},function(e){if(0<d.length)return C.Providers.Call.Utils.updateVideoSdp(d[0],e)})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.IncomingAddVideoTimedoutEventInActiveHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Timed out waiting for incoming add video request to be accepted"),e.triggerIncomingAddVideoTimedout(t.call)}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.IncomingCallEstablishedEventInEndingHandler=function(e){var t=e.data.cpCall;e.data.isRemote&&t.setQueuedRemoteCallEstablishedEvent(e)}}(),function(o){"use strict";o.Providers.Call.IncomingGenericOfferSDPEventInActive=function(e){var t=e.data.cpCall,i=t.getVideoStreams(),a=t.call.getVideoChannels();switch(e.data.action){case o.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION:var r=0===i.length||!1===i[0].enabled||t.isNailedUpVideoConnectionSupported()&&i[0].logicalDirection===o.Services.Call.MediaDirection.INACTIVE,s=0<a.length&&a[0].getNegotiatedDirection()===o.Services.Call.MediaDirection.DISABLE,n=r||s?new o.Providers.Call.IncomingAddVideoEvent(e.data):(i[0].enabled=!0,t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new o.Providers.Call.OfferSDPEvent(e.data));break;case o.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION:n=e.data.videoStreams&&e.data.videoStreams[0].enabled?(i[0].enabled=!0,t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION,new o.Providers.Call.OfferSDPEvent(e.data)):new o.Providers.Call.IncomingRemoveVideoEvent(e.data);break;case o.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION:r=0===i.length||!1===i[0].enabled||t.isNailedUpVideoConnectionSupported()&&i[0].logicalDirection===o.Services.Call.MediaDirection.INACTIVE,s=0<a.length&&a[0].getNegotiatedDirection()===o.Services.Call.MediaDirection.DISABLE,n=r||s?(t._mediaAction=o.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION,new o.Providers.Call.IncomingAddVideoEvent(e.data)):new o.Providers.Call.OfferSDPEvent(e.data);break;default:n=new o.Providers.Call.OfferSDPEvent(e.data)}return{nextState:T,nextEvent:n}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.IncomingGenericOfferSDPEventInActiveRenegotiate=function(e){var t=e.data.cpCall;return i.Base.Logger.debug(i.Base.LoggerTags.CALL_PROVIDER,"Received incoming offer event while in ACTIVE_RENEGOTIATE. Queuing for later processing."),t.setQueuedActiveRenegotiateEvent(e),{nextState:T,nextEvent:T}}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.IncomingRemoveVideoEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=i._callGatewayProvider,e=i._rtConnection,s=i.call.getVideoChannels();function n(){i.call.getState()===o.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i.call._setState(o.Services.Call.CallStates.ESTABLISHED)}i.disableLocalVideoStreams(),e.disableRemoteVideoStreams(),i.updateVideoStreamsDirection(t.data.videoStreams,t.data.action),0<s.length&&(i.isNailedUpVideoConnectionSupported()||i.removeLocalVideoTracks(),s[0]._setNegotiatedDirection(o.Services.Call.MediaDirection.DISABLE),s[0]._setVideoDisabledReason(o.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)),a.triggerVideoChannelUpdate(i.call),e.createAnswer(t.data.offer,function(e){r.offerSDPResponse(i.callId,e,t.data.action,i.getAudioStream(),i.getVideoStreams()).then(function(){n()}.bind(this),function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",e),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,o.Services.Call.CallError.SEND_ERROR]),n()}.bind(this))},function(e){o.Base.Utils.isDefined(e.errorCode)?(o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e),a.trigger(o.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,o.Services.Call.CallError.INTERNAL_ERROR])),n()})}}(AvayaClientServices),function(c){"use strict";c.Providers.Call.JoinRemoteCallEventInInitialHandler=function(e){var t,r=e.data.cpCall,i=e.data.callProvider,s=r._callGatewayProvider,a=e.data.audioDevice?e.data.audioDevice.getDeviceId():T,n=r._videoDevice?r._videoDevice.getDeviceId():T,o=r.isNailedUpVideoConnectionSupported()&&i.hasVideoDevices()&&i.isVideoAllowed();return o&&((e=i._createVideoChannel_VideoMode(c.Services.Call.VideoMode.DISABLE))._setInternalRequestedDirection(c.Services.Call.MediaDirection.RECV_ONLY),t="NailedUp_"+e.getChannelId(),e._setChannelId(t),r.call._videoChannels.push(e)),r._isReadyToReceiveMediaRequest=!0,i.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(r.call.getCallId(),!0,o,a,n,t,r._videoResolution).then(function(e){e=e.stream;r.localStream=e,r._rtConnection.addStream(r.localStream),r._rtConnection.disableLocalStreams();var t,i=null,a=[];e.getTracks().forEach(function(e){"audio"===e.kind?i=new c.Providers.Interfaces.AudioStream(e.id,c.Services.Call.MediaDirection.SEND_RECV):"video"===e.kind&&r.isNailedUpVideoConnectionSupported()&&((e=new c.Providers.Interfaces.VideoStream(e.id,c.Services.Call.MediaDirection.RECV_ONLY)).logicalDirection=c.Services.Call.MediaDirection.INACTIVE,a.push(e),t=new c.Providers.Call.NailedUpVideoConnectionInfo(c.Services.Call.MediaDirection.INACTIVE,c.Services.Call.MediaDirection.RECV_ONLY))}),r.setAVStreams(i,a),s.joinRemoteCall(r.callId,r.getAudioStream(),r.getVideoStreams(),t).then(function(){r._joinRemotePromise.resolve()},function(e){c.Base.Logger.info(c.Base.LoggerTags.CALL_PROVIDER,"Failed to join to remote call: "+r.callId),r._joinRemotePromise.reject(new c.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg)),r.revertFsmState(c.Providers.Call.States.INITIAL)})},function(e){c.Base.Logger.error(c.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams to join remote call. "+e),r._joinRemotePromise.reject(new c.Services.Call.CallException(c.Services.Call.CallError.MEDIA_CREATION_FAILURE)),r.revertFsmState(c.Providers.Call.States.INITIAL),r.handleEvent(new c.Providers.Call.DeviceRetrievalFailedEvent)}),{nextState:c.Providers.Call.States.ACTIVE}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.MuteAudioEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&(t.call._getIsContentVideoSharingStarted()?t.updateVideoSharingMicrophoneVolume(0):t._rtConnection.disableLocalAudioStreams(),e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.MuteSpeakerEventInMultipleHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;t.remoteStream&&e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().muteStream(t.remoteStream)}}(),function(a){"use strict";a.Providers.Call.MuteVideoEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;e.data.sendNotificationOnly||t.muteLocalVideo(),t.isMPaaSCall()?t.hasReceivedCallEstablishedEvent()?i.muteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).then(function(){t.noMediaTransactionDfd.resolve(),t._callProvider.triggerVideoChannelUpdate(t.call)},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+e),t.noMediaTransactionDfd.reject(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR))}):(t.queueMuteUnumteFunctor(function(){i.muteVideo(t.callId,t.call._sessionId,t.getVideoStreams()).fail(function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video mute state: "+e)})}),t.noMediaTransactionDfd.resolve()):t.noMediaTransactionDfd.resolve()}}(AvayaClientServices),function(d){"use strict";function C(){d.Providers.Call.AbstractEventHandler.call(this)}(C.prototype=Object.create(d.Providers.Call.AbstractEventHandler.prototype)).handleEvent=function(e){var t=(this.event=e).data.cpCall,i=e.data.callProvider,a=null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&0<t.videoStreams.length&&t.videoStreams[0].enabled;e.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration),d.Base.Utils.isDefined(e.data.videoBandwidth)&&t._updateVideoBandwidth(e.data.videoBandwidth),t._replaceAudioTrackIfNeeded().always(function(){a&&e.data.videoResolution&&(t._videoResolution.getWidth()>e.data.videoResolution.getWidth()||t._videoResolution.getHeight()>e.data.videoResolution.getHeight())?d.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,i.getMediaServiceFactory(),e.data.videoResolution,C.prototype.offerSDP.bind(this),C.prototype.errorHandler.bind(this),e):C.prototype.offerSDP.call(this,t,e)}.bind(this))},C.prototype.handleError=function(e){d.Base.Utils.isDefined(this.event.data.cpCall.mediaTransactionDfd)&&this.event.data.cpCall.rejectMediaTransaction(e)},C.prototype.errorHandler=function(e){this.handleError(new d.Services.Call.CallException(d.Services.Call.CallError.MEDIA_CREATION_FAILURE)),C.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,e)},C.prototype.resetFarEndRenegotiateStateIfNeeded=function(e){e.call.getState()===d.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.call._setState(d.Services.Call.CallStates.ESTABLISHED)},C.prototype.offerSDP=function(i,a){var r=a.data.callProvider,s=i._callGatewayProvider,n=i._rtConnection,e=i.call.getVideoChannels();n.onAddStream=function(e){i.handleEvent(new d.Providers.Call.OnAddStreamEvent({newStream:e,action:a.data.action}))},i.updateAudioVideoStreamsDirection(a.data.audioStream,a.data.videoStreams,a.data.action);var o=i.getVideoStreams();if(!(0<o.length)||a.data.action!==d.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION&&(l=i._mediaAction,c=a.data.action,l!==d.Providers.Call.CallProvider.Constants.INCOMING_UPDATE_VIDEO_ACTION||c!==d.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION&&c!==d.Providers.Call.CallProvider.Constants.INCOMING_REMOVE_VIDEO_ACTION)){if(0<o.length&&a.data.action===d.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION&&0<a.data.videoStreams.length&&(a.data.videoStreams[0].direction===d.Services.Call.MediaDirection.INACTIVE||a.data.videoStreams[0].direction===d.Services.Call.MediaDirection.DISABLE))for(var t=0;t<o.length;t++)e[t]._setNegotiatedDirection(a.data.videoStreams[0].direction),e[t]._setVideoDisabledReason(d.Services.Call.VideoChannelDisabledReason.DISABLED_BY_REMOTE_USER)}else{var c,l=i.getStreamDirection(o[0]);l===d.Services.Call.MediaDirection.SEND_RECV&&i._prevMediaAction===d.Providers.Call.CallProvider.Constants.INCOMING_ADD_VIDEO_ACTION?l=d.Services.Call.MediaDirection.RECV_ONLY:0<a.data.videoStreams.length&&(c=i.calculateUpdateVideoDirection(a.data.videoStreams[0]),d.Base.Utils.isDefined(c)&&(i._latestNonHoldingVideoDirection=l=c)),i.isNailedUpVideoConnectionSupported()?o[0].logicalDirection=l:o[0].direction=l}0!==o.length&&o[0].enabled||(a.data.offer=d.Base.SDPUtil.rejectMedia(a.data.offer,"m=video")),n.createAnswer(a.data.offer,function(e){switch(a.data.action){case d.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION:i.call.isAudioMuted()||i.audioStream.direction!==d.Services.Call.MediaDirection.RECV_ONLY&&i.audioStream.direction!==d.Services.Call.MediaDirection.INACTIVE||n.disableLocalAudioStreams(),r.triggerRemoteHold(i.call);break;case d.Providers.Call.CallProvider.Constants.INCOMING_UNHOLD_ACTION:i.call.isAudioMuted()||i.audioStream.direction!==d.Services.Call.MediaDirection.SEND_RECV&&i.audioStream.direction!==d.Services.Call.MediaDirection.SEND_ONLY||n.enableLocalAudioStreams(),r.triggerRemoteUnhold(i.call)}var t;0<o.length&&((t=i.getStreamDirection(o[0]))!==d.Services.Call.MediaDirection.RECV_ONLY&&t!==d.Services.Call.MediaDirection.INACTIVE||i.disableLocalVideoStreams(t)),i.notifyCallServiceOfMediaChanges(a.data.action),s.offerSDPResponse(i.callId,e,a.data.action,i.getAudioStream(),i.getVideoStreams()).then(function(){C.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this),function(e){d.Base.Logger.error(d.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while sending answer: "+e),this.handleError(new d.Services.Call.CallException(d.Services.Call.CallError.SEND_ERROR)),C.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this))}.bind(this),function(e){d.Base.Utils.isDefined(e.errorCode)?(d.Base.Logger.error(d.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer",e.errorMsg),r.trigger(d.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[i.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(d.Base.Logger.error(d.Base.LoggerTags.CALL_PROVIDER,"OfferSDPEventInMultipleHandler error while creating answer: "+e),this.handleError(new d.Services.Call.CallException(d.Services.Call.CallError.INTERNAL_ERROR))),C.prototype.resetFarEndRenegotiateStateIfNeeded.call(this,i)}.bind(this),function(e){return 0<o.length&&(o[0].enabled||i.isNailedUpVideoConnectionSupported())&&(e=d.Providers.Call.Utils.updateVideoSdp(o[0],e)),i.call.getState()===d.Services.Call.CallStates.HOLDING||i.call.getState()===d.Services.Call.CallStates.HELD||i.call.isHeldRemotely()||a.data.action===d.Providers.Call.CallProvider.Constants.INCOMING_HOLD_ACTION?i.call.getState()!==d.Services.Call.CallStates.HELD&&i.call.getState()!==d.Services.Call.CallStates.HOLDING||(e=d.Providers.Call.Utils.updateAudioSdp(i.getAudioStream(),e)):e=a.data.audioStream.direction!==d.Services.Call.MediaDirection.SEND_ONLY?d.Base.SDPUtil.updateAudioSdpSendRecv(e):d.Providers.Call.Utils.updateAudioSdp(i.getAudioStream(),e),e})},d.Providers.Call.OfferSDPEventInMultipleHandler=C}(AvayaClientServices),function(n){"use strict";function a(t,i){var a=t._callGatewayProvider,r=i.data.callProvider,e=t._rtConnection;e.onAddStream=function(e){t.handleEvent(new n.Providers.Call.OnAddStreamEvent({newStream:e}))};var s=t.getVideoStreams();e.createAnswer(i.data.offer,function(e){0<s.length&&0<i.data.videoStreams.length&&!n.Base.SDPUtil.hasH264(e.sdp)&&t.isFirefoxBrowser()&&(n.Base.Logger.warn(">>> H.264 video codec plugin must be installed to get video. <<<"),t.disableVideoStreamsAndChannels(n.Services.Call.VideoChannelDisabledReason.DISABLED_DUE_TO_MISSING_H264_PLUGIN)),n.Base.Utils.isDefined(i.data.videoBandwidth)&&t._updateVideoBandwidth(i.data.videoBandwidth),a.offerSDPResponse(t.callId,e,i.data.action,t.getAudioStream(),s).fail(function(e){n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Failed to send offer response",e),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,n.Services.Call.CallError.SEND_ERROR])})},function(e){n.Base.Utils.isDefined(e.errorCode)?(n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error while creating answer",e.errorMsg),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])):(n.Base.Logger.error(n.Base.LoggerTags.CALL_PROVIDER,"Error while creating offer",e),r.trigger(n.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[t.call,n.Services.Call.CallError.INTERNAL_ERROR]))})}function r(e){e.revertFsmState(n.Providers.Call.States.ACTIVE)}n.Providers.Call.OfferSDPEventInStartingHandler=function(e){var t=e.data.cpCall,i=e.data.callProvider;t.determineIfNailedUpVideoConnectionSupported(e.data.videoStreams),e.data.iceServerChanged&&t._rtConnection.updatePeerConfiguration(t._rtcConfiguration),t.removeLocalVideoTracksIfRemoteVideoChannelsIsEmpty(e.data.videoStreams),t._replaceAudioTrackIfNeeded().always(function(){null!==t.localStream&&t._rtConnection.hasVideo(t.localStream)&&e.data.videoResolution&&e.data.videoResolution.getWidth()!==t._videoResolution.getWidth()&&e.data.videoResolution.getHeight()!==t._videoResolution.getHeight()?n.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,t,i.getMediaServiceFactory(),e.data.videoResolution,a,r,e):a(t,e)}.bind(this))}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.OnAddRemoteTrackEventInActiveHandler=function(t){var e,i=t.data.cpCall,a=t.data.callProvider;r.Base.Logger.debug(r.Base.LoggerTags.CALL_PROVIDER,">>> Add new remote track: "+t.data.newTrack.kind+" id: "+t.data.newTrack.id),t.data.newTrack.kind===r.Providers.Call.CallProvider.Constants.VIDEO_TRACK?0<(e=i.call.getVideoChannels()).length&&(i.remoteStream.getTracks().some(function(e){return e.id===t.data.newTrack.id})||(i.remoteStream=new MediaStream,i.remoteStream.addTrack(t.data.newTrack)),i._rtConnection.enableRemoteVideoTrack(i.remoteStream,t.data.newTrack),a.getMediaServiceFactory().getVideoInterfaceService().setRemoteMediaStream(e[0].getChannelId(),i.remoteStream),a.triggerVideoChannelUpdate(i.call)):(e=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),i.remoteStream&&!e.playAudioStream(i.remoteStream,i.call.isSpeakerMuted())&&r.Base.Logger.info(r.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found. Could not replay remote audio."),a.trigger(r.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream]))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.OnAddStreamEventInActiveHandler=function(e){var t,i=e.data.cpCall,a=e.data.callProvider,r=null===i.remoteStream;0<e.data.newStream.getAudioTracks().length&&((t=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput()).stopPlayingAudioStream(i.remoteStream),i.remoteStream&&i.remoteStream.id===e.data.newStream.id?(i.remoteStream=new MediaStream,e.data.newStream.getTracks().forEach(function(e){e instanceof MediaStreamTrack&&"live"===e.readyState&&i.remoteStream.addTrack(e)})):i.remoteStream=e.data.newStream,t.playAudioStream(i.remoteStream,i.call.isSpeakerMuted()),a.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(i.call.getCallId(),i.remoteStream),a.trigger(s.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream])),!r&&null!==i.remoteStream.onaddtrack||(s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+i.remoteStream.id),i._rtConnection.onAddRemoteTrack=function(e){i.handleEvent(new s.Providers.Call.OnAddRemoteTrackEvent({newTrack:e}))},i._rtConnection.onRemoveRemoteTrack=function(e){i.handleEvent(new s.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:e}))}),i._rtConnection.enableRemoteStreams(),s.Base.Utils.isDefined(e.data.action)&&e.data.action===s.Providers.Call.CallProvider.Constants.UNHOLD&&(i.call.isAudioMuted()?i.enableLocalVideoStreams():i.enableLocalStreams()),i.notifyCallServiceOfMediaChanges(e.data.action)}}(AvayaClientServices),function(n){"use strict";n.Providers.Call.OnAddStreamEventPreActiveHandler=function(e){var t=e.data.cpCall,i=t._rtConnection,a=e.data.callProvider,r=a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput(),s=null===t.remoteStream;t.remoteStream=e.data.newStream,a.getMediaServiceFactory().getAudioOutputInterfaceService().setRemoteMediaStream(t.call.getCallId(),t.remoteStream),a.trigger(n.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.remoteStream]),t._isEarlyMedia&&!r.isPlaying(t.remoteStream)?(i.enableRemoteStreams(),t.call.isAudioMuted()||i.enableLocalAudioStreams(),r.playAudioStream(t.remoteStream,t.call.isSpeakerMuted())||n.Base.Logger.info(n.Base.LoggerTags.CALL_PROVIDER,"No Audio Tracks Found.  Could not play remote audio.")):i.disableRemoteStreams(),s&&(n.Base.Logger.info(n.Base.LoggerTags.CALL_PROVIDER,"Registering for add/remove track events from "+t.remoteStream.id),t._rtConnection.onAddRemoteTrack=function(e){t.handleEvent(new n.Providers.Call.OnAddRemoteTrackEvent({newTrack:e}))},t._rtConnection.onRemoveRemoteTrack=function(e){t.handleEvent(new n.Providers.Call.OnRemoveRemoteTrackEvent({newTrack:e}))})}}(AvayaClientServices),function(e){"use strict";e.Providers.Call.OnRemoveRemoteTrackEventInActiveHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider;e.Base.Logger.debug(e.Base.LoggerTags.CALL_PROVIDER,">>> Removed remote track: "+t.data.newTrack.kind+" id: "+t.data.newTrack.id),t.data.newTrack.kind===e.Providers.Call.CallProvider.Constants.AUDIO_TRACK&&(i.remoteStream.getAudioTracks().forEach(function(e){e.id===t.data.newTrack.id&&a.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().stopPlayingAudioStream(i.remoteStream,!1)}),a.trigger(e.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.remoteStream]))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectCallRequestEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider,a=e.data.deferred;i.rejectCallRequest(t.callId,t.getCallRequestedTransactionalId(e.data.requestedType),e.data.action).then(function(){a.resolve()},function(e){a.reject(e)})}}(),function(i){"use strict";i.Providers.Call.RejectMidCallEventInMultipleHandler=function(e){var t=e.data.cpCall;i.Base.Logger.error(i.Base.LoggerTags.CALL_PROVIDER,"Reject mid call event in invalid state: ",e.data.action),t.rejectMediaTransaction(new i.Services.Call.CallException(i.Services.Call.CallError.INVALID_STATE))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RejectOfferSDPEventInMultipleHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.rejectOfferSDPResponse(t.callId,e.data)}}(),function(s){"use strict";s.Providers.Call.RevertContentSharingVideoEventInMultipleHandler=function(e){function t(){s.Base.Logger.debug("Sending UPDATE_VIDEO request for new local video"),a._callGatewayProvider.updateVideo(a.callId,a.getAudioStream(),a.getVideoStreams()).then(function(){s.Base.Utils.isDefined(e.data.videoResolutionChanged)||a.revertFsmState(s.Providers.Call.States.ACTIVE)},function(e){s.Base.Logger.error("Failed to revert local video"),a.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.SEND_ERROR)),a.revertFsmState(s.Providers.Call.States.ACTIVE)})}function i(e){s.Base.Logger.error("Failed to revert local video: "+e),a.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.MEDIA_CREATION_FAILURE)),a.revertFsmState(s.Providers.Call.States.ACTIVE)}var a=e.data.cpCall;if(null!==e.data.videoDevice)return a._rtConnection.isRTCRtpSenderSupported()?s.Providers.Call.CPUtils.updateDevices(null,e.data.videoDevice,a,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,i):s.Providers.Call.CPUtils.createLocalMediaStream(null,e.data.videoDevice,a,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,i),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE};var r=a.getVideoStreams();0!==r.length&&(r[0].direction=s.Services.Call.MediaDirection.RECV_ONLY,a.setAVStreams(a.getAudioStream(),r)),t()}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.RevertStateEventInMultipleHandler=function(e){return{nextState:e.data.state}}}(),function(){"use strict";AvayaClientServices.Providers.Call.SendDTMFEventInMultipleHandler=function(e){e.data.cpCall._rtConnection.sendDTMF(e.data.dtmf)}}(),function(){"use strict";AvayaClientServices.Providers.Call.ServiceAvailableEventInMultipleHandler=function(e){(e=e.data.cpCall).isIceConnectionStateFailed()||!e.hasIceRecoveryElapsed()?e.iceConnectionFailedHandler():e.initiateIceRecoveryIfDetectedMediaPathProblem()}}(),function(r){"use strict";r.Providers.Call.SetMediaProcessingEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t.getVideoSendResolution();if(t.hasVideoTracks()&&r.Base.Utils.isUndefined(t._videoSharingStream)&&t._getPreviousVideoDirection()!==r.Services.Call.MediaDirection.DISABLE){var a=t.getLocalVideoTrack();if(!t.backgroundBlur&&!t.backgroundImage||!a||"function"!=typeof a.avayaSetBackground)return r.Providers.Call.CPUtils.updateDevices(T,e.data.videoDevice,t,e.data.callProvider.getMediaServiceFactory(),t.getVideoResolution(),function(){t._getPreviousVideoDirection()!==r.Services.Call.MediaDirection.SEND_RECV&&t._getPreviousVideoDirection()!==r.Services.Call.MediaDirection.SEND_ONLY||t.mediaTransactionDfd.then(function(){i.getHeight()<t.getNegotiatedVideoResolution().getHeight()?(r.Base.Logger.debug(r.Base.LoggerTags.CALL_PROVIDER,"Updating send video resolution to the previously set dynamic resolution. dynamic: "+i+" negotiated: "+t.getVideoResolution()),t.setVideoSendResolution(i,!1)):t._updateVideoSendResolution(t.getVideoResolution())}),t.resolveMediaTransaction(),t.revertFsmState(r.Providers.Call.States.ACTIVE)},function(){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Create local media error."),t.rejectMediaTransaction(new r.Services.Call.CallException(r.Services.Call.CallError.MEDIA_CREATION_FAILURE)),t.revertFsmState(r.Providers.Call.States.ACTIVE)},t.getNoiseSuppressionConstraints()),{nextState:r.Providers.Call.States.ACTIVE_RENEGOTIATE};a.avayaSetBackground(t.backgroundBlur,t.backgroundImage),t.resolveMediaTransaction()}else t.resolveMediaTransaction()}}(AvayaClientServices),function(f){"use strict";f.Providers.Call.StartCallEventInInitialHandler=function(n){var e,t,o,c,l,d,i,C=n.data.cpCall,u=n.data.callProvider,a=C._callGatewayProvider,h=C.call.getVideoChannels(),r=C.call.getAudioChannel(),s=!0,_=!1,v=!1,p=n.data.audioDevice?n.data.audioDevice.getDeviceId():T;if(f.Base.Utils.isDefined(h))for(var g=0;g<h.length;g++){var S=h[g]._getInternalRequestedDirection();S===f.Services.Call.MediaDirection.SEND_ONLY||S===f.Services.Call.MediaDirection.SEND_RECV?(_=!0,n.data.videoDevice&&(e=n.data.videoDevice.getDeviceId())):S===f.Services.Call.MediaDirection.RECV_ONLY&&(v=!0,f.Base.Utils.getBrowserType()===f.Base.BrowserType.EDGE&&u.hasVideoDevices()&&(_=!0)),S!==f.Services.Call.MediaDirection.INACTIVE&&(t=h[g].getChannelId())}return(s=f.Base.Utils.isDefined(r)&&r.getRequestedDirection()===f.Services.Call.MediaDirection.DISABLE?!1:s)||_||!n.data.webCollab?s?(o=null,c=[],l=C.call.isMicrophoneDisabled(),d=function(){C._rtConnection.addStream(C.localStream),C._rtConnection.disableLocalStreams();var e,t=C.isMPaaSCall()?C.isLocalVideoMuted():T,i=C.call.getCallId();f.Base.Utils.isUndefined(i)&&(e=C.generateTemporarilyCallId(),u.registerCall(e,C.call,C)),a.startCall(n.data.remoteAddress,C.call.getSubject(),C.call._callCreationInfo,n.data.video,n.data.webCollab,C.getAudioStream(),C.getVideoStreams(),t,n.data.uccp,i,C.call._sessionId,n.data.nailedUpVideoConnection,C.call.getNoiseReductionSetting(),n.data.appType,n.data.appVersion).then(function(e){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(e));var t=new f.Providers.Call.StartCallResponseEvent;t.data={},t.data.callId=e.callId,t.data.videoResolution=n.data.videoResolution,t.data.audioDevice=n.data.audioDevice,t.data.videoDevice=n.data.videoDevice,t.data.clientCpuUsageMgmt=e.clientCpuUsageMgmt,C.handleEvent(t)},function(e){C._rtConnection.stopAllStreams(),u.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[C.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])})}.bind(this),l&&!_?(o=new f.Providers.Interfaces.AudioStream("MicrophoneDisabledTrack",f.Services.Call.MediaDirection.SEND_RECV),v&&c.push(new f.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",f.Services.Call.MediaDirection.RECV_ONLY)),C.setAVStreams(o,c),C.localStream=new MediaStream,d()):(s=n.data.audioDevice?n.data.audioDevice.toString():"Default Audio",i=n.data.videoDevice?n.data.videoDevice.toString():"Default Camera",f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Starting call using",s,i),u.getMediaServiceFactory().getMediaServicesService().createLocalMediaStream(C.call.getCallId(),!l,_,p,e,t,n.data.videoResolution,T,C.backgroundBlur,C.backgroundImage).then(function(e){if(C.call.getState()===f.Services.Call.CallStates.ENDING||C.call.getState()===f.Services.Call.CallStates.ENDED)return f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Start call rejected for inactive call"),void e.stream.getTracks().forEach(function(e){e.stop()});var t=e.stream;e.videoResolution&&C._updateVideoResolution(e.videoResolution),f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var i=0;if(t.getTracks().forEach(function(e){var t;"audio"===e.kind?o=new f.Providers.Interfaces.AudioStream(e.id,f.Services.Call.MediaDirection.SEND_RECV):"video"===e.kind&&(t=f.Services.Call.MediaDirection.SEND_RECV,i<h.length&&(t=h[i]._getInternalRequestedDirection(),i++),c.push(new f.Providers.Interfaces.VideoStream(e.id,t)))}),null===o){if(!l)return f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"No microphone is available"),void u.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[C.call,f.Services.Call.CallError.MICROPHONE_NOT_FOUND]);o=new f.Providers.Interfaces.AudioStream("MicrophoneDisabledTrack",f.Services.Call.MediaDirection.SEND_RECV)}var a,r=n.data.nailedUpVideoConnection;if(_&&0===c.length&&r&&(a=u.getActiveCallVideoTrack(),f.Base.Utils.isDefined(a)&&(t.addTrack(a.clone()),c.push(new f.Providers.Interfaces.VideoStream(a.id,h[0]._getInternalRequestedDirection())))),0===c.length)if(_&&!v){e.constraint&&h[0]._setCameraConstraint(e.constraint);e=h[0]._getInternalRequestedDirection();if(e===f.Services.Call.MediaDirection.SEND_RECV)h[0]._setRequestedDirection(f.Services.Call.MediaDirection.RECV_ONLY),f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY"),c.push(new f.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",f.Services.Call.MediaDirection.RECV_ONLY));else if(e===f.Services.Call.MediaDirection.SEND_ONLY)h[0]._setRequestedDirection(f.Services.Call.MediaDirection.INACTIVE),f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE");else{if(!r){f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Failed to get video media streams for call."),C._rtConnection.stopStream(t);var s=new f.Providers.Call.DeviceRetrievalFailedEvent;return void C.handleEvent(s)}u.triggerAllowedNailedUpVideoModes(C.call,[f.Services.Call.VideoMode.RECEIVE_ONLY,f.Services.Call.VideoMode.DISABLE]),C.hasNailedUpConnectionVideoChannel()?(h[0]._setRequestedDirection(f.Services.Call.MediaDirection.DISABLE),h[0]._setInternalRequestedDirection(f.Services.Call.MediaDirection.RECV_ONLY)):h[0]._setRequestedDirection(f.Services.Call.MediaDirection.RECV_ONLY),r._setLogicalDirection(f.Services.Call.MediaDirection.INACTIVE);s=new f.Providers.Interfaces.VideoStream("nailedUpVideo",f.Services.Call.MediaDirection.RECV_ONLY);c.push(s)}r&&r._setRequiredDirection(h[0]._getInternalRequestedDirection())}else v&&c.push(new f.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",f.Services.Call.MediaDirection.RECV_ONLY));r&&0<c.length&&(c[0].logicalDirection=r.getLogicalDirection()),C.setAVStreams(o,c),C.localStream=t,d()},function(e){var t;f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",e),l?(o=new f.Providers.Interfaces.AudioStream("MicrophoneDisabledTrack",f.Services.Call.MediaDirection.SEND_RECV),_&&!v?(t=h[0]._getInternalRequestedDirection())===f.Services.Call.MediaDirection.SEND_RECV?(h[0]._setRequestedDirection(f.Services.Call.MediaDirection.RECV_ONLY),f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Update SEND_RECV video direction to RECV_ONLY"),c.push(new f.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",f.Services.Call.MediaDirection.RECV_ONLY))):t===f.Services.Call.MediaDirection.SEND_ONLY&&(h[0]._setRequestedDirection(f.Services.Call.MediaDirection.INACTIVE),f.Base.Logger.warn(f.Base.LoggerTags.CALL_PROVIDER,"Update SEND_ONLY video direction to INACTIVE")):v&&c.push(new f.Providers.Interfaces.VideoStream("recvOnlyVideoStreamId",f.Services.Call.MediaDirection.RECV_ONLY)),C.setAVStreams(o,c),C.localStream=new MediaStream,d()):(t=new f.Providers.Call.DeviceRetrievalFailedEvent,e.getError&&e.getError()&&(t.data={callError:e.getError()}),C.handleEvent(t))}))):(f.Base.Logger.error(f.Base.LoggerTags.CALL_PROVIDER,"Video only call is not supported"),u.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[C.call,f.Services.Call.CallError.VIDEO_ONLY_CALL_NOT_SUPPORTED])):(C.call._dataOnly=!0,C._isMPaaSCollabCall=C.isMPaaSCall(),f.Base.Logger.info(f.Base.LoggerTags.CALL_PROVIDER,"Starting Collaboration only call"),i=C.call.getCallId(),f.Base.Utils.isUndefined(i)&&(p=C.generateTemporarilyCallId(),u.registerCall(p,C.call,C)),a.startCall(n.data.remoteAddress,C.call.getSubject(),C.call._callCreationInfo,!1,n.data.webCollab,null,null,!1,n.data.uccp,i,C.call._sessionId,T,T,n.data.appType,n.data.appVersion).then(function(e){f.Base.Logger.debug(f.Base.LoggerTags.CALL_PROVIDER,"callGateway startCallResponse: "+JSON.stringify(e));var t=new f.Providers.Call.StartCallResponseEvent;t.data={},t.data.callId=e.callId,C.handleEvent(t)},function(e){e.code===f.Services.Call.CallError.TIMEOUT&&(C.stopAllStreams(),C.call._setState(f.Services.Call.CallStates.FAILED)),u.trigger(f.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,[C.call,e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg])})),{nextState:f.Providers.Call.States.STARTING}}}(AvayaClientServices),function(d){"use strict";d.Providers.Call.StartCallResponseEventInStartingHandler=function(t){var i=t.data.cpCall,a=t.data.callProvider,r=t.data.callId;if(i.callId=r,i._isReadyToReceiveMediaRequest=!0,a.updateCpCall(i,r),i.call.getState()===d.Services.Call.CallStates.ENDING)a.stopCall(i.call);else{a.triggerCallStarted(i.call),d.Base.Utils.isDefined(t.data.clientCpuUsageMgmt)&&a.trigger(d.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[t.data.clientCpuUsageMgmt]),a.getMediaServiceFactory().getAudioInputInterfaceService().replaceLocalMediaStream(r,i.localStream);var e=a.getQueuedCallFailure(r);if(e)i.callFailure(e.errorCode,e.protocolType,e.protocolErrorCode,e.failureReason);else{var s=a.getQueuedCallEstablishedNotification(r);if(s){var n=i.buildCallEstablishedEvent(s.remoteAddress,s.remoteDisplayName,s.audioStream,s.videoStreams,s.isConference,s.uccpUrl,s.webCollabUrl,!1,s.ucid,s.parentUcid,s.contextId);return i.prepareEvent(n),{nextEvent:n}}var o,c=function(){var e=a.getQueuedMediaOfferNotification(r);e&&(d.Base.Utils.isDefined(e.offer)?i.offerSDP(e.offer,e.action,e.audioStream,e.videoStreams,e.videoBandwidth,e.turnData):i.getOfferSDP(e.action,e.audioStream,e.videoStreams,e.videoBandwidth,t.data.audioDevice,t.data.videoDevice,e.turnData,e.restartTurnGathering,e.useIPv6Candidates,e.videoResolutions,e.serverSentResolution))},l=a.getQueuedVideoMuteState(),e=a.getQueuedAudioMuteState(),s=a.getQueuedSpeakerMuteState(),n=[];l&&(l===d.Services.Call.MediaMuteStates.MUTED?o=i.muteVideo():l===d.Services.Call.MediaMuteStates.UNMUTED&&(o=i.unmuteVideo()),n.push(o)),e&&(o=i.muteAudio(),n.push(o)),s&&(o=i.muteSpeaker(),n.push(o)),n.length?n.forEach(function(e){e?e.always(function(){c()}):c()}):c()}}}}(AvayaClientServices),function(l){"use strict";l.Providers.Call.StartContentVideoSharingHandler=function(i){var a,e,t,r=i.data.cpCall,s=[],n=r._callGatewayProvider,o=i.data.callProvider,c=r.getVideoStreams();r.isMPaaSCall()&&0<c.length?((a=c[0].direction===l.Services.Call.MediaDirection.RECV_ONLY)?c[0].direction=l.Services.Call.MediaDirection.SEND_RECV:(r._rtConnection.removeLocalVideoTrack(r.localStream),o.triggerVideoChannelUpdate(r.call)),i.data.stream.getTracks().forEach(function(e){var t;e.kind===l.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK?(r.localStream.getAudioTracks().forEach(function(e){r.setVideoSharingAudioConstraints(e.getConstraints())}),t=r.mixVideoSharingAudio(r.localStream,i.data.stream),s.push(r._rtConnection.replaceLocalMediaTrack(t))):a&&!r.hasVideoTracks()?r._rtConnection.addTrack(e,r.localStream):s.push(r._rtConnection.replaceLocalMediaTrack(e))}),e=function(){r.call._setIsContentVideoSharingStarted(!0),r.resolveMediaTransaction()},t=function(e,t){l.Base.Logger.error(l.Base.LoggerTags.CALL_PROVIDER,t),n.stopVideoSharing(r.callId,r.call._sessionId,c),r.rejectMediaTransaction(new l.Services.Call.CallException(e))},n.startVideoSharing(r.callId,r.call._sessionId,c).then(function(){E.when.apply(this,s).then(function(){a?n.updateVideo(r.call.getCallId(),r.getAudioStream(),c,!1).then(e,function(e){t(l.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+e)}):e()},function(e){n.stopVideoSharing(r.callId,r.call._sessionId,c),t(l.Services.Call.CallError.MEDIA_CREATION_FAILURE,"Failed to replace video sharing track: "+e)})},function(e){t(l.Services.Call.CallError.SEND_ERROR,"Failed to notify server of start video sharing: "+e)})):r.rejectMediaTransaction(new l.Services.Call.CallException(l.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.StartRingingEventInInitialHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.startRinging(t.callId).then(function(){t.setRingingStarted(!0)})}}(),function(o){"use strict";o.Providers.Call.StopContentVideoSharingHandler=function(e){var t,i,a=e.data.cpCall,r=a._callGatewayProvider,s=a.getVideoStreams(),n=a.getVideoSharingAudioConstraints();n&&(a.localStream.getAudioTracks().forEach(function(e){e.applyConstraints(n).catch(function(e){o.Base.Logger.info(o.Base.LoggerTags.CALL_PROVIDER,"Resetting "+n+" constraints rejected: "+e)})}.bind(this)),a.setVideoSharingAudioConstraints(T)),a.isMPaaSCall()&&0<s.length?((t="recvOnlyVideoStreamId"===s[0].id)&&(s[0].direction=o.Services.Call.MediaDirection.RECV_ONLY),i=function(e,t){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,t),r.stopVideoSharing(a.callId,a.call._sessionId,s),a.mediaTransactionDfd.reject(new o.Services.Call.CallException(e))},r.stopVideoSharing(a.callId,a.call._sessionId,a.getVideoStreams()).then(function(){a.call.isAudioMuted()&&(a.localStream.getAudioTracks()[0].enabled=!1),a.stopVideoSharingStream(),a.removeVideoSharingAudioContext(),a.call._setIsContentVideoSharingStarted(!1),t?(a._rtConnection.removeLocalVideoTrack(a.localStream),r.updateVideo(a.call.getCallId(),a.getAudioStream(),s,!1).then(function(){a.mediaTransactionDfd.resolve().promise()},function(e){i(o.Services.Call.CallError.SEND_ERROR,"Failed to notify server of content video track update: "+e)})):a.replaceContentWithVideo()},function(e){i(o.Services.Call.CallError.SEND_ERROR,"Failed to notify server of stop video sharing: "+e)})):a.mediaTransactionDfd.reject(new o.Services.Call.CallException(o.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.TransferEventInActiveHandler=function(e){var t=e.data.cpCall;t._callGatewayProvider.transfer(t.callId,e.data.targetRemoteAddress,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){t._transferPromise.reject(new i.Services.Call.CallException(e.errorCode,e.protocolType,e.protocolErrorCode,e.errorMsg))})}}(AvayaClientServices),function(o){"use strict";o.Providers.Call.UnBlockCameraEventInActiveHandler=function(e){var t,a,i,r=e.data.cpCall,s=r._callGatewayProvider,n=r.localStream.getVideoTracks();return 0<n.length&&!r.hasVideoTrackStopStreaming(n[0])?(r.enableLocalVideoStreams(),r._rtConnection.replaceTransceiverVideoTrackIfNeeded(o.Services.Call.MediaDirection.SEND_RECV),s.blockUnBlockCamera(r.callId,r.getAudioStream(),r.getVideoStreams()).then(function(){},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+e),r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),r.revertFsmState(o.Providers.Call.States.ACTIVE)})):(0<n.length&&r.localStream.removeTrack(n[0]),t=e.data.callProvider,a=r.call.getVideoChannels(),i=o.Base.Utils.isDefined(e.data.videoDevice)?e.data.videoDevice.getDeviceId():T,n=a[0].getChannelId(),r.setVideoChannelId(a[0].getChannelId()),t.getMediaServiceFactory().getMediaServicesService().addVideoTracksToLocalStream(i,n,r.localStream,e.data.videoResolution,r._rtConnection,r.backgroundBlur,r.backgroundImage).then(function(e){o.Base.Logger.debug(o.Base.LoggerTags.CALL_PROVIDER,"getUserMedia success");var t=r.getAudioStream(),i=[];e.getTracks().forEach(function(e){var t;e.kind===o.Providers.Call.CallProvider.Constants.VIDEO_TRACK&&e.readyState===o.Base.AbstractRTCConnectionProvider.Constants.MEDIA_STREAM_TRACK_READY_STATE_LIVE&&(t=o.Services.Call.MediaDirection.SEND_RECV,i.push(new o.Providers.Interfaces.VideoStream(e.id,t)))}),r.setAVStreams(t,i),r.isLocalVideoMuted()?r.muteLocalVideo():r.enableLocalVideoStreams(),s.blockUnBlockCamera(r.callId,r.getAudioStream(),r.getVideoStreams()).then(function(){},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to unblock camera: "+e),r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.SEND_ERROR)),r.revertFsmState(o.Providers.Call.States.ACTIVE)})},function(e){o.Base.Logger.error(o.Base.LoggerTags.CALL_PROVIDER,"Failed to get local media streams for call. ",e);for(var t=r.getVideoStreams(),i=0;i<t.length;i++)t[i].direction=a[i].getNegotiatedDirection();e.getError()===o.Services.Call.CallError.CAMERA_PERMISSION_DENIED||e.getError()===o.Services.Call.CallError.CAMERA_NOT_ACCESSIBLE?(r.rejectMediaTransaction(e),r.revertFsmState(o.Providers.Call.States.ACTIVE)):(r.rejectMediaTransaction(new o.Services.Call.CallException(o.Services.Call.CallError.MEDIA_CREATION_FAILURE)),r.deviceRetrievalFailure(o.Providers.Call.States.ACTIVE))})),{nextState:o.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UnHoldEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;0===(e=t.call.getVideoChannels()).length||e[0]._getInternalRequestedDirection()!==s.Services.Call.MediaDirection.SEND_RECV&&e[0]._getInternalRequestedDirection()!==s.Services.Call.MediaDirection.SEND_ONLY?(t.call.isAudioMuted()||t._rtConnection.enableLocalAudioStreams(),0<e.length&&e[0]._getInternalRequestedDirection()===s.Services.Call.MediaDirection.RECV_ONLY&&t.enableLocalVideoStreams(e[0]._getInternalRequestedDirection())):(t.call.isAudioMuted()||t._rtConnection.enableLocalAudioStreams(),t.enableLocalVideoStreams());var e=t.getAudioStream(),a=t.getVideoStreams();e.direction=s.Services.Call.MediaDirection.SEND_RECV,t.isNailedUpVideoConnectionSupported()&&(e.logicalDirection=s.Services.Call.MediaDirection.SEND_RECV);for(var r=0;r<a.length;r++)t.isNailedUpVideoConnectionSupported()?(a[r].direction=s.Services.Call.MediaDirection.SEND_RECV,a[r].logicalDirection=t._latestNonHoldingVideoDirection):a[r].direction=t._latestNonHoldingVideoDirection;return t.setAVStreams(e,a),i.unholdCall(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to unhold: "+e),t.rejectMediaTransaction(new s.Services.Call.CallException(s.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(s.Providers.Call.States.ACTIVE)}),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.UnmuteAudioEventInMultipleHandler=function(e){var t=e.data.cpCall;t.localStream&&(t.call._getIsContentVideoSharingStarted()?t.updateVideoSharingMicrophoneVolume(1):(i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Unmute tracks: ",t.localStream.getTracks()),t._rtConnection.hasMediaTrack(i.Base.AbstractRTCConnectionProvider.Constants.AUDIO_TRACK,t.localStream)?t._replaceAudioTrackIfNeeded(!0).always(function(){t._rtConnection.enableLocalAudioStreams(),e.data.callProvider.trigger(i.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[t.call,t.localStream])}):t.call.isMicrophoneDisabled()?i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Unmute audio will be delayed until microphone is enabled."):i.Base.Logger.error(i.Base.LoggerTags.CALL_PROVIDER,"Failed to unmute audio due to missing audio track.")))}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Call.UnmuteSpeakerEventInMultipleHandler=function(e){var t=e.data.cpCall,e=e.data.callProvider;t.remoteStream&&e.getMediaServiceFactory().getAudioOutputInterfaceService().getAudioOutput().unmuteStream(t.remoteStream)}}(),function(r){"use strict";r.Providers.Call.UnmuteVideoEventInMultipleHandler=function(e){function t(e){var t,i=r.Providers.Call.CPUtils.getEffectiveSendResolution(a);i?-1!==(t=a.needUnmuteSendResolutionDelay())?(a.setVideoSendResolutionDelayed(i,!1,t),e&&a.anyMediaTransactionDfd.resolve()):a.setVideoSendResolution(i,!1).always(function(){e&&a.anyMediaTransactionDfd.resolve()}):e&&a.anyMediaTransactionDfd.resolve()}var a=e.data.cpCall,i=a._callGatewayProvider;if(!e.data.sendNotificationOnly||!a.isMPaaSCall())return a.unmuteLocalVideo().then(function(){a.isMPaaSCall()?a.hasReceivedCallEstablishedEvent()?i.unmuteVideo(a.callId,a.call._sessionId,a.getVideoStreams()).then(function(){a._unmuteVideoRenogatiationNeeded?a._callGatewayProvider.updateVideo(a.callId,a.getAudioStream(),a.getVideoStreams()).then(function(){a._unmuteVideoRenogatiationNeeded=!1,a.revertFsmState(r.Providers.Call.States.ACTIVE_RENEGOTIATE),t(!1)},function(e){r.Base.Logger.error("Failed to update video: ",e),a.muteLocalVideo(),a.rejectMediaTransaction(new r.Services.Call.CallException(r.Services.Call.CallError.SEND_ERROR))}):t(!0)},function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+e),a.muteLocalVideo(),a.anyMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.SEND_ERROR))}):(a.queueMuteUnumteFunctor(function(){i.unmuteVideo(a.callId,a.call._sessionId,a.getVideoStreams()).fail(function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+e)})}),a.anyMediaTransactionDfd.resolve()):t(!0)},function(e){a.anyMediaTransactionDfd.reject(e)});i.unmuteVideo(a.callId,a.call._sessionId,a.getVideoStreams()).then(function(){a.anyMediaTransactionDfd.resolve()},function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to notify server of local video unmute state: "+e),a.anyMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.SEND_ERROR))})}}(AvayaClientServices),function(i){"use strict";i.Providers.Call.UpdateContentVideoSharingAudioEventInActiveHandler=function(e){var t=e.data.cpCall;t.isMPaaSCall()?e.data.fromMicrophone?t.localStream.getAudioTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e).then(function(){i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Updated content video sharing audio from microphone"),t.mediaTransactionDfd.resolve()},function(e){t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.MEDIA_CREATION_FAILURE,i.Services.Call.CallProtocolType.APPLICATION,500,e))})}):e.data.stream.getAudioTracks().forEach(function(e){t._rtConnection.replaceLocalMediaTrack(e).then(function(){i.Base.Logger.info(i.Base.LoggerTags.CALL_PROVIDER,"Reverted content video sharing audio"),t.mediaTransactionDfd.resolve()},function(e){t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.MEDIA_CREATION_FAILURE,i.Services.Call.CallProtocolType.APPLICATION,500,e))})}):t.mediaTransactionDfd.reject(new i.Services.Call.CallException(i.Services.Call.CallError.CAPABILITY_NOT_ALLOWED))}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UpdateIceRestartMediaEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;if(t.isCallServiceAvailable()){t.setIceRestartInProgress(!0),s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var a="all"===t._rtcConfiguration.iceTransportPolicy,r=!!t._rtcConfiguration.iceServers&&0<t._rtcConfiguration.iceServers.length&&!!t._rtcConfiguration.iceServers[0].urls&&0<t._rtcConfiguration.iceServers[0].urls.length,e=t._rtcConfiguration._turnOfferType===s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return a&&r&&e&&1<t.getIceRestartAttemtps()&&(s.Base.Logger.info("Initiating ICE restart with relay only"),t.setIceRestartRelayType(s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),t._replaceAudioTrackIfNeeded().always(function(){i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams(),!0).then(function(){},function(e){t.setIceRestartInProgress(!1),t.revertFsmState(s.Providers.Call.States.ACTIVE),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+e)})}.bind(this)),{nextState:s.Providers.Call.States.ACTIVE_RENEGOTIATE}}t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(s){"use strict";s.Providers.Call.UpdateIceRestartMediaEventInMultipleHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;if(t.isCallServiceAvailable()){t.setIceRestartInProgress(!0),s.Base.Logger.info(s.Base.LoggerTags.CALL_PROVIDER,"Initiating ICE restart request");var a="all"===t._rtcConfiguration.iceTransportPolicy,r=!!t._rtcConfiguration.iceServers&&0<t._rtcConfiguration.iceServers.length&&!!t._rtcConfiguration.iceServers[0].urls&&0<t._rtcConfiguration.iceServers[0].urls.length,e=t._rtcConfiguration._turnOfferType===s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_HOST_ONLY;return a&&r&&e&&(!t._hadMediaConnected||1<t.getIceRestartAttemtps())&&(s.Base.Logger.info("Initiating ICE restart with relay only"),t.setIceRestartRelayType(s.Providers.Call.CallProvider.Constants.ICE_CANDIDATE_TYPE_RELAY_ONLY)),t._replaceAudioTrackIfNeeded().always(function(){i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams(),!0).then(function(){},function(e){t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Failed to update ice media: "+e)})}.bind(this)),{nextState:s.Providers.Call.States.MEDIA_RECOVERY}}t.setIceRestartInProgress(!1),s.Base.Logger.error(s.Base.LoggerTags.CALL_PROVIDER,"Will initiate ICE restart request once call service is available")}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateLocalStreamHandler=function(e){function t(){a.Base.Logger.debug("Sending UPDATE_VIDEO request for new local stream"),i._callGatewayProvider.updateVideo(i.callId,i.getAudioStream(),i.getVideoStreams()).then(function(){e.data.selectedDevice&&e.data.selectedDevice._kind===a.Base.MediaTypes.AUDIO_INPUT&&e.data.callProvider.trigger(a.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,[i.call,i.localStream])},function(e){a.Base.Logger.error("Failed to update local stream: ",e),i.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),i.revertFsmState(a.Providers.Call.States.ACTIVE)})}var i=e.data.cpCall;if(null!==i.localStream)return a.Providers.Call.CPUtils.createLocalMediaStream(e.data.audioDevice,e.data.videoDevice,i,e.data.callProvider.getMediaServiceFactory(),e.data.videoResolution,t,function(){a.Base.Logger.error("Create local media error: "+i.getVideoResolution()),i.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.MEDIA_CREATION_FAILURE)),i.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE};t()}}(AvayaClientServices),function(r){"use strict";r.Providers.Call.UpdatePreferredReceiveResolutionEventInMultipleHandler=function(e){var t,i=e.data.cpCall,a=i._callGatewayProvider;i.hasReceivedCallEstablishedEvent()?(t=(t=r.Base.VideoResolution[e.data.videoResolution]).getWidth()+"x"+t.getHeight(),a.updatePreferredReceiveResolution(i.callId,i.call._sessionId,i.getVideoStreams(),t).then(function(){i.call.getVideoChannels()[0]._preferredReceiveResolution=e.data.videoResolution,i.noMediaTransactionDfd.resolve()},function(e){r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution: "+e),i.noMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.SEND_ERROR))})):(r.Base.Logger.error(r.Base.LoggerTags.CALL_PROVIDER,"Failed to update preferred resolution due to invalid state ",i.call.getState()),i.noMediaTransactionDfd.reject(new r.Services.Call.CallException(r.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))}}(AvayaClientServices),function(a){"use strict";a.Providers.Call.UpdateRemoteVideoEventInActiveHandler=function(e){var t=e.data.cpCall,i=t._callGatewayProvider;return 0!==(e=t.getVideoStreams()).length&&e[0].enabled&&t._rtConnection.setLocalVideoDirection(e[0].direction),i.updateVideo(t.callId,t.getAudioStream(),t.getVideoStreams()).then(function(){},function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_PROVIDER,"Failed to update remote video: "+e),t.rejectMediaTransaction(new a.Services.Call.CallException(a.Services.Call.CallError.SEND_ERROR)),t.revertFsmState(a.Providers.Call.States.ACTIVE)}),{nextState:a.Providers.Call.States.ACTIVE_RENEGOTIATE}}}(AvayaClientServices),function(t){"use strict";function e(e,t,i){this._verifySupportedLogicalDirection(e),this._verifySupportedGuidelinesDirection(t),this._verifySupportedGuidelinesDirection(i),this._logicalDirection=e,this._requiredDirection=t,this._permittedDirection=i}e.prototype={getLogicalDirection:function(){return this._logicalDirection},getRequiredDirection:function(){return this._requiredDirection},getPermittedDirection:function(){return this._permittedDirection},_setLogicalDirection:function(e){this._verifySupportedLogicalDirection(e),this._logicalDirection=e},_setRequiredDirection:function(e){this._verifySupportedGuidelinesDirection(e),this._requiredDirection=e},_setPermittedDirection:function(e){this._verifySupportedGuidelinesDirection(e),this._permittedDirection=e},_verifySupportedLogicalDirection:function(e){if(e===t.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported logical video direction: "+e)},_verifySupportedGuidelinesDirection:function(e){if(e&&e===t.Services.Call.MediaDirection.SEND_ONLY||e===t.Services.Call.MediaDirection.DISABLE)throw new Error("Unsupported video guidelines direction: "+e)}},t.Providers.Call.NailedUpVideoConnectionInfo=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Base.Observable.call(this),this._networkProvider=e,this._config={},this._notificationProvider=t,this._notificationParser=i}(e.prototype=Object.create(a.Base.Observable.prototype)).init=function(e){return this._config=e,this._networkProvider.onMessage=function(e){},this._networkProvider.onError=function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_GATEWAY_PROVIDER,e)},this._networkProvider.init(this._config),this._notificationProvider.onMessage=function(t){var e,i,t=t.data&&t.type!==a.Base.ProvidersEventTypes.PING?JSON.parse(t.data):t;try{e=JSON.parse(t.message),i=(i=this._notificationParser.parse(e))||e}catch(e){i=t}i.type?this.trigger("call."+i.type,[i]):this.trigger("call.message",[i])}.bind(this),this._notificationProvider.onError=function(e){a.Base.Logger.error(a.Base.LoggerTags.CALL_GATEWAY_PROVIDER,e)},this._notificationProvider.init(this._config),this},e.prototype.startCall=function(e){e=JSON.stringify({remoteAddress:e});return this._networkProvider.send(e,{sendType:"POST",urlSuffix:"/restgateway/calls",dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return new a.Providers.CallGateway.StartCallData(e.callHref,e.callId)})},e.prototype.endCall=function(e){return this._networkProvider.send(null,{sendType:"DELETE",urlSuffix:"/restgateway/calls/"+e,dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json"}})},e.prototype.acceptCall=function(e,t){return this._networkProvider.send(null,{sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t,dataType:"json",headers:{Accept:"application/json","Content-Type":"application/json;"}})},e.prototype.holdCall=function(e,t){return this._networkProvider.send(null,{sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t+"/hold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}})},e.prototype.unholdCall=function(e,t){return this._networkProvider.send(null,{sendType:"POST",urlSuffix:"/restgateway/calls/"+e+"/connections/"+t+"/unhold",dataType:"text",headers:{Accept:"application/json","Content-Type":"application/json;"}})},a.Providers.CallGateway.CallGatewayProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallGateway.ActiveCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="active",this.callEvent="ACTIVE",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AlertingCallMessage=function(e,t,i,a,r,s,n,o,c,l,d){this.type="alerting",this.callEvent="ALERTING",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l,this.alertingParticipant=d}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.AnsweredCallMessage=function(e,t,i,a,r,s,n,o,c,l,d){this.type="answered",this.callEvent="ANSWERED",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l,this.answeringParticipant=d}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.FailedCallMessage=function(e,t,i,a,r,s,n,o){this.type="failed",this.callEvent="FAILED",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.address=n,this.reason=o}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.HeldCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="held",this.callEvent="HELD",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.ParticipantDroppedCallMessage=function(e,t,i,a,r){this.type="participantDropped",this.callEvent="PARTICIPANTDROPPED",this.participants=e,this.callId=t,this.callHref=i,this.address=a,this.droppingParticipant=r}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.StartCallData=function(e,t){this.callId=t,this.callHref=e}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.SubscriptionCallMessage=function(e,t,i){this.type="subscription",this.callEvent="SUBSCRIPTION",this.status=e,this.subscriptionId=t,this.additionalProperties=i}}(),function(){"use strict";AvayaClientServices.Providers.CallGateway.UnheldCallMessage=function(e,t,i,a,r,s,n,o,c,l){this.type="unheld",this.callEvent="UNHELD",this.originalCallingParticipant=e,this.originalCalledParticipant=t,this.participants=i,this.callId=a,this.ucId=r,this.callHref=s,this.connectionId=n,this.connectionHref=o,this.address=c,this.operations=l}}(),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")}},e.Providers.CallGateway.AbstractParser=t}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.ActiveCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.ActiveCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.AlertingCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations,e.alertingParticipant)},t.Providers.CallGateway.AlertingCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.AnsweredCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations,e.answeringParticipant)},t.Providers.CallGateway.AnsweredCallMessageParser=e}(AvayaClientServices),function(i){"use strict";function e(){this._parsers=[]}e.prototype={register:function(e,t){this._parsers[e]=t},unregister:function(e){this._parsers[e]=T},parse:function(e){return e.callEvent?this._delegateParser(e.callEvent,e):e.subscriptionId?this._delegateParser("subscription",e):e},_delegateParser:function(e,t){if(this._parsers[e]!==T)return this._parsers[e].parse(t);i.Base.Logger.error(i.Base.LoggerTags.CALL_GATEWAY_PROVIDER,"No parser specified!",e)}},i.Providers.CallGateway.CallNotificationParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.FailedCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.address,e.reason)},t.Providers.CallGateway.FailedCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.HeldCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.HeldCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.ParticipantDroppedCallMessage(e.participants,e.callId,e.callHref,e.address,e.droppingParticipant)},t.Providers.CallGateway.ParticipantDroppedCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.SubscriptionCallMessage(e.status,e.subscriptionId,e.additionalProperties)},t.Providers.CallGateway.SubscriptionCallMessageParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.CallGateway.AbstractParser.prototype)).parse=function(e){return new t.Providers.CallGateway.UnheldCallMessage(e.originalCallingParticipant,e.originalCalledParticipant,e.participants,e.callId,e.ucId,e.callHref,e.connectionId,e.connectionHref,e.address,e.operations)},t.Providers.CallGateway.UnheldCallMessageParser=e}(AvayaClientServices),function(o){"use strict";function e(){this._csgCallsProviderMap={},this._csgProviderMap={},this._csgPresenceProvider=T,this._messageBuilder=new o.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder}e.prototype={getCSGCallsProvider:function(e,t,i){return this._csgCallsProviderMap.hasOwnProperty(e)||(this._csgCallsProviderMap[e]=new o.Providers.CallServiceGateway.CSGCallsProvider(this._getCSGProvider(e,t,i),this._messageBuilder,e)),this._csgCallsProviderMap[e]},getCSGCallsProviderAsArray:function(){var e,t=[];for(e in this._csgCallsProviderMap)this._csgCallsProviderMap.hasOwnProperty(e)&&t.push(this._csgCallsProviderMap[e]);return t},getCSGPresenceProvider:function(e){return this._csgPresenceProvider||(this._csgPresenceProvider=new o.Providers.CallServiceGateway.CSGPresenceProvider(this._getCSGProvider(e),this._messageBuilder)),this._csgPresenceProvider},_getCSGProvider:function(e,t,i){var a,r,s,n;return this._csgProviderMap.hasOwnProperty(e)||(s=[o.Providers.CallServiceGateway.CSGNotificationEventType.CAS_NOTIFICATION,o.Providers.CallServiceGateway.CSGNotificationEventType.PING],r=new o.Base.SSEProvider(s),a=new o.Base.RESTProvider,n=new o.Base.SSEIntegrationProvider(a,r),s=new o.Base.WebSocketProvider,a=new o.Base.NetworkProvider(s,n,o.Base.LoggerTags.CALL_GATEWAY_PROVIDER),r=new o.Base.NetworkProvider(new o.Base.RESTProvider,T,o.Base.LoggerTags.CALL_GATEWAY_PROVIDER),s=new o.Base.PollingRESTProvider,n=new o.Base.PollingRESTProvider,t&&t.userAgentWSSURL&&t.userAgentNotifyURL?this._csgProviderMap[e]=new o.Providers.CallServiceGateway.WSCSGProvider(this._messageBuilder,r,a,s,n,t,i):this._csgProviderMap[e]=new o.Providers.CallServiceGateway.CSGProvider(this._messageBuilder,r,a,s,n)),this._csgProviderMap[e]}},o.Providers.CallServiceGateway.CallServiceGatewayProviderFactory=e}(AvayaClientServices),function(c){"use strict";var a="://";function e(){this._requestCounter=0}e.prototype={buildStartCallOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:c.Providers.CallServiceGateway.MediaType.CSA_CALL,"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_CALL_PREFERENCE}}},buildActivateServiceOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:c.Providers.CallServiceGateway.MediaType.CSA_SERVICES,"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_SERVICES}}},buildActivateServiceData:function(e,t){e={action:c.Providers.CallServiceGateway.CallActionType.ACTIVATE,service:e,extendedData:{mode:c.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:c.Providers.CallServiceGateway.Constants.WEBRTC,register:t.isRegisterUser()}};return t.getMinBandwidth()&&(e.extendedData.videoBandwidth=t.getMinBandwidth()),t.getVideoChannelGuidelines()&&(t=t.getVideoChannelGuidelines(),e.extendedData.videoChannelGuidelines={},t.requiredDirection&&(e.extendedData.videoChannelGuidelines.requiredClientLegDirections=c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(t.requiredDirection)),t.permittedDirection&&(e.extendedData.videoChannelGuidelines.permittedLogicalDirections=c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(t.permittedDirection)),e.extendedData.audioChannelGuidelines={requiredClientLegDirections:c.Providers.CallServiceGateway.Utils.convertToChannelGuideLine(c.Services.Call.MediaDirection.SEND_RECV)}),e},buildDeactivateServiceOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,crossDomain:!0,headers:{Accept:c.Providers.CallServiceGateway.MediaType.CSA_SERVICES,"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_SERVICES}}},buildDeactivateServiceData:function(e){return{action:c.Providers.CallServiceGateway.CallActionType.DEACTIVATE,service:e,extendedData:{mode:c.Providers.CallServiceGateway.Constants.COMPUTER,mediaServiceType:c.Providers.CallServiceGateway.Constants.WEBRTC,recoveryToken:null,register:!1}}},buildResourceDiscoveryOptions:function(e){return{urlSuffix:e||c.Providers.CallServiceGateway.Constants.CSA_RESOURCES_PATH,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_RESOURCES,c.Providers.CallServiceGateway.MediaType.CSA_RESOURCES,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildDiscoveryResourcesv2Options:function(e){return{urlSuffix:e||c.Providers.CallServiceGateway.Constants.CSA_RESOURCES_PATH,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_NOTIFICATION_RESOURCES,c.Providers.CallServiceGateway.MediaType.CSA_RESOURCES,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildResourceDiscoveryData:function(e){var t={};return e&&(t.existingclientid=e),t},buildUpdateCallOptions:function(e,t){var i,e=c.Base.Utils.parseUrl(e);return e&&(i=e.protocol+a+e.host,i={urlSuffix:(e.path||"")+"/"+t,url:i,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,crossDomain:!0,headers:{"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_CALL_ACTION}}),i},buildGetCallsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_CALLS,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildGetCallOptions:function(e,t){var i=c.Base.Utils.parseUrl(e),e=i.protocol+a+i.host;return{urlSuffix:i.path||"",url:e+"/"+t,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_CALL,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildGetClientsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_CLIENTS,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildGetClientOptions:function(e,t){var i=c.Base.Utils.parseUrl(e),e=i.protocol+a+i.host;return{urlSuffix:i.path||"",url:e+"/"+t,sendType:c.Providers.CallServiceGateway.Constants.HTTP_GET,dataType:c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE,crossDomain:!0,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_CLIENT,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildKeepAliveOptions:function(e){var t={crossDomain:!0};return c.Base.Utils.isUndefined(e)||(c.Base.Utils.isDefined(e.credentialProvider)&&"string"==typeof e.credentialProvider.username&&"string"==typeof e.credentialProvider.password?t.authentication={type:c.Config.Authentication.Scheme.BASIC,username:e.credentialProvider.username,password:e.credentialProvider.password}:c.Base.Utils.isDefined(e.credentialProvider)&&"string"==typeof e.credentialProvider.token&&(t.authentication={type:c.Config.Authentication.Scheme.BEARER,bearer:e.credentialProvider.bearer,token:e.credentialProvider.token})),t},buildDeleteSessionOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_DELETE,crossDomain:!0}},buildSubscribeRequest:function(e,t){return{subscribe:{requestId:this._generateRequestId(),resources:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:e,resource:t}],version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildUnsubscribeRequest:function(e,t){return{unsubscribe:{requestId:this._generateRequestId(),resources:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:e,resource:t}],version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1}}},buildSubscribeGenericEventsOptions:function(e){return this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_POST,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildUnsubscribeGenericEventsOptions:function(e,t){e=this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_DELETE,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE);return e.urlSuffix=e.urlSuffix+"?sessionId="+t,e},buildUpdateGenericEventsOptions:function(e){return this._generateGenericEventsOptions(e,c.Providers.CallServiceGateway.Constants.HTTP_PUT,c.Providers.CallServiceGateway.Constants.CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS,c.Providers.CallServiceGateway.Constants.JSON_DATA_TYPE)},buildNotificationsOptions:function(){return{dataType:"JSON",headers:{"Content-Type":"application/json"}}},buildCreateCallNotification:function(e,t){t={subject:t.subject,sessionId:t.sessionId,audioChannel:t.audioChannel,videoChannels:t.videoChannels,conferenceData:t.conferenceData,highProfileSupported:t.highProfileSupported,clientType:t.clientType,clientVersion:t.clientVersion};return{notify:{requestId:this._generateRequestId("CC"),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{messageType:c.Providers.CallServiceGateway.Constants.CREATE_CALL,messageDataType:c.Providers.CallServiceGateway.MediaType.CSA_CALL_PREFERENCE,messageData:JSON.stringify(t)}}]}}},buildProcessMediaOfferResponseNotification:function(e,t,i,a,r,s,n){n={action:i,actionDetails:{targetCallId:null,participants:null,sdpType:a.toUpperCase(),sdp:r,audioChannel:c.Base.Utils.isDefined(s)?s:null,videoChannels:c.Base.Utils.isDefined(n)?n:null,conferenceData:null}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:c.Providers.CallServiceGateway.MediaType.CSA_CALL_ACTION,messageData:JSON.stringify(n)}}]}}},buildRejectOfferResponseNotification:function(e,t,i,a,r){r={error:[{errorCode:i,errorMsg:a,displayMsg:r}]};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:c.Providers.CallServiceGateway.MediaType.CSA_ERROR,messageData:JSON.stringify(r)}}]}}},buildProcessMediaAnswerResponseNotification:function(e,t,i,a){return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreateMediaResponseNotification:function(e,t,i,a,r,s,n){s={action:null,actionDetails:{targetCallId:null,participants:n||null,sdpType:i.toUpperCase(),sdp:a,audioChannel:c.Base.Utils.isDefined(r)?r:null,videoChannels:c.Base.Utils.isDefined(s)?s:null,conferenceData:null}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.CREATE_MEDIA_RESPONSE,messageDataType:c.Providers.CallServiceGateway.MediaType.CSA_CALL_ACTION,messageData:JSON.stringify(s)}}]}}},buildUpdateMediaRequestNotification:function(e,t,i,a,r,s){s=!!s,s={action:i,actionDetails:{targetCallId:null,participants:null,sdpType:null,sdp:null,audioChannel:c.Base.Utils.isDefined(a)?a:null,videoChannels:c.Base.Utils.isDefined(r)?r:null,conferenceData:null,forceIceRestart:s}};return{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.PROCESS_MEDIA_REQUEST,messageDataType:c.Providers.CallServiceGateway.MediaType.CSA_CALL_ACTION,messageData:JSON.stringify(s)}}]}}},buildGetConfigurationOptions:function(e){return{url:e,sendType:"GET",dataType:"JSON",headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_CONFIGURATION,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", ")}}},buildAcceptCallResponse:function(e,t,i){return{notify:{requestId:c.Base.Utils.isDefined(i)&&null!==i?i:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.ACCEPT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildRejectCallResponse:function(e,t,i){return{notify:{requestId:c.Base.Utils.isDefined(i)&&null!==i?i:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.REJECT_CALL_RESPONSE,messageDataType:null,messageData:null}}]}}},buildCreatePubSubContainerOptions:function(e){return{url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_POST,dataType:c.Providers.CallServiceGateway.Constants.TEXT_DATA_TYPE,headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_CONTAINER,c.Providers.CallServiceGateway.MediaType.CSA_ERROR].join(", "),"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_CONTAINER}}},buildDeletePubSubContainerOptions:function(e){return{url:e,sendType:c.Providers.CallServiceGateway.Constants.HTTP_DELETE,headers:{Accept:c.Providers.CallServiceGateway.MediaType.CSA_ERROR}}},buildCreateOrExtendPubSubContainerData:function(e,t,i){if(!e||t||i)return JSON.stringify({pubSubContainer:{additionalResources:{presencePublication:t?{}:T,presenceSubscriptions:i?[{}]:T}}})},buildPublishPresenceOptions:function(e){return{url:e,sendType:"PUT",headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_ERROR,c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_PUBLICATION].join(", "),"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_PUBLICATION}}},buildDeleteManualPresenceOptions:function(e){return{url:e,sendType:"DELETE",headers:{Accept:c.Providers.CallServiceGateway.MediaType.CSA_ERROR}}},buildPublishManualPresenceData:function(e,t){var i={presencePublication:{}};return e===c.Providers.CallServiceGateway.Constants.MANUAL_STATE?i.presencePublication.manualState={stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(t)}:e===c.Providers.CallServiceGateway.Constants.MODE?i.presencePublication.mode={modeEnum:c.Providers.CallServiceGateway.Utils.convertPresenceModeToCSGPresenceMode(t)}:e===c.Providers.CallServiceGateway.Constants.NOTE&&(i.presencePublication.note={content:t}),JSON.stringify(i)},buildPublishAutoPresenceData:function(e){var t=[],i=e.getEnterpriseIMState(),a=e.getEnterpriseIMContact(),r=e.getVideoState(),s=e.getVideoContact(),n=e.getPhoneState(),o=e.getPhoneContact(),e=c.Services.Presence.PresenceState;return r&&r!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"video",contact:s,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(r),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),i&&i!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"im",contact:a,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(i),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),n&&n!==e.PRESENCE_STATE_UNSPECIFIED&&t.push({channel:"phone",contact:o,stateEnum:c.Providers.CallServiceGateway.Utils.convertPresenceStateToCSGPresenceState(n),subType:c.Providers.CallServiceGateway.Constants.AVAYA_COMMUNICATOR}),JSON.stringify({presencePublication:{channelPresence:t}})},buildPresenceSubscriptionData:function(e,t){var i=[];return t.forEach(function(e){i.push({userIdentity:{userId:e}})}),JSON.stringify({resourceList:{listDefaults:{action:e,aclConfirmHandling:"prompt",docType:"full"},presentities:i}})},buildPresenceSubscriptionOptions:function(e){return{url:e,sendType:"POST",dataType:"JSON",headers:{Accept:[c.Providers.CallServiceGateway.MediaType.CSA_ERROR,c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_RESOURCE_LIST].join(", "),"Content-Type":c.Providers.CallServiceGateway.MediaType.CSA_PRESENCE_RESOURCE_LIST}}},buildUpdateCallPropertiesNotification:function(e,t,i,a,r){i={sessionId:i,videoChannels:c.Base.Utils.isDefined(a)?a:null};return a&&0!==a.length&&(c.Base.Utils.isDefined(r.localVideoMute)?i.videoChannels[0].localVideoMute=r.localVideoMute:i.videoChannels[0].localVideoMute=null,c.Base.Utils.isDefined(r.preferredReceiveResolution)?i.videoChannels[0].preferredReceiveResolution=r.preferredReceiveResolution:i.videoChannels[0].preferredReceiveResolution=null,c.Base.Utils.isDefined(r.screenSharing)?i.videoChannels[0].screenSharing=r.screenSharing:i.videoChannels[0].screenSharing=null,i.videoChannels[0].maxFrames=null,i.videoChannels[0].bandwidth=null),{notify:{requestId:this._generateRequestId(t),notifications:[{application:c.Providers.CallServiceGateway.Constants.CSA_APPLICATION,service:c.Providers.CallServiceGateway.Constants.TELEPHONY_SERVICE,version:c.Providers.CallServiceGateway.Constants.CSA_VERSION_1,resource:e,contents:{callId:t,messageType:c.Providers.CallServiceGateway.Constants.UPDATE_CALL_PROPERTIES,messageDataType:c.Providers.CallServiceGateway.MediaType.MPAAS_CALL_PROPERTIES,messageData:JSON.stringify(i)}}]}}},_generateRequestId:function(e){return e?"jscsdk."+e+".req-"+this._requestCounter++:"jscsdk.null.req-"+this._requestCounter++},_isFirefoxBrowser:function(){return c.Base.Utils.getBrowserType()===c.Base.BrowserType.FIREFOX},_generateCommonGenericEventsOptions:function(e){var t=c.Base.Utils.parseUrl(e),e=t.protocol+a+t.host;return{urlSuffix:t.path||"",url:e,sendType:T,dataType:T,headers:T,crossDomain:!0}},_generateGenericEventsOptions:function(e,t,i,a){e=this._generateCommonGenericEventsOptions(e);return e.dataType=a,e.sendType=t,e.headers={"Content-type":i},e}},c.Providers.CallServiceGateway.CallServiceGatewayProviderMessageBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGNotificationEventType={CAS_NOTIFICATION:"CASNotification",PING:"Ping"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CSGToneType={RINGBACK:"ringback",INTERCEPT:"intercept",REORDER:"reorder",FASTBUSY:"fastBusy"}}(),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallActionType={ACCEPT_AUDIO:"ACCEPT_AUDIO",ACCEPT_VIDEO:"ACCEPT_VIDEO",ACTIVATE:"ACTIVATE",ADD_PARTICIPANT:"ADD_PARTICIPANT",ADD_VIDEO:"ADD_VIDEO",ANSWER:"ANSWER",DEACTIVATE:"DEACTIVATE",DENY_AUDIO:"DENY_AUDIO",DENY_VIDEO:"DENY_VIDEO",END:"END",HOLD:"HOLD",INCOMING_ADD_VIDEO:"INCOMING_ADD_VIDEO",JOIN:"JOIN",MUTE_VIDEO:"MUTE_VIDEO",UNMUTE_VIDEO:"UNMUTE_VIDEO",REMOVE_VIDEO:"REMOVE_VIDEO",REMOTE_VIDEO_REMOVED_ACK:"REMOTE_VIDEO_REMOVED_ACK",RINGING:"RINGING",TRANSFER:"TRANSFER",UNHOLD:"UNHOLD",UPDATE_VIDEO:"UPDATE_VIDEO"}}(),function(e){"use strict";e.Providers.CallServiceGateway.Constants={TELEPHONY_SERVICE:"telephony",CSA_APPLICATION:"CSA",CREATE_MEDIA_RESPONSE:"createMediaResponse",PROCESS_MEDIA_REQUEST:"processMediaRequest",PROCESS_MEDIA_RESPONSE:"processMediaResponse",ACCEPT_CALL_RESPONSE:"acceptCallResponse",REJECT_CALL_RESPONSE:"rejectCallResponse",UPDATE_CALL_PROPERTIES:"updatecallproperties",MUTE_VIDEO:"muteVideo",UNMUTE_VIDEO:"unmuteVideo",HTTP:"HTTP",HTTP_POST:"POST",HTTP_GET:"GET",HTTP_DELETE:"DELETE",HTTP_PUT:"PUT",HTTP_BAD_REQUEST:400,JSON_DATA_TYPE:"json",TEXT_DATA_TYPE:"text",CSA_RESOURCES_PATH:"/csa/resources/tenants/default",CSA_VERSION_1:"1",CSA_VERSION_2:"2",COMPUTER:"COMPUTER",CALLS:"CALLS",PRESENCE:"PRESENCE",WEBRTC:"WEBRTC",STANDARD:"STANDARD",SEND:"SEND",RECEIVE:"RECEIVE",SEND_ONLY:"SEND_ONLY",RECV_ONLY:"RECEIVE_ONLY",SEND_RECV:"SEND_RECEIVE",INACTIVE:"INACTIVE",ENABLE:"ENABLE",DISABLE:"DISABLE",SDP_TYPE_ANSWER:"answer",SDP_TYPE_OFFER:"offer",ACTIVATED:"activated",CREATE_CALL:"createCall",APP_TYPE_JSCSDK:"JSCSDK",APP_VERSION_PLACEHOLDER:"4.9.0.44",CALL_STATE_FAILURE_ERROR_CODE:4220072,CALL_DOES_NOT_EXISTS:4040009,SEE_OTHER_RESOURCE:303e4,SVC_PRESENCE:"presence",MANUAL_STATE:"manualState",STATE:"state",MODE:"mode",NOTE:"note",SUBSCRIPTION_ADD:"add",SUBSCRIPTION_REMOVE:"remove",STATUS_ACTIVE:"active",AVAYA_COMMUNICATOR:"AVAYA_COMMUNICATOR",RESOURCE_DISCOVERY_USERNAME_MISMATCH:"Mismatch username",RESOURCES_DISCOVERY:"resourcesDiscovery",MWI_ON:"ON",MWI_OFF:"OFF",CLIENT_SESSION_EXPIRED:"CLIENT_SESSION_EXPIRED",DEACTIVATED_BY_CLIENT:"DEACTIVATED_BY_CLIENT",GUEST_SESSION_EXPIRED:"GUEST_SESSION_EXPIRED",PERMANENT_REGISTRATION_FAILURE:"PERMANENT_REGISTRATION_FAILURE",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",USER_DOES_NOT_MATCH:"USER_DOES_NOT_MATCH",TEMPORARY_REGISTRATION_FAILURE:"TEMPORARY_REGISTRATION_FAILURE",CONTENT_TYPE_SUBSCRIBE_GENERIC_EVENTS:"application/vnd.avaya.mpaas.eventsubscription+json",CONTENT_TYPE_UNSUBSCRIBE_GENERIC_EVENTS:"application/json"},e.Providers.CallServiceGateway.MediaType={CSA_RESOURCES:"application/vnd.avaya.csa.resources.v1+json",CSA_RESOURCES_V2:"application/vnd.avaya.csa.resources.v2+json",CSA_NOTIFICATION_RESOURCES:"application/vnd.avaya.csa.notification.resources.v1+json",CSA_SERVICES:"application/vnd.avaya.csa.services.v1+json",CSA_ERROR:"application/vnd.avaya.csa.error.v1+json",CSA_CONFIGURATION:"application/vnd.avaya.csa.configuration.v1+json",CSA_CALL:"application/vnd.avaya.csa.call.v1+json",CSA_CALLS:"application/vnd.avaya.csa.calls.v1+json",CSA_CLIENT:"application/vnd.avaya.csa.client.v1+json",CSA_CLIENTS:"application/vnd.avaya.csa.clients.v1+json",CSA_CALL_ACTION:"application/vnd.avaya.csa.callaction.v1+json",CSA_CALL_ACTION_V2:"application/vnd.avaya.csa.callaction.v2+json",CSA_CALL_PREFERENCE:"application/vnd.avaya.csa.callpreferences.v1+json",CSA_PRESENCE_CONTAINER:"application/vnd.avaya.presence-im.container.v1+json",CSA_PRESENCE_PUBLICATION:"application/vnd.avaya.presence.presence-pub.v1+json",CSA_PRESENCE_RESOURCE_LIST:"application/vnd.avaya.csa.resourcelist.v1+json",MPAAS_CALL_PROPERTIES:"application/vnd.avaya.mpaas.callproperties.v1+json"}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ResourceType={Users:"users",Clients:"clients",Calls:"calls",Services:"services",KeepAlive:"keepalive",SessionManagement:"sessionManagement",Websocket:"websocket",SSE:"sse",iViewToken:"iviewtoken",RestSessionMgmt:"RestSessionMgmt",ClientKeepAlive:"ClientKeepAlive",ClientTerminate:"ClientTerminate",Configuration:"configuration",FastDelete:"fastDelete",UploadLogs:"upload-logs",PresenceSubscriptions:"presence-subscriptions",PresencePublications:"presence-publications",CreatePresenceContainer:"CreatePresenceContainer",PublishPresenceState:"PublishPresenceState",PublishPresenceMode:"PublishPresenceMode",PublishPresenceNote:"PublishPresenceNote",DeletePresenceState:"DeletePresenceState",DeletePresenceMode:"DeletePresenceMode",DeletePresenceNote:"DeletePresenceNote"}}(),function(s){"use strict";var n=s.Providers.CallServiceGateway.Constants;s.Providers.CallServiceGateway.Utils={convertToAudioChannel:function(e,t,i){var a=null;if(e&&((a={channelId:e.id}).state=e.enabled?n.ENABLE:n.DISABLE,a.direction=this.convertToChannelDirection(e.direction),t?a.logicalDirection=this.convertToChannelDirection(t.getLogicalDirection()):e.logicalDirection&&(a.logicalDirection=this.convertToChannelDirection(e.logicalDirection)),i))switch(i){case s.Services.Call.NoiseReductionSetting.DISABLE_CLIENT:case s.Services.Call.NoiseReductionSetting.ENABLED:a.serverNoiseReduction="ENABLE";break;case s.Services.Call.NoiseReductionSetting.PREFER_CLIENT:case s.Services.Call.NoiseReductionSetting.DISABLE_ALL:a.serverNoiseReduction="DISABLE"}return a},convertToVideoChannels:function(e,i,a){var r=[];return e&&e.forEach(function(e){var t;e&&((t={channelId:e.id}).state=e.enabled?n.ENABLE:n.DISABLE,t.direction=this.convertToChannelDirection(e.direction),i?t.logicalDirection=this.convertToChannelDirection(i.getLogicalDirection()):e.logicalDirection&&(t.logicalDirection=this.convertToChannelDirection(e.logicalDirection)),s.Base.Utils.isDefined(a)&&(t.localVideoMute=a),r.push(t))}.bind(this)),r},convertToVideoChannelGuidelines:function(e){var t={};return e&&(e.getRequiredDirection()&&(t.requiredClientLegDirections=this.convertToChannelGuideLine(e.getRequiredDirection())),e.getPermittedDirection()&&(t.permittedLogicalDirections=this.convertToChannelGuideLine(e.getPermittedDirection()))),t},convertToChannelDirection:function(e){switch(e){case s.Services.Call.MediaDirection.SEND_ONLY:return n.SEND_ONLY;case s.Services.Call.MediaDirection.RECV_ONLY:return n.RECV_ONLY;case s.Services.Call.MediaDirection.SEND_RECV:return n.SEND_RECV;default:return n.INACTIVE}},convertToChannelGuideLine:function(e){switch(e){case s.Services.Call.MediaDirection.SEND_ONLY:return[n.SEND];case s.Services.Call.MediaDirection.RECV_ONLY:return[n.RECEIVE];case s.Services.Call.MediaDirection.SEND_RECV:return[n.SEND,n.RECEIVE];default:return[]}},convertToAudioStream:function(e,t){var i=null;return e&&((i=new s.Providers.Interfaces.AudioStream(e.channelId,this.convertToMediaDirection(e.direction))).enabled=e.state===n.ENABLE,t&&e.logicalDirection&&(i.logicalDirection=this.convertToMediaDirection(e.logicalDirection)),e.serverNoiseReduction&&(i.serverNoiseReduction=e.serverNoiseReduction)),i},convertToVideoStreams:function(e,i){var a=[];return e&&e.forEach(function(e){var t;e&&((t=new s.Providers.Interfaces.VideoStream(e.channelId,this.convertToMediaDirection(e.direction),e.maxHeight,e.maxWidth,e.maxFrames)).enabled=e.state===n.ENABLE,i&&e.logicalDirection&&(t.logicalDirection=this.convertToMediaDirection(e.logicalDirection)),a.push(t))}.bind(this)),a},convertToMediaDirection:function(e){switch(e){case n.SEND_ONLY:return s.Services.Call.MediaDirection.SEND_ONLY;case n.RECV_ONLY:return s.Services.Call.MediaDirection.RECV_ONLY;case n.SEND_RECV:return s.Services.Call.MediaDirection.SEND_RECV;default:return s.Services.Call.MediaDirection.INACTIVE}},convertAlertType:function(e){switch(e){case"ALERT_TYPE_UNSPECIFIED":return s.Services.Call.AlertType.UNSPECIFIED;case"ALERT_TYPE_NONE":return s.Services.Call.AlertType.NONE;case"ALERT_TYPE_INTERNAL":return s.Services.Call.AlertType.INTERNAL;case"ALERT_TYPE_EXTERNAL":return s.Services.Call.AlertType.EXTERNAL;case"ALERT_TYPE_PRIORITY":return s.Services.Call.AlertType.PRIORITY;case"ALERT_TYPE_INTERCOM":return s.Services.Call.AlertType.INTERCOM;case"ALERT_TYPE_AUTO_CALLBACK":return s.Services.Call.AlertType.AUTO_CALLBACK;case"ALERT_TYPE_HOLD_RECALL":return s.Services.Call.AlertType.HOLD_RECALL;case"ALERT_TYPE_DIRECT_AGENT_CALL_INTERNAL":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_INTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_EXTERNAL":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_EXTERNAL;case"ALERT_TYPE_DIRECT_AGENT_CALL_PRIORITY":return s.Services.Call.AlertType.DIRECT_AGENT_CALL_PRIORITY;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_INTERNAL":return s.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_INTERNAL;case"ALERT_TYPE_AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL":return s.Services.Call.AlertType.AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL;default:return s.Base.Logger.info(s.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled alert type: "+e),s.Services.Call.AlertType.UNSPECIFIED}},convertErrorCode:function(e){switch(e){case 4010001:return s.Services.Call.CallError.NOT_AUTHORIZED;case 4010003:return s.Services.Call.CallError.UNAUTHORIZED;case 4040009:return s.Services.Call.CallError.NOT_FOUND;case 4040011:return s.Services.Call.CallError.SESSION_ID_NOT_FOUND;case 4040013:return s.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED;case 4220072:return s.Services.Call.CallError.CALL_STATE_MISMATCH;case 4220078:return s.Services.Call.CallError.MEDIA_PRESERVED;case 5000010:return s.Services.Call.CallError.USER_NOT_FOUND;case 5000022:return s.Services.Call.CallError.BUSY;case 5000036:return s.Services.Call.CallError.VIDEO_DENIED;default:return s.Services.Call.CallError.INTERNAL_ERROR}},convertPresenceStateToCSGPresenceState:function(e){switch(e){case s.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE:return s.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE;case s.Services.Presence.PresenceState.PRESENCE_STATE_AWAY:return s.Providers.CallServiceGateway.CSGPresenceState.AWAY;case s.Services.Presence.PresenceState.PRESENCE_STATE_BUSY:return s.Providers.CallServiceGateway.CSGPresenceState.BUSY;case s.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB:return s.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB;case s.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE:return s.Providers.CallServiceGateway.CSGPresenceState.OFFLINE;case s.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL:return s.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL;case s.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE:return s.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE;default:return T}},convertCSGPresenceStateToPresenceState:function(e){switch(e){case s.Providers.CallServiceGateway.CSGPresenceState.AVAILABLE:return s.Services.Presence.PresenceState.PRESENCE_STATE_AVAILABLE;case s.Providers.CallServiceGateway.CSGPresenceState.AWAY:return s.Services.Presence.PresenceState.PRESENCE_STATE_AWAY;case s.Providers.CallServiceGateway.CSGPresenceState.BUSY:return s.Services.Presence.PresenceState.PRESENCE_STATE_BUSY;case s.Providers.CallServiceGateway.CSGPresenceState.DO_NOT_DISTURB:return s.Services.Presence.PresenceState.PRESENCE_STATE_DO_NOT_DISTURB;case s.Providers.CallServiceGateway.CSGPresenceState.OFFLINE:return s.Services.Presence.PresenceState.PRESENCE_STATE_OFFLINE;case s.Providers.CallServiceGateway.CSGPresenceState.ON_A_CALL:return s.Services.Presence.PresenceState.PRESENCE_STATE_ON_A_CALL;case s.Providers.CallServiceGateway.CSGPresenceState.OUT_OF_OFFICE:return s.Services.Presence.PresenceState.PRESENCE_STATE_OUT_OF_OFFICE;default:return s.Services.Presence.PresenceState.PRESENCE_STATE_UNSPECIFIED}},convertPresenceModeToCSGPresenceMode:function(e){switch(e){case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME:return s.Providers.CallServiceGateway.CSGPresenceMode.HOME;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE:return s.Providers.CallServiceGateway.CSGPresenceMode.MOBILE;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE:return s.Providers.CallServiceGateway.CSGPresenceMode.OFFICE;case s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING:return s.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING;default:return T}},convertCSGPresenceModeToPresenceMode:function(e){switch(e){case s.Providers.CallServiceGateway.CSGPresenceMode.HOME:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_HOME;case s.Providers.CallServiceGateway.CSGPresenceMode.MOBILE:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_MOBILE;case s.Providers.CallServiceGateway.CSGPresenceMode.OFFICE:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_OFFICE;case s.Providers.CallServiceGateway.CSGPresenceMode.TRAVELING:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_TRAVELING;default:return s.Services.Presence.PresenceLocationMode.PRESENCE_LOCATION_MODE_UNSPECIFIED}}}}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this._registerUser=e||!1,this._minBandwidth=t||null,this._videoChannelGuidelines=i}t.prototype={isRegisterUser:function(){return this._registerUser},getMinBandwidth:function(){return this._minBandwidth},getVideoChannelGuidelines:function(){return this._videoChannelGuidelines}},e.Providers.CallServiceGateway.ServiceActivationParameters=t}(AvayaClientServices),function(e){"use strict";e.Providers.CallServiceGateway.AbstractCallMessage=function(){this.type=e.Providers.CallServiceGateway.CallMessageTypes.UNDEFINED}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.CallMessageTypes={UNDEFINED:"Undefined",SUBSCRIPTION:"Subscription",USER_CLIENTS:"UserClients",PROCESS_MEDIA_REQUEST:"ProcessMediaRequest"}}(),function(e){"use strict";function t(){this.vmnumber=T}t.prototype={},e.Providers.CallServiceGateway.ConfigurationMessage=t}(AvayaClientServices),function(e){"use strict";function t(){this.expires=T,this.containerResources={container:{get:{method:T,href:T},updateOrExtend:{method:T,href:T},delete:{method:T,href:T}}},this.additionalResources={presencePublication:{replace:{method:T,href:T}},presenceSubscriptions:[{update:{method:T,href:T},replace:{method:T,href:T}}]}}t.prototype={},e.Providers.CallServiceGateway.CSGPresenceContainer=t}(AvayaClientServices),function(e){"use strict";function t(){this.presenceDoc={userIdentity:{userId:T}},this.presenceSummary={stateEnum:T},this.manualState={stateEnum:T},this.mode={modeEnum:T},this.note={content:T},this.channelPresence=[]}t.prototype={},e.Providers.CallServiceGateway.CSGPresenceDocument=t}(AvayaClientServices),function(e){"use strict";e.Providers.CallServiceGateway.CSGPresenceState={AVAILABLE:"AVAILABLE",BUSY:"BUSY",DO_NOT_DISTURB:"DO_NOT_DISTURB",ON_A_CALL:"ON_A_CALL",AWAY:"AWAY",OUT_OF_OFFICE:"OUT_OF_OFFICE",OFFLINE:"OFFLINE"};e.Providers.CallServiceGateway.CSGPresenceMode={OFFICE:"OFFICE",HOME:"HOME",MOBILE:"MOBILE",TRAVELING:"TRAVELING"}}(AvayaClientServices),function(e){"use strict";function t(){this.applications=[],this.capabilities=[],this.commandURL=T,this.sessionManagement={href:T,timeout:T}}t.prototype={},e.Providers.CallServiceGateway.NotificationResources=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=i.Providers.CallServiceGateway.CallMessageTypes.PROCESS_MEDIA_REQUEST,this.callId=e,this.sdp=t}e.prototype=Object.create(i.Providers.CallServiceGateway.AbstractCallMessage.prototype),i.Providers.CallServiceGateway.ProcessMediaRequestMessage=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=t.Providers.CallServiceGateway.CallMessageTypes.CALLINFO,this.registrationId=e,this.href=T,this.mode="Computer"}e.prototype=Object.create(t.Providers.CallServiceGateway.AbstractCallMessage.prototype),t.Providers.CallServiceGateway.RegistrationInfoMessage=e}(AvayaClientServices),function(e){"use strict";function t(){this.resources={avayaRequestTimeout:{maximum:T,minimum:T,recommended:T},capabilities:[],clientId:T,notificationService:{websocket:{href:T},sse:{href:T}},resources:[],sessionManagement:{href:T,timeout:T,username:T},clientManagement:{timeout:T}}}t.prototype={},e.Providers.CallServiceGateway.RestResources=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=t.Providers.CallServiceGateway.CallMessageTypes.SUBSCRIPTION,this.isSubscribed=!1,this.subscriptionId=e,this.application=T,this.service=T,this.resource=T}e.prototype=Object.create(t.Providers.CallServiceGateway.AbstractCallMessage.prototype),t.Providers.CallServiceGateway.SubscriptionCallMessage=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.UserClient=function(e){this.clientId=e,this.version=T,this.endpointLabel=T,this.productName=T}}(),function(e){"use strict";function t(){e.Providers.CallServiceGateway.AbstractCallMessage.call(this),this.type=e.Providers.CallServiceGateway.CallMessageTypes.USER_CLIENTS,this._clients=[]}(t.prototype=Object.create(e.Providers.CallServiceGateway.AbstractCallMessage.prototype)).add=function(e){this._clients.push(e)},t.prototype.getClients=function(){return this._clients},e.Providers.CallServiceGateway.UserClientsMessage=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.ObservableEvents={ANSWER_CALL_REQUEST:"csgwprovider.answerCallRequest",CREATE_MEDIA_REQUEST:"csgwprovider.createMediaRequest",CALL_ENDED:"csgwprovider.call.ended",CALL_ESTABLISHED:"csgwprovider.call.established",CALL_FAILURE:"csgwprovider.call.failure",CALL_HELD:"csgwprovider.call.held",CALL_INCOMING:"csgwprovider.call.incoming",CALL_RINGING:"csgwprovider.call.ringing",CALL_STATE_FAILURE:"csgwprovider.call.stateFailure",CALL_UNHELD:"csgwprovider.call.unheld",CALLS_SERVICE_ACTIVATED:"csgwprovider.callsActivated",CALLS_SERVICE_DEACTIVATED:"csgwprovider.callsDeactivated",ICE_CONFIG_UPDATES:"csgwprovider.ice.config.updates",IVIEW_TOKEN_UPDATE:"csgwprovider.iviewTokenUpdate",MAKE_CALL_REQUEST:"csgwprovider.makeCallRequeset",MAX_NETWORK_RECONNECTION_ATTEMPTED:"csgwprovider.maxReconnectionAttempted",NETWORK_PROVIDER_IS_AVAILABLE:"csgwprovider.network.available",NETWORK_PROVIDER_IS_UNAVAILABLE:"csgwprovider.network.unavailable",PROCESS_ANSWER_REQUEST:"csgwprovider.processAnswerRequest",RINGBACK_TONE_URLS_CHANGED:"csgwprovider.ringbackToneUrlsChanged",SUPPORTED_CALL_ENHANCEMENTS:"csgwprovider.supportedCallEnhancements",TERMINATE_CALL_REQUEST:"csgwprovider.terminateCallRequest",UPDATE_TRANSFER_STATUS:"csgwprovider.update.transferStatus",UPDATE_CALL_DATA:"csgwprovider.update.callData",UPDATE_CALL_REQUEST:"csgwprovider.update.callRequest",UPDATE_CONSULT_CONFERENCE_STATUS:"csgwprovider.update.consultConferenceStatus",UPLOAD_LOGS_UPDATE:"csgwprovider.uploadlogs",VIDEO_LICENSE_UPDATED:"csgwprovider.videoLicenceUpdated"}}(),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=new i.Providers.Interfaces.Call;return t.callId=e.callId,t.capabilities=e.capabilities,t.clientCpuUsageMgmt=e.clientCpuUsageMgmt,t}},i.Providers.CallServiceGateway.CallInfoParser=e}(AvayaClientServices),function(e){"use strict";function t(e){this._callInfoParser=e}t.prototype={parse:function(e){var t=[];if(e)for(var i=0;i<e.calls.length;i++)t.push(this._callInfoParser.parse(e.calls[i]));return t}},e.Providers.CallServiceGateway.ClientCallsParser=t}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return E.extend(new t.Providers.CallServiceGateway.ConfigurationMessage,e)}},t.Providers.CallServiceGateway.ConfigurationParser=e}(AvayaClientServices),function(E){"use strict";function e(e){this._provider=e}e.prototype={parse:function(t){var e=E.Base.Utils.isDefined(t.messageData)?JSON.parse(t.messageData):T,i=e&&e.actionDetails?E.Providers.CallServiceGateway.Utils.convertToAudioStream(e.actionDetails.audioChannel,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()):T,a=e&&e.actionDetails?E.Providers.CallServiceGateway.Utils.convertToVideoStreams(e.actionDetails.videoChannels,this._provider.getCallProvider().isSolutionSupportsNailedUpConnection()):T,r=this.getServerSentResolution(e);switch(t.messageType){case E.Providers.CallServiceGateway.NotificationType.CallFailure:var s=E.Base.Utils.queryJSONObject(e,"error[0].errorCode"),n=E.Providers.CallServiceGateway.Utils.convertErrorCode(s),o=E.Base.Utils.queryJSONObject(e,"error[0].displayMsg");s===E.Providers.CallServiceGateway.Constants.CALL_STATE_FAILURE_ERROR_CODE?this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_STATE_FAILURE,[t.callId,n,E.Services.Call.CallProtocolType.APPLICATION,s,o]):this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_FAILURE,[t.callId,n,E.Services.Call.CallProtocolType.APPLICATION,s,o]);break;case E.Providers.CallServiceGateway.NotificationType.IncomingCall:c=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),l=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),d=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),_=E.Base.Utils.queryJSONObject(e,"actionDetails.answerMode"),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_INCOMING,[t.callId,e.actionDetails.participants[0].remoteAddress,e.actionDetails.participants[0].remoteDisplayName,e.actionDetails.avayaAsserted,e.actionDetails.private,E.Providers.CallServiceGateway.Utils.convertAlertType(e.actionDetails.alertType),e.actionDetails.sdpType,e.actionDetails.sdp,i,a,e.actionDetails.subject,e.actionDetails.videoBandwidth,c,l,d,this.processTurnData(e.actionDetails.turnData),_]);break;case E.Providers.CallServiceGateway.NotificationType.CallRinging:var c=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),l=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),d=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),C=!1,u=E.Base.Utils.queryJSONObject(t,"alertingTypeEarlyMedia");E.Base.Utils.isDefined(u)&&("boolean"==typeof u?C=u:"string"==typeof u&&(C="true"===u.toLowerCase())),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_RINGING,[t.callId,e.actionDetails.participants[0].remoteAddress,e.actionDetails.participants[0].remoteDisplayName,e.actionDetails.avayaAsserted,e.actionDetails.private,E.Providers.CallServiceGateway.Utils.convertAlertType(e.actionDetails.alertType),C,i,a,c,l,d]);break;case E.Providers.CallServiceGateway.NotificationType.CallEstablished:var h,o=E.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.conference");o&&(h=e.actionDetails.conferenceData.uccpUrl),this._provider._csgProvider.updateCallInfo({callId:t.callId}),_=E.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.webCollaborationUrl"),c=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),l=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),d=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId");u="",C="";e.actionDetails.participants&&0<e.actionDetails.participants.length&&(u=e.actionDetails.participants[0].remoteAddress,C=e.actionDetails.participants[0].remoteDisplayName);var _=[t.callId,u,C,e.actionDetails.subject,e.actionDetails.remote,e.actionDetails.private,e.actionDetails.alertType,e.actionDetails.avayaAsserted,e.actionDetails.clientCpuUsageMgmt,i,a,o,h,_,e.actionDetails.videoBandwidth,c,l,d];this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_ESTABLISHED,_);break;case E.Providers.CallServiceGateway.NotificationType.CallHeld:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_HELD,[t.callId]);break;case E.Providers.CallServiceGateway.NotificationType.CallUnheld:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_UNHELD,[t.callId]);break;case E.Providers.CallServiceGateway.NotificationType.CallEnded:var v=!1;if(t.endCallReason)try{var p=JSON.parse(t.endCallReason);p&&(S=new E.Providers.Call.CallReason(p.reasonProtocol,p.reasonCode,p.reasonText),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[t.callId,S]),v=!0)}catch(e){E.Base.Logger.error(E.Base.LoggerTags.CALL_PROVIDER,"Failed to parse end call reason: "+t.endCallReason)}v||this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CALL_ENDED,[t.callId]);break;case E.Providers.CallServiceGateway.NotificationType.CreateMediaRequest:this.processCreateMediaRequest(t.callId,t.messageDataType,e,i,a);break;case E.Providers.CallServiceGateway.NotificationType.ProcessMediaRequest:this.processMediaRequestHandler(t.callId,e.action,e.actionDetails.sdpType,e.actionDetails.sdp,i,a,e.actionDetails.videoBandwidth,this.processTurnData(e.actionDetails.turnData),e.actionDetails.forceIceRestart,e.actionDetails.usesIPv6Candidates,e.actionDetails.videoResolutions,r);break;case E.Providers.CallServiceGateway.NotificationType.ProcessMediaResponse:this.processMediaResponseHandler(t.callId,e.action,e.actionDetails.sdpType,e.actionDetails.sdp,i,a,e.actionDetails.videoResolutions,r);break;case E.Providers.CallServiceGateway.NotificationType.UpdateTransferStatus:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.UPDATE_TRANSFER_STATUS,[t.callId,t.transferStatus]);break;case E.Providers.CallServiceGateway.NotificationType.UpdateCallData:var g,p=e.actionDetails.participants?e.actionDetails.participants[0]:{remoteAddress:T,displayName:T},S=E.Base.Utils.queryJSONObject(e,"actionDetails.conferenceData.conference"),v=!1;E.Base.Utils.isDefined(S)&&("boolean"==typeof S?v=S:"string"==typeof S&&(v="true"===S.toLowerCase()),g=e.actionDetails.conferenceData.uccpUrl,f=e.actionDetails.conferenceData.webCollaborationUrl),c=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),l=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),d=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_DATA,[t.callId,p.remoteAddress,p.remoteDisplayName,v,g,f,c,l,d,a,r]);break;case E.Providers.CallServiceGateway.NotificationType.MWIStatusChanged:var f=t.status;f===E.Providers.CallServiceGateway.Constants.MWI_OFF||f===E.Providers.CallServiceGateway.Constants.MWI_ON?this._provider.setVoicemailMWI(f):E.Base.Logger.warn(E.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received MWIStatusChanged notification in invalid format");break;case E.Providers.CallServiceGateway.NotificationType.EndpointConfigurationUpdate:this._provider.setVoicemailNumber(t.voiceMailNumber),this._provider.trigger(E.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,[t.voiceMailNumber]),t.IPVideoEnable&&this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.VIDEO_LICENSE_UPDATED,["true"===t.IPVideoEnable]);break;case E.Providers.CallServiceGateway.NotificationType.AddParticipantStatus:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.UPDATE_CONSULT_CONFERENCE_STATUS,[t.callId,t.status]);break;case E.Providers.CallServiceGateway.NotificationType.AnswerCallRequest:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.ANSWER_CALL_REQUEST,[t.callId,t.requestId]);break;case E.Providers.CallServiceGateway.NotificationType.TerminateCallRequest:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.TERMINATE_CALL_REQUEST,[t.callId,t.requestId]);break;case E.Providers.CallServiceGateway.NotificationType.UpdateCallRequest:this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.UPDATE_CALL_REQUEST,[t.callId,t.requestId,t.callactiontype]);break;case E.Providers.CallServiceGateway.NotificationType.MakeCallRequest:c=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.UCID"),l=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.parentUCID"),d=E.Base.Utils.queryJSONObject(e,"actionDetails.userToUserData.contextId"),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.MAKE_CALL_REQUEST,[t.callId,t.dialToAddress,t.requestId,c,l,d]);break;case E.Providers.CallServiceGateway.NotificationType.ServiceStatusChanged:this._provider.activateService(t.service,t.status,t.deactivationReason);break;case E.Providers.CallServiceGateway.NotificationType.NetworkEvents:this._provider.networkEventNotification(e);break;default:E.Base.Logger.info(E.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Ignoring telephony notification: [Id:"+t.callId+",Type:"+t.messageType+"]")}},processMediaRequestHandler:function(e,t,i,a,r,s,n,o,c,l,d,C){E.Base.Logger.debug(E.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Request: ["+t+","+i+"]"),i&&i.toLowerCase()===E.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(e,t,a,r,s,n,d,C):a?this._provider.getCallProvider().offerSDP(e,t,a,r,s,n,o):(a=!1,E.Base.Utils.isDefined(c)&&(a=c),this._provider.getCallProvider().getOfferSDP(e,t,r,s,n,o,a,l,d,C))},processMediaResponseHandler:function(e,t,i,a,r,s){E.Base.Logger.debug(E.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Received Process Media Response: "+i),E.Base.Utils.isDefined(a)&&null!==a?i&&i.toLowerCase()===E.Providers.CallServiceGateway.Constants.SDP_TYPE_ANSWER?this._provider.getCallProvider().answerSDP(e,t,a,r,s):E.Base.Logger.info(E.Base.LoggerTags.CSG_PRESENCE_AND_CALL_PROVIDER,"Unhandled SDP from process media response for ["+t+","+i+"]"):this._provider.getCallProvider().answerSdpAck(e,t,r,s)},processTurnData:function(e){if(e){var t=e.turnAddressDetails.turnAddress,i=e.sessionId,a=e.accessToken,r="relay";E.Base.Utils.isDefined(e.forceTurn)&&!1===e.forceTurn&&(r="all");for(var s=[],n=0;n<e.turnAddressDetails.turnTypesPriorities.length;n++){var o=e.turnAddressDetails.turnTypesPriorities[n],c=o.turnAddress||t,l="turn",d=o.port,C=o.transportType;"tls"===o.transportType&&(l="turns",C="tcp");d=new E.Providers.Call.TurnTransportType(c,l,C,d);this._provider.getCallProvider()._isTurnTlsHasHighestPriority()&&d._setTlsToHighestPriority(!0),s.push(d)}return new E.Providers.Call.TurnData(i,a,t,s,r,e.expiryTime)}return T},processCreateMediaRequest:function(e,t,i,a,r){t===E.Providers.CallServiceGateway.MediaType.CSA_CALL_ACTION_V2&&(t={callId:e,capabilities:i.call.capabilities,clientCpuUsageMgmt:i.call.clientCpuUsageMgmt},this._provider._csgProvider.updateCallInfo(t)),this._provider.trigger(E.Providers.CallServiceGateway.ObservableEvents.CREATE_MEDIA_REQUEST,[e,i.action,a,r,i.actionDetails.videoBandwidth,this.processTurnData(i.actionDetails.turnData),i.actionDetails.usesIPv6Cand])},getServerSentResolution:function(e){try{return e&&e.actionDetails&&e.actionDetails.videoChannels&&1===e.actionDetails.videoChannels.length?e.actionDetails.videoChannels[0].preferredSendResolution||null:null}catch(e){return null}}},E.Providers.CallServiceGateway.NotificationParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.CallServiceGateway.NotificationType={CreateMediaRequest:"createMediaRequest",ProcessMediaRequest:"processMediaRequest",ProcessMediaResponse:"processMediaResponse",IncomingCall:"callIncoming",CallRinging:"callRinging",CallEstablished:"callEstablished",CallEnded:"callEnded",CallFailure:"callFailure",CallHeld:"onCallRemoteHeld",CallUnheld:"onCallRemoteUnheld",UpdateTransferStatus:"updateTransferStatus",UpdateCallData:"updateCallData",MWIStatusChanged:"MWIStatusChanged",EndpointConfigurationUpdate:"EndpointConfigurationUpdate",AddParticipantStatus:"addParticipantStatus",AnswerCallRequest:"answerCallRequest",AnswerCallResponse:"answerCallResponse",TerminateCallRequest:"terminateCallRequest",UpdateCallRequest:"updateCallRequest",MakeCallRequest:"makeCallRequest",ServiceStatusChanged:"serviceStatusChanged",NetworkEvents:"mpaasevents"}}(),function(r){"use strict";function e(){}e.prototype={parse:function(e){for(var t=new r.Providers.CallServiceGateway.UserClientsMessage,i=0;i<e.clients.length;i++){var a=this.parseClient(e.clients[i]);t.add(a)}return t},parseClient:function(e){var t=new r.Providers.CallServiceGateway.UserClient(e.clientId);return t.version=e.version,t.endpointLabel=e.endpointLabel,t.productName=e.productName,t}},r.Providers.CallServiceGateway.UserClientsParser=e}(AvayaClientServices),function(t){"use strict";t.Providers.ContentSharing.BandwidthManager=function(e){this._serverManager=e,this._queue=[],this._intervals=[],this._encodingTimes=[],this._run=!1,this._outstandingDataSize=0,this._isAcksActivated=!0,this._minimalInterval=100,this._lastIntervalsToConsiderCount=10,this._maxBytesPerSecond=37500,this._bytesSentLastSecond=0,this._queueSize=0,this._loggedQueueSize=0,this._sendTimeout=T},t.Providers.ContentSharing.BandwidthManager.prototype={start:function(e){this._interval=e.captureInterval,this._maxBytesPerSecond=e.maxBytesPerSecond;for(var t=0;t<this._lastIntervalsToConsiderCount;t++)this._intervals.push(e.captureInterval);this._serverManager.onBandwidthAvailable=function(){this._process()}.bind(this),this._serverManager.start(e)},stop:function(){var e=E.Deferred();return this._queue=[],this._queueSize=0,this._loggedQueueSize=0,this._outstandingDataSize=0,this._serverManager.stop(),clearTimeout(this._sendTimeout),e.resolve(),e.promise()},pause:function(){this._serverManager.stop()},resume:function(){var e={maxBytesPerSecond:this._maxBytesPerSecond};this._serverManager.start(e)},addToQueue:function(e){var t;e._keyFrame&&(this._lostSize=0,this._queue.forEach(function(e){this._lostSize+=e.byteLength}.bind(this)),t=(this._bytesSentLastSecond+this._lostSize)/this._maxBytesPerSecond,this._intervals.push(Math.floor(this._interval*t)),this._determineInterval(),this._queue=[]),this._queue.push(e),this._run||(this._run=!0,this._process())},onIntervalChanged:function(e){},setMaxUploadSpeed:function(e){this._maxBytesPerSecond=e/8*1e3},isFrameNeeded:function(e){if(this._queueSize=this._queue.reduce(function(e,t){return e+t.byteLength},0),this._isAcksActivated){var t=Math.min(this._serverManager.getActualBandwidth(),this._maxBytesPerSecond);this._maxCapacity=.333*t,this._outstandingDataSize=this._serverManager.getOutstandingDataSize();var i=t*e/1e3,a=this._getAverageEncodingTime(),a=this._maxCapacity+i+t*a/1e3>=this._queueSize+this._outstandingDataSize;return this._serverManager.setIsFrameNeeded(a),a}return(i=this._maxBytesPerSecond*e/1e3)>=this._queueSize},_determineInterval:function(){for(var e=0,t=this._intervals.length-this._lastIntervalsToConsiderCount;t<this._intervals.length;t++)e+=this._intervals[t];var i=e/this._lastIntervalsToConsiderCount;i<this._minimalInterval&&(i=this._minimalInterval),this._interval=Math.floor(i),this.onIntervalChanged(this._interval)},_process:function(){this._queueSize=this._queue.reduce(function(e,t){return e+t.byteLength},0);var e=this._queue.shift();e?(0!==this._loggedQueueSize&&this._loggedQueueSize===this._queueSize||(this._loggedQueueSize=this._queueSize,t.Base.Logger.debug(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Current screen sharing queue size: "+this._queueSize+" bytes.  Length: "+this._queue.length)),this._serverManager.canSend(e.byteLength)?(this._send(e),this._process()):this._queue.unshift(e)):this._run=!1},_send:function(e){this._serverManager.send(e),this._bytesSentLastSecond+=e.getByteLength(),this._sendTimeout=setTimeout(function(){this._bytesSentLastSecond-=e.getByteLength()}.bind(this),1e3)},addToEncodingTimes:function(e){100<this._encodingTimes.length&&this._encodingTimes.slice(this._encodingTimes.length-100),this._encodingTimes.push(e)},setAcksActivated:function(e){this._isAcksActivated=e,this._serverManager.setAcksActivated(this._isAcksActivated)},_getAverageEncodingTime:function(){return 0===this._encodingTimes.length?0:this._encodingTimes.reduce(function(e,t){return e+t/this._encodingTimes.length}.bind(this),0)}}}(AvayaClientServices),function(o){"use strict";function e(){this._jpegImageQuality=.35,this._messageId=1,this._maxMessageId=Math.pow(2,31),this._isWindows="windows"===o.Base.Utils.getBrowserOS(),this._utf8TextEncoder=new TextEncoder}e.prototype={createStartTag:function(e,t,i,a){var r=new o.Providers.WCS.ScreenSharingStartTag;return a&&(r.messageId=this._getMessageId()),r.isKeyFrame=e,r.width=t,r.height=i,r.creationTime=Date.now(),r},createBlockTag:function(e,t){var i=new o.Providers.WCS.ScreenSharingBlockTag;t&&(i.messageId=this._getMessageId()),i.x=e._x,i.y=e._y,i.width=e._width,i.height=e._height;t=this._jpegImageQuality;e._type?(e._type===o.Providers.WCS.ScreenSharingImageTypes.JPEG_RED_WITH_BLACK&&(e._type=o.Providers.WCS.ScreenSharingImageTypes.JPEG,t=Math.max(.8,t)),i.imageType=e._type):i.imageType=o.Providers.WCS.ScreenSharingImageTypes.JPEG;t=this._getImageData(e,e._type,t);return i.length=t.length,i.data=t,i},createEndTag:function(e){var t=new o.Providers.WCS.ScreenSharingEndTag;return e&&(t.messageId=this._getMessageId()),t},createMouseTag:function(e,t,i,a,r){var s=new o.Providers.WCS.ScreenSharingMouseTag;return r&&(s.messageId=this._getMessageId()),s.x=e,s.y=t,s.buttonEventType=a,s.buttonPressedType=this._mouseButtonType(i),s},createKeyboardTag:function(e,t,i,a,r,s){var n=new o.Providers.WCS.ScreenSharingKeyboardTag;return s&&(n.messageId=this._getMessageId()),n.ctrlPressed=t,n.altPressed=e,n.shiftPressed=i,0!==a&&(this._isWindows?n.winPressed=a:n.cmdPressed=a),n.key1=r,n},createCopyPasteTag:function(e,t,i){var a=new o.Providers.WCS.ScreenSharingCopyPasteTag;i&&(a.messageId=this._getMessageId()),a.eventType=e;t=this._utf8TextEncoder.encode(t);return a.length=t.length,a.data=t,a},_mouseButtonType(e){switch(e){case 0:return o.Services.Collaboration.ContentSharingButtonPressedType.LEFT;case 1:return o.Services.Collaboration.ContentSharingButtonPressedType.MIDDLE;case 2:return o.Services.Collaboration.ContentSharingButtonPressedType.RIGHT;default:return o.Services.Collaboration.ContentSharingButtonPressedType.NONE}},_getImageData:function(e,t,i){var a=document.createElement("canvas");a.width=e._width,a.height=e._height,a.getContext("2d").putImageData(e._imgData,0,0);t=t===o.Providers.WCS.ScreenSharingImageTypes.JPEG?"jpeg":"png",i=a.toDataURL("image/"+t,i);return this._getImageBuffer(i)},_getImageBuffer:function(e){for(var e=e.split(","),t=atob(e[1]),i=t.length,a=new Uint8Array(i);i--;)a[i]=t.charCodeAt(i);return a},setJpegImageQuality:function(e){e&&(this._jpegImageQuality=e)},_getMessageId:function(){var e=this._messageId;return this._setMessageId(),e},_setMessageId:function(){return this._messageId<this._maxMessageId-1?this._messageId++:this._messageId=1}},o.Providers.ContentSharing.ContentSharingTagBuilder=e}(AvayaClientServices),function(i,a){"use strict";var r="SCREEN_SHARING",s="PONG",n="START",o="Chrome",c="Firefox",e="message",l="CANCELED";i.Providers.ContentSharing.ExtensionNetworkProvider=function(e){this._pingTimer=T,this._pingTime=0,this._pongTime=0,this._pingInterval=500,this._requestBuilder=e,this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.INVALID,this._onMediaAvailableCallbacks=E.Callbacks(),this._onCapabilityChangeCallbacks=E.Callbacks(),this._onMediaCancelledCallbacks=E.Callbacks(),this._listenerFunction=T,this._isExtensionAvailable=!1},i.Providers.ContentSharing.ExtensionNetworkProvider.prototype={setExtensionAvailable:function(e){this._isExtensionAvailable=e,this._onCapabilityChangeCallbacks.fire(i.Providers.ContentSharing.InstalledExtensionType.CHROME,this._isExtensionAvailable)},start:function(){this._startWindowEventListener(),i.Base.Utils.getBrowserSubType()===i.Base.BrowserSubType.ELECTRON?this.setExtensionAvailable(!0):(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.INVALID,this._startPingTask())},send:function(e){a.postMessage(e,"*")},stop:function(){this._stopPingTimer(),this._removeWindowEventListener()},addOnMediaAvailableCallback:function(e){this._onMediaAvailableCallbacks.add(e)},removeOnMediaAvailableCallback:function(e){this._onMediaAvailableCallbacks.remove(e)},addOnMediaCancelledCallback:function(e){this._onMediaCancelledCallbacks.add(e)},removeOnMediaCancelledCallback:function(e){this._onMediaCancelledCallbacks.remove(e)},addOnCapabilityChange:function(e){this._onCapabilityChangeCallbacks.add(e)},removeOnCapabilityChange:function(e){this._onCapabilityChangeCallbacks.remove(e)},getInstalledExtensionType:function(){return this._installedExtensionType},_stopPingTimer:function(){this._pingTimer&&a.clearTimeout(this._pingTimer)},_startWindowEventListener:function(){this._listenerFunction=function(e){var t;e.source===a&&e.data.type&&(e.data.type===n?this._onMediaAvailableCallbacks.fire(e):e.data.type===l?this._onMediaCancelledCallbacks.fire(e):e.data.type===s&&e.data.app===r&&(this._pongTime=Date.now(),t=this._installedExtensionType,e.data.extension===o?this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.CHROME:e.data.extension===c&&(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.FIREFOX),t!==i.Providers.ContentSharing.InstalledExtensionType.CHROME&&t!==i.Providers.ContentSharing.InstalledExtensionType.FIREFOX&&(this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!0),this._pingInterval=2e3)))}.bind(this),a.addEventListener(e,this._listenerFunction,!1),this._pingTime=Date.now(),this.send(this._requestBuilder.createPingRequest()),i.Base.Logger.debug(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Started receiving pings from extension")},_removeWindowEventListener:function(){a.removeEventListener(e,this._listenerFunction,!1),i.Base.Logger.debug(i.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Stopped receiving pings from extension")},_startPingTask:function(){this._pingTimer&&a.clearTimeout(this._pingTimer),this._pingTimer=a.setTimeout(function(){var e;0===this._pongTime&&this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.INVALID?(this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(this._installedExtensionType,!1),this._pingInterval=2e3<=this._pingInterval?2e3:Math.max(2e3,2*this._pingInterval)):this._pingTime-this._pongTime>this._pingInterval&&(this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.CHROME||this._installedExtensionType===i.Providers.ContentSharing.InstalledExtensionType.FIREFOX)&&(e=this._installedExtensionType,this._installedExtensionType=i.Providers.ContentSharing.InstalledExtensionType.NOT_INSTALLED,this._onCapabilityChangeCallbacks.fire(e,!1)),this._pingTime=Date.now(),!0===this._isExtensionAvailable?this._pongTime=Date.now():this.send(this._requestBuilder.createPingRequest()),this._startPingTask()}.bind(this),this._pingInterval)}}}(AvayaClientServices,window),function(e){"use strict";var t="SCREEN_SHARING_PAGE",i="STOP",a="START",r="PING";function s(){}s.prototype={createStartSharingRequest:function(e){return{type:t,text:a,capture:e}},createStopSharingRequest:function(e){return{type:t,text:i,mediaSourceId:e}},createPingRequest:function(){return{type:t,text:r}}},e.Providers.ContentSharing.ExtensionRequestBuilder=s}(AvayaClientServices),function(i){"use strict";i.Providers.ContentSharing.FeatureSupported={isSharingApplicationWindowAvailable:function(){var e=i.Base.Utils.getBrowserType();return e===i.Base.BrowserType.CHROME||e===i.Base.BrowserType.FIREFOX},isSharingFullScreenAvailable:function(){var e=i.Base.Utils.getBrowserType();return e===i.Base.BrowserType.CHROME||e===i.Base.BrowserType.FIREFOX},isSharingAnyTypeAvailable:function(){var e=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,t=i.Base.Utils.getBrowserType()===i.Base.BrowserType.SAFARI;return!0===e&&!1==t},isSharingContentVideoAvailable:function(){var e=navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||"getDisplayMedia"in navigator,t=i.Base.Utils.getBrowserType()===i.Base.BrowserType.SAFARI;return e&&!1==t}}}(AvayaClientServices),function(e){"use strict";function t(e){this._blocks=[],this.byteLength=0,this._keyFrame=e,this._processingTime=0}t.prototype={addBlock:function(e){this._blocks.push(e),this.byteLength+=e.byteLength},getBlocks:function(){return this._blocks},getByteLength:function(){return this.byteLength}},e.Providers.ContentSharing.FrameBlocks=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.InstalledExtensionType={CHROME:"Chrome",FIREFOX:"Firefox",NOT_INSTALLED:"Not Installed",INVALID:"Invalid"}}(),function(t){"use strict";function e(e){this._isStarted=!1,this._setInterval=T,this._framesCount=0,this._frametimeAcum=0,this._overloadsCount=0,this._frametimeThreshold=t.Base.Utils.isDefined(e)?e.frametimeThreshold:2e3,this._overloadsThreshold=t.Base.Utils.isDefined(e)?e.overloadsThreshold:2,this._interval=t.Base.Utils.isDefined(e)?e.evaluateInterval:15e3,this._startDelay=7e3,this.onPerformanceMonitorAlert=function(){}}e.prototype.start=function(){this._isStarted?t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager already started"):(t.Base.Logger.info(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager starting in - "+this._startDelay/1e3+"s"),setTimeout(function(){this._isStarted=!0,this._setInterval=setInterval(function(){0<this._framesCount&&this._evaluate()}.bind(this),this._interval)}.bind(this),this._startDelay))},e.prototype.stop=function(){this._isStarted?(this._isStarted=!1,this._clearMeasures(),clearInterval(this._setInterval),t.Base.Logger.info(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager stopped")):t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"PerformanceManager is already stop")},e.prototype.registerMeasure=function(e){this._isStarted&&(t.Base.Utils.isDefined(e)?(this._framesCount++,this._frametimeAcum+=e):t.Base.Logger.warn(t.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Invalid frametime measaure"))},e.prototype._evaluate=function(){var e=Math.round(this._frametimeAcum/this._framesCount);e>this._frametimeThreshold?(this._overloadsCount++,this._overloadsCount===this._overloadsThreshold&&(e="Average frametime ("+e+"ms) higher than maximum expected ("+this._frametimeThreshold+"ms), overloads acummulated: "+this._overloadsCount,this.onPerformanceMonitorAlert(t.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,e),this._overloadsCount=0)):this._overloadsCount=0,this._clearMeasures()},e.prototype._clearMeasures=function(){this._framesCount=0,this._frametimeAcum=0},t.Providers.ContentSharing.PerformanceManager=e}(AvayaClientServices),function(e){"use strict";var t={0:"Disabled",1:new e.Config.PerformanceManagerConfiguration(2500,2,15e3),2:new e.Config.PerformanceManagerConfiguration(2250,2,15e3),3:new e.Config.PerformanceManagerConfiguration(2e3,2,15e3),4:new e.Config.PerformanceManagerConfiguration(1750,2,15e3),5:new e.Config.PerformanceManagerConfiguration(1500,2,15e3)};e.Providers.ContentSharing.PerformanceManagerProfiles=t}(AvayaClientServices),function(c){"use strict";c.Providers.ContentSharing.ScreenBlock=function(e,t,i,a,r,s,n,o){this._x=e,this._y=t,this._row=i,this._column=a,this._height=s,this._width=r,this._imgData=n,this._previousBase64=T,this._blocks=o||[],this._type=c.Providers.WCS.ScreenSharingImageTypes.JPEG}}(AvayaClientServices),function(p){"use strict";function e(e){p.Base.Observable.call(this),this._config=T,this._video=T,this._videoTrack=T,this._screenScraper=e,this._capturingTimeout=T,this._delayInterval=T,this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._workerHealthCheckInterval=3e4,this._captureInterval=T,this._captureIntervalMinimum=250,this._lastWorkerHealthCheckTime=0,this._lastWorkerMessageLength=0,this._isFrameNeededCounter=0,this._isFrameNeededCounterMaxValue=33,this._isVideoResolutionSmallerCounter=0,this._isVideoResolutionSmallerMaxValue=99,this._processTimes=[],this._scaledWidth=0,this._scaledHeight=0,this._oldScale=T,this._performanceManager=T,this.onPerformanceMonitorAlert=function(){},this.isFrameNeeded=function(e){},this._visibleRect=T,this._masks=T}e.prototype=Object.create(p.Base.Observable.prototype),(p.Providers.ContentSharing.ScreenCapturer=e).prototype.start=function(t,e,i){var a=E.Deferred();return this._manuallyStopped=!1,this._config=e,this._captureInterval=this._config.captureInterval,this._delayInterval=T,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._startPerformanceManager(),this._worker=new Worker(this._config.contentSharingWorkerPath),this._worker.postMessage({type:p.Providers.ContentSharing.ScreenCapturerWorkerEvents.INITIALIZE,browser:i,config:e}),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),this._worker.onerror=function(e){t.getVideoTracks()[0].stop(),a.reject(e)},this._worker.onmessage=function(e){this._handleWorkerMessage(e,a,t)}.bind(this),a.promise()},e.prototype._handleWorkerMessage=function(e,t,i){switch(e.data.type){case p.Providers.ContentSharing.ScreenCapturerWorkerEvents.CHANGED_BLOCKS:this._handleChangedBlocksMessage(e.data);break;case p.Providers.ContentSharing.ScreenCapturerWorkerEvents.WORKER_STARTED:this._handleWorkerStartedMessage(e.data,t,i);break;default:p.Base.Logger.warn(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Unknown message data type received: {0}",e.data.type)}},e.prototype._calculateScale=function(e,t,i,a){var r=1,s=1;return i<e&&(r=i/e),a<t&&(s=a/t),Math.min(r,s)},e.prototype._handleChangedBlocksMessage=function(e){this._changedBlocksMessageReceived=!0,this._lastWorkerHealthCheckTime=(new Date).getTime(),this._lastWorkerMessageLength=e.data.length,0<e.data.length&&(this._processTimes.unshift(e.meta.processingTime),this._registerFrametime(e.meta.processingTime),this.trigger(p.Providers.ContentSharing.ScreenCapturerEvents.BLOCKS_CHANGED,[e.data,e.meta.keyFrame,this._getAverageProcessingTime()])),this._capturingTimeout=setTimeout(function(){this._capture()}.bind(this),this._config.captureInterval)},e.prototype._handleWorkerStartedMessage=function(e,t,i){this._workerStartedMessageReceived=!0,this._videoTrack=i.getVideoTracks()[0];var a=this._videoTrack.getSettings();p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"displaySurface: "+a.displaySurface),this._videoTrack.onended=function(){this._manuallyStopped?p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was ended successfully"):(p.Base.Logger.info(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.trigger(p.Providers.ContentSharing.ScreenCapturerEvents.WINDOW_CLOSED,[]))}.bind(this),this._video=window.document.createElement("video"),this._video.setAttribute("hidden","true"),this._video.srcObject=i,this._video.play().then(function(){p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was successfully executed")}).catch(function(){p.Base.Logger.info(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Video play() was interrupted before completion")}),this._capture(),t.resolve()},e.prototype._getAverageProcessingTime=function(){return 100<this._processTimes.length&&this._processTimes.slice(this._processTimes.length-100),this._processTimes.reduce(function(e,t){return e+t/this._processTimes.length}.bind(this),0)},e.prototype.stop=function(){var e=E.Deferred();return this._removeListeners(),this._videoTrack&&(this._manuallyStopped=!0,this._videoTrack.stop(),this._videoTrack=T),this._video&&(this._video.srcObject=null,this._video=T),this._processTimes=[],this._worker&&this._worker.terminate(),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._workerStartedMessageReceived=!1,this._changedBlocksMessageReceived=!1,this._delayInterval=T,this._stopPerformanceManager(),e.resolve(),e.promise()},e.prototype.pause=function(){var e=E.Deferred(),t=!0;return this._video&&!this._video.paused&&(t=!1,this._video.pause()),clearTimeout(this._capturingTimeout),clearInterval(this._workerHealthCheck),clearTimeout(this._delayInterval),this._delayInterval=T,e.resolve(t),e.promise()},e.prototype.getWidth=function(){return this._scaledWidth},e.prototype.getHeight=function(){return this._scaledHeight},e.prototype.setScreenSharingVisibleRect=function(e){this._visibleRect=e},e.prototype.getScreenSharingVisibleRect=function(){return this._visibleRect},e.prototype.setScreenSharingMasks=function(e){e instanceof Array&&(e=e.slice()),this._masks=e},e.prototype.getScreenSharingMasks=function(){var e=this._masks;return e=e instanceof Array?e.slice():e},e.prototype.resume=function(){var e=E.Deferred(),t=!1;return this._video&&this._video.paused&&(t=!0,this._video.play(),this._capture(!0)),e.resolve(t),this._workerHealthCheck=setInterval(function(){this._checkWorkerHealth()}.bind(this),this._workerHealthCheckInterval),e.promise()},e.prototype._capture=function(e){var t=this._getAverageProcessingTime();this._captureInterval=this._captureInterval-t>this._captureIntervalMinimum?this._captureInterval-t:t>this._captureIntervalMinimum?t:this._captureIntervalMinimum;if(this._videoTrack&&"ended"!==this._videoTrack.readyState&&!this._video.paused)if(this.isFrameNeeded(this._getAverageProcessingTime()))if(8<=this._video.videoWidth&&8<=this._video.videoHeight){var i,a,r=window.document.createElement("canvas"),s=0,n=0,o=this._video.videoWidth,c=this._video.videoHeight,l=this._visibleRect;l instanceof p.Base.Rect&&(i=l.getX(),a=l.getY(),t=l.getWidth(),d=l.getHeight(),i<0&&(t+=i,i=0),a<0&&(d+=a,a=0),s=i,n=a,o=Math.max(1,Math.min(t,o-s)),c=Math.max(1,Math.min(d,c-n)));var d=this._calculateScale(c,o,this._config.maxHeight,this._config.maxWidth);this._scaledWidth=+(d*o).toFixed(0),this._scaledHeight=+(d*c).toFixed(0),r.width=this._scaledWidth,r.height=this._scaledHeight;var C=r.getContext("2d",{alpha:!1});1!==d&&(C.scale(d,d),d!==this._oldScale&&(this._oldScale=d,p.Base.Logger.info(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Resolution of shared content is too high. Scaling down from  "+o+"x"+c+" to "+this._scaledWidth+"x"+this._scaledHeight))),C.drawImage(this._video,-s,-n);var u=this._masks;if(u instanceof Array)for(var h=0;h<u.length;++h){var _,v=u[h];v instanceof p.Base.Mask&&((_=v.getRect())instanceof p.Base.Rect&&(C.fillStyle=v.getColor(),C.fillRect(_.getX()-s,_.getY()-n,_.getWidth(),_.getHeight())))}c=C.getImageData(0,0,this._scaledWidth,this._scaledHeight).data;this._worker.postMessage({type:p.Providers.ContentSharing.ScreenCapturerWorkerEvents.SEND_IMAGE_DATA,imgData:c,config:this._config,width:this._scaledWidth,height:this._scaledHeight,forceKeyFrame:e},[c.buffer]),this._lastCapturedImageTime=(new Date).getTime()}else this._isVideoResolutionSmallerCounter++,this._isVideoResolutionSmallerCounter===this._isVideoResolutionSmallerMaxValue&&(p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Capture skipped due to low video resolution: "+{width:this._video.videoWidth,height:this._video.videoHeight}),this._isVideoResolutionSmallerCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=T,this._capture(!0)}.bind(this),this._captureInterval);else this._isFrameNeededCounter++,this._isFrameNeededCounter===this._isFrameNeededCounterMaxValue&&(p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"isFrameNeeded delaying the _capture method"),this._isFrameNeededCounter=0),this._capturingTimeout=setTimeout(function(){this._capturingTimeout=T,this._capture()}.bind(this),this._captureInterval);else{c=this._videoTrack?{enabled:this._videoTrack.enabled,kind:this._videoTrack.kind,muted:this._videoTrack.muted,readyState:this._videoTrack.readyState}:T;p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"videoTrack: "+JSON.stringify(c))}},e.prototype._registerFrametime=function(e){p.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.registerMeasure(e)},e.prototype._stopPerformanceManager=function(){p.Base.Utils.isDefined(this._performanceManager)&&this._performanceManager.stop()},e.prototype.setServerCapabilities=function(e){this._config=E.extend({},this._config,e)},e.prototype.setPerformanceManagerProfile=function(e){this._performanceManagerProfile=e},e.prototype._startPerformanceManager=function(){"Disabled"!==this._performanceManagerProfile&&(this._performanceManager=new p.Providers.ContentSharing.PerformanceManager(this._performanceManagerProfile),this._performanceManager.onPerformanceMonitorAlert=function(e,t){this.onPerformanceMonitorAlert(e,t)}.bind(this),this._performanceManager.start())},e.prototype._checkWorkerHealth=function(){var e=(new Date).getTime();e-this._lastWorkerHealthCheckTime>this._workerHealthCheckInterval&&p.Base.Logger.debug(p.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Worker not generating new blocks, block message length: "+this._lastWorkerMessageLength+", worker message received: "+this._workerStartedMessageReceived+", changed blocks message received: "+this._changedBlocksMessageReceived+", scaled width: "+this._scaledWidth+", scaled height: "+this._scaledHeight+", last captured time: "+(e-this._lastCapturedImageTime)+"ms ago, last changed block time: "+(e-this._lastWorkerHealthCheckTime)+"ms ago.")}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerConfig=function(){this.captureInterval=333,this.losslessColorLimit=32,this.blockSize=64,this.framesPerKeyFrame=75,this.maxBytesPerSecond=37500,this.maxWidth=1920,this.maxHeight=1080}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerEvents={BLOCKS_CHANGED:"blocks_changed",KEY_FRAME:"key_frame",WINDOW_CLOSED:"window_changed"}}(),function(){"use strict";AvayaClientServices.Providers.ContentSharing.ScreenCapturerWorkerEvents={INITIALIZE:"initialize",CHANGED_BLOCKS:"changedBlocksMessage",SEND_IMAGE_DATA:"wholeImgData",WORKER_STARTED:"workerStarted"}}(),function(C){"use strict";C.Providers.ContentSharing.ScreenScraper=function(){this._previousBlocks=[],this._blockWidth=64,this._blockHeight=64,this._previousBase64=T,this._captureKeyFrame=!1},C.Providers.ContentSharing.ScreenScraper.prototype={getChangedBlocks:function(e,t,i){if(!e.videoWidth)return[];this._blockWidth=t,this._blockHeight=t;t=window.document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t=t.getContext("2d");t.drawImage(e,0,0);t=this._determineChangedBlocks(e,t);return 0<t.length&&(t=this._mergeBlocks(t),t=this._determineTypes(t,i)),t},_determineTypes:function(e,i){return e.forEach(function(e){var t=this._getColorsCount(e._imgData);e._type=i<t?C.Providers.WCS.ScreenSharingImageTypes.JPEG:C.Providers.WCS.ScreenSharingImageTypes.PNG}.bind(this)),e},_mergeBlocks:function(e){return e=this._sortByColumn(e),e=this._mergeByColumn(e),e=this._sortByRow(e),(e=this._mergeByRow(e)).map(this._createMergedBlock)},_createMergedBlock:function(t){var e=document.createElement("canvas");e.width=t._width,e.height=t._height;var i=e.getContext("2d");t._blocks.forEach(function(e){i.putImageData(e._imgData,e._x-t._x,e._y-t._y)});e=i.getImageData(0,0,t._width,t._height);return new C.Providers.ContentSharing.ScreenBlock(t._x,t._y,t._row,t._column,t._width,t._height,e)},_determineChangedBlocks:function(e,t){var i=[],a=[],r=Math.ceil(e.videoHeight/this._blockHeight);if(!this._imageChanged(e,t))return i;for(var s=0;s<e.videoWidth;s+=this._blockWidth)for(var n=s/this._blockWidth,o=s+this._blockWidth>e.videoWidth?e.videoWidth-s:this._blockWidth,c=0;c<e.videoHeight;c+=this._blockHeight){var l=c+this._blockHeight>e.videoHeight?e.videoHeight-c:this._blockHeight,d=t.getImageData(s,c,o,l),l=new C.Providers.ContentSharing.ScreenBlock(s,c,c/this._blockHeight,n,o,l,d);l._previousBase64=this._getBase64Image(l._imgData),0<this._previousBlocks.length&&!this._captureKeyFrame?(d=l._column*r+l._row,(d=this._previousBlocks[d])&&d._previousBase64===l._previousBase64||(d._previousBase64=T,a.push(l))):a.push(l),i.push(l)}return this._captureKeyFrame&&(this._captureKeyFrame=!1),this._previousBlocks=i,a},_imageChanged:function(e,t){var i=!0,e=t.getImageData(0,0,e.videoWidth,e.videoHeight),e=this._getBase64Image(e);return e!==this._previousBase64||this._captureKeyFrame?this._previousBase64=e:i=!1,i},_getColorsCount:function(e){for(var t={},i=new Uint32Array(e.data.buffer),a=0,r=i.length,s=0;s<r;s++){var n=""+(16777215&i[s]);t[n]||(t[n]=0,a++),t[n]++}return a},_getBase64Image:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")},_mergeByColumn:function(e){return this._merge(e,this._compareBlocksByColumn,function(e,t){e._height+=t._height})},_mergeByRow:function(e){return this._merge(e,this._compareBlocksByRow,function(e,t){e._width+=t._width})},_merge:function(e,t,i){for(var a=[],r=this._copyBlock(e[0]),s=1;s<e.length;s++)t(r,e[s])?(0<e[s]._blocks.length?this._copyBlocks(e,s,r):r._blocks.push(e[s]),i(r,e[s])):(a.push(r),r=this._copyBlock(e[s]));return a.push(r),a},_copyBlocks:function(e,t,i){e[t]._blocks.forEach(function(e){i._blocks.push(e)})},_copyBlock:function(e){var t;return 0===e._blocks.length?(t=new C.Providers.ContentSharing.ScreenBlock(e._x,e._y,e._row,e._column,e._width,e._height))._blocks.push(e):t=e,t},_sortByColumn:function(e){return e.sort(function(e,t){return e._column===t._column?e._row-t._row:e._column-t._column})},_sortByRow:function(e){return e.sort(function(e,t){return e._row===t._row?e._column-t._column:e._row-t._row})},_compareBlocksByColumn:function(e,t){return e._x===t._x&&e._width===t._width&&(e._y+e._height===t._y||t._y+t._height===e._y)},_compareBlocksByRow:function(e,t){return e._y===t._y&&e._height===t._height&&(e._x+e._width===t._x||t._x+t._width===e._x)}}}(AvayaClientServices),function(a){"use strict";function e(e,t){this._collaborationProvider=e,this._extensionNetworkProvider=new a.Providers.ContentSharing.ExtensionNetworkProvider(new a.Providers.ContentSharing.ExtensionRequestBuilder);var i=new a.Providers.ContentSharing.ScreenScraper;this._screenCapturer=new a.Providers.ContentSharing.ScreenCapturer(i),this._extensionRequestBuilder=new a.Providers.ContentSharing.ExtensionRequestBuilder,this._contentSharingTagBuilder=new a.Providers.ContentSharing.ContentSharingTagBuilder;e=new a.Providers.ContentSharing.ServerManager(e.sendBlocks.bind(e),e.getBufferedAmount.bind(e));this._bandwidthManager=new a.Providers.ContentSharing.BandwidthManager(e),this._screenSharingTagEncoder=new a.Providers.WCS.ScreenSharingTagEncoder,t.registerServer(e),t.registerScreenCapturer(this._screenCapturer)}e.prototype={getScreenSharingProvider:function(e){var t=a.Base.Utils.getBrowserType();return t===a.Base.BrowserType.CHROME?new a.Providers.ContentSharing.ChromeScreenSharingProvider(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,e,this._extensionNetworkProvider,this._extensionRequestBuilder):new(t===a.Base.BrowserType.FIREFOX?a.Providers.ContentSharing.FirefoxScreenSharingProvider:t===a.Base.BrowserType.EDGE?a.Providers.ContentSharing.EdgeScreenSharingProvider:a.Providers.ContentSharing.AbstractScreenSharingProvider)(this._collaborationProvider,this._screenCapturer,this._contentSharingTagBuilder,this._bandwidthManager,this._screenSharingTagEncoder,e)}},a.Providers.ContentSharing.ScreenSharingProviderFactory=e}(AvayaClientServices),function(n){"use strict";function e(e,t){this._sentData=0,this._isFrameNeeded=!0,this._videoResolutionChangeThreshold=9,this._outstandingDataSize=0,this._videoStepDownBandwidthThreshold=.75,this._videoStepUpBandwidthThreshold=.95,this._idlePackageSizeThreshold=2e3,this._videoResolutionChangeMonitoringInterval=1e4,this._dataEntryMonitoringInterval=1e3,this._observationStartedTime=0,this._sentDataSum=0,this._cumulativeDataTransferred=0,this._lastCumulativeDataTransferred=0,this._isAcksActivated=!0,this._maxBytesPerSecond=5e4,this._sendingFunction=e,this._blocksSentHistory=[],this._dataEntryForVideoResolutionChange=[],this._monitoringFunction=t,this._checkBandwidthforVideoResolutionDelay=5e3,this.onPerformanceMonitorAlert=function(){},this._history=[{buffered:0,bufferedSum:0,sent:0,sentSum:0}],this._actualBandwidth=this._maxBytesPerSecond,this._observationInterval=5,this._onStop=function(){},this._onStart=function(){}}e.prototype={start:function(e){this._onStart(),this._blocksSentHistory.length=0,this.resetOutstandingDataSize(),this._maxBytesPerSecond=e.maxBytesPerSecond,this._observationStartedTime=(new Date).getTime();var n={};this._interval=setInterval(function(){var t,i,a,r,s,e=this._history[this._history.length-1],e={buffered:this._monitoringFunction()-e.bufferedSum,bufferedSum:this._monitoringFunction(),sent:this._sentDataSum-e.sentSum,sentSum:this._sentDataSum};this._history.push(e),0!==this._blocksSentHistory.length&&(a=!(i=e=t=0),s=r=0,this._blocksSentHistory.forEach(function(e){t+=e.size,n[e.started]=n[e.started]||{},n[e.started].remainingDataSize=e.remainingDataSize,n[e.started].finished=e.finished}.bind(this)),this._blocksSentHistory.length=0,Object.keys(n).forEach(function(e){var t=parseInt(e)>this._observationStartedTime?parseInt(e):this._observationStartedTime;!0===a?(r=t,s=n[e].finished,a=!1):(s<t&&(i+=s-t),s=n[e].finished),0===n[e].remainingDataSize&&delete n[e]}.bind(this)),e=s-r+i,0!==t&&(this._actualBandwidth=1e3*t/e)),this._observationStartedTime=(new Date).getTime()}.bind(this),1e3*this._observationInterval),this.checkBandwidthForVideoResolution()},getHistory:function(){return this._history},stop:function(){this._onStop(),this.resetOutstandingDataSize(),this._blocksSentHistory.length=0,this._dataEntryForVideoResolutionChange.length=0,clearInterval(this._interval),clearInterval(this._dataEntryInterval),clearInterval(this._videoResolutionChangeInterval)},send:function(e){this._sentDataSum+=e.getByteLength(),this._sentData+=e.getByteLength();var i,a,t=e.getByteLength()/this._maxBytesPerSecond*1e3;this._isAcksActivated?(i=e.getByteLength(),this._outstandingDataSize+=e.getByteLength(),a=(new Date).getTime(),e.getBlocks().forEach(function(t){var e=new n.Providers.WCS.ByteArray(t).readInt();this._sendingFunction(t,e).always(function(){this._cumulativeDataTransferred+=t.byteLength;var e={};e.started=a,e.finished=(new Date).getTime(),i-=t.byteLength,e.size=t.byteLength,e.remainingDataSize=i,this._blocksSentHistory.push(e),this._outstandingDataSize-=t.byteLength}.bind(this))}.bind(this))):e.getBlocks().forEach(function(e){this._sendingFunction(e)}.bind(this));var r=this._monitoringFunction();n.Base.Logger.debug(n.Base.LoggerTags.CONTENT_SHARING_COLLABORATION_PROVIDER,"Sent frame WebSocket bufferedAmount: "+r);var s=function(){this._monitoringFunction()<this._maxBytesPerSecond?this.onBandwidthAvailable():setTimeout(s,500)}.bind(this);setTimeout(function(){this._sentData-=e.getByteLength(),s()}.bind(this),t)},canSend:function(e){return 0===this._sentData||e+this._sentData<=this._maxBytesPerSecond},measureDataSentPerSecond:function(){if(0===this._lastCumulativeDataTransferred)return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,this._lastCumulativeDataTransferred;var e=this._cumulativeDataTransferred-this._lastCumulativeDataTransferred;return this._lastCumulativeDataTransferred=this._cumulativeDataTransferred,e},checkBandwidthForVideoResolution:function(){setTimeout(function(){this._isAcksActivated&&(this._dataEntryInterval=setInterval(this.addDataEntryEverySecond.bind(this),this._dataEntryMonitoringInterval),this._videoResolutionChangeInterval=setInterval(this.monitorBandwidthForVideoResolutionChange.bind(this),this._videoResolutionChangeMonitoringInterval))}.bind(this),this._checkBandwidthforVideoResolutionDelay)},addDataEntryEverySecond:function(){this._dataEntryForVideoResolutionChange.push({data:this.measureDataSentPerSecond(),bandwidth:this.getActualBandwidth(),isNeeded:this._isFrameNeeded})},monitorBandwidthForVideoResolutionChange:function(){var e,t,i=0,a=0;this._dataEntryForVideoResolutionChange.forEach(function(e){this._videoStepUpBandwidthThreshold*this._maxBytesPerSecond>=e.bandwidth&&(0===e.data&&!1===e.isNeeded||e.data>this._idlePackageSizeThreshold)&&(this._videoStepDownBandwidthThreshold*this._maxBytesPerSecond>=e.bandwidth?a++:i++)}.bind(this)),a>=this._videoResolutionChangeThreshold&&(e="Send screen sharing bandwidth is limited to "+(8*this.getActualBandwidth()/1e3).toFixed(2)+"kbps",this.onPerformanceMonitorAlert(n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_OVERLOAD,e)),i>=this._videoResolutionChangeThreshold&&(t=(8*this.getActualBandwidth()/1e3).toFixed(2),this.onPerformanceMonitorAlert(n.Base.PerformanceAlertType.BANDWIDTH_UNAVAILABLE_WARNING,e="Send screen sharing bandwidth is limited to "+t+"kbps")),this._dataEntryForVideoResolutionChange.length=0},getOutstandingDataSize:function(){return this._outstandingDataSize<0&&this.resetOutstandingDataSize(),this._outstandingDataSize},getActualBandwidth:function(){return(!isFinite(this._actualBandwidth)||this._actualBandwidth<0)&&(this._actualBandwidth=this._maxBytesPerSecond),this._actualBandwidth},resetOutstandingDataSize:function(){this._outstandingDataSize=0},onBandwidthAvailable:function(){},setIsFrameNeeded:function(e){this._isFrameNeeded=e},setAcksActivated:function(e){this._isAcksActivated=e}},n.Providers.ContentSharing.ServerManager=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Base.Observable.call(this),this._networkProvider=e}(e.prototype=Object.create(t.Base.Observable.prototype)).init=function(e){this._networkProvider.init(e)},e.prototype.login=function(e){return this._networkProvider.send({loginId:e.username,password:e.password},{sendType:"GET"}).then(function(e){return this.trigger("focus.login.success",[e]),e}.bind(this),function(e){this.trigger("focus.login.error",[e])}.bind(this))},t.Providers.Focus.FocusProvider=e}(AvayaClientServices),function(e){"use strict";function t(){e.Base.Observable.call(this)}(t.prototype=Object.create(e.Base.Observable.prototype)).start=function(){},t.prototype.stop=function(){},e.Providers.Interfaces.AbstractProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.AbstractStream=function(e,t,i){this.type=e,this.id=t,this.enabled=!0,this.direction=i,this.logicalDirection=T}}(),function(i){"use strict";function e(e,t){this.serverNoiseReduction=T,i.Providers.Interfaces.AbstractStream.call(this,"audio",e,t)}e.prototype=Object.create(i.Providers.Interfaces.AbstractStream.prototype),i.Providers.Interfaces.AudioStream=e}(AvayaClientServices),function(e){"use strict";function t(){this.callId=T}t.prototype={},e.Providers.Interfaces.Call=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).accept=function(e,t,i,a){},t.prototype.setVideoMode=function(e,t,i){},t.prototype.ignore=function(){},t.prototype.deny=function(){},t.prototype.hold=function(e){},t.prototype.unhold=function(e){},t.prototype.sendDigits=function(){},t.prototype.getRemoteAddress=function(){},t.prototype.getAccessCode=function(){},t.prototype.getSessionDetails=function(){},t.prototype.isConference=function(){},t.prototype.isIncoming=function(){},t.prototype.canAutoAnswer=function(){},t.prototype.isRemote=function(){},t.prototype.isServiceAvailable=function(){},t.prototype.isCallerIdentityPrivate=function(){},t.prototype.getAlertType=function(){},t.prototype.getSubject=function(){},t.prototype.getState=function(){},t.prototype.join=function(){},t.prototype.addCall=function(e){},t.prototype.addParticipant=function(e){},t.prototype.muteAudio=function(e){},t.prototype.unmuteAudio=function(e){},t.prototype.muteVideo=function(e){},t.prototype.unmuteVideo=function(e){},t.prototype.muteSpeaker=function(e){},t.prototype.unmuteSpeaker=function(e){},t.prototype.updateDevices=function(e,t,i){},t.prototype.startContentVideoSharing=function(e,t){},t.prototype.stopContentVideoSharing=function(e){},t.prototype.setPreferredResolution=function(e,t,i){},t.prototype.setPreferredReceiveResolution=function(e,t,i){},t.prototype.setBackgroundBlur=function(e,t){},t.prototype.setBackgroundImage=function(e,t){},e.Providers.Interfaces.CallProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallProviderCallbackIds={ALLOWED_NAILEDUP_VIDEO_MODES:"allowedNailedUpVideoModes",ANSWER_CALL_REQUESTED:"answerCallRequested",AUDIO_STREAM_UPDATED:"audioStreamUpdated",CALL_STARTED:"callStarted",CALL_RINGING:"callRinging",CALL_ESTABLISHED:"callEstablished",CALL_ESTABLISHING:"callEstablishing",CALL_ENDED:"callEnded",CALL_FAILURE:"callFailure",CALL_SERVICE_AVAILABLE:"callServiceAvailable",CALL_SERVICE_ACTIVATED:"callServiceActivated",CALL_SERVICE_DEACTIVATED:"callServiceDeactivated",CALL_SERVICE_UNAVAILABLE:"callServiceUnavailable",CALL_SERVICE_UNSUPPORTED:"callServiceUnsupported",CALL_MEDIA_FAILED:"callMediaFailed",CONFERENCE_ESCALATION:"conferenceEscalation",ICE_CONNECTION_UPDATE:"iceConnectionUpdate",INCOMING_CALL:"incomingCall",INCOMING_ADD_VIDEO_REQUEST:"incomingAddVideoRequest",INCOMING_ADD_VIDEO_ACCEPTED:"incomingAddVideoAccepted",INCOMING_ADD_VIDEO_DENIED:"incomingAddVideoDenied",INCOMING_ADD_VIDEO_TIMEDOUT:"incomingAddVideoTimedout",INCOMING_HOLD:"incomingHold",INCOMING_UNHOLD:"incomingUnhold",INITIATING_MEDIA_RECOVERY:"initiatingMediaRecovery",MAKE_CALL_REQUESTED:"makeCallRequested",MAX_NETWORK_RECOVERY_ATTEMPTED:"maxNetworkRecoveryAttempted",MEDIA_CHANNEL_GUIDELINES_AVAILABLE:"mediaChannelGuidelinesAvailable",MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE:"mediaChannelGuidelinesUnavailable",REMOTE_ADDRESS_CHANGED:"remoteAddressChanged",REMOTE_CALL_CREATED:"remoteCallCreated",TERMINATE_CALL_REQUESTED:"terminateCallRequested",UPDATE_CALL_REQUESTED:"updateCallRequested",UPLOAD_LOGS_UPDATE:"uploadLogUpdate",VIDEO_CHANNEL_UPDATE:"videoChannelUpdate",VIDEO_ESCALATION_REJECTED:"videoEscalationRejected",VIDEO_LICENSE_UPDATED:"VIDEO_LICENSE_UPDATED",RINGBACK_TONE_URLS_CHANGED:"RINGBACK_TONE_URLS_CHANGED",PERFORMANCE_MANAGER_PROFILE_CHANGED:"PERFORMANCE_MANAGER_PROFILE_CHANGED",PERFORMANCE_MONITOR_ALERT:"PERFORMANCE_MONITOR_ALERT"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.CallServiceCallbackIds={INCOMING_CALL:"incomingCall",MAKE_CALL_REQUESTED:"makeCallRequested",PERFORMANCE_MANAGER_PROFILE_CHANGED:"performanceManagerProfileChanged",PERFORMANCE_MONITOR_ALERT:"performanceMonitorAlert",PERFORMANCE_MONITOR_START:"performanceMonitorStart",CAMERA_DEALLOCATED:"CameraDeallocated"}}(),function(s){"use strict";function e(e,t,i,a,r){s.Providers.Interfaces.AbstractStream.call(this,"video",e,t),this.maxHeight=i,this.maxWidth=a,this.maxFrames=r}e.prototype=Object.create(s.Providers.Interfaces.AbstractStream.prototype),s.Providers.Interfaces.VideoStream=e}(AvayaClientServices),function(e){"use strict";function t(){e.Base.Observable.call(this)}(t.prototype=Object.create(e.Base.Observable.prototype)).start=function(){},t.prototype.stop=function(){},t.prototype.startWhiteboard=function(e){},t.prototype.endWhiteboard=function(e){},t.prototype.addWhiteboardSurface=function(){},t.prototype.removeWhiteboardSurface=function(e){},t.prototype.observeCollaboration=function(){},t.prototype.addCircle=function(){},t.prototype.addShape=function(){},t.prototype.startDrawShape=function(){},t.prototype.discoverResources=function(e){},t.prototype.liveDrawShape=function(){},t.prototype.endDrawShape=function(){},t.prototype.addText=function(){},t.prototype.getReceivingBitrate=function(){},t.prototype.startScreenSharing=function(e){},t.prototype.stopScreenSharing=function(){},t.prototype.pauseScreenSharing=function(){},t.prototype.sendBlocks=function(e){},t.prototype.sendLiveEvent=function(e){},t.prototype.removeShape=function(e,t){},t.prototype.clearContent=function(e){},t.prototype.getParticipants=function(){},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.isOpened=function(){},t.prototype.isFeatureAvailable=function(e){},t.prototype.getServerCapabilities=function(){},t.prototype.getAcksActivated=function(){},e.Providers.Interfaces.CollaborationProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.CollaborationProviderCallbackIds={SERVER_CAPABILITIES:"server_capabilities"}}(),function(){"use strict";AvayaClientServices.Providers.Interfaces.ConferenceCallbackIds={NETWORK_PROVIDER_IS_UNAVAILABLE:"NETWORK_PROVIDER_IS_UNAVAILABLE",NETWORK_PROVIDER_IS_AVAILABLE:"NETWORK_PROVIDER_IS_AVAILABLE"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).sendHandshake=function(e){},t.prototype.subscribeMeetingInfo=function(e){},t.prototype.subscribeRoster=function(e){},t.prototype.subscribeActiveTalker=function(e){},t.prototype.subscribePermissions=function(e){},t.prototype.subscribeSlider=function(e){},t.prototype.subscribeMeetingNote=function(e){},t.prototype.subscribeWebCollab=function(e){},t.prototype.subscribeAvailableLayouts=function(e){},t.prototype.getCurrentVideoLayout=function(e){},t.prototype.setAsLecturer=function(e,t){},t.prototype.disconnectParticipant=function(e,t){},t.prototype.terminateConference=function(e){},t.prototype.requestToBecomeModerator=function(e,t){},t.prototype.signIn=function(e,t){},t.prototype.videoPin=function(e,t,i,a,r,s){},t.prototype.extendMeeting=function(e,t){},t.prototype.addParticipant=function(e,t){},t.prototype.cancelDialoutParticipant=function(e,t){},t.prototype.unsetAsLecturer=function(e){},t.prototype.controlRemoteCamera=function(e,t,i){},t.prototype.muteUnmute=function(e,t,i,a){},t.prototype.sendChatMessage=function(e,t,i){},t.prototype.muteUnmuteAll=function(e,t){},t.prototype.raiseLowerHand=function(e,t){},t.prototype.moderatorLowerHand=function(e,t,i){},t.prototype.sendModeratorAdmissionRequest=function(e){},t.prototype.sendAdmissionRequest=function(e,t){},t.prototype.changeParticipantName=function(e,t,i){},e.Providers.Interfaces.ConferenceDataProvider=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.observeConference=function(e){},t.prototype.disconnectParticipant=function(e){},t.prototype.setAsLecturer=function(e){},t.prototype.setLocked=function(e){},t.prototype.setVideoLayoutTextOverlay=function(e){},t.prototype.setVideoLayoutSelfSee=function(e){},t.prototype.setVideoLayout=function(e){},t.prototype.terminateConference=function(){},t.prototype.removeLastParticipant=function(){},t.prototype.requestToBecomeModerator=function(e){},t.prototype.signIn=function(e){},t.prototype.videoPin=function(e,t,i,a,r){},t.prototype.extendMeeting=function(e){},t.prototype.addParticipant=function(e){},t.prototype.addParticipantFromCall=function(e){},t.prototype.cancelDialoutParticipant=function(e){},t.prototype.startRecording=function(e,t,i){},t.prototype.stopRecording=function(e){},t.prototype.pauseRecording=function(e){},t.prototype.resumeRecording=function(e){},t.prototype.unsetAsLecturer=function(){},t.prototype.controlRemoteCamera=function(e,t){},t.prototype.muteUnmute=function(e,t,i){},t.prototype.sendChatMessage=function(e,t){},t.prototype.muteUnmuteAll=function(e){},t.prototype.raiseLowerHand=function(e){},t.prototype.moderatorLowerHand=function(e,t){},t.prototype.getDialInInfo=function(){},t.prototype.changeParticipantName=function(e,t){},e.Providers.Interfaces.ConferenceProvider=t}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e,t){},t.prototype.stop=function(){},t.prototype.getProviderType=function(){},t.prototype.createContactForAdd=function(){},t.prototype.addContact=function(e){},t.prototype.updateContact=function(e){},t.prototype.deleteContact=function(e){},t.prototype.retrieveAllContacts=function(){},t.prototype.getContactsChanges=function(){},t.prototype.getAddContactCapability=function(){},t.prototype.getUpdateContactCapability=function(){},t.prototype.getDeleteContactCapability=function(){},t.prototype.getExtendedContactDetailsCapability=function(){},e.Providers.Interfaces.ContactsProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.ContactsProviderCallbackIds={CONTACT_ADDED:"contact_added",CONTACT_UPDATED:"contact_updated",CONTACT_DELETED:"contact_deleted",CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.stop=function(){},t.prototype.getProviderType=function(){},t.prototype.startDirectorySearch=function(e){},t.prototype.startResolvingContacts=function(e,t){},t.prototype.stopDirectorySearch=function(e){},t.prototype.getNetworkSearchContactCapability=function(){},t.prototype.getNetworkResolveContactsCapability=function(){},t.prototype.getNetworkSearchTerminalCapability=function(){},t.prototype.getSelfContact=function(){},e.Providers.Interfaces.DirectorySearchProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.DirectorySearchProviderCallbackIds={CAPABILITIES_CHANGED:"capabilities_changed"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.logout=function(){},t.prototype.getRoutableDomains=function(){},t.prototype.getConversations=function(e){},t.prototype.getConversationIds=function(e){},t.prototype.getConversationsByQuery=function(e){},t.prototype.discoverResources=function(){},t.prototype.getResources=function(){},t.prototype.validateUsers=function(e){},t.prototype.getParticipants=function(e,t){},t.prototype.sendMessage=function(e,t){},t.prototype.sendMessageWithAttachments=function(e,t,i){},t.prototype.leaveConversation=function(e){},t.prototype.markAllAsRead=function(e){},t.prototype.changeSubject=function(e){},t.prototype.markAsReadBatch=function(e){},t.prototype.getMessages=function(e,t,i,a,r){},t.prototype.reportTyping=function(){},t.prototype.observeConversations=function(){},t.prototype.callEscalationEvent=function(e,t){},t.prototype.setLastAccessTime=function(e,t){},t.prototype.addParticipantsToConversation=function(e,t){},t.prototype.close=function(e){},t.prototype.isStarted=function(){},t.prototype.getMaxImageSize=function(){},t.prototype.getMaxVideoSize=function(){},t.prototype.getMaxAudioSize=function(){},t.prototype.getMaxTextLength=function(){},t.prototype.getMaxGenericAttachmentSize=function(){},e.Providers.Interfaces.MessagingProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.MessagingProviderHandlers={CONVERSATIONS_UPDATE:"conversations.update"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).start=function(e){},t.prototype.stop=function(){},t.prototype.subscribeForPresence=function(e){},t.prototype.unsubscribeFromPresence=function(e){},t.prototype.unsubscribeFromAllAddressesPresence=function(){},t.prototype.publishManualState=function(e){},t.prototype.publishLocationMode=function(e){},t.prototype.publishNote=function(e){},t.prototype.publishAutomaticPresence=function(e){},e.Providers.Interfaces.PresenceProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.PresenceProviderCallbackIds={PRESENCE_NOTIFICATION:"PRESENCE_NOTIFICATION",PRESENCE_HANDLE_RECEIVED:"PRESENCE_HANDLE_RECEIVED"}}(),function(e){"use strict";function t(){e.Providers.Interfaces.AbstractProvider.call(this)}(t.prototype=Object.create(e.Providers.Interfaces.AbstractProvider.prototype)).getVoicemailNumber=function(){},t.prototype.getVoicemailMWI=function(){},t.prototype.isServiceAvailable=function(){},e.Providers.Interfaces.VoiceMessagingProvider=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.Interfaces.VoiceMessagingProviderCallbackIds={VOICEMAIL_NUMBER_CHANGED:"VOICEMAIL_NUMBER_CHANGED",MWI_STATUS_CHANGED:"MWI_STATUS_CHANGED"}}(),function(i){"use strict";var t="text/plain",a="POST";function e(e,t,i,a,r){this._href=e,this._bucketName=t,this._sessionId=i,this._clientId=a,this._displayName=r}e.prototype={buildMultipartOptions:function(){var e=i.Base.Utils.parseUrl(this._href),t=e.protocol+"://"+e.host;return{urlSuffix:e.path||"",url:t,contentType:!1,processData:!1,sendType:a,method:a,crossDomain:!0}},buildMultipartData:function(e){var t=new FormData;t.append("metadata",this._buildMetadata());e=this._buildLogfile(e);return t.append("logfile",e,this._logFilename(".log")),t},buildMultipartDataAsZip:function(e){var t=E.Deferred(),i=new FormData;return i.append("metadata",this._buildMetadata()),this._buildLogfileAsZip(e).then(function(e){i.append("logfile",e,this._logFilename(".zip")),t.resolve(i)}.bind(this),function(e){t.reject(e)}),t.promise()},_buildMetadata:function(){var e={bucketName:this._bucketName,contentType:t,sessionID:this._sessionId};return this._displayName&&(e.displayName=this._displayName),this._clientId&&(e.clientID=this._clientId),JSON.stringify(e)},_buildLogfile:function(e){return new Blob([e],{type:"text/plain; charset=UTF-8"})},_buildLogfileAsZip:function(e){var t=E.Deferred(),i=new JSZip;return i.file("jscsdk_upload.log",e),i.generateAsync({type:"blob",compression:"DEFLATE"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()},_logFilename:function(e){var t=this._sessionId+"_"+this._clientId;return this._displayName&&(t+="_"+this._trimDisplayName()),t+=e},_trimDisplayName:function(){return this._displayName.replace(/\s/g,"")}},i.Providers.Mpaas.GoogleCloudMessageBuilder=e}(AvayaClientServices),function(o){"use strict";function e(){this.MAX_RETRIES=3,this.RETRY_WAIT_TIME=1e3,this._serverInfo=T,this._href=T,this._messageBuilder=T,this._credentialProvider=T,this._isStarted=!1,this._startPromise=T,this._uploadTimer=T,this._hasPendingUpload=!1,this._restProvider=new o.Base.NetworkProvider(new o.Base.RESTProvider)}(e.prototype={}).start=function(e,t,i,a,r,s){if(this._isStarted){if(this._href===t)return E.Deferred().resolve().promise();var n=E.Deferred();return this.stop().always(function(){this._startProvider().then(function(){n.resolve()},function(e){n.reject(e)})}.bind(this)),n.promise()}return this._serverInfo=e,this._href=t,this._credentialProvider=s,this._messageBuilder=new o.Providers.Mpaas.GoogleCloudMessageBuilder(t,i,a,r),this._startProvider()},e.prototype.stop=function(){return this._stopProvider()},e.prototype._startProvider=function(){return o.Base.Utils.isUndefined(this._serverInfo)?E.Deferred().reject("Uninitialized remote server").promise():(this._isStarted||(this._isStarted=!0,this._startPromise=E.Deferred(),this._restProvider._onCredentialsRequired=this._onCredentialsRequired.bind(this),this._restProvider.onConnectionUnavailable=function(e){o.Base.Logger.error("Error communicating with upload log server:",e),this._stopProvider()}.bind(this),this._restProvider.onOpen=function(){this._startPromise.resolve()}.bind(this),this._restProvider.onError=function(e){o.Base.Logger.error("Error encountered with upload log server:",e),this._stopProvider()}.bind(this),this._restProvider.on(o.Base.NetworkProviderEvents.UNAUTHORIZED,function(e){o.Base.Logger.error("Unauthorized connection to upload log server:",e),this._stopProvider(),this._startPromise.reject(o.Base.NetworkProviderEvents.UNAUTHORIZED)}.bind(this)),this._restProvider.disableNetworkLogging(),this._restProvider.start(new o.Config.NetworkProviderConfiguration(this._serverInfo),this._credentialProvider)),this._startPromise.promise())},e.prototype._onCredentialsRequired=function(t,e){e&&e!==this._credentialProvider&&o.Base.Utils.deepMerge(this._credentialProvider,e),this._credentialProvider.onAuthenticationChallenge(void 0,function(e){this._onCredentialsRetrieved(e,t)}.bind(this))},e.prototype._onCredentialsRetrieved=function(e,t){o.Base.Utils.isDefined(t.options)&&(t.options.authentication=t.options.authentication||{},e.token?(e.bearer=e.bearer||o.Config.Authentication.TokenType.BEARER,this._credentialProvider.token!==e.token&&(this._credentialProvider.token=e.token),t.options.authentication.type=o.Config.Authentication.Scheme.BEARER,t.options.authentication.token=e.token,t.options.authentication.bearer=e.bearer):(t.options.authentication.type=o.Config.Authentication.Scheme.BASIC,t.options.authentication.username=e.username,t.options.authentication.password=e.password))},e.prototype._stopProvider=function(){return this._uploadTimer&&(clearTimeout(this._uploadTimer),this._uploadTimer=T),this._isStarted?this._restProvider.close().always(function(){this._isStarted=!1}.bind(this)):E.Deferred().reject("LoggerProvider: Provider is not started").promise()},e.prototype.upload=function(e){return this._hasPendingUpload?E.Deferred().reject("There is pending upload").promise():e?this._upload(e,this._sendLogs.bind(this)):E.Deferred().reject("Invalid logs").promise()},e.prototype.uploadZip=function(e){return this._hasPendingUpload?E.Deferred().reject("There is pending upload").promise():e?this._isZipLibraryInstalled()?this._upload(e,this._sendLogsAsZip.bind(this)):(o.Base.Logger.warn("Missing required JSZip library. Will upload as uncompressed file"),this._upload(e,this._sendLogs.bind(this))):E.Deferred().reject("Invalid logs").promise()},e.prototype._isZipLibraryInstalled=function(){return"undefined"!=typeof JSZip},e.prototype._upload=function(e,a){var r=E.Deferred();this._hasPendingUpload=!0;var s=function(t){var i;t++>=this.MAX_RETRIES?(this._hasPendingUpload=!1,r.reject("Max attempts reached")):(i=this.RETRY_WAIT_TIME*Math.pow(2,t),this._isStarted?a(e).then(function(){this._hasPendingUpload=!1,r.resolve()}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this)):this._startProvider().then(function(){a(e).then(function(){this._hasPendingUpload=!1,r.resolve()}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this))}.bind(this),function(e){this._uploadTimer=setTimeout(function(){s(t)},i)}.bind(this)))}.bind(this);return s(0),r.promise()},e.prototype._sendLogs=function(e){var t=this._messageBuilder.buildMultipartOptions(),e=this._messageBuilder.buildMultipartData(e);return this._restProvider.send(e,t)},e.prototype._sendLogsAsZip=function(e){var t=E.Deferred(),i=this._messageBuilder.buildMultipartOptions();return this._messageBuilder.buildMultipartDataAsZip(e).then(function(e){this._restProvider.send(e,i).then(function(){t.resolve()},function(e){t.reject(e)})}.bind(this),function(e){t.reject(e)}),t.promise()},o.Providers.Mpaas.LoggerProvider=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.CallbackIds={MAX_SIZE_REACHED:"maxSizeReached"}}(),function(r){"use strict";function e(){r.Base.Observable.call(this),this._output="",this._oldOutput=[],this._outputBytesCount=0,this._loggingLevel=r.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG,this._loggingEnabled=!0,this.MAX_LOG_SIZE=2097152,this.MAX_LOG_COUNT=5,this._maxSizeReachedCount=0}(e.prototype=Object.create(r.Base.Observable.prototype)).log=function(e,t){if(this._loggingEnabled)switch(e){case"debug":this._debug(t);break;case"info":this._info(t);break;case"trace":this._trace(t);break;case"warn":this._warn(t);break;case"error":this._error(t);break;case"fatal":this._fatal(t);break;default:this._info(t)}},e.prototype.getOutput=function(){var e=this._oldOutput.join("");return e+=this._output},e.prototype.clear=function(e){if(e)for(var t=e;0<t;){var i,a=this._oldOutput.shift();a?t-a.length<0?(i=a.substring(t),this._oldOutput.unshift(i),t=0):t-=a.length:(this._output=this._output.substring(t),this._outputBytesCount=r.Base.Utils.getBytesCount(this._output),t=0)}else this._output="",this._oldOutput=[],this._outputBytesCount=0},e.prototype.enableLogging=function(e){this._loggingEnabled=e},e.prototype.setLoggingLevel=function(e){this._loggingLevel=e},e.prototype._info=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.INFO&&this._prettyPrint("[I]",e)},e.prototype._error=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.ERROR&&this._prettyPrint("[E]",e)},e.prototype._fatal=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.FATAL&&this._prettyPrint("[F]",e)},e.prototype._debug=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.DEBUG&&this._prettyPrint("[D]",e)},e.prototype._trace=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.TRACE&&this._prettyPrint("[T]",e)},e.prototype._warn=function(e){this._loggingLevel<=r.Providers.RemoteLogger.LOGGING_LEVELS.WARN&&this._prettyPrint("[W]",e)},e.prototype._prettyPrint=function(e,t){e=e+" "+t.shift();0<t.length&&(e+=" "+this._format(t));t=r.Base.Utils.getBytesCount(e+="\n");this._output+=e,this._outputBytesCount+=t,this._outputBytesCount>=this.MAX_LOG_SIZE&&(this._oldOutput.push(this._output),this._oldOutput.length>=this.MAX_LOG_COUNT&&this._oldOutput.shift(),this._output="",this._outputBytesCount=0,this._triggerMaxSizeReached())},e.prototype._format=function(e){var t="",i=0;return e.forEach(function(e){switch(0!==i&&(t+=" "),typeof e){case"boolean":t+=e?"true":"false";break;case"object":t+=JSON.stringify(e);break;default:t+=e}i++}),t},e.prototype._triggerMaxSizeReached=function(){this.trigger(r.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,[])},r.Providers.RemoteLogger.Logger=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.LOGGING_LEVELS={DEBUG:0,TRACE:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}(),function(){"use strict";AvayaClientServices.Providers.RemoteLogger.Names={MPAAS:"MPaaS"}}(),function(i){"use strict";function e(){this._logger=new i.Providers.RemoteLogger.Logger,this._uploadProviders={},this._logger.on(i.Providers.RemoteLogger.CallbackIds.MAX_SIZE_REACHED,function(){this.uploadLogs()}.bind(this))}(e.prototype={}).getLogger=function(){return this._logger},e.prototype.getProvider=function(e){var t;return this._uploadProviders.hasOwnProperty(e)?t=this._uploadProviders[e]:e===i.Providers.RemoteLogger.Names.MPAAS&&(t=new i.Providers.Mpaas.LoggerProvider,this._uploadProviders[i.Providers.RemoteLogger.Names.MPAAS]=t),t},e.prototype.uploadLogs=function(e){var t=this._logger.getOutput(),i=t.length;if(0===t.length)return E.Deferred().resolve().promise();var a,r,s=E.Deferred(),n=[];return e?this._upload(e,t,n):this._multipleUploads(t,n),0===n.length?s.reject("No upload logger provider found."):(r=a=0,n.forEach(function(e){e.then(function(){++a+r===n.length&&(this._logger.clear(i),s.resolve())}.bind(this),function(e){a+ ++r===n.length&&(0<a?(this._logger.clear(i),s.resolve()):s.reject(e))}.bind(this))}.bind(this))),s.promise()},e.prototype._upload=function(e,t,i){!this._uploadProviders.hasOwnProperty(e)||(e=this._uploadProviders[e])&&i.push(e.uploadZip(t))},e.prototype._multipleUploads=function(e,t){for(var i in this._uploadProviders)!this._uploadProviders.hasOwnProperty(i)||(i=this._uploadProviders[i])&&t.push(i.uploadZip(e))},i.Providers.RemoteLogger.RemoteLoggerProvider=e}(AvayaClientServices),function(s){"use strict";function e(){}e.prototype.updateMeetingInfo=function(t,i){var e,a=0<t._activeParticipants.length;s.Base.Utils.isDefined(i.eventConference)&&t._eventConference!==i.eventConference&&(t._eventConference=i.eventConference,t._onEventConferenceStatusChangedCallbacks.fire(t,t._eventConference)),i.meetingName&&i.meetingName!==t._subject&&(t._subject=i.meetingName,t._onConferenceSubjectChangedCallbacks.fire(t,i.meetingName)),i.lecturerId&&"none"!==i.lecturerId!==t._isLectureModeActive&&(t._isLectureModeActive="none"!==i.lecturerId,t._onConferenceLectureModeStatusChangedCallbacks.fire(t,t._isLectureModeActive)),i.lecturerId&&i.lecturerId!==t._lecturerId&&(a?((e=t._activeParticipants.filter(function(e){return!!e._participantId&&e._participantId===t._lecturerId})[0])&&(e._lecturer=!1,e._onParticipantUnsetAsLecturerCallbacks.fire(e)),t._lecturerId=i.lecturerId,(e=t._activeParticipants.filter(function(e){return e._participantId===t._lecturerId})[0])&&(e._lecturer=!0,e._onParticipantSetAsLecturerCallbacks.fire(e))):t._lecturerId=i.lecturerId),i.virtualRoomOwnerId&&i.virtualRoomOwnerId!==t._conferenceOwnerAddress&&(t._conferenceOwnerAddress=i.virtualRoomOwnerId,t._activeParticipants.forEach(function(e){e._isConferenceOwner=e._userId===i.virtualRoomOwnerId,e._recalculateAllCapabilities()}),t._onConferenceOwnerAddressChangedCallbacks.fire(t,i.virtualRoomOwnerId)),i.recorderAvailable&&i.recorderAvailable!==t._recorderStatus&&(t._recorderStatus=i.recorderAvailable),i.recording&&i.recording!==t._recordingStatus&&(t._recordingStatus=i.recording,t._onConferenceRecordingStatusChangedCallbacks.fire(t,t._recordingStatus)),!i.locked&&!1!==i.locked||i.locked===t._isLocked||(t._isLocked=i.locked,t._admissionPasscodeNeeded=i.locked,t._admissionPermissionNeeded=i.locked,t._onConferenceLockStatusChangedCallbacks.fire(t,t._isLocked,t._admissionPasscodeNeeded,t._admissionPermissionNeeded)),i.media&&"video"===i.media!==t._isVideoAllowed&&(t._isVideoAllowed="video"===i.media,t._onConferenceVideoStatusChangedCallbacks.fire(t,t._isVideoAllowed)),i.presenterId&&"none"!==i.presenterId!==t._isApplicationSharingActive&&(t._isApplicationSharingActive="none"!==i.presenterId,t._onConferencePresentationModeStatusChangedCallbacks.fire(t,t._isApplicationSharingActive)),i.presenterId&&i.presenterId!==t._presenterId&&(a?((a=t._activeParticipants.filter(function(e){return e._participantId===t._presenterId})[0])&&(a._presenter=!1,a._onParticipantUnsetAsPresenterCallbacks.fire(a)),t._presenterId=i.presenterId,(e=t._activeParticipants.filter(function(e){return e._participantId===t._presenterId})[0])&&(e._presenter=!0,e._onParticipantSetAsPresenterCallbacks.fire(e))):t._presenterId=i.presenterId),i.encrypted&&i.encrypted!==t._encryptionStatus&&(t._encryptionStatus=i.encrypted,t._onConferenceEncryptionStatusChangedCallbacks.fire(t,t._encryptionStatus)),i.streaming!==T&&i.streaming!==t._isStreamingActive&&(t._isStreamingActive=i.streaming,t._onConferenceStreamingStatusChangedCallbacks.fire(t,t._isStreamingActive)),i.terminationTime&&i.terminationTime!==t._terminationTime&&(t._terminationTime=i.terminationTime,t._onConferenceMeetingTerminationTimeChangedCallbacks.fire(t,t._terminationTime)),i.moderatorPinNeeded!==T&&i.moderatorPinNeeded!==t._isPasscodeRequiredToBecomeModerator&&(t._isPasscodeRequiredToBecomeModerator=i.moderatorPinNeeded),i.mediaStatus&&i.mediaStatus!==t._mediaStatus&&(t._mediaStatus?i.mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(t._mediaStatus=i.mediaStatus,t._onConferenceAllParticipantsMutedCallbacks.fire(t)):i.mediaStatus===s.Services.Conference.MediaStatus.ACTIVE&&t._mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO?(t._mediaStatus=i.mediaStatus,t._onConferenceAllParticipantsUnmutedCallbacks.fire(t)):i.mediaStatus===s.Services.Conference.MediaStatus.ACTIVE&&t._mediaStatus===s.Services.Conference.MediaStatus.WAITING_ROOM?(t._mediaStatus=i.mediaStatus,t._onConferenceStartingCallbacks.fire(t,t._mediaStatus)):t._mediaStatus=i.mediaStatus:(t._mediaStatus=i.mediaStatus,t._mediaStatus===s.Services.Conference.MediaStatus.WAITING_ROOM?t._onConferenceWaitingToStartCallbacks.fire(t,t._mediaStatus):t._mediaStatus===s.Services.Conference.MediaStatus.MUTE_ALL_AUDIO&&t._onConferenceAllParticipantsMutedCallbacks.fire(t)))},e.prototype.updateRoster=function(i,e){var t=[],a=[],r={};e.participants.forEach(function(e){r=this._buildActiveParticipant(e,i),a.push(r),0<i._activeParticipants.filter(function(e){return e._participantId===r._participantId}).length||(r._participantId===i._selfParticipantId&&(r._localUser=!0,i._selfParticipant=r,i.getInConferenceChat()._setSelfParticipant(r),r._isSelfParticipant=!0),t.push(r),i._activeParticipants.push(r))}.bind(this));e=i.getActiveParticipants().filter(function(t){return 0===a.filter(function(e){return e._participantId===t._participantId}).length});e.concat(i.getPendingParticipants().filter(function(t){return 0===a.filter(function(e){return e._participantId===t._participantId}).length})),e.forEach(function(e){var t=new s.Providers.UCCP.UCCPParticipantLeftEvent(e._participantId);s.Base.Logger.info("Dropping participant that is no longer in roster list: ",e._participantId),this.dropParticipant(i,t)}.bind(this)),i._activeParticipants.forEach(function(e){e._recalculateAllCapabilities()}),i._conferenceService._updateMatchedContactsForConference(i),0<t.length&&i._onConferenceParticipantsAddedCallbacks.fire(i,t),i._isLectureModeActive&&(r=i._activeParticipants.filter(function(e){return e._participantId===i._lecturerId})[0])&&(r._lecturer=!0,r._onParticipantSetAsLecturerCallbacks.fire(r)),i._isApplicationSharingActive&&(r=i._activeParticipants.filter(function(e){return e._participantId===i._presenterId})[0])&&(r._presenter=!0,r._onParticipantSetAsPresenterCallbacks.fire(r))},e.prototype.updateSlider=function(e,t){},e.prototype.addActiveParticipant=function(e,t){var i;0<e._activeParticipants.filter(function(e){return e._participantId===t.participantId}).length?this._buildActiveExistingParticipant(t,e):((i=this._buildActiveParticipant(t,e))._participantId===e._selfParticipantId&&(i._localUser=!0,e._selfParticipant=i,e.getInConferenceChat()._setSelfParticipant(i),i._isSelfParticipant=!0,e._recalculateAllCapabilities()),e._activeParticipants.push(i),e._onConferenceParticipantsAddedCallbacks.fire(e,[i]),e._conferenceService._updateMatchedContactsForParticipant(i),i._recalculateAllCapabilities())},e.prototype.addDialoutParticipant=function(e,t,i){if(0<e._activeParticipants.filter(function(e){return e._participantId===t.participantId}).length)return!1;var a=new s.Services.Conference.ActiveParticipant(e._participantService,e);return a._participantId=t.participantId,a._displayName=i,e._activeParticipants.push(a),a._connectionStatus=s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTING,!0},e.prototype.updateDialoutParticipant=function(e,t,i){t._connectionStatus=s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED,t._onParticipantConnectionStatusChangedCallbacks.fire(t,t._connectionStatus)},e.prototype.removeDialoutParticipant=function(e,t,i){var a=e._activeParticipants.filter(function(e){return e._participantId===t})[0];s.Base.Utils.isDefined(a)&&e._activeParticipants.splice(e._activeParticipants.indexOf(a),1)},e.prototype.addPendingParticipant=function(e,t){var i;0<e._pendingParticipants.filter(function(e){return e._participantId===t.participantId}).length||(i=this._buildPendingParticipant(t,e),e._pendingParticipants.push(i),e._conferenceService._updateMatchedContactsForParticipant(i),e._onConferencePendingParticipantCallbacks.fire(e,i))},e.prototype.removePendingParticipant=function(e,t){var i,a=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId||e._participantId===t._participantId})[0];s.Base.Utils.isDefined(a)&&(i=e._pendingParticipants.indexOf(a),e._pendingParticipants.splice(i,1),e._onConferencePendingParticipantRemovedCallbacks.fire(e,a))},e.prototype.pendingParticipantAccepted=function(e,t){e._onPendingParticipantAcceptedCallbacks.fire(e,t.anotherModerator),this.removePendingParticipant(e._conference,e)},e.prototype.pendingParticipantCancelled=function(e,t){e=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId})[0];s.Base.Utils.isDefined(e)&&(e._onPendingParticipantCancelledCallbacks.fire(e,t.reason,t.anotherModerator),this.removePendingParticipant(e._conference,e))},e.prototype.pendingParticipantDenied=function(e,t){e._onPendingParticipantDeniedCallbacks.fire(e,t.anotherModerator),this.removePendingParticipant(e._conference,e)},e.prototype.dropParticipant=function(e,t){var i,a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0],r=e._pendingParticipants.filter(function(e){return e._participantId===t.participantId})[0];s.Base.Utils.isDefined(a)&&(e._activeParticipants.splice(e._activeParticipants.indexOf(a),1),i=this._buildDroppedParticipant(a,e),e._droppedParticipants.push(i),e._conferenceService._updateMatchedContactsForParticipant(i),e._onConferenceParticipantsRemovedCallbacks.fire(e,[a]),e._onConferenceDroppedParticipantAddedCallbacks.fire(e,i)),s.Base.Utils.isDefined(r)&&(e._pendingParticipants.splice(e._pendingParticipants.indexOf(r),1),e._onConferencePendingParticipantRemovedCallbacks.fire(e,r))},e.prototype.updateMeetingNote=function(e,t){},e.prototype.updateActiveTalker=function(t,i){var e;i.participantId!==t._activeTalkerId&&(e=t._activeParticipants.filter(function(e){return e._participantId===t._activeTalkerId})[0],s.Base.Utils.isDefined(e)&&e._onParticipantActiveTalkerStatusChangedCallbacks.fire(e,!1),e=t._activeParticipants.filter(function(e){return e._participantId===i.participantId})[0],s.Base.Utils.isDefined(e)&&(t._activeTalkerId=i.participantId,t._onConferenceActiveTalkersChangedCallbacks.fire(t,e),e._lastSpokenTime=new Date,e._onParticipantActiveTalkerStatusChangedCallbacks.fire(e,!0))),t._activeTalkerId&&e&&(t._recentTalkersList=t.getRecentTalkers().filter(function(e){return e._participantId!==t._activeTalkerId}),t.getRecentTalkers().push(e),t.getRecentTalkers().length>s.Services.Conference.RecentTalkersConfiguration.SIZE&&(t._recentTalkersList=t.getRecentTalkers().slice(-s.Services.Conference.RecentTalkersConfiguration.SIZE)))},e.prototype.updateWebCollab=function(e,t){s.Base.Utils.isDefined(t)&&s.Base.Utils.isDefined(t.webCollabUrl)&&0<t.webCollabUrl.length?e._collaborationURI=t.webCollabUrl+"/viewer.php?token="+t.token+"&participantId="+t.participantId+"&meeting_id="+t.meeting_id+"&mode="+t.mode+"&login="+t.login:e._collaborationURI="",e._onConferenceCollaborationURIChangedCallbacks.fire(e,e._collaborationURI)},e.prototype.updatePermissions=function(e,t){s.Base.Utils.isDefined(t.dialout)&&t.dialout!==e._dialoutPermissions&&(e._dialoutPermissions=t.dialout),s.Base.Utils.isDefined(t.recording)&&t.recording!==e._recordingPermissions&&(e._recordingPermissions=t.recording),s.Base.Utils.isDefined(t.lock)&&t.lock!==e._lockPermissions&&(e._lockPermissions=t.lock),s.Base.Utils.isDefined(t.unmuteSelf)&&t.unmuteSelf!==e._unmuteSelfPermissions&&(e._unmuteSelfPermissions=t.unmuteSelf),s.Base.Utils.isDefined(t.unmuteAll)&&t.unmuteAll!==e._unmuteAllPermissions&&(e._unmuteAllPermissions=t.unmuteAll),s.Base.Utils.isDefined(t.sendFecc)&&t.sendFecc!==e._sendFeccPermissions&&(e._sendFeccPermissions=t.sendFecc),s.Base.Utils.isDefined(t.allowVideo)&&t.allowVideo!==e._allowVideoDirection&&(e._allowVideoDirection=t.allowVideo,e._isAvailable&&s.Base.Utils.isDefined(e._selfParticipant)&&e._onConferenceAllowVideoDirectionChangedCallbacks.fire(e)),e._recalculateAllCapabilities()},e.prototype.updateAvailableLayouts=function(e,t){if(s.Base.Utils.isDefined(t.textOverlay)&&t.textOverlay!==e._isVideoParticipantNameDisplayChangeAllowed&&(e._isVideoParticipantNameDisplayChangeAllowed=t.textOverlay,e._recalculateAllCapabilities(),e._onConferenceDisplayParticipantNameOnVideoAllowedCallbacks.fire(e,e._isVideoParticipantNameDisplayChangeAllowed)),s.Base.Utils.isDefined(t.LPPOn)&&t.LPPOn!==e._isVideoPersonalLayoutActive&&(e._isVideoPersonalLayoutActive=t.LPPOn,e._recalculateAllCapabilities()),s.Base.Utils.isDefined(t.noSelfSee)&&t.noSelfSee!==e._isVideoSelfSeeChangeAllowed&&(e._isVideoSelfSeeChangeAllowed=t.noSelfSee,e._recalculateAllCapabilities(),e._onConferenceVideoSelfSeeAllowedCallbacks.fire(e,e._isVideoSelfSeeChangeAllowed)),s.Base.Utils.isDefined(t.videoPin)&&t.videoPin!==e._isVideoPinAllowed&&(e._isVideoPinAllowed=t.videoPin,e._recalculateAllCapabilities(),e._onConferenceVideoPinAllowedCallbacks.fire(e,e._isVideoPinAllowed)),s.Base.Utils.isDefined(t.geometries)){var i=e._supportedVideoLayouts.slice(0);e._supportedVideoLayouts=t.geometries.slice(0);var a=!1;if(i.length===e._supportedVideoLayouts.length){for(var r=0;r<i.length;r++)if(i[r]!==e._supportedVideoLayouts[r]){a=!0;break}}else a=!0;a&&(e._recalculateAllCapabilities(),e._onConferenceAvailableVideoLayoutsChangedCallbacks.fire(e,e._supportedVideoLayouts))}},e.prototype.updateCurrentLayout=function(e,t){var i;s.Base.Utils.isDefined(t.textOverlay)&&t.textOverlay!==e._isVideoParticipantNameDisplayActive&&(e._isVideoParticipantNameDisplayActive=t.textOverlay,e._onConferenceDisplayVideoParticipantNameChangedCallbacks.fire(e,e._isVideoParticipantNameDisplayActive)),s.Base.Utils.isDefined(t.LPPOn)&&t.LPPOn!==e._isVideoPersonalLayoutActive&&(e._isVideoPersonalLayoutActive=t.LPPOn),s.Base.Utils.isDefined(t.noSelfSee)&&(i=e._isVideoSelfSeeActive,e._isVideoSelfSeeActive=!t.noSelfSee,e._isVideoSelfSeeActive!==i&&e._onConferenceVideoSelfSeeChangedCallbacks.fire(e,e._isVideoSelfSeeActive)),s.Base.Utils.isDefined(t.geometry)&&t.geometry!==e._currentVideoLayout&&(e._currentVideoLayout=t.geometry,e._onConferenceVideoLayoutChangedCallbacks.fire(e,e._currentVideoLayout))},e.prototype.addChatMessage=function(e,t){var i=e.getInConferenceChat(),a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];t.participantId!==e._selfParticipantId&&(a=new s.Services.Conference.ChatMessage(t.text,a,i._selfParticipant,t.type===s.Services.Conference.ChatType.PRIVATE),i._addMessage(a))},e.prototype._buildActiveParticipant=function(e,t){var i=new s.Services.Conference.ActiveParticipant(t._participantService,t);return i._participantId=e.participantId,i._displayName=e.participantName,i._address=e.userId,i._userId=e.userId,i._joinTime=e.joinTime,i._sourceID=e.sourceID,i._status=e.status,i._handRaised=e.handRaised,i._role=e.role,i._feccRecvSupport=e.feccRecvSupport,i._audioFromParticipant=e.audioFromParticipant,i._audioToParticipant=e.audioToParticipant,i._videoFromParticipant=e.videoFromParticipant,i._videoToParticipant=e.videoToParticipant,i._contentFromParticipant=e.contentFromParticipant,i._contentToParticipant=e.contentToParticipant,i._canLecture=e.canLecture,i._wasPreviouslyNotVisibleInParticipantList=e.wasHidden,i._isConferenceOwner=e.userId===t._conferenceOwnerAddress,i},e.prototype._buildDroppedParticipant=function(e,t){t=new s.Services.Conference.DroppedParticipant(t._participantService,t);return t._participantId=e._participantId,t._userId=e._userId,t._displayName=e._displayName,t._address=e._address,t._localUser=!1,t._conference=e._conference,t._recalculateAllCapabilities(),t},e.prototype._buildPendingParticipant=function(e,t){var i=new s.Services.Conference.PendingParticipant(t._participantService,t);return i._participantId=e.participantId,i._userId=e.userId,i._displayName=e.participantName,i._address=e.userId,i._status=e.status,i._localUser=!1,i._conference=t,i._recalculateAllCapabilities(),i},e.prototype._buildActiveExistingParticipant=function(t,e){var i=e._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];return i._connectionStatus===s.Services.Conference.ParticipantConnectionStatus.CONNECTION_STATUS_CONNECTED?(i._displayName=t.participantName,i._userId=t.userId,i._address=t.userId,i._joinTime=t.joinTime,i._sourceID=t.sourceID,i._status=t.status,i._handRaised=t.handRaised,i._role=t.role,i._feccRecvSupport=t.feccRecvSupport,i._audioFromParticipant=t.audioFromParticipant,i._audioToParticipant=t.audioToParticipant,i._videoFromParticipant=t.videoFromParticipant,i._videoToParticipant=t.videoToParticipant,i._contentFromParticipant=t.contentFromParticipant,i._contentToParticipant=t.contentToParticipant,i._canLecture=t.canLecture,i._wasPreviouslyNotVisibleInParticipantList=t.wasHidden,e._onConferenceParticipantsAddedCallbacks.fire(e,[i]),i._recalculateAllCapabilities()):this._updateParticipantsData(e,i,t),i},e.prototype.updateParticipant=function(e,t,i){var a=e._activeParticipants.filter(function(e){return e._participantId===t.participantId});s.Base.Utils.isDefined(a[0])?(this._updateParticipantsData(e,a[0],t),e._conferenceService._updateMatchedContactsForParticipant(a[0])):(i=s.Base.Utils.isDefined(i)?i:0,s.Base.Logger.info(s.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"updateParticipant: Participant is not found."),i<2&&setTimeout(function(){this.updateParticipant(e,t,++i)}.bind(this),500))},e.prototype._updateParticipantsData=function(e,t,i){var a;s.Base.Utils.isDefined(i.audioFromParticipant)&&t._audioFromParticipant!==i.audioFromParticipant&&(t._audioFromParticipant=i.audioFromParticipant,t._isAudioMuted=i.audioFromParticipant!==s.Services.Conference.MediaFromParticipantStatus.ACTIVE,t._onParticipantAudioStatusChangedCallbacks.fire(t,t._audioFromParticipant),t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.videoFromParticipant)&&t._videoFromParticipant!==i.videoFromParticipant&&(t._videoFromParticipant=i.videoFromParticipant,t._isVideoBlocked=i.videoFromParticipant!==s.Services.Conference.MediaFromParticipantStatus.ACTIVE,t._onParticipantVideoStatusChangedCallbacks.fire(t,t._videoFromParticipant),t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.joinTime)&&t._joinTime!==i.joinTime&&(t._joinTime=i.joinTime),s.Base.Utils.isDefined(i.status)&&t._status!==i.status&&(t._status=i.status,t._onParticipantStatusChangedCallbacks.fire(t,t._status)),s.Base.Utils.isDefined(i.handRaised)&&t._handRaised!==i.handRaised&&(t._handRaised=i.handRaised,t.isLocalUser()&&(e._isHandRaised=i.handRaised),(t._handRaised?t._onParticipantHandRaisedCallbacks:t._onParticipantHandLoweredCallbacks).fire(t)),s.Base.Utils.isDefined(i.role)&&t._role!==i.role&&(a=t._role,t._role=i.role,t._role===s.Services.Conference.ParticipantRole.MODERATOR?t._onParticipantSetAsModeratorCallbacks.fire(t):a===s.Services.Conference.ParticipantRole.MODERATOR&&t._role!==s.Services.Conference.ParticipantRole.MODERATOR&&t._onParticipantUnsetAsModeratorCallbacks.fire(t),e._recalculate()),s.Base.Utils.isDefined(i.canLecture)&&t._canLecture!==i.canLecture&&(t._canLecture=i.canLecture,t._recalculateAllCapabilities()),s.Base.Utils.isDefined(i.participantName)&&t._displayName!==i.participantName&&(t._displayName=i.participantName,t._onParticipantDisplayNameChangedCallbacks.fire(t),t._onParticipantNameChangedCallbacks.fire(t)),s.Base.Utils.isDefined(i.feccRecvSupport)&&t._feccRecvSupport!==i.feccRecvSupport&&(t._feccRecvSupport=i.feccRecvSupport),s.Base.Utils.isDefined(i.audioToParticipant)&&t._audioToParticipant!==i.audioToParticipant&&(t._audioToParticipant=i.audioToParticipant),s.Base.Utils.isDefined(i.videoToParticipant)&&t._videoToParticipant!==i.videoToParticipant&&(t._videoToParticipant=i.videoToParticipant),s.Base.Utils.isDefined(i.contentFromParticipant)&&t._contentFromParticipant!==i.contentFromParticipant&&(t._contentFromParticipant=i.contentFromParticipant,t._onParticipantCollaborationStatusChangedCallbacks.fire(t)),s.Base.Utils.isDefined(i.contentToParticipant)&&t._contentToParticipant!==i.contentToParticipant&&(t._contentToParticipant=i.contentToParticipant),s.Base.Utils.isDefined(i.userId)&&t._userId!==i.userId&&(t._userId=i.userId)},e.prototype.updateDialInInfo=function(e,t){e._joinMeetingURI=t.webLink,e._streamingURI=t.streamingLink,e._dialInInformation=t.dialInInformation,e._dialInInformationHtml=t.dialInInformationHtml,e._onConferenceStreamingURIUpdatedCallbacks.fire(e),e._onConferenceJoinMeetingURIUpdatedCallbacks.fire(e),e._onConferenceDialInInfoUpdatedCallbacks.fire(e)},e.prototype.recordingFailed=function(e,t){e._onConferenceRecordingFailedCallbacks.fire(e)},e.prototype.meetingTerminationInProgress=function(e,t){e._onConferenceMeetingTerminationInProgressCallbacks.fire(e,t.reason,t.userName)},e.prototype.handleDisconnectEvent=function(e,t){s.Base.Logger.info(s.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference received disconnect event. Reason: "+t.reason),e._conferenceService._isDisconnecting=!0,e._onConferenceConnectionEndedCallbacks.fire(e,t.reason),e.stop()},e.prototype.networkFailureHandler=function(e){e._isAvailable&&(e._isAvailable=!1,e._inConferenceChatCapability.denialReason=s.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED,e._inConferenceChatCapability.isAllowed=!1,e._onConferenceServiceUnavailableCallbacks.fire(e,new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.NETWORK_UNAVAILABLE))),e._recalculate()},e.prototype.networkAvailabilityHandler=function(e){e._isAvailable||(e._isAvailable=!0,e._inConferenceChatCapability.denialReason=s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,e._inConferenceChatCapability.isAllowed=!0,e._onConferenceServiceAvailableCallbacks.fire(e)),e._recalculate()},e.prototype.connectionRecoveryFailureHandler=function(e){e._isAvailable&&(e._isAvailable=!1),e._onConferenceServiceUnavailableCallbacks.fire(e,new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CONFERENCE_CONNECTION_FAILED_TO_RECOVER)),e._recalculate()},s.Providers.Scopia.ScopiaConferenceBuilder=e}(AvayaClientServices),function(r){"use strict";function e(e,t){r.Providers.Interfaces.ConferenceProvider.call(this),this._dataProvider=e,this._conferenceBuilder=t,this._transaction={id:1},this._isAvailable=!1,this._isChatEnabled=!0,this._networkFailureTimer=T}(e.prototype=Object.create(r.Providers.Interfaces.ConferenceProvider.prototype)).start=function(a,e){if(this._isAvailable)return E.Deferred().resolve();var t=r.Base.Utils.queryJSONObject(e,"networkProviderConfiguration.webSocketConfig");return!1!==e.enabled&&r.Base.Utils.isDefined(t)?(this._startNetworkFailureTimer(a),this._dataProvider.start(e,a).then(function(){return this._dataProvider.sendHandshake(this._transaction.id++)}.bind(this)).then(function(e){var t=E.Deferred();this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._conferenceBuilder.networkAvailabilityHandler(a),a._selfParticipantId=e.participantId,a._admissionPermissionNeeded=e.admissionPermissionNeeded,a._admissionPasscodeNeeded=e.admissionPasscodeNeeded,a._knockDoorTimeout=e.knockDoorTimeout,(e.admissionPermissionNeeded||e.admissionPasscodeNeeded)&&e.commands&&(0===e.commands.filter(function(e){return"chatRequest"===e.command}).length?this._isChatEnabled=!1:this._isChatEnabled=!0,r.Base.Logger.debug(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER," Admission Permission/Admission needed, _isChatEnabled: ",this._isChatEnabled));var i=a._getPreEnteredPasscode();return e.admissionPermissionNeeded?(this._stopNetworkFailureTimer(),e.admissionPasscodeNeeded?t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission is needed"})):e.admissionPasscodeNeeded?(this._stopNetworkFailureTimer(),i?a.sendPasscode(i).then(function(){e.commands&&(0===e.commands.filter(function(e){return"chatRequest"===e.command}).length?(a._inConferenceChatCapability._updateIfChanged(!1,r.Base.CapabilityDenialReason.CAPABILITY_DISABLED_BY_ADMIN),a._isChatEnabled=!1):(a._inConferenceChatCapability._updateIfChanged(!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),a._isChatEnabled=!0)),t.resolve()},function(){t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):t.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is needed"})):"fail"===e.responseCode?(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),t.reject({name:r.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),a._isAvailable=!0,a._onConferenceServiceAvailableCallbacks.fire(a),this._startListenersAndSubscribes(a),this._isAvailable=!0,e.commands&&(0===e.commands.filter(function(e){return"chatRequest"===e.command}).length?(a._inConferenceChatCapability._updateIfChanged(!1,r.Base.CapabilityDenialReason.CAPABILITY_DISABLED_BY_ADMIN),a._isChatEnabled=!1):(a._inConferenceChatCapability._updateIfChanged(!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),a._isChatEnabled=!0)),t.resolve()),t.promise()}.bind(this),function(e){(e._data&&(502===e._data._status||403===e._data._status)||e.code&&"fail"===e.code)&&(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))):E.Deferred().reject({name:r.Services.Conference.ConferenceStartStatus.CONFERENCE_CONFIG_NOT_ENABLED,message:"Conference config is not enabled"})},e.prototype._startListenersAndSubscribes=function(e,t){return this.addConferenceEventListeners(e,t),this.observeConference(e),r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Conference service is started."),e},e.prototype.observeConference=function(t){this._dataProvider.getDialInInfo(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateDialInInfo(t,e),e}.bind(this)),this._dataProvider.subscribeMeetingInfo(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateMeetingInfo(t,e),t._recalculateAllCapabilities(),e}.bind(this)),this._dataProvider.subscribeRoster(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateRoster(t,e),t._recalculateAllCapabilities(),e}.bind(this)),this._dataProvider.subscribeActiveTalker(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateActiveTalker(t,e),e}.bind(this)),this._dataProvider.subscribeMeetingNote(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateMeetingNote(t,e),e}.bind(this)),this._dataProvider.subscribeWebCollab(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateWebCollab(t,e),e}.bind(this)),this._dataProvider.subscribeAvailableLayouts(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateAvailableLayouts(t,e),e}.bind(this)),this._dataProvider.subscribePermissions(this._transaction.id++).then(function(e){return this._conferenceBuilder.updatePermissions(t,e),e}.bind(this)),this._dataProvider.getCurrentVideoLayout(this._transaction.id++).then(function(e){return this._conferenceBuilder.updateCurrentLayout(t,e),t._recalculateAllCapabilities(),e}.bind(this))},e.prototype.sendAdmissionRequest=function(t,e){return this._dataProvider.sendAdmissionRequest(this._transaction.id++,e).then(function(e){if(e.responseCode===r.Services.Conference.AdmissionResponseCode.SUCCESS)return t._isAvailable=!0,t._setConferenceStarted(!0),t._onConferenceServiceAvailableCallbacks.fire(t),t._admissionPasscodeNeeded=!1,this._isAvailable=!0,t.addOnConferenceRecordingStatusChangedCallback(t._conferenceService._recalculateConferenceRecordingStatuses),this._isChatEnabled?(r.Base.Logger.debug(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER," Admission response success, _isChatEnabled: ",this._isChatEnabled),t._isChatEnabled=!0):(r.Base.Logger.debug(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER," Admission response success, _isChatEnabled: ",this._isChatEnabled),t._isChatEnabled=!1),t._recalculateInConferenceChatCapability(),this._startListenersAndSubscribes(t)}.bind(this))},e.prototype.addConferenceEventListeners=function(t,e){var i;e||((i=this._dataProvider.getSelectedProvider()).on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,function(e){this._conferenceBuilder.addActiveParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,function(e){this._conferenceBuilder.dropParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,function(e){this._conferenceBuilder.updateActiveTalker(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,function(e){this._conferenceBuilder.handleDisconnectEvent(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,function(e){this._conferenceBuilder.updatePermissions(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,function(e){this._conferenceBuilder.updateParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,function(e){this._conferenceBuilder.updateMeetingInfo(t,e),t._recalculateInConferenceChatCapability()}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,function(e){this._conferenceBuilder.updateAvailableLayouts(t,e),e.geometries&&0<e.geometries.length&&i.getCurrentVideoLayout(this._transaction.id++).then(function(e){this._conferenceBuilder.updateCurrentLayout(t,e)}.bind(this),function(e){r.Base.Logger.error(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Failed to retrieve current layout",e)})}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,function(e){this._conferenceBuilder.updateCurrentLayout(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,function(e){this._conferenceBuilder.meetingTerminationInProgress(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,function(e){this._conferenceBuilder.addPendingParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,function(e){this._conferenceBuilder.pendingParticipantCancelled(t,e),this._conferenceBuilder.removePendingParticipant(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,function(e){this._conferenceBuilder.recordingFailed(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,function(e){this._conferenceBuilder.updateWebCollab(t,e)}.bind(this)),i.on(r.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,function(e){this._conferenceBuilder.addChatMessage(t,e)}.bind(this)),i.on(r.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._startNetworkFailureTimer(t),this._conferenceBuilder.networkFailureHandler(t)}.bind(this)),i.on(r.Providers.Interfaces.ConferenceCallbackIds.NETWORK_PROVIDER_IS_AVAILABLE,function(){this._resubscribe(t)}.bind(this)))},e.prototype.stop=function(){return this._isAvailable=!1,this._stopNetworkFailureTimer(),this._dataProvider.stop().fail(function(e){r.Base.Logger.error(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"failed to stop data provider: ",e)})},e.prototype._startNetworkFailureTimer=function(e){r.Base.Utils.isUndefined(this._networkFailureTimer)&&(this._networkFailureTimer=setTimeout(function(){this._conferenceBuilder.connectionRecoveryFailureHandler(e)}.bind(this),2e4))},e.prototype._stopNetworkFailureTimer=function(){this._networkFailureTimer&&(clearTimeout(this._networkFailureTimer),this._networkFailureTimer=T)},e.prototype._startLongPollHandshakeResponseTimer=function(){this._stopLongPollHandshakeResponseTimer(),this._longPollHandshakeResponseTimer=setTimeout(function(){this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&(r.Base.Logger.warn("UCCP long polling handshake timeout"),this._abortLongPollProvider(this._dataProvider.getSelectedProvider()),this._longPollHandshakeResponseTimer=T)}.bind(this),2e4)},e.prototype._abortLongPollProvider=function(e){this._isLongPollingUccpProvider(e)&&e._networkProvider._communicationAdapter.abort()},e.prototype._stopLongPollHandshakeResponseTimer=function(){this._longPollHandshakeResponseTimer&&(clearTimeout(this._longPollHandshakeResponseTimer),this._longPollHandshakeResponseTimer=T)},e.prototype._resubscribe=function(a){return this._isLongPollingUccpProvider(this._dataProvider.getSelectedProvider())&&this._startLongPollHandshakeResponseTimer(),this._dataProvider.sendHandshake(this._transaction.id++).then(function(e){var t,i=E.Deferred();return this._stopLongPollHandshakeResponseTimer(),a._selfParticipantId=e.participantId,a._admissionPermissionNeeded=e.admissionPermissionNeeded,a._admissionPasscodeNeeded=e.admissionPasscodeNeeded,a._knockDoorTimeout=e.knockDoorTimeout,e.admissionPermissionNeeded||e.admissionPasscodeNeeded?(t=a._getPreEnteredPasscode(),this._stopNetworkFailureTimer(),e.admissionPermissionNeeded?e.admissionPasscodeNeeded?i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission and passcode are needed"}):i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference admission is needed"}):e.admissionPasscodeNeeded&&(t?a.sendPasscode(t).then(function(){i.resolve()},function(){i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is wrong"})}):i.reject({name:r.Services.Conference.ConferenceStartStatus.ADMISSION_NEEDED,admissionPasscodeNeeded:e.admissionPasscodeNeeded,admissionPermissionNeeded:e.admissionPermissionNeeded,message:"Conference passcode is needed"}))):"fail"===e.responseCode?(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Handshake Rejected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a),i.reject({name:r.Services.Conference.ConferenceStartStatus.HANDSHAKE_REJECTED})):(this._stopNetworkFailureTimer(),this._conferenceBuilder.networkAvailabilityHandler(a),this._startListenersAndSubscribes(a,!0),e.commands&&(0===e.commands.filter(function(e){return"chatRequest"===e.command}).length?(a._inConferenceChatCapability._updateIfChanged(!1,r.Base.CapabilityDenialReason.CAPABILITY_DISABLED_BY_ADMIN),a._isChatEnabled=!1):(a._inConferenceChatCapability._updateIfChanged(!0,r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),a._isChatEnabled=!0)),i.resolve()),i.promise()}.bind(this),function(e){this._stopLongPollHandshakeResponseTimer(),(e._data&&(502===e._data._status||403===e._data._status)||e.code&&"fail"===e.code)&&(r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Possible iView failover detected"),this._stopNetworkFailureTimer(),this._conferenceBuilder.connectionRecoveryFailureHandler(a))}.bind(this))},e.prototype.setAsLecturer=function(e){return this._dataProvider.setAsLecturer(this._transaction.id++,e)},e.prototype.setLocked=function(e){return this._dataProvider.setLocked(this._transaction.id++,e)},e.prototype.unsetAsLecturer=function(){return this._dataProvider.unsetAsLecturer(this._transaction.id++)},e.prototype.disconnectParticipant=function(e){return this._dataProvider.disconnectParticipant(this._transaction.id++,e)},e.prototype.startRecording=function(e,t,i){return this._dataProvider.startRecording(this._transaction.id++,t,i)},e.prototype.stopRecording=function(e){return this._dataProvider.stopRecording(this._transaction.id++)},e.prototype.pauseRecording=function(e){return this._dataProvider.pauseRecording(this._transaction.id++)},e.prototype.resumeRecording=function(e){return this._dataProvider.resumeRecording(this._transaction.id++)},e.prototype.muteUnmute=function(e,t,i){return this._dataProvider.muteUnmute(this._transaction.id++,e,t,i)},e.prototype.controlRemoteCamera=function(e,t){return this._dataProvider.controlRemoteCamera(this._transaction.id++,e,t)},e.prototype.muteUnmuteAll=function(e){return this._dataProvider.muteUnmuteAll(this._transaction.id++,e)},e.prototype.sendLocalMuteEvent=function(e,t){return this._dataProvider.sendLocalMuteEvent(this._transaction.id++,e,t)},e.prototype.sendDisconnectEvent=function(e){return this._isAvailable?this._dataProvider.sendDisconnectEvent(this._transaction.id++,e):E.Deferred().reject("Service unavailable")},e.prototype.setVideoLayout=function(e){return this._dataProvider.setVideoLayout(this._transaction.id++,e)},e.prototype.setVideoLayoutSelfSee=function(e){return this._dataProvider.setVideoLayoutSelfSee(this._transaction.id++,e)},e.prototype.setVideoLayoutTextOverlay=function(e){return this._dataProvider.setVideoLayoutTextOverlay(this._transaction.id++,e)},e.prototype.getCurrentVideoLayout=function(){return this._dataProvider.getCurrentVideoLayout(this._transaction.id++)},e.prototype.terminateConference=function(){return this._dataProvider.terminateConference(this._transaction.id++)},e.prototype.removeLastParticipant=function(){var e=E.Deferred();return r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"removeLastParticipant method is not implemented"),e.reject(new r.Services.Conference.ConferenceException(r.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"removeLastParticipant method is not implemented")),e.promise()},e.prototype.requestToBecomeModerator=function(e){return this._dataProvider.requestToBecomeModerator(this._transaction.id++,e)},e.prototype.signIn=function(e){return this._dataProvider.signIn(this._transaction.id++,e)},e.prototype.videoPin=function(e,t,i,a,r){return this._dataProvider.videoPin(this._transaction.id++,e,t,i,a,r)},e.prototype.extendMeeting=function(e){return this._dataProvider.extendMeeting(this._transaction.id++,e)},e.prototype.addParticipantFromCall=function(e){var t=E.Deferred();return r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"addParticipantFromCall method is not implemented"),t.reject(new r.Services.Conference.ConferenceException(r.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"addParticipantFromCall method is not implemented")),t.promise()},e.prototype.addParticipant=function(i,t){var a=E.Deferred();return this._dataProvider.addParticipant(this._transaction.id++,t).then(function(e){this._conferenceBuilder.addDialoutParticipant(i,e,t)&&a.notify(e),this._dataProvider.getSelectedProvider().on(r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,function(t){var e=i._activeParticipants.filter(function(e){return e._participantId===t.participantId})[0];r.Base.Utils.isDefined(e)?t.result===r.Services.Conference.DialoutStatus.CONNECT?(this._conferenceBuilder.updateDialoutParticipant(i,e,t),a.resolve(t)):(i._activeParticipants.splice(i._activeParticipants.indexOf(e),1),a.reject({name:"UCCPServerError",code:t.result,message:"UCCP server responded with "+t.result,type:r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT})):r.Base.Logger.info(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Update dialout participant: unknown or canceled participant with participantId",t.participantId),this._dataProvider.getSelectedProvider().off(r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,this._dataProvider.getSelectedProvider()._listeners[r.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT][0])}.bind(this))}.bind(this),function(e){a.reject(e)}.bind(this)),a.promise()},e.prototype.cancelDialoutParticipant=function(t,i){var a=E.Deferred();return this._dataProvider.cancelDialoutParticipant(this._transaction.id++,i).then(function(e){this._conferenceBuilder.removeDialoutParticipant(t,i,e),a.resolve(e)}.bind(this),function(e){a.reject(e)}.bind(this)),a.promise()},e.prototype.sendChatMessage=function(e,t){return this._dataProvider.sendChatMessage(this._transaction.id++,e,t)},e.prototype.moderatorAdmission=function(t,i){return this._dataProvider.moderatorAdmission(this._transaction.id++,t.getParticipantId(),i).then(function(e){switch(i){case r.Services.Conference.ModeratorAdmissionActions.ADMIT:this._conferenceBuilder.pendingParticipantAccepted(t,e);break;case r.Services.Conference.ModeratorAdmissionActions.REJECT:this._conferenceBuilder.pendingParticipantDenied(t,e);break;default:r.Base.Logger.warn(r.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER,"Unknown action value received: {0}",i)}return e}.bind(this))},e.prototype.raiseLowerHand=function(e){return this._dataProvider.raiseLowerHand(this._transaction.id++,e)},e.prototype.moderatorLowerHand=function(e,t){return this._dataProvider.moderatorLowerHand(this._transaction.id++,e,t)},e.prototype.getDialInInfo=function(){return this._dataProvider.getDialInInfo(this._transaction.id++)},e.prototype.recalculateAddParticipantFromCallCapability=function(e,t){},e.prototype.recalculateAddParticipantFromCallCapabilityByCallId=function(e,t){},e.prototype._isLongPollingUccpProvider=function(e){return!(!e||!e._networkProvider)&&e._networkProvider._communicationAdapter instanceof r.Providers.UCCP.UCCPLongPollingProvider},e.prototype.changeParticipantName=function(e,t){return this._dataProvider.changeParticipantName(this._transaction.id++,e,t)},r.Providers.Scopia.ScopiaConferenceProvider=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={getScopiaConferenceProvider:function(e){if(a.Base.Utils.isDefined(e)&&e.enabled){var t=new a.Providers.UCCP.UCCPMessageBuilder,i=new a.Providers.UCCP.UCCPMessageParser;i.register(a.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_RESPONSE,new a.Providers.UCCP.UCCPHandshakeResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeRosterResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_RESPONSE,new a.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE,new a.Providers.UCCP.UCCPSubscribePermissionsResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_RESPONSE,new a.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_RESPONSE,new a.Providers.UCCP.UCCPSubscribeWebCollabResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE,new a.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_JOINED_EVENT,new a.Providers.UCCP.UCCPParticipantJoinedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_LEFT_EVENT,new a.Providers.UCCP.UCCPParticipantLeftEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.ACTIVE_TALKER_CHANGED_EVENT,new a.Providers.UCCP.UCCPActiveTalkerChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT,new a.Providers.UCCP.UCCPPermissionsChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPMeetingInfoChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.PARTICIPANT_INFO_CHANGED_EVENT,new a.Providers.UCCP.UCCPParticipantInfoChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStartResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_RESPONSE,new a.Providers.UCCP.UCCPLectureModeStopResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.FECC_RESPONSE,new a.Providers.UCCP.UCCPFeccResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE,new a.Providers.UCCP.UCCPMuteAllResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_RESPONSE,new a.Providers.UCCP.UCCPDisconnectParticipantResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,new a.Providers.UCCP.UCCPDisconnectEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE,new a.Providers.UCCP.UCCPModeratorMuteResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MEETING_TERMINATION_IN_PROGRESS_EVENT,new a.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_RESPONSE,new a.Providers.UCCP.UCCPTerminateMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_RESPONSE,new a.Providers.UCCP.UCCPDialInInfoResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_RESPONSE,new a.Providers.UCCP.UCCPDialoutResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_COMPLETED_EVENT,new a.Providers.UCCP.UCCPDialoutCompletedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_RESPONSE,new a.Providers.UCCP.UCCPDialoutCancelResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE,new a.Providers.UCCP.UCCPStartModerationResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE,new a.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_RESPONSE,new a.Providers.UCCP.UCCPChatResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHAT_EVENT,new a.Providers.UCCP.UCCPChatEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_RESPONSE,new a.Providers.UCCP.UCCPLockMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_RESPONSE,new a.Providers.UCCP.UCCPRecordingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_RESPONSE,new a.Providers.UCCP.UCCPExtendMeetingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,new a.Providers.UCCP.UCCPRecordingResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_RESPONSE,new a.Providers.UCCP.UCCPCurrentLayoutResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE,new a.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.AVAILABLE_LAYOUTS_CHANGED_EVENT,new a.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_CHANGED_EVENT,new a.Providers.UCCP.UCCPCurrentLayoutChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE,new a.Providers.UCCP.UCCPVideoPinResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE,new a.Providers.UCCP.UCCPRaiseHandResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE,new a.Providers.UCCP.UCCPModeratorLowerHandResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPAdmissionResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE,new a.Providers.UCCP.UCCPModeratorAdmissionResponseParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT,new a.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.RECORDING_FAILED_EVENT,new a.Providers.UCCP.UCCPRecordingFailedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT,new a.Providers.UCCP.UCCPWebCollabChangedEventParser),i.register(a.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,new a.Providers.UCCP.UCCPKeepAliveRequestEventParser);e=this._createUccpNetworkProvider(i),t=new a.Providers.UCCP.UCCPProviderFactory(e,t,i).getUCCPProvider(),i=new a.Providers.Scopia.ScopiaConferenceBuilder;return new a.Providers.Scopia.ScopiaConferenceProvider(t,i)}},_createUccpNetworkProvider:function(e){var t=new a.Base.TransactionalWebSocketProvider(a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER),e=new a.Providers.UCCP.UCCPLongPollingProvider(e);return new a.Base.NetworkProvider(t,e,a.Base.LoggerTags.SCOPIA_CONFERENCE_PROVIDER)}},a.Providers.Scopia.ScopiaConferenceProviderFactory=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessage=function(e){this.protocolType="UCCP",this.name=e}}(),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_CANCELED_EVENT),this.participantId=e,this.reason=t,this.anotherModerator=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_EVENT),this.participantId=e,this.participantName=t,this.userId=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionEvent=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,a.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_RESPONSE),this.transId=e,this.responseCode=t,this.anotherModerator=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPModeratorAdmissionResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPModeratorLowerHandResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,r.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_RESPONSE),this.transId=e,this.responseCode=t,this.audioMute=i,this.videoMute=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPModeratorMuteResponse=e}(AvayaClientServices),function(i){"use strict";i.Providers.UCCP.UCCPMuteAllResponse=function(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_RESPONSE),this.transId=e,this.responseCode=t}}(AvayaClientServices),function(_){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h){_.Providers.UCCP.UCCPMessage.call(this,"participantInfoChangedEvent"),this.participantId=t,this.participantName=e,this.status=i,this.handRaised=a,this.role=r,this.feccRecvSupport=s,this.audioFromParticipant=n,this.audioToParticipant=o,this.videoFromParticipant=c,this.videoToParticipant=l,this.contentFromParticipant=d,this.contentToParticipant=C,this.userId=u,this.canLecture=h}e.prototype=Object.create(_.Providers.UCCP.UCCPMessage.prototype),_.Providers.UCCP.UCCPParticipantInfoChangedEvent=e}(AvayaClientServices),function(g){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p){g.Providers.UCCP.UCCPMessage.call(this,"participantJoinedEvent"),this.participantId=e,this.participantName=t,this.userId=i,this.sourceID=a,this.status=r,this.handRaised=s,this.role=n,this.feccRecvSupport=o,this.audioFromParticipant=c,this.audioToParticipant=l,this.videoFromParticipant=d,this.videoToParticipant=C,this.contentFromParticipant=u,this.contentToParticipant=h,this.joinTime=_,this.canLecture=v,this.wasHidden=p}e.prototype=Object.create(g.Providers.UCCP.UCCPMessage.prototype),g.Providers.UCCP.UCCPParticipantJoinedEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.UCCP.UCCPMessage.call(this,"participantLeftEvent"),this.participantId=e}e.prototype=Object.create(t.Providers.UCCP.UCCPMessage.prototype),t.Providers.UCCP.UCCPParticipantLeftEvent=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){o.Providers.UCCP.UCCPMessage.call(this,o.Providers.UCCP.UCCPMessageTypes.PERMISSIONS_CHANGED_EVENT),this.dialout=e,this.recording=t,this.lock=i,this.unmuteSelf=a,this.unmuteAll=r,this.sendFecc=s,this.allowVideo=n}e.prototype=Object.create(o.Providers.UCCP.UCCPMessage.prototype),o.Providers.UCCP.UCCPPermissionsChangedEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPRaiseHandResponse=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.UCCP.UCCPMessage.call(this,"recordingFailedEvent")}t.prototype=Object.create(e.Providers.UCCP.UCCPMessage.prototype),e.Providers.UCCP.UCCPRecordingFailedEvent=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"recordingResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPRecordingResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.START_MODERATION_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPStartModerationResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeActiveTalkerResponse"),this.transId=e,this.responseCode=t,this.participantId=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeActiveTalkerResponse=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){o.Providers.UCCP.UCCPMessage.call(this,o.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE),this.transId=e,this.responseCode=t,this.textOverlay=i,this.noSelfSee=a,this.videoPin=r,this.geometries=s,this.LPPOn=n}e.prototype=Object.create(o.Providers.UCCP.UCCPMessage.prototype),o.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse=e}(AvayaClientServices),function(A){"use strict";function e(e,t,i,a,r,s,n,o,c,l,d,C,u,h,_,v,p,g,S,f,E){A.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingInfoResponse"),this.transId=e,this.responseCode=t,this.meetingId=i,this.meetingName=a,this.virtualRoomName=r,this.virtualRoomOwnerId=s,this.media=n,this.eventConference=o,this.locked=c,this.mediaStatus=l,this.lecturerId=d,this.lecturerName=C,this.presenterId=u,this.presenterName=h,this.recording=_,this.streaming=v,this.encrypted=p,this.moderatorPinNeeded=g,this.slidesAvailable=S,this.recorderAvailable=f,this.terminationTime=E}e.prototype=Object.create(A.Providers.UCCP.UCCPMessage.prototype),A.Providers.UCCP.UCCPSubscribeMeetingInfoResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeMeetingNoteResponse"),this.transId=e,this.responseCode=t,this.notes=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeMeetingNoteResponse=e}(AvayaClientServices),function(l){"use strict";function e(e,t,i,a,r,s,n,o,c){l.Providers.UCCP.UCCPMessage.call(this,l.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_RESPONSE),this.transId=e,this.responseCode=t,this.dialout=i,this.recording=a,this.lock=r,this.unmuteSelf=s,this.unmuteAll=n,this.sendFecc=o,this.allowVideo=c}e.prototype=Object.create(l.Providers.UCCP.UCCPMessage.prototype),l.Providers.UCCP.UCCPSubscribePermissionsResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,"subscribeRosterResponse"),this.transId=e,this.responseCode=t,this.fragmentation=i,this.participants=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPSubscribeRosterResponse=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){a.Providers.UCCP.UCCPMessage.call(this,"subscribeSliderResponse"),this.transId=e,this.responseCode=t,this.slides=i}e.prototype=Object.create(a.Providers.UCCP.UCCPMessage.prototype),a.Providers.UCCP.UCCPSubscribeSliderResponse=e}(AvayaClientServices),function(l){"use strict";function e(e,t,i,a,r,s,n,o,c){l.Providers.UCCP.UCCPMessage.call(this,"subscribeWebCollabResponse"),this.transId=e,this.responseCode=t,this.webCollabUrl=i,this.token=o,this.participantId=n,this.meeting_id=r,this.mode=s,this.login=a,this.gsid=c}e.prototype=Object.create(l.Providers.UCCP.UCCPMessage.prototype),l.Providers.UCCP.UCCPSubscribeWebCollabResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,"terminateMeetingResponse"),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPTerminateMeetingResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPUpdateCredentialsTokenResponse=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.UCCP.UCCPMessage.call(this,i.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_RESPONSE),this.transId=e,this.responseCode=t}e.prototype=Object.create(i.Providers.UCCP.UCCPMessage.prototype),i.Providers.UCCP.UCCPVideoPinResponse=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){r.Providers.UCCP.UCCPMessage.call(this,r.Providers.UCCP.UCCPMessageTypes.WEB_COLLAB_CHANGED_EVENT),this.webCollabUrl=e,this.token=t,this.participantId=i,this.meeting_id=a}e.prototype=Object.create(r.Providers.UCCP.UCCPMessage.prototype),r.Providers.UCCP.UCCPWebCollabChangedEvent=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPActiveTalkerChangedEvent(e.params.participantId)}},t.Providers.UCCP.UCCPActiveTalkerChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPAdmissionResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPAdmissionResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPAvailableLayoutsChangedEvent(e.params.textOverlay?"true"===e.params.textOverlay:T,e.params.noSelfSee?"true"===e.params.noSelfSee:T,e.params.videoPin?"true"===e.params.videoPin:T,e.params.geometries,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPAvailableLayoutsChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutGeometryResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutGeometryResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutNoSelfSeeResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChangeLayoutTextOverlayResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChangeLayoutTextOverlayResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t="";return i.Base.Utils.isDefined(e.params.time)&&(t=e.params.time),new i.Providers.UCCP.UCCPChatEvent(e.params.participantId,e.params.type,t,e.params.text)}},i.Providers.UCCP.UCCPChatEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPChatResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPChatResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPCurrentLayoutChangedEvent(e.params.textOverlay?"true"===e.params.textOverlay:T,e.params.noSelfSee?"true"===e.params.noSelfSee:T,e.params.geometry,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPCurrentLayoutChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPCurrentLayoutResponse(e.params.transId,e.params.responseCode,"true"===e.params.textOverlay,"true"===e.params.noSelfSee,e.params.geometry,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPCurrentLayoutResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialInInfoResponse(e.params.transId,e.params.responseCode,e.params.webLink,e.params.streamingLink,e.params.dialInInformation,e.params.dialInInformationHtml)}},t.Providers.UCCP.UCCPDialInInfoResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutCancelResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPDialoutCancelResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutCompletedEvent(e.params.participantId,e.params.result)}},t.Providers.UCCP.UCCPDialoutCompletedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDialoutResponse(e.params.transId,e.params.responseCode,e.params.participantId)}},t.Providers.UCCP.UCCPDialoutResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDisconnectEvent(e.params.reason)}},t.Providers.UCCP.UCCPDisconnectEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPDisconnectParticipantResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPDisconnectParticipantResponseParser=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={parse:function(e){return new AvayaClientServices.Providers.UCCP.UCCPExtendMeetingResponse(e.params.transId,e.params.responseCode)}},e.Providers.UCCP.UCCPExtendMeetingResponseParser=t}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPFeccResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPFeccResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.currentTime?new Date(Date.parse(e.params.currentTime)):T;return new i.Providers.UCCP.UCCPHandshakeResponse(e.params.transId,e.params.responseCode,e.params.version,e.params.participantId,"true"===e.params.externalAdmissionNeeded,"true"===e.params.admissionPasscodeNeeded,"true"===e.params.admissionPermissionNeeded,e.params.commands,t,e.params.longPollEmptyResponseTimeout,isNaN(parseInt(e.params.knockDoorTimeout))?T:parseInt(e.params.knockDoorTimeout))}},i.Providers.UCCP.UCCPHandshakeResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPKeepAliveRequestEvent(e.params.transId)}},t.Providers.UCCP.UCCPKeepAliveRequestEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLectureModeStartResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLectureModeStartResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLectureModeStopResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLectureModeStopResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPLockMeetingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPLockMeetingResponseParser=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.terminationTime?new Date(Date.parse(e.params.terminationTime)):T,i=e.params.locked?"true"===e.params.locked:T;return new a.Providers.UCCP.UCCPMeetingInfoChangedEvent(e.params.media,i,e.params.mediaStatus,e.params.lecturerId,e.params.lecturerName,e.params.presenterId,e.params.presenterName,e.params.recording,e.params.streaming?"enabled"===e.params.streaming:T,e.params.encrypted,"true"===e.params.slidesAvailable,t)}},a.Providers.UCCP.UCCPMeetingInfoChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPMeetingTerminationInProgressEvent(e.params.reason,e.params.userName)}},t.Providers.UCCP.UCCPMeetingTerminationInProgressEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionCanceledEvent(e.params.participantId,e.params.reason,e.params.anotherModerator)}},t.Providers.UCCP.UCCPModeratorAdmissionCanceledEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionEvent(e.params.participantId,e.params.name,e.params.userId)}},t.Providers.UCCP.UCCPModeratorAdmissionEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorAdmissionResponse(e.params.transId,e.params.responseCode,e.params.anotherModerator)}},t.Providers.UCCP.UCCPModeratorAdmissionResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorLowerHandResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPModeratorLowerHandResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPModeratorMuteResponse(e.params.transId,e.params.responseCode,"true"===e.params.audioMute,"true"===e.params.videoMute)}},t.Providers.UCCP.UCCPModeratorMuteResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPMuteAllResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPMuteAllResponseParser=e}(AvayaClientServices),function(r){"use strict";function e(){}e.prototype={parse:function(e){var t,i,a;return r.Base.Utils.isDefined(e.params.handRaised)&&(t="true"===e.params.handRaised),r.Base.Utils.isDefined(e.params.feccRecvSupport)&&(i="true"===e.params.feccRecvSupport),r.Base.Utils.isDefined(e.params.canLecture)&&(a="true"===e.params.canLecture),new r.Providers.UCCP.UCCPParticipantInfoChangedEvent(e.params.name,e.params.participantId,e.params.status,t,e.params.role,i,e.params.audioFromParticipant,e.params.audioToParticipant,e.params.videoFromParticipant,e.params.videoToParticipant,e.params.contentFromParticipant,e.params.contentToParticipant,e.params.userId,a)}},r.Providers.UCCP.UCCPParticipantInfoChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPParticipantJoinedEvent(e.params.participantId,e.params.name,e.params.userId,e.params.sourceID,e.params.status,"true"===e.params.handRaised,e.params.role,"true"===e.params.feccRecvSupport,e.params.audioFromParticipant,e.params.audioToParticipant,e.params.videoFromParticipant,e.params.videoToParticipant,e.params.contentFromParticipant,e.params.contentToParticipant,new Date(Date.parse(e.params.joinTime)),e.params.canLecture?"true"===e.params.canLecture:T,e.params.wasHidden)}},t.Providers.UCCP.UCCPParticipantJoinedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPParticipantLeftEvent(e.params.participantId)}},t.Providers.UCCP.UCCPParticipantLeftEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPPermissionsChangedEvent(e.params.dialout,e.params.recording,e.params.lock,e.params.unmuteSelf,e.params.unmuteAll,e.params.sendFecc,e.params.allowVideo)}},t.Providers.UCCP.UCCPPermissionsChangedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRaiseHandResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPRaiseHandResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRecordingFailedEvent}},t.Providers.UCCP.UCCPRecordingFailedEventParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPRecordingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPRecordingResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPStartModerationResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPStartModerationResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeActiveTalkerResponse(e.params.transId,e.params.responseCode,e.params.participantId)}},t.Providers.UCCP.UCCPSubscribeActiveTalkerResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponse(e.params.transId,e.params.responseCode,"true"===e.params.textOverlay,"true"===e.params.noSelfSee,"true"===e.params.videoPin,e.params.geometries,e.params.LPPOn?"true"===e.params.LPPOn:T)}},t.Providers.UCCP.UCCPSubscribeAvailableLayoutsResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=new Date(Date.parse(e.params.terminationTime));return new i.Providers.UCCP.UCCPSubscribeMeetingInfoResponse(e.params.transId,e.params.responseCode,e.params.meetingId,e.params.meetingName,e.params.virtualRoomName,e.params.virtualRoomOwnerId,e.params.media,"true"===e.params.eventConference,"true"===e.params.locked,e.params.mediaStatus,e.params.lecturerId,e.params.lecturerName,e.params.presenterId,e.params.presenterName,e.params.recording,"enabled"===e.params.streaming,e.params.encrypted,"true"===e.params.moderatorPinNeeded,"true"===e.params.slidesAvailable,e.params.recorderAvailable,t)}},i.Providers.UCCP.UCCPSubscribeMeetingInfoResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.notes.map(function(e){return{participantId:e.participantId,participantDisplayName:e.participantDisplayName,noteId:e.noteId,text:e.text,time:new Date(Date.parse(e.time))}});return new i.Providers.UCCP.UCCPSubscribeMeetingNoteResponse(e.params.transId,e.params.responseCode,t)}},i.Providers.UCCP.UCCPSubscribeMeetingNoteResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribePermissionsResponse(e.params.transId,e.params.responseCode,e.params.dialout,e.params.recording,e.params.lock,e.params.unmuteSelf,e.params.unmuteAll,e.params.sendFecc,e.params.allowVideo)}},t.Providers.UCCP.UCCPSubscribePermissionsResponseParser=e}(AvayaClientServices),function(i){"use strict";function e(){}e.prototype={parse:function(e){var t=e.params.participants.map(function(e){return this._buildActiveParticipant(e)}.bind(this));return new i.Providers.UCCP.UCCPSubscribeRosterResponse(e.params.transId,e.params.responseCode,e.params.fragmentation,t)},_buildActiveParticipant:function(e){var t,i,a={},r="";return a.participantId=e.participantId,a.participantName=e.name,a.userId=e.userId,e.joinTime&&(t=new RegExp(/(\d{2}:\d{2}:\d{2})\s(\d{2})-(\d{2})-(\d{4})\s(-?\+?\d{4})/),i=new RegExp(/(\d{4}-\d{2}-\d{2})[a-zA-Z](\d{2}:\d{2}:\d{2})(-?\+?\d{2}:\d{2})/),t.test(e.joinTime)?r=(t=t.exec(e.joinTime))[4]+"-"+t[3]+"-"+t[2]+" "+t[1]+" GMT"+t[5]:i.test(e.joinTime)&&(r=e.joinTime),r&&(a.joinTime=new Date(Date.parse(r)))),a.sourceID=e.sourceID,a.status=e.status,a.handRaised="true"===e.handRaised,a.role=e.role,a.feccRecvSupport="true"===e.feccRecvSupport,a.audioFromParticipant=e.audioFromParticipant,a.audioToParticipant=e.audioToParticipant,a.videoFromParticipant=e.videoFromParticipant,a.videoToParticipant=e.videoToParticipant,a.contentFromParticipant=e.contentFromParticipant,a.contentToParticipant=e.contentToParticipant,a.canLecture=e.canLecture?"true"===e.canLecture:T,a}},i.Providers.UCCP.UCCPSubscribeRosterResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeSliderResponse(e.params.transId,e.params.responseCode,e.params.slides)}},t.Providers.UCCP.UCCPSubscribeSliderResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPSubscribeWebCollabResponse(e.params.transId,e.params.responseCode,e.params.webCollabUrl,e.params.login,e.params.meeting_id,e.params.mode,e.params.participantId,e.params.token,e.params.gsid)}},t.Providers.UCCP.UCCPSubscribeWebCollabResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPTerminateMeetingResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPTerminateMeetingResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPUpdateCredentialsTokenResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPUpdateCredentialsTokenResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPVideoPinResponse(e.params.transId,e.params.responseCode)}},t.Providers.UCCP.UCCPVideoPinResponseParser=e}(AvayaClientServices),function(t){"use strict";function e(){}e.prototype={parse:function(e){return new t.Providers.UCCP.UCCPWebCollabChangedEvent(e.params.webCollabUrl,e.params.token,e.params.participantId,e.params.meeting_id)}},t.Providers.UCCP.UCCPWebCollabChangedEventParser=e}(AvayaClientServices),function(n){"use strict";var t=n.Base.Storage,i="JSCSDK_UCCP_ClientId";function e(){}e.prototype={buildHandshakeRequest:function(e){var t=new Date,i=-t.getTimezoneOffset(),a=0<=i?"+":"-",i=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+"T"+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+a+("0"+parseInt(Math.abs(i/60))).slice(-2)+":"+("0"+Math.abs(i%60)).slice(-2),i={clientId:this._getClientID(),transId:e.toString(),clientType:"Web Client",clientUserAgent:navigator.userAgent,version:"1.0",features:[{featureName:"passcode",version:"1.0"},{featureName:"knockOnTheDoorParticipant",version:"1.0"},{featureName:"knockOnTheDoorModerator",version:"1.0"}],currentTime:i};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.HANDSHAKE_REQUEST,i)},buildSubscribeMeetingInfoRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_INFO_REQUEST,e)},buildSubscribeSliderRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_SLIDER_REQUEST,e)},buildSubscribeActiveTalkerRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ACTIVE_TALKER_REQUEST,e)},buildSubscribePermissionsRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_PERMISSIONS_REQUEST,e)},buildSubscribeMeetingNoteRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_MEETING_NOTE_REQUEST,e)},buildSubscribeRosterRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_ROSTER_REQUEST,e)},buildSubscribeWebCollabRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_WEB_COLLAB_REQUEST,e)},buildSubscribeAvailableLayoutsRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST,e)},buildSetAsLecturerRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_START_REQUEST,t)},buildUnsetAsLecturerRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LECTURE_MODE_STOP_REQUEST,e)},buildMuteAllRequest:function(e,t){t={transId:e.toString(),audioMute:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MUTE_ALL_REQUEST,t)},buildModeratorMuteRequest:function(e,t,i,a){a={transId:e.toString(),participantId:t,mediaType:i,mute:a.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_MUTE_REQUEST,a)},buildFeccRequest:function(e,t,i){i={transId:e.toString(),participantId:t,action:i.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.FECC_REQUEST,i)},buildDisconnectParticipantRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DISCONNECT_PARTICIPANT_REQUEST,t)},buildLocalMuteEvent:function(e,t,i){i={transId:e.toString(),participantId:t,audioMute:i.toString(),videoMute:"false"};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LOCAL_MUTE_EVENT,i)},buildDisconnectEvent:function(e,t){t={transId:e.toString(),reason:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DISCONNECT_EVENT,t)},buildTerminateMeetingRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.TERMINATE_MEETING_REQUEST,e)},buildStartModerationRequest:function(e,t){e={transId:e.toString()};return n.Base.Utils.isDefined(t)&&(e.pin=t),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.START_MODERATION_REQUEST,e)},buildUpdateCredentialsTokenRequest:function(e,t){t={transId:e.toString(),token:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.UPDATE_CREDENTIALS_TOKEN_REQUEST,t)},buildDialoutRequest:function(e,t){t={transId:e.toString(),dialTo:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIALOUT_REQUEST,t)},buildCancelDialoutRequest:function(e,t){t={transId:e.toString(),participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIALOUT_CANCEL_REQUEST,t)},buildSendChatMessage:function(e,t,i){i={transId:e.toString(),text:t.toString(),participantId:i||"public"};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHAT_REQUEST,i)},buildExtendMeetingRequest:function(e,t){t={transId:e.toString(),additionalTimeInMinutes:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.EXTEND_MEETING_REQUEST,t)},buildLockMeetingRequest:function(e,t){t={transId:e.toString(),lock:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.LOCK_MEETING_REQUEST,t)},buildCurrentLayoutRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CURRENT_LAYOUT_REQUEST,e)},buildChangeLayoutGeometryRequest:function(e,t){t={transId:e.toString(),geometry:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_GEOMETRY_REQUEST,t)},buildChangeLayoutTextOverlayRequest:function(e,t){t={transId:e.toString(),textOverlay:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_OVERLAY_REQUEST,t)},buildChangeLayoutNoSelfSeeRequest:function(e,t){t={transId:e.toString(),enableNoSelfSee:t.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_LAYOUT_NO_SELF_SEE_REQUEST,t)},buildSetRecordingRequest:function(e,t,i,a){t={transId:e.toString(),recording:t};return n.Base.Utils.isDefined(i)&&(t.name=i),n.Base.Utils.isDefined(a)&&(t.description=a),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.RECORDING_REQUEST,t)},buildVideoPinRequest:function(e,t,i,a,r,s){s={transId:e.toString(),destXCord:r.toString(),destYCord:s.toString()};return n.Base.Utils.isDefined(t)?s.sourceParticipantId=t:n.Base.Utils.isDefined(i)&&n.Base.Utils.isDefined(a)&&(s.sourceXCord=i.toString(),s.sourceYCord=a.toString()),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.VIDEO_PIN_REQUEST,s)},buildRaiseHandRequest:function(e,t){t={transId:e.toString(),action:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.RAISE_HAND_REQUEST,t)},buildModeratorLowerHandRequest:function(e,t,i){i={transId:e.toString(),participantId:t.toString(),unmuteAudio:i.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_LOWER_HAND_REQUEST,i)},buildAdmissionRequest:function(e,t){e={transId:e.toString()};return n.Base.Utils.isDefined(t)&&(e.passcode=t),this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.ADMISSION_REQUEST,e)},buildModeratorAdmissionRequest:function(e,t,i){i={transId:e.toString(),participantId:t,action:i};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.MODERATOR_ADMISSION_REQUEST,i)},buildDialInInfoRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.DIAL_IN_INFO_REQUEST,e)},buildKeepaliveRequest:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_REQUEST,e)},buildKeepAliveResponse:function(e){e={transId:e.toString()};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.KEEPALIVE_RESPONSE,e)},_getClientID:function(){var e=t.get(t.TYPES.LOCAL,i);return n.Base.Utils.isUndefined(e)&&(e=n.Base.Utils.generateUUID(),t.set(t.TYPES.LOCAL,i,e)),e},_wrapParams:function(e,t){return{protocolType:"UCCP",name:e,params:t}},buildChangeParticipantNameRequest:function(e,t,i){t={transId:e.toString(),participantName:i,participantId:t};return this._wrapParams(n.Providers.UCCP.UCCPMessageTypes.CHANGE_PARTICIPANT_NAME_REQUEST,t)}},n.Providers.UCCP.UCCPMessageBuilder=e}(AvayaClientServices),function(e){"use strict";function t(){this._parsers={}}t.prototype={parse:function(e){return this._parsers[e.name]?this._parsers[e.name].parse(e):e},register:function(e,t){this._parsers[e]=t}},e.Providers.UCCP.UCCPMessageParser=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.UCCP.UCCPMessageTypes={HANDSHAKE_REQUEST:"handshakeRequest",HANDSHAKE_RESPONSE:"handshakeResponse",SUBSCRIBE_MEETING_INFO_REQUEST:"subscribeMeetingInfoRequest",SUBSCRIBE_MEETING_INFO_RESPONSE:"subscribeMeetingInfoResponse",SUBSCRIBE_ROSTER_REQUEST:"subscribeRosterRequest",SUBSCRIBE_ROSTER_RESPONSE:"subscribeRosterResponse",SUBSCRIBE_ACTIVE_TALKER_REQUEST:"subscribeActiveTalkerRequest",SUBSCRIBE_ACTIVE_TALKER_RESPONSE:"subscribeActiveTalkerResponse",SUBSCRIBE_PERMISSIONS_REQUEST:"subscribePermissionsRequest",SUBSCRIBE_PERMISSIONS_RESPONSE:"subscribePermissionsResponse",SUBSCRIBE_SLIDER_REQUEST:"subscribeSliderInfoRequest",SUBSCRIBE_SLIDER_RESPONSE:"subscribeSliderInfoResponse",SUBSCRIBE_MEETING_NOTE_REQUEST:"subscribeMeetingNoteRequest",SUBSCRIBE_MEETING_NOTE_RESPONSE:"subscribeMeetingNoteResponse",SUBSCRIBE_WEB_COLLAB_REQUEST:"subscribeWebCollabRequest",SUBSCRIBE_WEB_COLLAB_RESPONSE:"subscribeWebCollabResponse",SUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"subscribeAvailableLayoutsRequest",SUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"subscribeAvailableLayoutsResponse",START_MODERATION_REQUEST:"startModerationRequest",START_MODERATION_RESPONSE:"startModerationResponse",TERMINATE_MEETING_REQUEST:"terminateMeetingRequest",TERMINATE_MEETING_RESPONSE:"terminateMeetingResponse",DIRECTORY_LOOKUP_REQUEST:"directoryLookupRequest",DIRECTORY_LOOKUP_NOTE_RESPONSE:"directoryLookupResponse",DIAL_IN_INFO_REQUEST:"dialInInfoRequest",DIAL_IN_INFO_RESPONSE:"dialInInfoResponse",DIALOUT_REQUEST:"dialoutRequest",DIALOUT_RESPONSE:"dialoutResponse",DIALOUT_CANCEL_REQUEST:"dialoutCancelRequest",DIALOUT_CANCEL_RESPONSE:"dialoutCancelResponse",DISCONNECT_PARTICIPANT_REQUEST:"disconnectParticipantRequest",DISCONNECT_PARTICIPANT_RESPONSE:"disconnectParticipantResponse",LECTURE_MODE_START_REQUEST:"lectureModeStartRequest",LECTURE_MODE_START_RESPONSE:"lectureModeStartResponse",LECTURE_MODE_STOP_REQUEST:"lectureModeStopRequest",LECTURE_MODE_STOP_RESPONSE:"lectureModeStopResponse",RECORDING_REQUEST:"recordingRequest",RECORDING_RESPONSE:"recordingResponse",LOCK_MEETING_REQUEST:"lockMeetingRequest",LOCK_MEETING_RESPONSE:"lockMeetingResponse",EXTEND_MEETING_REQUEST:"extendMeetingRequest",EXTEND_MEETING_RESPONSE:"extendMeetingResponse",MUTE_ALL_REQUEST:"muteAllRequest",MUTE_ALL_RESPONSE:"muteAllResponse",MODERATOR_MUTE_REQUEST:"moderatorMuteRequest",MODERATOR_MUTE_RESPONSE:"moderatorMuteResponse",RAISE_HAND_REQUEST:"raiseHandRequest",RAISE_HAND_RESPONSE:"raiseHandResponse",MODERATOR_LOWER_HAND_REQUEST:"moderatorLowerHandRequest",MODERATOR_LOWER_HAND_RESPONSE:"moderatorLowerHandResponse",CURRENT_LAYOUT_REQUEST:"currentLayoutRequest",CURRENT_LAYOUT_RESPONSE:"currentLayoutResponse",CHANGE_LAYOUT_GEOMETRY_REQUEST:"changeLayoutGeometryRequest",CHANGE_LAYOUT_GEOMETRY_RESPONSE:"changeLayoutGeometryResponse",CHANGE_LAYOUT_NO_SELF_SEE_REQUEST:"changeLayoutNoSelfSeeRequest",CHANGE_LAYOUT_NO_SELF_SEE_RESPONSE:"changeLayoutNoSelfSeeResponse",VIDEO_PIN_REQUEST:"videoPinRequest",VIDEO_PIN_RESPONSE:"videoPinResponse",FECC_REQUEST:"feccRequest",FECC_RESPONSE:"feccResponse",CHANGE_LAYOUT_OVERLAY_REQUEST:"changeLayoutTextOverlayRequest",CHANGE_LAYOUT_OVERLAY_RESPONSE:"changeLayoutTextOverlayResponse",CHAT_REQUEST:"chatRequest",CHAT_RESPONSE:"chatResponse",ADD_MEETING_NOTE_REQUEST:"addMeetingNoteRequest",ADD_MEETING_NOTE_RESPONSE:"addMeetingNoteResponse",UPDATE_MEETING_NOTE_REQUEST:"updateMeetingNoteRequest",UPDATE_MEETING_NOTE_RESPONSE:"updateMeetingNoteResponse",DELETE_MEETING_NOTE_REQUEST:"deleteMeetingNoteRequest",DELETE_MEETING_NOTE_RESPONSE:"deleteMeetingNoteResponse",LOGGING_REQUEST:"loggingRequest",LOGGING_RESPONSE:"loggingResponse",ADMISSION_REQUEST:"admissionRequest",ADMISSION_RESPONSE:"admissionResponse",MODERATOR_ADMISSION_REQUEST:"moderatorAdmissionRequest",MODERATOR_ADMISSION_RESPONSE:"moderatorAdmissionResponse",MOBILE_LINK_ID_REQUEST:"mobileLinkIdRequest",MOBILE_LINK_ID_RESPONSE:"mobileLinkIdResponse",MOBILE_LINK_ROOM_SYSTEM_LIST_REQUEST:"mobileLinkRoomSystemListRequest",MOBILE_LINK_ROOM_SYSTEM_LIST_RESPONSE:"mobileLinkRoomSystemListResponse",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkChooseRoomSystemRequest",MOBILE_LINK_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkChooseRoomSystemResponse",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_REQUEST:"mobileLinkManualChooseRoomSystemRequest",MOBILE_LINK_MANUAL_CHOOSE_ROOM_SYSTEM_RESPONSE:"mobileLinkManualChooseRoomSystemResponse",MOBILE_LINK_DISCONNECT_REQUEST:"mobileLinkDisconnectRequest",MOBILE_LINK_DISCONNECT_RESPONSE:"mobileLinkDisconnectResponse",UPDATE_CREDENTIALS_TOKEN_REQUEST:"updateCredentialsTokenRequest",UPDATE_CREDENTIALS_TOKEN_RESPONSE:"updateCredentialsTokenResponse",UNSUBSCRIBE_MEETING_INFO_REQUEST:"unsubscribeMeetingInfoRequest",UNSUBSCRIBE_MEETING_INFO_RESPONSE:"unsubscribeMeetingInfoResponse",UNSUBSCRIBE_ROSTER_REQUEST:"unsubscribeRosterRequest",UNSUBSCRIBE_ROSTER_RESPONSE:"unsubscribeRosterResponse",UNSUBSCRIBE_SLIDER_REQUEST:"unsubscribeSliderInfoRequest",UNSUBSCRIBE_SLIDER_RESPONSE:"unsubscribeSliderInfoResponse",UNSUBSCRIBE_ACTIVE_TALKER_REQUEST:"unsubscribeActiveTalkerRequest",UNSUBSCRIBE_ACTIVE_TALKER_RESPONSE:"unsubscribeActiveTalkerResponse",UNSUBSCRIBE_PERMISSIONS_REQUEST:"unsubscribePermissionsRequest",UNSUBSCRIBE_PERMISSIONS_RESPONSE:"unsubscribePermissionsResponse",UNSUBSCRIBE_MEETING_NOTE_REQUEST:"unsubscribeMeetingNoteRequest",UNSUBSCRIBE_MEETING_NOTE_RESPONSE:"unsubscribeMeetingNoteResponse",UNSUBSCRIBE_WEB_COLLAB_REQUEST:"unsubscribeWebCollabRequest",UNSUBSCRIBE_WEB_COLLAB_RESPONSE:"unsubscribeWebCollabResponse",UNSUBSCRIBE_AVAILABLE_LAYOUTS_REQUEST:"unsubscribeAvailableLayoutsRequest",UNSUBSCRIBE_AVAILABLE_LAYOUTS_RESPONSE:"unsubscribeAvailableLayoutsResponse",KEEPALIVE_REQUEST:"keepaliveRequest",KEEPALIVE_RESPONSE:"keepaliveResponse",CHANGE_PARTICIPANT_NAME_REQUEST:"changeParticipantNameRequest",PARTICIPANT_JOINED_EVENT:"participantJoinedEvent",PARTICIPANT_LEFT_EVENT:"participantLeftEvent",ACTIVE_TALKER_CHANGED_EVENT:"activeTalkerChangedEvent",PERMISSIONS_CHANGED_EVENT:"permissionsChangedEvent",CHAT_EVENT:"chatEvent",MEETING_NOTE_ADDED_EVENT:"meetingNoteAddedEvent",MEETING_NOTE_UPDATED_EVENT:"meetingNoteUpdatedEvent",MEETING_NOTE_DELETED_EVENT:"meetingNoteDeletedEvent",LOGGING_EVENT:"loggingEvent",MEETING_INFO_CHANGED_EVENT:"meetingInfoChangedEvent",MEETING_TERMINATION_IN_PROGRESS_EVENT:"meetingTerminationInProgressEvent",NEW_SLIDE_EVENT:"newSlideEvent",PARTICIPANT_INFO_CHANGED_EVENT:"participantInfoChangedEvent",USER_MOVED_EVENT:"userMovedEvent",DIALOUT_COMPLETED_EVENT:"dialoutCompletedEvent",LOCAL_MUTE_EVENT:"localMuteEvent",AVAILABLE_LAYOUTS_CHANGED_EVENT:"availableLayoutsChangedEvent",CURRENT_LAYOUT_CHANGED_EVENT:"currentLayoutChangedEvent",RECORDING_FAILED_EVENT:"recordingFailedEvent",MODERATOR_ADMISSION_EVENT:"moderatorAdmissionEvent",MODERATOR_ADMISSION_CANCELED_EVENT:"moderatorAdmissionCanceledEvent",WEB_COLLAB_CHANGED_EVENT:"webCollabChangedEvent",DISCONNECT_EVENT:"disconnectEvent"}}(),function(t){"use strict";function e(e,t,i){this._networkProvider=e,this._messageBuilder=t,this._messageParser=i,this._uccpProvider={}}e.prototype={getUCCPProvider:function(){var e;return E.isEmptyObject(this._uccpProvider)&&(e=this._createUCCP1Provider(),this._uccpProvider=new t.Providers.UCCP.UCCPProvider,this._uccpProvider.registerUCCPProvider(1,e)),this._uccpProvider},_createUCCP1Provider:function(){return new t.Providers.UCCP.UCCP1Provider(this._networkProvider,this._messageBuilder,this._messageParser)}},t.Providers.UCCP.UCCPProviderFactory=e}(AvayaClientServices),function(a){"use strict";function e(){}e.prototype={_validateTagLength:function(e,t){var i=0;switch(t){case a.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:case a.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:i=14;break;case a.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG:i=13;break;case a.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:i=1;break;case a.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG:i=5;break;case a.Providers.WCS.WCSScreenSharingTagTypes.MOUSE_TAG:i=8;break;case a.Providers.WCS.WCSScreenSharingTagTypes.KEYBOARD_TAG:i=10;break;case a.Providers.WCS.WCSScreenSharingTagTypes.COPY_PASTE_TAG:i=6}return i<=e||(a.Base.Logger.warn(a.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Byte array size: {0} < Min Tag length: {1} Tag type: {2}",e,i,t),!1)},_get64bitNumber:function(e){e=e.readBytes(8);return 4294967296*e.readUnsignedInt()+e.readUnsignedInt()}},a.Providers.WCS.AbstractBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray,e=e.id;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG))return T;t=new i.Providers.WCS.ScreenSharingAcknowledgementTag;return t.messageId=e,t},i.Providers.WCS.AcknowledgementTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG))return T;e=new i.Providers.WCS.ScreenSharingBlockTag;if(e.width=t.readShort(),e.height=t.readShort(),e.x=t.readShort(),e.y=t.readShort(),e.imageType=t.readByte(),e.length=t.readInt(),e.length===t.getBytesAvailable())e.data=t.readBytes(e.length);else{if(e.length+4!==t.getBytesAvailable())return i.Base.Logger.error(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Invalid type "+i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG+". Tried to read: "+e.length+". BytesAvailable "+t.getBytesAvailable()),T;t.readInt(),e.data=t.readBytes(e.length)}return e},i.Providers.WCS.BlockTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.COPY_PASTE_TAG))return T;e=new i.Providers.WCS.ScreenSharingCopyPasteTag;return e.eventType=t.readByte(),e.length=t.readInt(),e.length===t.getBytesAvailable()&&(e.data=t.readBytes(e.length)),e},i.Providers.WCS.CopyPasteTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG))return T;e=new i.Providers.WCS.ScreenSharingCursorTag;return e.x=t.readShort(),e.y=t.readShort(),e.creationTime=this._get64bitNumber(t),e},i.Providers.WCS.CursorTagBinaryParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){e=e.byteArray;return this._validateTagLength(e.length,t.Providers.WCS.WCSScreenSharingTagTypes.END_TAG)?new t.Providers.WCS.ScreenSharingEndTag:T},t.Providers.WCS.EndTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.KEYBOARD_TAG))return T;e=new i.Providers.WCS.ScreenSharingKeyboardTag;return e.ctrlPressed=t.readByte(),e.altPressed=t.readByte(),e.shiftPressed=t.readByte(),e.cmdPressed=t.readByte(),e.winPressed=t.readByte(),e.key1=t.readShort(),e.key2=t.readShort(),e},i.Providers.WCS.KeyboardTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(t.length,i.Providers.WCS.WCSScreenSharingTagTypes.MOUSE_TAG))return T;e=new i.Providers.WCS.ScreenSharingMouseTag;return e.x=t.readShort(),e.y=t.readShort(),e.buttonEventType=t.readByte(),e.buttonPressedType=t.readByte(),e.wheelAmount=t.readByte(),e},i.Providers.WCS.MouseTagBinaryParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractBinaryParser.prototype)).parse=function(e){var t=e.byteArray;if(!this._validateTagLength(e.byteArray.length,i.Providers.WCS.WCSScreenSharingTagTypes.START_TAG))return T;e=new i.Providers.WCS.ScreenSharingStartTag;e.isKeyFrame=Boolean(t.readByte()),e.width=t.readShort(),e.height=t.readShort(),e.creationTime=this._get64bitNumber(t);t=(new Date).getTime();return i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Start Tag [keyframe={0}]: {1}x{2} isKeyFrame: "+e.isKeyFrame+". width: "+e.width+". height: "+e.height+". creationTime: "+e.creationTime+". TimeDiff: "+(t-e.creationTime)),e},i.Providers.WCS.StartTagBinaryParser=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.AbstractEvent=function(e){this.type=e}}(),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractEvent.call(this,e),t&&(this.from=t.from,this.fromname=t.fromname,this.eventId=t.eventId,this.senderId=t.senderId,this.senderName=t.senderName,this.time=t.time,this.useragent=t.useragent,this.wsConnectionId=t.wsConnectionId,this.data={})}(e.prototype=Object.create(i.Providers.WCS.AbstractEvent)).isServerInitiated=function(){return"Web Collaboration Server"===this.from},i.Providers.WCS.AbstractLiveEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.ADD_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.AddNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r){this.noteType=e,this.text=t,this.meetingOwner=i,this.isPersonal=a,r&&(this.targetId=r)}t.prototype={},e.Providers.WCS.AddNoteEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.AddWhiteboardEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.AllowPresentingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.targetId=e,this.targetName=t}t.prototype={},e.Providers.WCS.AllowPresentingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.CLEAR_DRAWING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.ClearDrawingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.groupId=e,this.layerType=t}t.prototype={},e.Providers.WCS.ClearDrawingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DECLINE_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeclineControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.noteId=e}t.prototype={},e.Providers.WCS.DeleteNoteEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_SELECTION),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteSelectionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r){this.groupId=e,this.layerType=t,this.shapeId=i,this.selectionX=a,this.selectionY=r}t.prototype={},e.Providers.WCS.DeleteSelectionEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DeleteWhiteboardEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.id=e}t.prototype={},e.Providers.WCS.DeleteWhiteboardEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DENY_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DenyControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DENY_PRESENTING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DenyPresentingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.targetId=e,this.targetName=t}t.prototype={},e.Providers.WCS.DenyPresentingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_CIRCLE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawCircleEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l,d,C){this.alpha=e,t&&(this.fillColor=t),i&&(this.color=i),d&&(this.filled=d),C&&(this.contour=C),this.groupId=a,this.layerType=r,this.width=s,this.x0=n,this.x1=o,this.y0=c,this.y1=l}t.prototype={},e.Providers.WCS.DrawCircleEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawShapeEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l){e&&(this.alpha=e),t&&(this.fillColor=t),i&&(this.color=i),a&&(this.groupId=a),r&&(this.layerType=r),!s&&0!==s||(this.width=s),!n&&0===n.length||(this.l=n),!o&&0===o.length||(this.m=o),l&&(this.contour=l),c&&(this.filled=c)}t.prototype={},e.Providers.WCS.DrawShapeEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.DRAW_TEXT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.DrawTextEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.fillColor=e,this.fontSize=t,this.groupId=i,this.layerType=a,this.text=r||"",this.x=s,this.y=n}t.prototype={},e.Providers.WCS.DrawTextEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.EjectParticipantEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.targetId=e,this.targetName=t,this.targetParticipantId=i,this.time=a}t.prototype={},e.Providers.WCS.EjectParticipantEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.END_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.EndControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.EndDrawShapeEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.groupId=e,this.layerType=t}t.prototype={},e.Providers.WCS.EndDrawShapeEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_MEETING),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndMeetingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndScreenSharingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndVideoSharingEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.END_WHITEBOARD),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.EndWhiteboardEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.ERROR),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.ErrorEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.code=e,this.message=t,this.requestId=i,this.wsConnectionId=a}t.prototype={},e.Providers.WCS.ErrorEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.FRAME_REPORT),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.FrameReportEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this.droppedFrames=e,this.droppedFramesPercentageRounded=t,this.period=i,this.successfulFrames=a,this.timeEnd=r,this.timeStart=s}t.prototype={},e.Providers.WCS.FrameReportEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.GRANT_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.GrantControlEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this.senderId=e,this.senderName=t,this.targetId=i,this.targetName=a,this.time=r,this.osType=s}t.prototype={},e.Providers.WCS.GrantControlEventData=t}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o){this.attendeeId=e,this.clientVersion=t,this.privateChatSupported=i,this.startTime=a,this.userAgent=r,this.userIp=s,this.userName=n,this.wsConnectionId=o}t.prototype={},e.Providers.WCS.LiveAttendeeEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveAttendeesEvent=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveCapabilitiesEvent=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={},e.Providers.WCS.LiveCapabilitiesEventData=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.LiveEventCommonData=function(e,t,i,a,r,s,n,o,c){this.from=e,this.fromname=t,this.eventId=i,this.senderId=a,this.senderName=r,this.time=s,this.type=n,this.useragent=o,this.wsConnectionId=c}}(),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_SESSION),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveSessionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.requestId=e,this.idleTimeout=t,this.serverTimeDiff=i,this.wsConnectionId=a,this.meeting=r,this.liveAttendee=s,this.features=n}t.prototype={},e.Providers.WCS.LiveSessionEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.LIVE_VIEWER),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.LiveViewerEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o,c,l,d,C,u){this.brandId=e,this.wcsVersion=t,this.websocketPath=i,this.websocketCacheSize=a,this.uploadSize=r,this.uploadMaxImageSize=s,this.uploadMaxImageResolution=n,this.uploadTypes=o,this.maxDuration=c,this.eventWaitTime=l,this.uploadMaxFile=d,this.themesLocation=C,this.internalUiControls=u}t.prototype={},e.Providers.WCS.LiveViewerEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.MOVE_SELECTION),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.MoveSelectionEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n){this.groupId=e,this.layerType=t,this.shapeId=i,this.moveToX=a,this.moveToY=r,this.selectionX=s,this.selectionY=n}t.prototype={},e.Providers.WCS.MoveSelectionEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.PauseScreenSharingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r){this.senderId=e,this.senderName=t,this.targetId=i,this.targetName=a,this.time=r}t.prototype={},e.Providers.WCS.RemoteControlEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.REQUEST_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.RequestControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_DOCUMENT),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendDocumentEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this.filename=e,this.filesize=t,this.fileurl=i}t.prototype={},e.Providers.WCS.SendDocumentEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_MESSAGE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendMessageEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this.message=e,this.targetName=t,this.isPrivate=i,a&&(this.targetId=a)}t.prototype={},e.Providers.WCS.SendMessageEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SEND_SLIDE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SendSlideEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s,n,o){this.count=e,this.index=t,this.title=i,this.presentationId=a,this.slideUrl=r,this.slideBaseUrl=s,this.tocUrl=n,this.includeToc=o}t.prototype={},e.Providers.WCS.SendSlideEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractEvent.call(this,t.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractEvent.prototype),t.Providers.WCS.ServerCapabilitiesEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.maxHeight=e,this.maxWidth=t}t.prototype={},e.Providers.WCS.ServerCapabilitiesEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SET_NOTE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SetNoteEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this.noteId=e,this.noteType=t,this.text=i,this.attendeeId=a,this.isPersonal=r,s&&(this.targetId=s)}t.prototype={},e.Providers.WCS.SetNoteEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.SLIDER_EMPTY),this.liveEventCommonData=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.SliderEmptyEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.SLIDER_SLIDE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.SliderSlideEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.slideURL=e,this.thumbUrl=t}t.prototype={},e.Providers.WCS.SliderSlideEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_CONTROL),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartControlEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartDrawShapeEvent=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.StartDrawShapeEventData=function(e,t,i,a,r){this.alpha=e,this.color=t,this.groupId=i,this.layerType=a,this.width=r}}(),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_MEETING),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartMeetingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.userkey=e}t.prototype={},e.Providers.WCS.StartMeetingEventData=t}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,e),this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartScreenSharingEvent=e}(AvayaClientServices),function(e){"use strict";function t(e){this.transportVersion=e}t.prototype={},e.Providers.WCS.StartScreenSharingEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,e)}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.StartVideoSharingEvent=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Providers.WCS.AbstractLiveEvent.call(this,i.Providers.WCS.WCSEventTypes.START_WHITEBOARD),this.liveEventCommonData=e,this.data=t}e.prototype=Object.create(i.Providers.WCS.AbstractLiveEvent.prototype),i.Providers.WCS.StartWhiteboardEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i){this.id=e,this.width=t,this.height=i}t.prototype={},e.Providers.WCS.StartWhiteboardEventData=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Providers.WCS.AbstractLiveEvent.call(this,t.Providers.WCS.WCSEventTypes.UPDATE_ATTENDEE_NAME,e),this.data=e}e.prototype=Object.create(t.Providers.WCS.AbstractLiveEvent.prototype),t.Providers.WCS.UpdateAttendeeNameEvent=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this.id=e,this.displayName=t}t.prototype={},e.Providers.WCS.UpdateAttendeeNameEventData=t}(AvayaClientServices),function(s){"use strict";function e(){this.lastStartScreenSharingWsId="",this.latestKeyEvents={sharing:T,slider:T}}e.prototype={getOptimizedQueue:function(e){var t=[];if(e.length<=1)t=e;else{for(var i=e.length-1;0<=i;i--){var a=e[i];this.isEventValid(a)?(e[i].type!==s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&e[i].type!==s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||e[i].wsConnectionId!==this.lastStartScreenSharingWsId)&&t.push(a):s.Base.Logger.debug(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Event is not relevant: ",a.type)}t.reverse()}for(var r=0;r<=t.length-1;r++)t[r].type!==s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING&&t[r].type!==s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING||(this.lastStartScreenSharingWsId=t[r].wsConnectionId);return this.latestKeyEvents={sharing:T,videoSharing:T,slider:T},t},isEventValid:function(e){return this.isStartContentSharingEvent(e)?this.isStartSharingEventValid(e):this.isEndContentSharingEvent(e)?this.isEndSharingEventValid(e):this.isStartContentVideoSharingEvent(e)?this.isStartVideoSharingEventValid(e):this.isEndContentVideoSharingEvent(e)?this.isEndVideoSharingEventValid(e):this.isMidSharingEvent(e)?this.isMidSharingEventValid():this.isSliderEvent(e)?this.isSliderEventValid():!this.isEmptySliderEvent(e)||this.isEmptySliderEventValid(e)},isStartContentSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING},isEndContentSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING||e.type===s.Providers.WCS.WCSEventTypes.END_PRESENTATION},isStartContentVideoSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING},isEndContentVideoSharingEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING},isMidSharingEvent:function(e){switch(e.type){case s.Providers.WCS.WCSEventTypes.REQUEST_CONTROL:case s.Providers.WCS.WCSEventTypes.GRANT_CONTROL:case s.Providers.WCS.WCSEventTypes.DECLINE_CONTROL:case s.Providers.WCS.WCSEventTypes.DENY_CONTROL:case s.Providers.WCS.WCSEventTypes.START_CONTROL:case s.Providers.WCS.WCSEventTypes.END_CONTROL:case s.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING:case s.Providers.WCS.WCSEventTypes.DENY_PRESENTING:case s.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING:case s.Providers.WCS.WCSEventTypes.SEND_SLIDE:return!0;default:return!1}},isSliderEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.SLIDER_SLIDE},isEmptySliderEvent:function(e){return e.type===s.Providers.WCS.WCSEventTypes.SLIDER_EMPTY},isStartSharingEventValid:function(e){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=e,!0)},isEndSharingEventValid:function(e){return!this.latestKeyEvents.sharing&&(this.latestKeyEvents.sharing=e,!0)},isStartVideoSharingEventValid:function(e){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=e,!0)},isEndVideoSharingEventValid:function(e){return!this.latestKeyEvents.videoSharing&&(this.latestKeyEvents.videoSharing=e,!0)},isMidSharingEventValid:function(){return!this.latestKeyEvents.sharing},isEmptySliderEventValid:function(e){return this.latestKeyEvents.slider||(this.latestKeyEvents.slider=e),!1},isSliderEventValid:function(){return!this.latestKeyEvents.slider}},s.Providers.WCS.LiveEventQueueOptimizer=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={parse:function(e){throw new Error("Method not implemented!")},colorHexToInt:function(e){return parseInt("0x".concat(e.slice(1))).toString()},stringToCamel:function(e){return e.replace(/(_[a-z])/g,function(e){return e.toUpperCase().replace("_","")})}},e.Providers.WCS.AbstractParser=t}(AvayaClientServices),function(e){"use strict";function t(){this._onMessageParsedCallbacks=E.Callbacks(),this.msgHeaderDetails={headerSize:8,msgSize:3,flagSize:1,lengthIndicatorSize:4,msgTxt:"msg",textFlagValue:128},this._activeMsg=T}t.prototype.parse=function(e){var t;e instanceof ArrayBuffer&&(0<(t=e.byteLength)&&this._extractDataFromMsg(0,e,t))},t.prototype.addOnMessageParsedCallback=function(e){this._onMessageParsedCallbacks.add(e)},t.prototype.removeOnMessageParsedCallback=function(e){this._onMessageParsedCallbacks.remove(e)},t.prototype._parseToString=function(e){for(var t=new Uint8Array(e),i="",a=0;a<t.length;a++)i+=String.fromCharCode(t[a]);return i},t.prototype._utf8Decoder=function(e){for(var t,i=new Uint8Array(e),a="",r=i.length,s=0;s<r;s++)t=i[s],a+=String.fromCharCode(251<t&&t<254&&s+5<r?1073741824*(t-252)+(i[++s]-128<<24)+(i[++s]-128<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:247<t&&t<252&&s+4<r?(t-248<<24)+(i[++s]-128<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:239<t&&t<248&&s+3<r?(t-240<<18)+(i[++s]-128<<12)+(i[++s]-128<<6)+i[++s]-128:223<t&&t<240&&s+2<r?(t-224<<12)+(i[++s]-128<<6)+i[++s]-128:191<t&&t<224&&s+1<r?(t-192<<6)+i[++s]-128:t);return a},t.prototype._extractDataFromMsg=function(e,t,i){var a,r;e<i&&(i-this.msgHeaderDetails.headerSize>=this.msgHeaderDetails.headerSize+1?this._utf8Decoder(t.slice(e,e+this.msgHeaderDetails.msgSize))===this.msgHeaderDetails.msgTxt?(r=this._getMessageLength(t.slice(e+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize,e+this.msgHeaderDetails.headerSize)),a=t.slice(e+this.msgHeaderDetails.headerSize,e+this.msgHeaderDetails.headerSize+r),this._isMsgBinary(t.slice(e+this.msgHeaderDetails.msgSize,e+this.msgHeaderDetails.msgSize+this.msgHeaderDetails.flagSize))||(a=this._utf8Decoder(a)),r+this.msgHeaderDetails.headerSize+e<=i?(this._onMessageParsedCallbacks.fire({data:a}),this._extractDataFromMsg(r+this.msgHeaderDetails.headerSize+e,t,i)):this._activeMsg=t.slice(e,i)):(r=this._concatBuffers(this._activeMsg,t),this._extractDataFromMsg(0,r,r.byteLength)):this._activeMsg=t.slice(e,i))},t.prototype._isMsgBinary=function(e){return 0===new Uint8Array(e)[0]},t.prototype._getMessageLength=function(e){for(var t=new Uint8Array(e),i=0,a=0;a<this.msgHeaderDetails.lengthIndicatorSize;++a)i+=t[a],a<this.msgHeaderDetails.lengthIndicatorSize-1&&(i<<=8);return i},t.prototype._concatBuffers=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer},e.Providers.WCS.CometParser=t}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t={};t.droppedFrames=i.Base.Utils.queryJSONObject(e,"dropped_frames[0]._text"),t.droppedFramesPercentageRounded=i.Base.Utils.queryJSONObject(e,"dropped_frames_percentage_rounded[0]._text"),t.period=i.Base.Utils.queryJSONObject(e,"period[0]._text"),t.successfulFrames=i.Base.Utils.queryJSONObject(e,"successful_frames[0]._text"),t.timeEnd=i.Base.Utils.queryJSONObject(e,"time_end[0]._text"),t.timeStart=i.Base.Utils.queryJSONObject(e,"time_start[0]._text");t=new i.Providers.WCS.FrameReportEventData(t.droppedFrames,t.droppedFramesPercentageRounded,t.period,t.successfulFrames,t.timeEnd,t.timeStart);return new i.Providers.WCS.FrameReportEvent(t)},i.Providers.WCS.FrameReportParser=e}(AvayaClientServices),function(C){"use strict";function e(){}(e.prototype=Object.create(C.Providers.WCS.AbstractParser.prototype)).parse=function(e){for(var t={liveAttendees:[]},i=0;i<e.live_attendee.length;i++){var a=C.Base.Utils.queryJSONObject(e.live_attendee[i],"attendee_id[0]._text"),r=C.Base.Utils.queryJSONObject(e.live_attendee[i],"client_version[0]._text"),s=C.Base.Utils.queryJSONObject(e.live_attendee[i],"private_chat_supported[0]._text"),n=C.Base.Utils.queryJSONObject(e.live_attendee[i],"start_time[0]._text"),o=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_agent[0]._text"),c=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_ip[0]._text"),l=C.Base.Utils.queryJSONObject(e.live_attendee[i],"user_name[0]._text"),d=C.Base.Utils.queryJSONObject(e.live_attendee[i],"ws_connection_id[0]._text");t.liveAttendees.push(new C.Providers.WCS.LiveAttendeeEventData(a,r,s,n,o,c,l,d))}return new C.Providers.WCS.LiveAttendeesEvent(t)},C.Providers.WCS.LiveAttendeesParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t=new i.Providers.WCS.LiveCapabilitiesEventData;return new i.Providers.WCS.LiveCapabilitiesEvent(t)},i.Providers.WCS.LiveCapabilitiesParser=e}(AvayaClientServices),function(t){"use strict";function e(){}var r={whiteboard:"whiteboard_",slide:"slide_"};(e.prototype=Object.create(t.Providers.WCS.AbstractParser.prototype)).stripCommonData=function(e){var i={};return E.each(e._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),new t.Providers.WCS.LiveEventCommonData(i.from,i.fromname,i.id,i.senderId,i.senderName,i.time,i.type,i.useragent,i.wsConnectionId)},e.prototype.convertGroup=function(i){var a;if(E.each(r,function(e,t){if(0===i.indexOf(t))return!(a={groupId:parseInt(i.split(t)[1]),layerType:e})}.bind(this)),a)return a;t.Base.Logger.error(t.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown group prefix type!")},t.Providers.WCS.LiveEventParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t={request_id:i.Base.Utils.queryJSONObject(e,"request_id[0]._text"),idle_timeout:i.Base.Utils.queryJSONObject(e,"idle_timeout[0]._text"),ws_connection_id:i.Base.Utils.queryJSONObject(e,"ws_connection_id[0]._text"),server_time_diff:i.Base.Utils.queryJSONObject(e,"server_time_diff[0]._text")},e={attendeeId:i.Base.Utils.queryJSONObject(e,"attendee_id[0]._text"),userName:i.Base.Utils.queryJSONObject(e,"username[0]._text")},e=new i.Providers.WCS.LiveSessionEventData(t.request_id,t.idle_timeout,t.ws_connection_id,t.server_time_diff,{},e,{});return new i.Providers.WCS.LiveSessionEvent(e)},i.Providers.WCS.LiveSessionParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.AbstractParser.prototype)).parse=function(e){e=new t.Providers.WCS.LiveViewerEventData(t.Base.Utils.queryJSONObject(e,"brand_id[0]._text"),t.Base.Utils.queryJSONObject(e,"wcs_version[0]._text"),t.Base.Utils.queryJSONObject(e,"websocket_path[0]._text"),+t.Base.Utils.queryJSONObject(e,"websocket_cache_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_image_size[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_image_resolution[0]._text"),t.Base.Utils.queryJSONObject(e,"upload_types[0]._text"),+t.Base.Utils.queryJSONObject(e,"max_duration[0]._text"),+t.Base.Utils.queryJSONObject(e,"event_wait_time[0]._text"),+t.Base.Utils.queryJSONObject(e,"upload_max_file[0]._text"),t.Base.Utils.queryJSONObject(e,"themes_location[0]._text"),"true"===t.Base.Utils.queryJSONObject(e,"internal_ui_controls[0]._text"));return new t.Providers.WCS.LiveViewerEvent(e)},t.Providers.WCS.LiveViewerParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.selection[0]._attr&&E.each(e.selection[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.MoveSelectionEventData(i.groupId,i.layerType,i.id,i.moveToX,i.moveToY,i.selectionX,i.selectionY);return new a.Providers.WCS.MoveSelectionEvent(this.stripCommonData(e),t)},a.Providers.WCS.MoveSelectionParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.PauseScreenSharingEvent(this.stripCommonData(e))},t.Providers.WCS.PauseScreenSharingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.senderId=i.Base.Utils.queryJSONObject(e,"_attr.sender_id._value"),t.senderName=i.Base.Utils.queryJSONObject(e,"_attr.sender_name._value"),t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value"),t.time=i.Base.Utils.queryJSONObject(e,"_attr.time._value");t=new i.Providers.WCS.RemoteControlEventData(t.senderId,t.senderName,t.targetId,t.targetName,t.time);return new i.Providers.WCS.RequestControlEvent(this.stripCommonData(e),t)},i.Providers.WCS.RequestControlParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.filename=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.filename._value"),t.filesize=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.filesize._value"),t.fileurl=i.Base.Utils.queryJSONObject(e,"documentinfo[0]._attr.fileurl._value");t=new i.Providers.WCS.SendDocumentEventData(t.filename,t.filesize,t.fileurl);return new i.Providers.WCS.SendDocumentEvent(this.stripCommonData(e),t)},i.Providers.WCS.SendDocumentParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.message&&(t.message=i.Base.Utils.queryJSONObject(e,"message[0]._text")),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value"),e._attr.target_id?(t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.private=!0):t.private=!1;t=new i.Providers.WCS.SendMessageEventData(t.message,t.targetName,t.private,t.targetId);return new i.Providers.WCS.SendMessageEvent(this.stripCommonData(e),t)},i.Providers.WCS.SendMessageParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={},i=a.Base.Utils.queryJSONObject(e,"slide[0]._attr");t.count=i.count._value,t.index=i.index._value,t.title=i.title._value,t.presentationId=i.presentationid._value,t.slideUrl=i.slideurl._value,t.slideBaseUrl=i.slideurl._value,t.tocUrl=i.toc._value,t.includeToc="true"===i.includetoc._value;t=new a.Providers.WCS.SendSlideEventData(t.count,t.index,t.title,t.presentationId,t.slideUrl,t.slideBaseUrl,t.tocUrl,t.includeToc);return new a.Providers.WCS.SendSlideEvent(this.stripCommonData(e),t)},a.Providers.WCS.SendSlideParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"server_capabilities[0].max_frame_height[0]._text"),e=i.Base.Utils.queryJSONObject(e,"server_capabilities[0].max_frame_width[0]._text"),e=new i.Providers.WCS.ServerCapabilitiesEventData(t,e);return new i.Providers.WCS.ServerCapabilitiesEvent(e)},i.Providers.WCS.ServerCapabilitiesParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};e.note&&(t.type=i.Base.Utils.queryJSONObject(e,"note[0]._attr.type._value"),t.text=i.Base.Utils.queryJSONObject(e,"note[0]._text"),t.noteId=i.Base.Utils.queryJSONObject(e,"note[0]._attr.event_id._value"),t.attendeeId=i.Base.Utils.queryJSONObject(e,"note[0]._attr.attende_id._value")),e._attr.target_id?(t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.personal=!0):t.personal=!1;t=new i.Providers.WCS.SetNoteEventData(t.noteId,t.type,t.text,t.attendeeId,t.personal,t.targetId);return new i.Providers.WCS.SetNoteEvent(this.stripCommonData(e),t)},i.Providers.WCS.SetNoteParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.SliderEmptyEvent(this.stripCommonData(e))},t.Providers.WCS.SliderEmptyParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};i.Base.Utils.queryJSONObject(e,"data[0].slide_url[0]")?(t.slideURL=i.Base.Utils.queryJSONObject(e,"data[0].slide_url[0]._text"),t.thumbUrl=i.Base.Utils.queryJSONObject(e,"data[0].thumbnail_url[0]._text")):(t.slideURL=i.Base.Utils.queryJSONObject(e,"data[0].sliderUrl[0]._text"),t.thumbUrl=i.Base.Utils.queryJSONObject(e,"data[0].thumbUrl[0]._text"));t=new i.Providers.WCS.SliderSlideEventData(t.slideURL,t.thumbUrl);return new i.Providers.WCS.SliderSlideEvent(this.stripCommonData(e),t)},i.Providers.WCS.SliderSlideParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t={};t.senderId=i.Base.Utils.queryJSONObject(e,"_attr.sender_id._value"),t.senderName=i.Base.Utils.queryJSONObject(e,"_attr.sender_name._value"),t.targetId=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),t.targetName=i.Base.Utils.queryJSONObject(e,"_attr.target_name._value"),t.time=i.Base.Utils.queryJSONObject(e,"_attr.time._value");t=new i.Providers.WCS.RemoteControlEventData(t.senderId,t.senderName,t.targetId,t.targetName,t.time);return new i.Providers.WCS.StartControlEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartControlParser=e}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var i={};e.lines[0]._attr&&E.each(e.lines[0]._attr,function(e,t){i[this.stringToCamel(e)]=t._value}.bind(this)),a.Base.Utils.isDefined(i.color)&&(i.color=a.Base.Utils.colorIntToHex(i.color)),i.group&&(t=this.convertGroup(i.group),i.layerType=t.layerType,i.groupId=t.groupId,delete i.group);var t=new a.Providers.WCS.StartDrawShapeEventData(i.alpha,i.color,i.groupId,i.layerType,i.width);return new a.Providers.WCS.StartDrawShapeEvent(this.stripCommonData(e),t)},a.Providers.WCS.StartDrawShapeParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=new i.Providers.WCS.StartMeetingEventData("173621");return new i.Providers.WCS.StartMeetingEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartMeetingParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"transport_version[0]._text"),t=new i.Providers.WCS.StartScreenSharingEventData(t);return new i.Providers.WCS.StartScreenSharingEvent(this.stripCommonData(e),t)},i.Providers.WCS.StartScreenSharingParser=e}(AvayaClientServices),function(t){"use strict";function e(){}(e.prototype=Object.create(t.Providers.WCS.LiveEventParser.prototype)).parse=function(e){return new t.Providers.WCS.StartVideoSharingEvent(this.stripCommonData(e))},t.Providers.WCS.StartVideoSharingParser=e}(AvayaClientServices),function(r){"use strict";function e(){}(e.prototype=Object.create(r.Providers.WCS.LiveEventParser.prototype)).parse=function(e){var t=r.Base.Utils.queryJSONObject(e,"whiteboard[0]._attr.index._value"),i=r.Base.Utils.queryJSONObject(e,"whiteboard[0]._attr.width._value"),a=r.Base.Utils.queryJSONObject(e,"whiteboard[0]._attr.height._value"),a=new r.Providers.WCS.StartWhiteboardEventData(t,i,a);return new r.Providers.WCS.StartWhiteboardEvent(this.stripCommonData(e),a)},r.Providers.WCS.StartWhiteboardParser=e}(AvayaClientServices),function(i){"use strict";function e(){}(e.prototype=Object.create(i.Providers.WCS.AbstractParser.prototype)).parse=function(e){var t=i.Base.Utils.queryJSONObject(e,"_attr.target_id._value"),e=i.Base.Utils.queryJSONObject(e,"_attr.toname._value"),e=new i.Providers.WCS.UpdateAttendeeNameEventData(t,e);return new i.Providers.WCS.UpdateAttendeeNameEvent(e)},i.Providers.WCS.UpdateAttendeeNameParser=e}(AvayaClientServices),function(i){"use strict";function e(e){this._position=0,this._buffer=e,this.length=this._buffer.byteLength}e.prototype={getBuffer:function(){return this._buffer},setPosition:function(e){this._position=e},getPosition:function(){return this._position},getBytesAvailable:function(){return this._buffer.byteLength-this._position},readBytes:function(e){var t=new i.Providers.WCS.ByteArray(this._buffer.slice(this._position,this._position+e));return this._position+=e,t},readByte:function(){var e=new Int8Array(this._buffer.slice(this._position,this._position+1));return this._position++,e[0]},readUnsignedInt:function(){var e=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,e.getUint32(0)},readShort:function(){var e=new DataView(this._buffer.slice(this._position,this._position+2));return this._position+=2,e.getInt16(0)},readInt:function(){var e=new DataView(this._buffer.slice(this._position,this._position+4));return this._position+=4,e.getInt32(0)}},i.Providers.WCS.ByteArray=e}(AvayaClientServices),function(e){"use strict";function t(){this._bitmapElements=[],this.width=0,this.height=0,this.isKeyFrame=!1}t.prototype={setStartTag:function(e){return this.width=e.width,this.height=e.height,this.isKeyFrame=e.isKeyFrame,this},addBitmapElement:function(e){return this._bitmapElements.push(e),this}},e.Providers.WCS.Frame=t}(AvayaClientServices),function(e){"use strict";function t(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.bitmapData=e.data.getBuffer(),this.imageType=e.imageType}t.prototype={},e.Providers.WCS.FrameBitmapLoader=t}(AvayaClientServices),function(i){"use strict";function e(){this._frame=T}e.prototype={processTag:function(e,t){switch(e.type){case i.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:this._startFrame(e);break;case i.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:this._addBinaryBlock(e);break;case i.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:this._endFrame(t);break;default:i.Base.Logger.warn(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",e.type)}},_startFrame:function(e){i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add start Tag"),this._frame=new i.Providers.WCS.Frame,this._frame.setStartTag(e)},_addBinaryBlock:function(e){this._frame&&0<e.data.length&&(e=new i.Providers.WCS.FrameBitmapLoader(e),this._frame.addBitmapElement(e))},_endFrame:function(e){this._frame?(i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Add End Tag - end Frame",this._frame._bitmapElements.length),e(this._frame),this._frame=T):i.Base.Logger.debug(i.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"There was no Start Tag for this End Tag")}},i.Providers.WCS.FrameBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingCopyPasteTypes={COPY:0,PASTE:1}}(),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingImageTypes={JPEG:0,PNG:1,JPEG_RED_WITH_BLACK:2}}(),function(){"use strict";AvayaClientServices.Providers.WCS.ScreenSharingKeyFrameTypes={INTRA_FRAME:0,KEY_FRAME:1}}(),function(n){"use strict";n.Providers.WCS.ScreenSharingTagEncoder=function(){},n.Providers.WCS.ScreenSharingTagEncoder.prototype={encodeTag:function(e){switch(e.type){case n.Providers.WCS.WCSScreenSharingTagTypes.START_TAG:return this._encodeStartFrame(e);case n.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG:return this._encodeBinaryBlock(e);case n.Providers.WCS.WCSScreenSharingTagTypes.END_TAG:return this._encodeEndFrame(e);case n.Providers.WCS.WCSScreenSharingTagTypes.MOUSE_TAG:return this._encodeMouse(e);case n.Providers.WCS.WCSScreenSharingTagTypes.KEYBOARD_TAG:return this._encodeKeyboard(e);case n.Providers.WCS.WCSScreenSharingTagTypes.COPY_PASTE_TAG:return this._encodeCopyPaste(e);default:n.Base.Logger.warn(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Unknown tag type received: {0}",e.type)}},_encodeStartFrame:function(e){var t,i,a=0;0!==e.messageId?(a=4,t=new ArrayBuffer(14+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(14+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.START_TAG),i.setInt8(1+a,e.isKeyFrame?n.Providers.WCS.ScreenSharingKeyFrameTypes.KEY_FRAME:n.Providers.WCS.ScreenSharingKeyFrameTypes.INTRA_FRAME),i.setInt16(2+a,e.width),i.setInt16(4+a,e.height);for(var r=this._getCurrentTimeStamp(e.creationTime),s=0;s<r.length;s++)i.setInt8(6+a+s,r[s]);return t},_encodeBinaryBlock:function(e){var t,i,a,r=0;return 0!==e.messageId?(r=4,t=new ArrayBuffer(18+r+e.data.length),i=new Uint8Array(t),(a=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(18+r+e.data.length),i=new Uint8Array(t),a=new DataView(t)),a.setInt8(0+r,n.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG),a.setInt16(1+r,e.width),a.setInt16(3+r,e.height),a.setInt16(5+r,e.x),a.setInt16(7+r,e.y),a.setInt8(9+r,e.imageType),0===e.length?a.setInt32(10+r,e.data.length):a.setInt32(10+r,e.length),a.setInt32(14+r,0),i.set(e.data,18+r),t},_encodeEndFrame:function(e){var t,i,a=0;return 0!==e.messageId?(a=4,t=new ArrayBuffer(1+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(1+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.END_TAG),t},_encodeMouse:function(e){var t,i,a=0;return 0!==e.messageId?(a=4,t=new ArrayBuffer(8+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(8+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.MOUSE_TAG),i.setInt16(1+a,e.x),i.setInt16(3+a,e.y),i.setInt8(5+a,e.buttonEventType),i.setInt8(6+a,e.buttonPressedType),i.setInt8(7+a,e.wheelAmount),t},_encodeKeyboard:function(e){var t,i,a=0;return 0!==e.messageId?(a=4,t=new ArrayBuffer(10+a),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(10+a),i=new DataView(t)),i.setInt8(0+a,n.Providers.WCS.WCSScreenSharingTagTypes.KEYBOARD_TAG),i.setInt8(1+a,e.ctrlPressed),i.setInt8(2+a,e.altPressed),i.setInt8(3+a,e.shiftPressed),i.setInt8(4+a,e.cmdPressed),i.setInt8(5+a,e.winPressed),i.setInt16(6+a,e.key1),i.setInt16(8+a,e.key2),t},_encodeCopyPaste:function(e){var t,i,a,r=0;return 0!==e.messageId?(r=4,t=new ArrayBuffer(6+r+e.data.length),a=new Uint8Array(t),(i=new DataView(t)).setInt32(0,e.messageId)):(t=new ArrayBuffer(6+r+e.data.length),a=new Uint8Array(t),i=new DataView(t)),i.setInt8(0+r,n.Providers.WCS.WCSScreenSharingTagTypes.COPY_PASTE_TAG),i.setInt8(1+r,e.eventType),0===e.length?i.setInt32(2+r,e.data.length):i.setInt32(2+r,e.length),a.set(e.data,6+r),t},_getCurrentTimeStamp:function(e){e=this._longToByteArray(e);return e.reverse(),e},_longToByteArray:function(e){for(var t=[0,0,0,0,0,0,0,0],i=0;i<t.length;i++){var a=255&e;e=(e-(t[i]=a))/256}return t}}}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSScreenSharingTagTypes={START_TAG:0,BLOCK_TAG:1,CURSOR_TAG:2,END_TAG:3,ACK_TAG:4,KEYBOARD_TAG:16,MOUSE_TAG:17,COPY_PASTE_TAG:18}}(),function(){"use strict";AvayaClientServices.Providers.WCS.WCSSharingTag=function(e){this.type=e,this.messageId=0}}(),function(s){"use strict";function e(){this._parsers={},this._ackPackageSize=5}e.prototype={parse:function(e){var t,i,a,r={};return 0<e.byteLength?(i=new s.Providers.WCS.ByteArray(e),e.byteLength===this._ackPackageSize&&(r.id=i.readInt()),e=(a=i.readByte())>>4,a=15&a,r.byteArray=i,this._parsers[e]&&this._parsers[e][a]?t=this._parsers[e][a].parse(r):s.Base.Logger.error(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Failed to find parser for ",e," : ",a)):s.Base.Logger.warn(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Buffer length = 0. Parse process skipped."),t},registerParser:function(e,t,i){this._parsers[e]||(this._parsers[e]={}),this._parsers[e][t]=i}},s.Providers.WCS.WCSBinaryParser=e}(AvayaClientServices),function(r){"use strict";function e(e){this._frameBuilder=e,this._lastPoint=T,this._timeout=T,this._isKeyFrameArrived=!1,this._utf8Decoder=new TextDecoder}e.prototype={updateFrame:function(i,e){this._frameBuilder.processTag(e,function(e){var t=e._bitmapElements.map(function(e){return new r.Services.Collaboration.Bitmap(e.x,e.y,e.width,e.height,e.imageType,e.bitmapData)}),e=new r.Services.Collaboration.Frame(e.width,e.height,t,e.isKeyFrame);e.isKeyFrame()?(this._isKeyFrameArrived=!0,i._contentSharing._onFrameReceivedCallbacks.fire(i._contentSharing,e)):this._isKeyFrameArrived?i._contentSharing._onFrameChangedCallbacks.fire(i._contentSharing,e):r.Base.Logger.warn(r.Base.LoggerTags.WCS_CONTENT_SHARING_HANDLER,"A normal frame has arrived before the key frame")}.bind(this))},updateCursor:function(e,t){this._lastPoint=new r.Services.Collaboration.Point(t.x,t.y),this._timeout||(this._timeout=setTimeout(function(){e._contentSharing._onCursorReceivedCallbacks.fire(e._contentSharing,this._lastPoint),this._timeout=T}.bind(this),100))},startScreenSharing:function(e,t,i){var a=this._getParticipant(e,t),t=e._contentSharing._contentSharingService._sharingState;e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.SHARING,r.Base.Logger.debug(r.Base.LoggerTags.WCS_COLLABORATION_PROVIDER," Old sharing state: ",t,"New sharingState: ",e._contentSharing._contentSharingService._sharingState),!0===e._contentSharing._isPaused&&t!==r.Services.Collaboration.ContentSharingState.NOT_SHARING&&i?(e._contentSharing._isPaused=!1,e._contentSharing._onContentSharingResumedCallbacks.fire(e._contentSharing,a)):(e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.SHARING,e._contentSharing._recalculateAllRemoteControlCapabilities(e),e._contentSharing._onContentSharingStartedCallbacks.fire(e._contentSharing,a))},pauseScreenSharing:function(e,t){e._contentSharing._isPaused=!0;t=this._getParticipant(e,t);e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.PAUSED,e._contentSharing._onContentSharingPausedCallbacks.fire(e._contentSharing,t)},endScreenSharing:function(e,t){this._isKeyFrameArrived=!1;t=this._getParticipant(e,t);e._contentSharing._isPaused=!1,e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.NOT_SHARING,e._contentSharing._recalculateAllRemoteControlCapabilities(e),e._contentSharing._onContentSharingEndedCallbacks.fire(e._contentSharing,t)},endScreenSharingByParticipant:function(e,t){this._isKeyFrameArrived=!1,e._contentSharing._isPaused=!1,e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.NOT_SHARING,e._contentSharing._onContentSharingEndedCallbacks.fire(e._contentSharing,t)},startVideoSharing:function(e,t){t=this._getParticipant(e,t);e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.SHARING,e._contentSharing._onScreenSharingUsingVideoStartedCallbacks.fire(e._contentSharing,t)},endVideoSharing:function(e,t){var i=this._getParticipant(e,t);this.endVideoSharingByParticipant(e,i,t.isServerInitiated())},requestRemoteControl:function(e,t){e._contentSharing._onRemoteControlRequestedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName)},grantRemoteControl:function(e,t){e._contentSharing._onRemoteControlGrantedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName,t.data.osType)},denyRemoteControl:function(e,t){e._contentSharing._onRemoteControlDeniedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName)},declineRemoteControl:function(e,t){e._contentSharing._onRemoteControlDeclinedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName)},startRemoteControl:function(e,t){e._contentSharing._contentSharingService._remoteControlState=r.Services.Collaboration.ContentSharingState.SHARING,e._contentSharing._onRemoteControlStartedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName,t.data.targetId)},endRemoteControl:function(e,t){e._contentSharing._contentSharingService._remoteControlState=r.Services.Collaboration.ContentSharingState.NOT_SHARING,e._contentSharing._onRemoteControlEndedCallbacks.fire(e._contentSharing,t.data.senderId,t.data.senderName)},updateRemoteControlMouse:function(e,t){this._rcMouseTimeout||(this._rcMouseTimeout=setTimeout(function(){e._contentSharing._onRemoteControlMouseTagCallbacks.fire(e._contentSharing,t),this._rcMouseTimeout=T}.bind(this),100))},updateRemoteControlKeyboard:function(e,t){e._contentSharing._onRemoteControlKeyboardTagCallbacks.fire(e._contentSharing,t)},updateRemoteControlCopyPaste:function(e,t){if(0<t.length)try{var i=this._utf8Decoder.decode(new Uint8Array(t.data._buffer));navigator.clipboard&&r.Base.Utils.getBrowserType()!==r.Base.BrowserType.FIREFOX&&navigator.clipboard.writeText(i).catch(function(e){r.Base.Logger.error(r.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error writting to clipboard: ",e)}).finally(function(){e._contentSharing._onRemoteControlCopyPasteTagCallbacks.fire(e._contentSharing,i)})}catch(e){r.Base.Logger.error(r.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Error decoding copy/paste data: ",e)}},endVideoSharingByParticipant:function(e,t,i){e._contentSharing._contentSharingService.isScreenSharingUsingVideo()?e._contentSharing._contentSharingService._sharingState=r.Services.Collaboration.ContentSharingState.NOT_SHARING:t.isLocalUser()&&e._contentSharing._contentSharingService.stopScreenSharingUsingVideo(e._contentSharing,!1),e._contentSharing._onScreenSharingUsingVideoEndedCallbacks.fire(e._contentSharing,t,i)},frameReport:function(e,t){e._contentSharing._onFrameReportReceivedCallbacks.fire(e._contentSharing,t)},_getParticipant:function(e,t){var i=e._participants.filter(function(e){return e.getParticipantId()===t.senderId&&e.setDisplayName(t.senderName),e.getParticipantId()===t.senderId})[0];return i||(i=new r.Services.Collaboration.Participant(t.senderId,t.senderName),e._participants.push(i)),i}},r.Providers.WCS.WCSContentSharingHandler=e}(AvayaClientServices),function(s,n){"use strict";function e(){this.parsers=[],this.optimizer=new s.Providers.WCS.LiveEventQueueOptimizer}e.prototype={register:function(e,t){this.parsers[e]=t},unregister:function(e){this.parsers[e]=T},parse:function(e){"string"==typeof e?r=n.parseString(e):"object"==typeof e&&(r=e);var t=r.response[0],i=[],e=[];if(t.error){var a=s.Providers.WCS.WCSEventTypes.ERROR,r=t.error[0];return i.push(this.delegateParser(a,r)),i}if(t.live_events)return t.live_events[0]&&t.live_events[0].event&&(E.each(t.live_events[0].event,function(e,t){a=t._attr.type._value;t=this.delegateParser(a,t);t!==T&&i.push(t)}.bind(this)),e=this.optimizer.getOptimizedQueue(i)),e;if(t.live_event||t.live_ping)return[];if(t.live_session)return a=s.Providers.WCS.WCSEventTypes.LIVE_SESSION,i.push(this.delegateParser(a,t.live_session[0])),i;if(t.frame_report)return a=s.Providers.WCS.WCSEventTypes.FRAME_REPORT,i.push(this.delegateParser(a,t.frame_report[0])),i;if(t.live_viewer)return a=s.Providers.WCS.WCSEventTypes.LIVE_VIEWER,i.push(this.delegateParser(a,t.live_viewer[0])),i;if(t.live_capabilities)return a=s.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,i.push(this.delegateParser(a,t.live_capabilities[0])),i;if(t.live_attendees)return a=s.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,i.push(this.delegateParser(a,t.live_attendees[0])),i;throw new Error("No parser specified!")},delegateParser:function(e,t){if(this.parsers[e]!==T)return this.parsers[e].parse(t);s.Base.Logger.error(s.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"No parser specified!",e)}},s.Providers.WCS.WCSEventsParser=e}(AvayaClientServices,xmlToJSON),function(){"use strict";AvayaClientServices.Providers.WCS.WCSEventTypes={START_WHITEBOARD:"StartWhiteboard",ADD_WHITEBOARD:"AddWhiteboard",DELETE_WHITEBOARD:"DeleteWhiteboard",START_DRAW_SHAPE:"StartDrawShape",DRAW_SHAPE:"DrawShape",END_DRAW_SHAPE:"EndDrawShape",DRAW_CIRCLE:"DrawCircle",DRAW_TEXT:"DrawText",MOVE_SELECTION:"MoveSelection",DELETE_SELECTION:"DeleteSelection",CLEAR_DRAWING:"ClearDrawing",END_WHITEBOARD:"EndWhiteboard",SEND_SLIDE:"SendSlide",END_PRESENTATION:"EndPresentation",SEND_MESSAGE:"SendMessage",ADD_NOTE:"AddNote",SET_NOTE:"SetNote",DELETE_NOTE:"DeleteNote",START_SCREEN_SHARING:"StartScreenSharing",PAUSE_SCREEN_SHARING:"PauseScreenSharing",END_SCREEN_SHARING:"EndScreenSharing",REQUEST_CONTROL:"RequestControl",GRANT_CONTROL:"GrantControl",START_CONTROL:"StartControl",DECLINE_CONTROL:"DeclineControl",DENY_CONTROL:"DenyControl",SEND_DOCUMENT:"SendDocument",END_CONTROL:"EndControl",ALLOW_PRESENTING:"AllowPresenting",DENY_PRESENTING:"DenyPresenting",EJECT_PARTICIPANT:"EjectParticipant",START_MEETING:"StartMeeting",END_MEETING:"EndMeeting",DRAW_CURSOR:"DrawCursor",DRAW_FRAME:"DrawFrame",LIVE_VIEWER:"LiveViewer",FRAME_REPORT:"FrameReport",START_VIDEO_SHARING:"StartVideoSharing",END_VIDEO_SHARING:"EndVideoSharing",ERROR:"Error",LIVE_SESSION:"LiveSession",LIVE_ATTENDEES:"LiveAttendees",LIVE_ATTENDEE:"LiveAttendee",LIVE_CAPABILITIES:"LiveCapabilities",SERVER_CAPABILITIES:"ServerCapabilities",SLIDER_SLIDE:"SliderSlide",SLIDER_EMPTY:"SliderEmpty",UPDATE_ATTENDEE_NAME:"UpdateAttendeeName"}}(),function(o){"use strict";function e(){this._config=T,this._participant=T,this._meetingId=T}e.prototype={buildDrawCircleMessage:function(e,t,i,a,r){t=this._buildDrawCircleEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,i,a,r,t)},buildResourceDiscoveryMessage:function(e,t,i,a,r){return{mode:e,meeting_id:t,participant_id:i,username:a,token:r}},buildMoveSelectionMessage:function(e,t,i,a,r,s,n){a=this._buildMoveSelectionEventData(e,t,i,a);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.MOVE_SELECTION,r,s,n,a)},buildDrawShapeMessage:function(e,t,i,a,r){t=this._buildDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,i,a,r,t)},buildLiveDrawShapeMessage:function(e,t,i,a,r){t=this._buildLiveDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,i,a,r,t)},buildFirstPointLiveDrawShapeMessage:function(e,t,i,a){e=this._buildFirstPointLiveDrawShapeEventData(e);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_SHAPE,t,i,a,e)},buildStartDrawShapeMessage:function(e,t,i,a,r){t=this._buildStartDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,i,a,r,t)},buildEndDrawShapeMessage:function(e,t,i,a,r){t=this._buildEndDrawShapeEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,i,a,r,t)},buildDrawTextMessage:function(e,t,i,a,r){t=this._buildDrawTextEventData(e,t);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DRAW_TEXT,i,a,r,t)},buildAddWhiteboardMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,e,t,i)},buildEndWhiteboardMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_WHITEBOARD,e,t,i)},buildRemoveWhiteboardMessage:function(e,t,i,a){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,t,i,a,'<whiteboard index="'+e+'"/>')},buildStartWhiteboardMessage:function(e,t,i,a){var r='<whiteboard index="';return o.Base.Utils.isDefined(a)&&(r+=a),this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_WHITEBOARD,e,t,i,r+='"/>')},buildLiveEventMessage:function(e,t,i,a,r){return this._decorateRequest(e,t,i,a,r)},buildRemoteControlMessage:function(e,t,i,a,r,s){return this._decorateRequest(e,t,i,a,s,r)},buildStartScreenSharingMessage:function(e,t,i,a){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,e,t,i,!0===a?"<data><transport_version>1</transport_version><remote_control>true</remote_control></data>":"<transport_version>1</transport_version>")},buildStopScreenSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,e,t,i)},buildPauseScreenSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,e,t,i)},buildStartVideoSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,e,t,i)},buildStopVideoSharingMessage:function(e,t,i){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,e,t,i)},buildClearContentMessage:function(e,t,i,a){return this._decorateRequest(o.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,t,i,a,'<selection group="whiteboard_'+e+'"/>')},buildGetParticipantsMessage:function(e){return"live_attendees?rc_only="+!!e+"&request_id="+o.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},buildMaxDownloadMessage:function(e){return"live_capabilities?max_download_bandwidth="+e+"&request_id="+o.Base.Utils.makeId(32,"abcdefgijklmnopqrstuvwxyz0123456789")},_buildMoveSelectionEventData:function(e,t,i,a){var r=e.getTranslation();return'<selection group="whiteboard_'+t+'" id="'+e.getId()+'" moveToX="'+r.getX()+'" moveToY="'+r.getY()+'" selectionX="'+i+'" selectionY="'+a+'"/>'},buildDeleteSelectionMessage:function(e,t,i,a,r,s,n){a=this._buildDeleteSelectionEventData(e,t,i,a);return this._decorateRequest(o.Providers.WCS.WCSEventTypes.DELETE_SELECTION,r,s,n,a)},buildPauseMessage:function(){return"live_capabilities?sharing_reception=false&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef")},buildResumeMessage:function(){return"live_capabilities?sharing_reception=true&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef")},_buildDeleteSelectionEventData:function(e,t,i,a){return'<selection group="whiteboard_'+t+'" id="'+e._id+'" selectionX="'+i+'" selectionY="'+a+'"/>'},_buildDrawCircleEventData:function(e,t){t='<circle alpha="'+e.getAlpha()+'" group="whiteboard_'+t+'" x0="'+e.getTopLeft().getX()+'" x1="'+e.getBottomRight().getX()+'" y0="'+e.getTopLeft().getY()+'" y1="'+e.getBottomRight().getY()+'"';return e.isFilled()?t+=' fillColor="'+e.getColor()+'"':t+=' color="'+e.getColor()+'"',t=t+' width="'+e.getWidth()+'" />'},_buildDrawShapeEventData:function(e,t){var i='<lines group="whiteboard_'+t+'" alpha="'+e.getAlpha()+'" width="'+e.getWidth()+'"';e.isFilled()?i+=' fillColor="'+e.getColor()+'"':i+=' color="'+e.getColor()+'"',i+=">";for(var a=0,r=e.getPoints();a<r.length;a++){var s=r[a];s.isMove?i+='<m x="'+s.point.getX()+'" y="'+s.point.getY()+'"/>':i+='<l x="'+s.point.getX()+'" y="'+s.point.getY()+'"/>'}return i+="</lines>"},_buildFirstPointLiveDrawShapeEventData:function(e){return'<m x="'+e.getX()+'" y="'+e.getY()+'"/>'},_buildLiveDrawShapeEventData:function(e,t){var i="",a=0;for(e[0].isMove&&(a=1,i+='<m x="'+e[0].point.getX()+'" y="'+e[0].point.getY()+'"/>'),i+='<lines group="whiteboard_'+t+'">';a<e.length;a++){var r=e[a];r.isMove?i+='<m x="'+r.point.getX()+'" y="'+r.point.getY()+'"/>':i+='<l x="'+r.point.getX()+'" y="'+r.point.getY()+'"/>'}return i+="</lines>"},_buildStartDrawShapeEventData:function(e,t){t='<lines group="whiteboard_'+t+'" alpha="'+e.getAlpha()+'" width="'+e.getWidth()+'"';return e.isFilled()?t+=' fillColor="'+e.getColor()+'"':t+=' color="'+e.getColor()+'"',t+="/>"},_buildEndDrawShapeEventData:function(e,t){return'<lines group="whiteboard_'+t+'"/>'},_buildDrawTextEventData:function(e,t){return'<drawText fillColor="'+e.getColor()+'" fontSize="'+e.getFontSize()+'" group="whiteboard_'+t+'" text="'+this._escapeXMLSpecialChars(e.getContent())+'" x="'+e.getPosition().getX()+'" y="'+e.getPosition().getY()+'"/>'},_translateColor:function(e){return parseInt("0x".concat(e.slice(1))).toString()},_decorateRequest:function(e,t,i,a,r,s){a="live_event"+(r?"?event_data="+encodeURIComponent(r)+"&":"?")+"event_type="+e+"&meeting_id="+t+"&sender_id="+i+"&sender_name="+encodeURIComponent(a)+"&request_id="+o.Base.Utils.makeId(32,"0123456789abcdef");return s&&(a+="&target_id="+s),a},_escapeXMLSpecialChars:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"&#xA;")}},o.Providers.WCS.WCSMessageBuilder=e}(AvayaClientServices),function(e){"use strict";function t(){e.Providers.Interfaces.CollaborationProvider.call(this),this._providers=[],this._selectedProvider=T,this._config={}}(t.prototype=Object.create(e.Providers.Interfaces.CollaborationProvider.prototype)).stop=function(){return e.Base.Utils.isDefined(this._selectedProvider)?this._selectedProvider.stop():E.Deferred().resolve().promise()},t.prototype.registerWCSProvider=function(e,t){this._providers.push({version:e,provider:t})},t.prototype.start=function(e,t){return E.isEmptyObject(e)||this._config===e||(this._config=e.wcsConfiguration),this._selectedProvider=this._providers[0].provider,this._selectedProvider.start(e.wcsConfiguration,t)},t.prototype.on=function(e,t){this._selectedProvider.on(e,t)},t.prototype.off=function(e,t){this._selectedProvider.off(e,t)},t.prototype.getReceivingBitrate=function(){return this._selectedProvider.getReceivingBitrate()},t.prototype.getBufferedAmount=function(){return this._selectedProvider.getBufferedAmount()},t.prototype.addCircle=function(e,t){return this._selectedProvider.addCircle(e,t)},t.prototype.pause=function(){return this._selectedProvider.pause()},t.prototype.resume=function(){return this._selectedProvider.resume()},t.prototype.addText=function(e,t){return this._selectedProvider.addText(e,t)},t.prototype.addShape=function(e,t){return this._selectedProvider.addShape(e,t)},t.prototype.discoverResources=function(e){return this._selectedProvider.discoverResources(e)},t.prototype.startDrawShape=function(e,t){return this._selectedProvider.startDrawShape(e,t)},t.prototype.liveDrawShape=function(e,t){return this._selectedProvider.liveDrawShape(e,t)},t.prototype.endDrawShape=function(e,t){return this._selectedProvider.endDrawShape(e,t)},t.prototype.moveSelection=function(e,t,i){return this._selectedProvider.moveSelection(e,t,i)},t.prototype.observeCollaboration=function(e){this._selectedProvider.observeCollaboration(e)},t.prototype.startWhiteboard=function(e){return this._selectedProvider.startWhiteboard(e)},t.prototype.endWhiteboard=function(e){return this._selectedProvider.endWhiteboard(e)},t.prototype.addWhiteboardSurface=function(){return this._selectedProvider.addWhiteboardSurface()},t.prototype.removeWhiteboardSurface=function(e){return this._selectedProvider.removeWhiteboardSurface(e)},t.prototype.sendBlocks=function(e,t){return this._selectedProvider.sendBlocks(e,t)},t.prototype.startScreenSharing=function(e){return this._selectedProvider.startScreenSharing(e)},t.prototype.stopScreenSharing=function(){return this._selectedProvider.stopScreenSharing()},t.prototype.startVideoSharing=function(){return this._selectedProvider.startVideoSharing()},t.prototype.stopVideoSharing=function(){return this._selectedProvider.stopVideoSharing()},t.prototype.pauseScreenSharing=function(){return this._selectedProvider.pauseScreenSharing()},t.prototype.requestRemoteControl=function(){return this._selectedProvider.requestRemoteControl()},t.prototype.grantRemoteControl=function(e,t){return this._selectedProvider.grantRemoteControl(e,t)},t.prototype.denyRemoteControl=function(e){return this._selectedProvider.denyRemoteControl(e)},t.prototype.declineRemoteControl=function(e){return this._selectedProvider.declineRemoteControl(e)},t.prototype.startRemoteControl=function(e){return this._selectedProvider.startRemoteControl(e)},t.prototype.endRemoteControl=function(e){return this._selectedProvider.endRemoteControl(e)},t.prototype.sendLiveEvent=function(e){return this._selectedProvider.sendLiveEvent(e)},t.prototype.removeShape=function(e,t,i){return this._selectedProvider.removeShape(e,t,i)},t.prototype.clearContent=function(e){return this._selectedProvider.clearContent(e)},t.prototype.getParticipants=function(){return this._selectedProvider.getParticipants()},t.prototype.isOpened=function(){return this._selectedProvider&&this._selectedProvider.isOpened()},t.prototype.isFeatureAvailable=function(e){return this._selectedProvider&&this._selectedProvider.isFeatureAvailable(e)},t.prototype.run=function(e){return this._selectedProvider.run(e)},t.prototype.getServerCapabilities=function(){return this._selectedProvider.getServerCapabilities()},t.prototype.isWhiteboardActive=function(){return this._selectedProvider.isWhiteboardActive()},t.prototype.getAcksActivated=function(){return this._selectedProvider.getAcksActivated()},e.Providers.WCS.WCSProvider=t}(AvayaClientServices),function(l){"use strict";function e(){this._collaborationProvider={}}e.prototype={getWCSProvider:function(e){if(l.Base.Utils.isDefined(e)&&e.enabled)return E.isEmptyObject(this._collaborationProvider)&&(e=this._createWCSv1_1Provider(),this._collaborationProvider=new l.Providers.WCS.WCSProvider,this._collaborationProvider.registerWCSProvider("1.1",e)),this._collaborationProvider},_createWCSv1_1Provider:function(){var e=new l.Base.RESTProvider,t=new l.Base.NetworkProvider(e,T,l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),i=new l.Providers.WCS.CometParser,a=new l.Providers.WCS.WCSCometProvider(i),r=new l.Providers.WCS.WCSTransactionalWebSocketProvider,s=new l.Base.NetworkProvider(r,a,l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER),n=this._createEventsParser(),o=this._createBinaryParser(),c=new l.Providers.WCS.FrameBuilder,e=new l.Providers.WCS.WCSMessageBuilder,i=new l.Providers.WCS.WCSContentSharingHandler(c),r=new l.Providers.WCS.WCSShapeConverter,a=new l.Providers.WCS.WCSWhiteboardHandler(r),c=new l.Services.Analytics.CollaborationsAnalyticsService,r=new l.Providers.WCS.WCSSliderHandler;return new l.Providers.WCS.WCSv1_1Provider(t,n,o,e,i,a,r,s,c)},_createEventsParser:function(){var e=new l.Providers.WCS.WCSEventsParser;return e.register(l.Providers.WCS.WCSEventTypes.ERROR,new l.Providers.WCS.ErrorParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_SESSION,new l.Providers.WCS.LiveSessionParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_VIEWER,new l.Providers.WCS.LiveViewerParser),e.register(l.Providers.WCS.WCSEventTypes.SEND_MESSAGE,new l.Providers.WCS.SendMessageParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_SHAPE,new l.Providers.WCS.DrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_CIRCLE,new l.Providers.WCS.DrawCircleParser),e.register(l.Providers.WCS.WCSEventTypes.MOVE_SELECTION,new l.Providers.WCS.MoveSelectionParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_SELECTION,new l.Providers.WCS.DeleteSelectionParser),e.register(l.Providers.WCS.WCSEventTypes.CLEAR_DRAWING,new l.Providers.WCS.ClearDrawingParser),e.register(l.Providers.WCS.WCSEventTypes.DRAW_TEXT,new l.Providers.WCS.DrawTextParser),e.register(l.Providers.WCS.WCSEventTypes.START_DRAW_SHAPE,new l.Providers.WCS.StartDrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.END_DRAW_SHAPE,new l.Providers.WCS.EndDrawShapeParser),e.register(l.Providers.WCS.WCSEventTypes.START_WHITEBOARD,new l.Providers.WCS.StartWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.ADD_WHITEBOARD,new l.Providers.WCS.AddWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_WHITEBOARD,new l.Providers.WCS.DeleteWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.END_WHITEBOARD,new l.Providers.WCS.EndWhiteboardParser),e.register(l.Providers.WCS.WCSEventTypes.START_MEETING,new l.Providers.WCS.StartMeetingParser),e.register(l.Providers.WCS.WCSEventTypes.START_SCREEN_SHARING,new l.Providers.WCS.StartScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.START_VIDEO_SHARING,new l.Providers.WCS.StartVideoSharingParser),e.register(l.Providers.WCS.WCSEventTypes.PAUSE_SCREEN_SHARING,new l.Providers.WCS.PauseScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.END_SCREEN_SHARING,new l.Providers.WCS.EndScreenSharingParser),e.register(l.Providers.WCS.WCSEventTypes.END_VIDEO_SHARING,new l.Providers.WCS.EndVideoSharingParser),e.register(l.Providers.WCS.WCSEventTypes.GRANT_CONTROL,new l.Providers.WCS.GrantControlParser),e.register(l.Providers.WCS.WCSEventTypes.ADD_NOTE,new l.Providers.WCS.AddNoteParser),e.register(l.Providers.WCS.WCSEventTypes.DELETE_NOTE,new l.Providers.WCS.DeleteNoteParser),e.register(l.Providers.WCS.WCSEventTypes.SET_NOTE,new l.Providers.WCS.SetNoteParser),e.register(l.Providers.WCS.WCSEventTypes.DENY_CONTROL,new l.Providers.WCS.DenyControlParser),e.register(l.Providers.WCS.WCSEventTypes.DECLINE_CONTROL,new l.Providers.WCS.DeclineControlParser),e.register(l.Providers.WCS.WCSEventTypes.REQUEST_CONTROL,new l.Providers.WCS.RequestControlParser),e.register(l.Providers.WCS.WCSEventTypes.GRANT_CONTROL,new l.Providers.WCS.GrantControlParser),e.register(l.Providers.WCS.WCSEventTypes.END_CONTROL,new l.Providers.WCS.EndControlParser),e.register(l.Providers.WCS.WCSEventTypes.START_CONTROL,new l.Providers.WCS.StartControlParser),e.register(l.Providers.WCS.WCSEventTypes.END_MEETING,new l.Providers.WCS.EndMeetingParser),e.register(l.Providers.WCS.WCSEventTypes.SEND_DOCUMENT,new l.Providers.WCS.SendDocumentParser),e.register(l.Providers.WCS.WCSEventTypes.ALLOW_PRESENTING,new l.Providers.WCS.AllowPresentingParser),e.register(l.Providers.WCS.WCSEventTypes.DENY_PRESENTING,new l.Providers.WCS.DenyPresentingParser),e.register(l.Providers.WCS.WCSEventTypes.EJECT_PARTICIPANT,new l.Providers.WCS.EjectParticipantParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_ATTENDEES,new l.Providers.WCS.LiveAttendeesParser),e.register(l.Providers.WCS.WCSEventTypes.FRAME_REPORT,new l.Providers.WCS.FrameReportParser),e.register(l.Providers.WCS.WCSEventTypes.LIVE_CAPABILITIES,new l.Providers.WCS.LiveCapabilitiesParser),e.register(l.Providers.WCS.WCSEventTypes.SERVER_CAPABILITIES,new l.Providers.WCS.ServerCapabilitiesParser),e.register(l.Providers.WCS.WCSEventTypes.SLIDER_SLIDE,new l.Providers.WCS.SliderSlideParser),e.register(l.Providers.WCS.WCSEventTypes.SLIDER_EMPTY,new l.Providers.WCS.SliderEmptyParser),e.register(l.Providers.WCS.WCSEventTypes.UPDATE_ATTENDEE_NAME,new l.Providers.WCS.UpdateAttendeeNameParser),e},_createBinaryParser:function(){var e=new l.Providers.WCS.WCSBinaryParser;e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.START_TAG,new l.Providers.WCS.StartTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.BLOCK_TAG,new l.Providers.WCS.BlockTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.CURSOR_TAG,new l.Providers.WCS.CursorTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.END_TAG,new l.Providers.WCS.EndTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.SCREEN_SHARING,l.Providers.WCS.WCSScreenSharingTagTypes.ACK_TAG,new l.Providers.WCS.AcknowledgementTagBinaryParser);var t=l.Providers.WCS.WCSTransmissionTypes.REMOTE_CONTROL<<4;return e.registerParser(l.Providers.WCS.WCSTransmissionTypes.REMOTE_CONTROL,l.Providers.WCS.WCSScreenSharingTagTypes.MOUSE_TAG-t,new l.Providers.WCS.MouseTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.REMOTE_CONTROL,l.Providers.WCS.WCSScreenSharingTagTypes.KEYBOARD_TAG-t,new l.Providers.WCS.KeyboardTagBinaryParser),e.registerParser(l.Providers.WCS.WCSTransmissionTypes.REMOTE_CONTROL,l.Providers.WCS.WCSScreenSharingTagTypes.COPY_PASTE_TAG-t,new l.Providers.WCS.CopyPasteTagBinaryParser),e}},l.Providers.WCS.WCSProviderFactory=e}(AvayaClientServices),function(d){"use strict";function e(){}e.prototype={convertShape:function(e,t){var i=this._determineColor(e.data),a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=e.data.alpha,t=e.data.width,o=new d.Services.Collaboration.Shape(a,r,s,i,n,t);if(o.setId(e.liveEventCommonData.eventId),d.Base.Utils.isDefined(e.data.m))for(var c=0;c<e.data.m.length;c++)o.addMovePoint(new d.Services.Collaboration.Point(e.data.m[c].x,e.data.m[c].y));if(d.Base.Utils.isDefined(e.data.l))for(var l=0;l<e.data.l.length;l++)o.addLinePoint(new d.Services.Collaboration.Point(e.data.l[l].x,e.data.l[l].y));return o.finishDrawing(),o},convertLiveShape:function(e,t){var i=e.liveEventCommonData.fromname,a=e.liveEventCommonData.senderId===t,r=this._convertColor(e.data.color),s=e.data.alpha,t=e.data.width,t=new d.Services.Collaboration.Shape(i,!1,a,r,s,t);return t.setId(e.liveEventCommonData.eventId),t},convertText:function(e,t){var i=e.data.text,a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=this._convertColor(e.data.fillColor),t=e.data.fontSize,n=new d.Services.Collaboration.WhiteboardText(i,t,a,r,s,n,void 0);return n.setId(e.liveEventCommonData.eventId),n.setPosition(new d.Services.Collaboration.Point(e.data.x,e.data.y)),n.finishDrawing(),n},convertCircle:function(e,t){var i=this._determineColor(e.data),a=e.liveEventCommonData.fromname,r=e.data.filled,s=e.liveEventCommonData.senderId===t,n=e.data.width,o=e.data.alpha,t=this._calculatePoints(e.data),n=new d.Services.Collaboration.Circle(t.topLeft,t.bottomRight,a,r,s,i,o,n);return n.setId(e.liveEventCommonData.eventId),n.finishDrawing(),n},_determineColor:function(e){return e.filled&&e.fillColor?this._convertColor(e.fillColor):e.contour&&e.color?this._convertColor(e.color):void 0},_convertColor:function(e){return 0===e.indexOf("#")?parseInt(e.slice(1),16):parseInt(e,16)},_calculatePoints:function(e){var t,e=e.x0<e.x1&&e.y0<e.y1?(t=new d.Services.Collaboration.Point(e.x0,e.y0),new d.Services.Collaboration.Point(e.x1,e.y1)):e.x0>=e.x1&&e.y0>=e.y1?(t=new d.Services.Collaboration.Point(e.x1,e.y1),new d.Services.Collaboration.Point(e.x0,e.y0)):e.x0<e.x1&&e.y0>=e.y1?(t=new d.Services.Collaboration.Point(e.x0,e.y1),new d.Services.Collaboration.Point(e.x1,e.y0)):(t=new d.Services.Collaboration.Point(e.x1,e.y0),new d.Services.Collaboration.Point(e.x0,e.y1));return{topLeft:t,bottomRight:e}}},d.Providers.WCS.WCSShapeConverter=e}(AvayaClientServices),function(n){"use strict";function e(){}e.prototype={handleSliderSlide:function(e,t){n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderSlide");var i=e.getSlider(),a=e._config.wcsConfiguration.networkProviderConfiguration.restConfig,r=i.getSlides().length+1,s=a.getUrl(!1)+t.data.slideURL,a=a.getUrl(!1)+t.data.thumbUrl,t=new Date(t.liveEventCommonData.time),t=new n.Services.Collaboration.SliderSlide(r,s,a,t);i._addSlides(t),i._onSlidesAddedCallbacks.fire(t),e._recalculateSliderCapability()},handleSliderEmpty:function(e,t){n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"handleSliderEmpty");var i=e.getSlider(),a=i.getSlides();i._removeSlides(),i._onSlidesRemovedCallbacks.fire(a),e._recalculateSliderCapability()}},n.Providers.WCS.WCSSliderHandler=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Providers.WCS.WCSTransmissionTypes={SCREEN_SHARING:0,REMOTE_CONTROL:1,SLIDE_SHARING:2}}(),function(l){"use strict";function e(e){this._shapeConverter=e}e.prototype={addWhiteboard:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"addWhiteboard");var i,a,r=e.getWhiteboard(),s=r.getSurfaceById(t.liveEventCommonData.eventId);l.Base.Utils.isDefined(s)?this.startWhiteboard(e,t):(i=this._createNewSurface(r,t.liveEventCommonData.eventId),a=r.getActiveSurface(),s=this._getParticipant(e,t),l.Base.Utils.isDefined(a)&&(a._active=!1),i._active=!0,r._activeSurface=i,r._onWhiteboardSurfaceAddedCallbacks.fire(t,i,s),r._onWhiteboardSurfaceSetActiveCallbacks.fire(r,i,s),r._recalculateRemoveWhiteboardCapability(e),r._recalculateAddWhiteboardCapability(e))},startWhiteboard:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startWhiteboard");var i,a=t.data&&t.data.id?t.data.id:t.liveEventCommonData.eventId,r=t.data&&t.data.width?t.data.width:T,s=t.data&&t.data.height?t.data.height:T,n=e.getWhiteboard(),o=n.getSurfaceById(a),c=n.getActiveSurface()||n._recentlyActiveSurface,a=this._getParticipant(e,t);l.Base.Utils.isDefined(r)&&l.Base.Utils.isDefined(s)&&(n._setWidth(Math.max(n.getWidth(),r)),n._setHeight(Math.max(n.getHeight(),s))),l.Base.Utils.isDefined(c)&&(c._active=!1),l.Base.Utils.isDefined(o)?(o._active=!0,n._activeSurface=o,n._onWhiteboardSurfaceSetActiveCallbacks.fire(n,o,a)):((i=this._createNewSurface(n,t.liveEventCommonData.eventId))._active=!0,n._activeSurface=i,n._onWhiteboardSurfaceAddedCallbacks.fire(n,i,a),n._onWhiteboardSurfaceSetActiveCallbacks.fire(n,i,a)),n._onWhiteboardStartedCallbacks.fire(n,i,a),n._recalculateRemoveWhiteboardCapability(e),n._recalculateAddWhiteboardCapability(e)},endWhiteboard:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endWhiteboard");var i=e.getWhiteboard(),t=this._getParticipant(e,t);i._recentlyActiveSurface=i._activeSurface,i._activeSurface=T,i._onWhiteboardEndedCallbacks.fire(i,t),i._recalculateRemoveWhiteboardCapability(e),i._recalculateAddWhiteboardCapability(e)},deleteWhiteboard:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteWhiteboard");var i,a=e.getWhiteboard(),r=a.getSurfaceById(t.data.id),s=this._getParticipant(e,t);r&&((i=r).isActive()&&(a._activeSurface=this._chooseNewActiveSurface(a,t.data.id)),-1<(r=a.getSurfaces().indexOf(r))&&a.getSurfaces().splice(r,1),a._onWhiteboardSurfaceRemovedCallbacks.fire(a,i,s),a._onWhiteboardSurfaceSetActiveCallbacks.fire(a,a.getActiveSurface(),s)),a._recalculateRemoveWhiteboardCapability(e)},startDrawShape:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"startDrawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);a&&((e=this._shapeConverter.convertLiveShape(t,e._selfParticipant.getParticipantId()))._tempId=t.liveEventCommonData.eventId,a._appendShape(t.liveEventCommonData.eventId,e),i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId]=t.data.groupId,i._currentLiveDrawingShapes[t.liveEventCommonData.senderId]=e,a._onShapeAddedCallbacks.fire(a,e))},drawShape:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);if(l.Base.Utils.isDefined(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])){var r=(a=i.getSurfaceById(i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId]))._getShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),s=t.liveEventCommonData.senderId===e._selfParticipant.getParticipantId();if(r&&!s){if(0<t.data.m.length&&i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].addMovePoint(new l.Services.Collaboration.Point(t.data.m[0].x,t.data.m[0].y)),0<t.data.l.length)for(var n=0;n<t.data.l.length;n++)i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].addLinePoint(new l.Services.Collaboration.Point(t.data.l[n].x,t.data.l[n].y));a._onShapeUpdatedCallbacks.fire(a,i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])}}else l.Base.Utils.isDefined(a)&&(e=this._shapeConverter.convertShape(t,e._selfParticipant.getParticipantId()),a._appendShape(t.liveEventCommonData.eventId,e),a._onShapeAddedCallbacks.fire(a,e))},endDrawShape:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"endDrawShape");var i=e.getWhiteboard(),a=i.getSurfaceById(t.data.groupId);a&&i._currentLiveDrawingShapes[t.liveEventCommonData.senderId]&&(e=a._getShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),a._removeShapeById(i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].getId()),e.setId(t.liveEventCommonData.eventId),a._appendShape(t.liveEventCommonData.eventId,e),a._onShapeUpdatedCallbacks.fire(a,e),e._tempId=t.liveEventCommonData.eventId,delete i._currentLiveDrawingWhiteboardIds[t.liveEventCommonData.senderId],i._currentLiveDrawingShapes[t.liveEventCommonData.senderId].finishDrawing(),delete i._currentLiveDrawingShapes[t.liveEventCommonData.senderId])},drawCircle:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawCircle");var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&(e=this._shapeConverter.convertCircle(t,e._selfParticipant.getParticipantId()),i._appendShape(t.liveEventCommonData.eventId,e),i._onShapeAddedCallbacks.fire(i,e))},drawText:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"drawText");var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&(e=this._shapeConverter.convertText(t,e._selfParticipant.getParticipantId()),i._appendShape(t.liveEventCommonData.eventId,e),i._onShapeAddedCallbacks.fire(i,e))},clearDrawing:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"clearDrawing");t=e.getWhiteboard().getSurfaceById(t.data.groupId);t&&(t._clearShapes(),t._onSurfaceClearedCallbacks.fire(t))},moveSelection:function(e,t){var i=e.getWhiteboard().getSurfaceById(t.data.groupId);i&&((e=i._getShapeById(t.data.shapeId)).setTranslation(new l.Services.Collaboration.Point(t.data.moveToX,t.data.moveToY)),i._onShapeUpdatedCallbacks.fire(i,e))},deleteSelection:function(e,t){l.Base.Logger.debug(l.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"deleteSelection");e=e.getWhiteboard().getSurfaceById(t.data.groupId);!e||(t=e._getShapeById(t.data.shapeId))&&(e._onShapeDeletedCallbacks.fire(e,t),e._removeShapeById(t.getId()))},_createNewSurface:function(e,t){var i=new l.Services.Collaboration.WhiteboardSurface(e,e._whiteboardService);return e.getSurfaces().push(i),i._surfaceId=t,i},_chooseNewActiveSurface:function(e,t){var i=e.getSurfaces(),t=e.getSurfaceById(t),t=i.indexOf(t);return l.Base.Utils.isDefined(e.getActiveSurface())&&(e.getActiveSurface()._active=!1),0===t?1<i.length?(i[1]._active=!0,i[1]):(i[0]._active=!0,i[0]):(i[t-1]._active=!0,i[t-1])},_getParticipant:function(e,t){var i=(t.liveEventCommonData||t).senderId,a=(t.liveEventCommonData||t).senderName,t=e._participants.filter(function(e){return e.getParticipantId()===i})[0];return t||(t=new l.Services.Collaboration.Participant(i,a),e._participants.push(t)),t}},l.Providers.WCS.WCSWhiteboardHandler=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Analytics.AnalyticsErrorCode={NOTIFICATION_ERROR:"Notification failed",UNAUTHORIZED:"Unauthorized status",NETWORK_ERROR:"Network Error",MESSAGE_SENDING_ERROR:"Message sending error",CONNECTION_BACKOFF_ALGORITHM_ERROR:"connection Backoff Algorithm error",GETTING_CONVERSATIONS_ERROR:"Getting conversations error",SEARCHING_CONVERSATIONS_ERROR:"Searching conversations error",STARTING_COLLABORATION_ERROR:"Starting Collaboration is error",HOLD_CALL_ERROR:"Hold call error",TRANSFER_CALL_ERROR:"Transfer call error",ATTENDED_TRANSFER_CALL_ERROR:"Attended transfer call error",JOIN_CALL_ERROR:"Join call error",STARTING_CALL_ERROR:"Starting call is error",STOPPING_CALL_ERROR:"Stopping call is error",GETTING_CALL_STATISTICS_ERROR:"Getting call statistics error",SETTING_VIDEO_MODE_ERROR:"Setting video mode error",DENY_SEND_VIDEO_ERROR:"Deny send video error",ACCEPT_SEND_VIDEO_ERROR:"Accept send video error",MUTE_AUDIO_ERROR:"Mute audio error",UNMUTE_AUDIO_ERROR:"Unmute audio error",MUTE_VIDEO_ERROR:"Mute video error",UNMUTE_VIDEO_ERROR:"Unmute video error",MUTE_SPEAKER_ERROR:"Mute speaker error",UNMUTE_SPEAKER_ERROR:"Unmute speaker error",ACCEPT_CALL_ERROR:"accept call error",MEDIA_PRESERVED_ERROR:"Media preserved error",SEND_DTMF_ERROR:"send dtmf error",WEBRTC_NOT_SUPPORTED:"WebRTC not supported",NO_CALL_WAS_CREATED_ERROR:"No call was created"}}(),function(){"use strict";AvayaClientServices.Services.Call.AlertType={AUTO_CALLBACK:"AUTO_CALLBACK",AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_EXTERNAL",AUTOMATIC_CALL_DISTRIBUTION_INTERNAL:"AUTOMATIC_CALL_DISTRIBUTION_INTERNAL",DIRECT_AGENT_CALL_EXTERNAL:"DIRECT_AGENT_CALL_EXTERNAL",DIRECT_AGENT_CALL_INTERNAL:"DIRECT_AGENT_CALL_INTERNAL",DIRECT_AGENT_CALL_PRIORITY:"DIRECT_AGENT_CALL_PRIORITY",EXTERNAL:"EXTERNAL",HOLD_RECALL:"HOLD_RECALL",INTERCOM:"INTERCOM",INTERNAL:"INTERNAL",NONE:"NONE",PRIORITY:"PRIORITY",TRANSFER_RECALL:"TRANSFER_RECALL",UNSPECIFIED:"UNSPECIFIED"}}(),function(e){"use strict";function t(){this._requestedDirection=T,this._negotiatedDirection=T}t.prototype={getRequestedDirection:function(){return this._requestedDirection},_getNegotiatedDirection:function(){return this._negotiatedDirection},_setRequestedDirection:function(e){this._requestedDirection=e},_setNegotiatedDirection:function(e){this._negotiatedDirection=e}},e.Services.Call.AudioChannel=t}(AvayaClientServices),function(){"use strict";(AvayaClientServices||{}).Services.Call.AudioDetails=function(e){this.bytesTransmitted=e.bytesTransmitted,this.bytesReceived=e.bytesReceived,this.rtcBytesReceived=e.transportBytesReceived,this.packetsTransmitted=e.packetsTransmitted,this.packetsReceived=e.packetsReceived,this.roundTripTimeMilliseconds=e.roundTripTimeMilliseconds,this.packetLossTotalTransmitted=e.packetLossTotalTransmitted,this.packetLossTotalReceived=e.packetLossTotalReceived,this.jitterMillisecondsReceived=e.jitterMillisecondsReceived,this.totalAudioEnergyTransmitted=e.totalAudioEnergyTransmitted,this.totalAudioEnergyReceived=e.totalAudioEnergyReceived,this.audioLevelTransmitted=e.audioLevelTransmitted,this.audioLevelReceived=e.audioLevelReceived,this.codec=e.codec,this.fractionLostLocal=e.fractionLostLocal}}(),function(){"use strict";AvayaClientServices.Services.Call.AudioMode={SEND_RECEIVE:"SEND_RECEIVE",DISABLE:"DISABLE",ENABLE:"ENABLE"}}(),function(a){"use strict";function e(e,t,i){this._remoteAddress=e,this._presentationModeOnly=!!a.Base.Utils.isDefined(t)&&!!t,this._subject=i,this._avayaLineId=T,this._avayaLineOwner=T,this._conferenceID=T,this._conferencePasscode=T,this._portalToken=T,this._meetMeUserName=T,this._serviceGatewayURL=T,this._uccpURL=T,this._callType=a.Services.Call.CallType.CallTypeDefaultRegisteredService,this._authorizationToken=T,this._contextId=T}e.prototype={getRemoteAddress:function(){return this._remoteAddress},isPresentationModeOnly:function(){return a.Base.Utils.isDefined(this._presentationModeOnly)&&!!this._presentationModeOnly},getSubject:function(){return this._subject},getConferenceID:function(){return this._conferenceID},setConferenceID:function(e){this._conferenceID=e},getPasscode:function(){return this._conferencePasscode},setPasscode:function(e){this._conferencePasscode=e},getContextId:function(){return this._contextId},setContextId:function(e){this._contextId=e},getPortalToken:function(){return this._portalToken},setPortalToken:function(e){this._portalToken=e},getMeetMeUserName:function(){return this._meetMeUserName},setMeetMeUserName:function(e){this._meetMeUserName=e},getCallType:function(){return this._callType},setCallType:function(e){this._callType=e},getServiceGatewayURL:function(){return this._serviceGatewayURL},setServiceGatewayURL:function(e){this._serviceGatewayURL=e},setUccpURL:function(e){this._uccpURL=e},getUccpURL:function(){return this._uccpURL},getAvayaLineId:function(){return this._avayaLineId},getAvayaLineOwner:function(){return this._avayaLineOwner},setAuthorizationToken:function(e){this._authorizationToken=e},getAuthorizationToken:function(){return this._authorizationToken}},a.Services.Call.CallCreationInfo=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallDenialReason={BUSY:"BUSY",FORBIDDEN:"FORBIDDEN",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallDetails=function(e,t,i,a,r,s){this.callId=e,this.callingParticipant=t,this.calledParticipant=i,this.participants=a,this.connectionId=r,this.status=s}}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._reason=e,this._reasonProtocol=t,this._reasonCause=i,this._reasonText=a}t.prototype={getReason:function(){return this._reason},getReasonProtocol:function(){return this._reasonProtocol},getReasonCause:function(){return this._reasonCause},getReasonText:function(){return this._reasonText},_setReason:function(e){this._reason=e}},e.Services.Call.CallEndEvent=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallEndReason={CALL_DISCONNECTED:"CALL_DISCONNECTED",CALL_DISCONNECTED_UNKNOWN_REASON:"CALL_DISCONNECTED_UNKNOWN_REASON",CALL_ENDED_LOCALLY:"CALL_ENDED_LOCALLY",DISCONNECTED_BY_CONFERENCE_MODERATOR:"DISCONNECTED_BY_CONFERENCE_MODERATOR",CONFERENCE_TERMINATED:"CONFERENCE_TERMINATED",DTLS_FAILURE:"DTLS_FAILURE",ICE_FAILURE:"ICE_FAILURE"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallError={AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",AUTO_HOLD_FAILED:"AUTO_HOLD_FAILED",BUSY:"BUSY",CALL_STATE_MISMATCH:"CALL_STATE_MISMATCH",CALL_NOT_FOUND:"CALL_NOT_FOUND",CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",CODEC_MISMATCH:"CODEC_MISMATCH",DEVICES_NOT_FOUND:"DEVICES_NOT_FOUND",MICROPHONE_NOT_FOUND:"MICROPHONE_NOT_FOUND",MICROPHONE_PERMISSION_DENIED:"MICROPHONE_PERMISSION_DENIED",MICROPHONE_NOT_ACCESSIBLE:"MICROPHONE_NOT_ACCESSIBLE",SPEAKERS_NOT_FOUND:"SPEAKERS_NOT_FOUND",CAMERA_NOT_FOUND:"CAMERA_NOT_FOUND",CAMERA_PERMISSION_DENIED:"CAMERA_PERMISSION_DENIED",CAMERA_NOT_ACCESSIBLE:"CAMERA_NOT_ACCESSIBLE",FAILED:"FAILED",TCP_TLS_TURN_NOT_SUPPORTED:"TCP_TLS_TURN_NOT_SUPPORTED",ENDED:"ENDED",IN_PROGRESS:"IN_PROGRESS",INTERNAL_ERROR:"INTERNAL_ERROR",INVALID_PARAMETER:"INVALID_PARAMETER",LINE_RESERVATION_ERROR:"LINE_RESERVATION_ERROR",MEDIA_CREATION_FAILURE:"MEDIA_CREATION_FAILURE",MEDIA_START_FAILURE:"MEDIA_START_FAILURE",MULTIPLE_CALLS_NOT_SUPPORTED:"MULTIPLE_CALLS_NOT_SUPPORTED",MEDIA_PATH_FAILURE:"MEDIA_PATH_FAILURE",MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED:"MULTIPLE_VIDEO_CHANNELS_NOT_SUPPORTED",MUTE_STATE_MISMATCH:"MUTE_STATE_MISMATCH",NO_AVAILABLE_CALL_APPEARANCE:"NO_AVAILABLE_CALL_APPEARANCE",NOT_AUTHORIZED:"NOT_AUTHORIZED",NOT_FOUND:"NOT_FOUND",NOT_LICENSED:"NOT_LICENSED",NOT_REGISTERED:"NOT_REGISTERED",OVERCONSTRAINED:"OVERCONSTRAINED",REDIRECTED:"REDIRECTED",REGISTRATION_TERMINATED:"REGISTRATION_TERMINATED",REMOTE_CALL_NOT_ALERTING:"REMOTE_CALL_NOT_ALERTING",REMOTE_MEDIA_PROCESSING_FAILURE:"REMOTE_MEDIA_PROCESSING_FAILURE",SEND_ERROR:"SEND_ERROR",SERVER_ERROR:"SERVER_ERROR",SESSION_ID_NOT_FOUND:"SESSION_ID_NOT_FOUND",SESSION_ID_ALREADY_CONNECTED:"SESSION_ID_ALREADY_CONNECTED",SUCCESS:"SUCCESS",TIMEOUT:"TIMEOUT",TRANSPORT_ERROR:"TRANSPORT_ERROR",UNDEFINED:"UNDEFINED",UNHANDLED_VIDEO_DIRECTION:"UNHANDLED_VIDEO_DIRECTION",USER_NOT_FOUND:"USER_NOT_FOUND",USER_TEMPORARILY_UNAVAILABLE:"USER_TEMPORARILY_UNAVAILABLE",VIDEO_DENIED:"VIDEO_DENIED",VIDEO_DEESCALATION_NOT_SUPPORTED:"VIDEO_DEESCALATION_NOT_SUPPORTED",WEBRTC_NOT_SUPPORTED:"WEBRTC_NOT_SUPPORTED",STATISTICS_UNAVAILABLE:"STATISTICS_UNAVAILABLE",MEDIA_PRESERVED:"MEDIA_PRESERVED",SERVICE_TEMPORARILY_UNAVAILABLE:"SERVICE_TEMPORARILY_UNAVAILABLE",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",VIDEO_ONLY_CALL_NOT_SUPPORTED:"VIDEO_ONLY_CALL_NOT_SUPPORTED",VIDEO_REJECTION_NOT_SUPPORTED:"VIDEO_REJECTION_NOT_SUPPORTED",COLLABORATION_ONLY_CALL_NOT_SUPPORTED:"COLLABORATION_ONLY_CALL_NOT_SUPPORTED",NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE:"NETWORK_EVENTS_SUBSCRIPTION_UNAVAILABLE",NETWORK_EVENTS_SUBSCRIPTION_FAILED:"NETWORK_EVENTS_SUBSCRIPTION_FAILED",MEDIA_SERVICE_UNAVAILABLE:"MEDIA_SERVICE_UNAVAILABLE",INVALID_ACCEPTED_EVENTS:"INVALID_ACCEPTED_EVENTS"}}(),function(){"use strict";function e(e,t,i,a){this._error=e,this._protocolType=t,this._protocolErrorCode=i,this._protocolErrorReason=a}e.prototype={getError:function(){return this._error},getProtocolType:function(){return this._protocolType},getProtocolErrorCode:function(){return this._protocolErrorCode},getProtocolErrorReason:function(){return this._protocolErrorReason}},AvayaClientServices.Services.Call.CallException=e}(AvayaClientServices),function(s){"use strict";function e(e,t,i,a,r){this._providerFactory=e,this._mediaServiceFactory=t,this._callService={},this._callManager=new s.Services.Call.CallManager,this.calls=T,this._callProvider={},this._participantService=T,this._conferenceService=T,this._contactsIntegrationService=i,this._callsAnalyticsService=a,this._callPerformanceManager=r}e.prototype={init:function(e){this._callProvider=this._providerFactory.getCallProviders(e,this._mediaServiceFactory,this._callsAnalyticsService)[0],this._callService=new s.Services.Call.CallService(e,this._callProvider,this._callManager,this._mediaServiceFactory,this._contactsIntegrationService,this._callsAnalyticsService,this._providerFactory.getRemoteLoggerProvider()),this._callPerformanceManager.setCallService(this._callService),this.calls=new s.Services.Call.Calls(this._callManager,this._callService)},getCalls:function(){return this.calls},getCallService:function(){return this._callService},getCallManager:function(){return this._callManager}},s.Services.Call.CallFactory=e}(AvayaClientServices),function(_){"use strict";function e(){this._callsObject=T,this._calls=[],this._lastMissedCall=T}e.prototype={setCalls:function(e){this._callsObject=e},createCall:function(e){var t=new _.Services.Call.Call(e);return t._setServiceAvailability(e.isServiceAvailable()),e._config.sgConfiguration&&e._config.sgConfiguration.credentialProvider&&t._setIsGuestUser(e._config.sgConfiguration.credentialProvider.isGuest),this._calls.push(t),this._callsObject._callCreatedCallbacks.fire(t),t},createRemoteOrIncomingCall:function(e,t,i,a,r,s,n,o,c,l,d,C,u){var h=new _.Services.Call.Call(e);return h._setServiceAvailability(e.isServiceAvailable()),h._setCallId(t),h._setRemoteAddress(i),h._setRemoteDisplayName(a),h._setIsAutoAnswerEnabled(u),h._isPrivateCallerID=!!_.Base.Utils.isDefined(s)&&s,h._isAuraAsserted=!!_.Base.Utils.isDefined(r)&&r,h._alertType=o,h._subject=c,n&&(h._incomingVideoOffered=_.Services.Call.VideoNetworkSignalingType.SUPPORTED),h._setRemote(!!_.Base.Utils.isDefined(d)&&d),h._setState(l),h._incoming=!!_.Base.Utils.isDefined(C)&&C,h.isRemote()&&this._lastMissedCall&&(this._lastMissedCall.getRemoteAddress()===i&&h._setIsMissed(!0),this._lastMissedCall=T),_.Base.Utils.isDefined(e._config.wcsConfiguration)&&_.Base.Utils.isDefined(e._config.wcsConfiguration.enabled)&&(h._webCollaboration=e._config.wcsConfiguration.enabled),this._calls.push(h),this._callsObject._callCreatedCallbacks.fire(h),h},createMakeCall:function(e,t,i,a,r,s){var n=new _.Services.Call.Call(e);return n._setServiceAvailability(e.isServiceAvailable()),n._setCallId(t),n._setRemoteAddress(i),_.Base.Utils.isDefined(a)&&n._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this._calls.push(n),this._callsObject._callCreatedCallbacks.fire(n),n},deleteCall:function(e){var t=this._calls.indexOf(e);-1<t&&(this._calls.splice(t,1),this._callsObject._callRemovedCallbacks.fire(e))},getCallCount:function(){return this._calls.length},_getLiveCallCount:function(){for(var e=0,t=0;t<this._calls.length;t++){var i=this._calls[t];i.getState()!==_.Services.Call.CallStates.ENDED&&i.getState()!==_.Services.Call.CallStates.ENDING&&e++}return e},setLastMissedCall:function(e){this._lastMissedCall=e},getLastMissedCall:function(){return this._lastMissedCall},getAllCalls:function(){return this._calls},getActiveCall:function(){for(var e=0;e<this._calls.length;e++){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.ESTABLISHED&&!t.isRemote()||t.getState()===_.Services.Call.CallStates.RENEGOTIATING||t.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING)return t}return T},getIgnoredCalls:function(){return this._calls.filter(function(e){return e.getState()===_.Services.Call.CallStates.IGNORED})},getCallById:function(e){for(var t=0;t<this._calls.length;t++)if(this._calls[t].getCallId()===e)return this._calls[t];return T},getEndingCall:function(){if(this._calls&&this._calls.length)for(var e=this._calls.length-1;0<=e;e--){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.ENDING)return t}},hasHeldCall:function(){for(var e=0;e<this._calls.length;e++)if(this._calls[e].getState()===_.Services.Call.CallStates.HELD)return!0;return!1},hasInitiatingCall:function(){for(var e=0;e<this._calls.length;e++){var t=this._calls[e];if(t.getState()===_.Services.Call.CallStates.INITIATING||t.getState()===_.Services.Call.CallStates.REMOTE_ALERTING||t.getState()===_.Services.Call.CallStates.IDLE)return!0}return!1},setCallMode:function(e,t){e=this._calls.indexOf(e);this._calls[e]._modes.push(t)},getCallModes:function(e){e=this._calls.indexOf(e);return e<0?[]:this._calls[e]._modes}},_.Services.Call.CallManager=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallModes={CONFERENCE_CALL:"conferenceCall",AV_COLLABORATION_CALL:"avCollaborationCall"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallProtocolType={APPLICATION:"APPLICATION",HTTP:"HTTP"}}(),function(_){"use strict";function e(e,t,i,a,r,s,n){_.Base.Observable.call(this),this._config=e,this._callProvider=t,this._callManager=i,this._mediaServicesFactory=a,this._remoteLoggerProvider=n,this._isServiceAvailable=!1,this._mediaServices=a.getMediaServices(),this._scopiaConferenceProviderFactory=new _.Providers.Scopia.ScopiaConferenceProviderFactory,this._contactsIntegrationService=r,this._onContactListChanged=T,this._videoLicenseEnabled=!0,this.videoResolution={},this._videoCapability=new _.Base.Capability(_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._calls=T,this._callsAnalyticsService=s,this._uploadLoggerProvider=T,this._isUploadedOnServiceUnavailable=!1,this._isRegistrationTerminated=!1,this._uploadIntervalTimer=T}(e.prototype=Object.create(_.Base.Observable.prototype)).setCollaborations=function(e){this._collaborations=e},e.prototype.startCall=function(t){if(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Call Service is starting..."),!this._isMakeCallAllowed(t))return this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),void this._notifyCallFailure(t,_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED);if(t.getState()!==_.Services.Call.CallStates.IDLE){var e=this._config._mediaServiceConfiguration?_.Services.Call.CallError.MULTIPLE_CALLS_NOT_SUPPORTED:_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("start",e),void this._notifyCallFailure(t,e)}if(t._setState(_.Services.Call.CallStates.INITIATING),t._callCreationInfo&&t._callCreationInfo.getAuthorizationToken()&&this._registerCallbacks(),t.addOnCallEndedCallback(function(e){this._stopCollaboration(e)}.bind(this)),t._isDataOnly()){_.Base.Utils.isUndefined(t.getAudioChannel())&&(t._audioChannel=this._callProvider.createAudioChannel_AudioMode(_.Services.Call.AudioMode.DISABLE));for(var i=this._callManager.getCallModes(t),a=0;a<i.length;a++){var r=i[a];if(r.id===_.Services.Call.CallModes.CONFERENCE_CALL)return void r.startCall(t)}}else{var s=t.getRemoteAddress();null!==s.match(/sips?:.*/)||-1!==(h=s.search(/,/))&&(t._setDtmfString(s.substring(h).split("")),t._setRemoteAddress(s.substring(0,h)))}var n=this._getMicrophoneAvailability(),o=this._getSpeakersAvailability(),c=this._getCameraAvailability(t),l=0<t.getVideoChannels().length;this._setupVideoResolution(t),this._setupDevicesListeners(t),this._setupAnalyticsListeners(t),this._setupStatisticsLogger(t);var d,C,u=_.Services.Call.MediaDirection.RECV_ONLY,e=_.Services.Call.MediaDirection.SEND_RECV,s=_.Services.Call.MediaDirection.SEND_RECV,h=t.getAudioChannel()&&t.getAudioChannel().getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE;n||h||t.isMicrophoneDisabled()?o||h||t.isMicrophoneDisabled()?(this.isVideoEnabled()?l?(s=u=l=(h=t.getVideoChannels())[0]._getInternalRequestedDirection(),c||(l===_.Services.Call.MediaDirection.SEND_RECV?(h[0]._setRequestedDirection(_.Services.Call.MediaDirection.RECV_ONLY),_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_RECV video direction to RECV_ONLY"),s=_.Services.Call.MediaDirection.RECV_ONLY):l===_.Services.Call.MediaDirection.SEND_ONLY&&(h[0]._setRequestedDirection(_.Services.Call.MediaDirection.INACTIVE),s=_.Services.Call.MediaDirection.INACTIVE,_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"No camera found for video call - update SEND_ONLY video direction to INACTIVE")))):this._isCollabCall(t)||this._setupNailedUpVideoConnection(t,_.Services.Call.VideoMode.RECEIVE_ONLY)&&(u=_.Services.Call.MediaDirection.RECV_ONLY,s=_.Services.Call.MediaDirection.INACTIVE):(u=_.Services.Call.MediaDirection.INACTIVE,e=_.Services.Call.MediaDirection.INACTIVE,s=_.Services.Call.MediaDirection.INACTIVE),!this._callProvider.isNailedUpVideoConnectionRequired()||t._isDataOnly()||this._isCollabCall(t)||(d=new _.Providers.Call.NailedUpVideoConnectionInfo(s,u,e)),_.Base.Utils.isUndefined(t.getAudioChannel())&&(t._audioChannel=this._callProvider.createAudioChannel_AudioMode(_.Services.Call.AudioMode.SEND_RECEIVE)),C=function(){return this._callProvider.startCall(t,this.isVideoEnabled(),this.isWebCollaborationEnabled(t),this.isUccpEnabled(),this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice(),this.videoResolution,d).fail(function(e){_.Base.Logger.warn("Failed to start call.",e),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.FAILED)}.bind(this))}.bind(this),(e=this._callManager.getActiveCall())!==T?(this._callProvider.setActiveCallVideoTrack(e.getCallId()),e.hold().then(function(){C()}.bind(this),function(e){_.Base.Logger.warn("Auto hold failed when starting call.",e),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.AUTO_HOLD_FAILED),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.AUTO_HOLD_FAILED)}.bind(this))):C()):(_.Base.Logger.warn("Speaker is not available"),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.SPEAKERS_NOT_FOUND)):(_.Base.Logger.warn("Microphone is not available"),this.uploadLogs(),this._notifyCallFailure(t,_.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Call.CallError.MICROPHONE_NOT_FOUND))},e.prototype._setupNailedUpVideoConnection=function(e,t){if(e._isDataOnly()||!this._callProvider.isNailedUpVideoConnectionRequired())return!1;var i=this._callProvider._createVideoChannel_VideoMode(_.Services.Call.VideoMode.DISABLE);return i._setInternalRequestedDirection(_.Providers.Call.Utils.getVideoDirection(t)),i._setChannelId("NailedUp_"+i.getChannelId()),e._videoChannels.push(i),!0},e.prototype._getMicrophoneAvailability=function(){var e=this._mediaServices.getAudioInterface().getInputInterface();return!e.getSelectDeviceCapability().isAllowed||e.hasAvailableDevices()},e.prototype._getSpeakersAvailability=function(){var e=this._mediaServices.getAudioInterface().getOutputInterface(),t=e.getSelectDeviceCapability().isAllowed,i=_.Base.Utils.getBrowserType(),e=i===_.Base.BrowserType.FIREFOX||i===_.Base.BrowserType.SAFARI||e.hasAvailableDevices();return!t||e},e.prototype._getCameraAvailability=function(e){var t=!1;0<e.getVideoChannels().length&&(t=e.getVideoChannels().reduce(function(e,t){return e&&t._getInternalRequestedDirection()===_.Services.Call.MediaDirection.RECV_ONLY},!0));var i=this._mediaServices.getVideoInterface(),e=i.getSelectDeviceCapability().isAllowed,i=i.hasAvailableDevices();return t||!e||i},e.prototype._setupDevicesListeners=function(e){var t=this._handleOnSelectedDeviceChanged(e).bind(this);this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceChangedCallback(t),this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(t);var i=this._handleOnSelectedDeviceRemoved;this._mediaServices.getAudioInterface().getInputInterface().addOnSelectedDeviceRemovedCallback(i),this._mediaServices.getAudioInterface().getOutputInterface().addOnSelectedDeviceRemovedCallback(i),this._mediaServices.getVideoInterface().addOnSelectedDeviceRemovedCallback(i),e.addOnCallEndedCallback(function(){this._mediaServices.getAudioInterface().getOutputInterface().removeOnSelectedDeviceChangedCallback(t),this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceChangedCallback(t),this._mediaServices.getVideoInterface().removeOnSelectedDeviceChangedCallback(t),this._mediaServices.getAudioInterface().getInputInterface().removeOnSelectedDeviceRemovedCallback(i),this._mediaServices.getAudioInterface().getOutputInterface().removeOnSelectedDeviceRemovedCallback(i),this._mediaServices.getVideoInterface().removeOnSelectedDeviceRemovedCallback(i)}.bind(this))},e.prototype._setupAnalyticsListeners=function(e){var t;e.addOnCallEstablishedCallback(function(){t=this._callsAnalyticsService.startTimingMetric(),this._callsAnalyticsService.setCallMediaTypes(Boolean(e._videoChannels.length))}.bind(this)),e.addOnCallVideoChannelsUpdatedCallback(function(){this._callsAnalyticsService.setCallMediaTypes(!0)}.bind(this)),e.addOnCallEndedCallback(function(){this._callsAnalyticsService.callTimeEnd(t),this._callsAnalyticsService.sendCallMediaTypes()}.bind(this))},e.prototype._setupStatisticsLogger=function(e){e.addOnCallEstablishedCallback(function(){e._isDataOnly()||e.startLoggingStatistics()}.bind(this)),e.addOnCallEndedCallback(function(){e._isDataOnly()||e.stopLoggingStatistics()}.bind(this))},e.prototype._setupVideoResolution=function(s){s.addOnCallEstablishedCallback(function(){var e=_.Base.Storage,t=e.get(e.TYPES.LOCAL,e.KEYS.VIDEO_RESOLUTIONS),i=new _.Base.VideoResolutionDetails,e=this.getNegotiatedVideoResolution(s),a=i.convertToConfigVideoResolution(e),t=(r=t?t.find(function(e){return e.negotiate===a}):r)&&r.limited||[a],r=this.getVideoResolution(s),t=this._getAverageLimitedResolution(t);null===this.getServerSentPreferredResolution(s)&&(t.getWidth()!==r.getWidth()||t.getHeight()!==r.getHeight()||t.getFPS()&&t.getFPS()<30&&t.getFPS()!==r.getFPS())&&this.setVideoSendResolution(s,t,!0),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_START,[])}.bind(this))},e.prototype._initAnalyticsMetrics=function(){var t,i;this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(e){t=this._callsAnalyticsService.startTimingMetric();e=e&&e.getState()===_.Services.Call.CallStates.ESTABLISHED;i=this._callsAnalyticsService.callPreservationTimeStart(e)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){this._callsAnalyticsService.serviceUnavailableTimeEnd(t);var e=this._callsAnalyticsService.callPreservationTimeEnd(i);this._callsAnalyticsService.sendPreservationEvent(!0,e)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,function(){var e=this._callsAnalyticsService.callPreservationTimeEnd(i);this._callsAnalyticsService.sendPreservationEvent(!1,e)}.bind(this))},e.prototype._handleOnSelectedDeviceRemoved=function(e){var t=e.getAvailableDevices();e.getSelectDeviceCapability().isAllowed&&t.length&&e.setSelectedDevice(t[0])},e.prototype._handleOnSelectedDeviceChanged=function(i){return function(e,t){i.isRemote()||i.getState()!==_.Services.Call.CallStates.ESTABLISHED&&i.getState()!==_.Services.Call.CallStates.HELD&&i.getState()!==_.Services.Call.CallStates.RENEGOTIATING&&i.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING||(i.getState()===_.Services.Call.CallStates.ESTABLISHED&&i._setState(_.Services.Call.CallStates.RENEGOTIATING),this._callProvider.updateDevices(i,t).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",_.Services.Call.CallError.FAILED)}.bind(this)).always(function(){i.getState()===_.Services.Call.CallStates.RENEGOTIATING&&i._setState(_.Services.Call.CallStates.ESTABLISHED)}))}.bind(this)},e.prototype.endCall=function(t,e){if(t){if(t._isDataOnly())for(var i=this._callManager.getCallModes(t),a=0;a<i.length;a++){var r=i[a];if(r.id===_.Services.Call.CallModes.CONFERENCE_CALL)return void r.endCall(t)}return this._callProvider._cpCalls[t.getCallId()]&&t.isConference()&&this._disconnectCallFromConference(t),this._limitedVideoResolutionStoring(t),this._callProvider.stopCall(t,e).then(function(){this._triggerCallbacksAsync(t._remoteVideoRemovedCallbacks,t)}.bind(this),function(e){e.getError()===_.Services.Call.CallError.CALL_NOT_FOUND&&(e._error=_.Services.Call.CallError.ENDED,t._setState(_.Services.Call.CallStates.ENDED),this._callManager.deleteCall(t),this._callProvider.stopExternalGatewayProvider(t)),this._triggerCallbacksAsync(t._callFailedCallbacks,t,e),this._callsAnalyticsService.sendOperationFailureEvent("end",_.Services.Call.CallError.FAILED)}.bind(this))}},e.prototype.mute=function(e){return e.getMuteCapability().isAllowed?this._callProvider.muteAudio(e).then(function(){e._isAudioMuted=!0,e._muteCapability._recalculate(),e._unmuteCapability._recalculate(),this._triggerCallbacksAsync(e._onCallAudioMuteStatusChangedCallbacks,e,!0)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("mute",_.Services.Analytics.AnalyticsErrorCode.MUTE_AUDIO_ERROR),E.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not mute call: "+e.getCallId()+": "+e.getMuteCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("mute",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.unmute=function(e){return e.getUnmuteCapability().isAllowed?this._callProvider.unmuteAudio(e).then(function(){e._isAudioMuted=!1,e._muteCapability._recalculate(),e._unmuteCapability._recalculate(),this._triggerCallbacksAsync(e._onCallAudioMuteStatusChangedCallbacks,e,!1)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("unmute",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_AUDIO_ERROR),E.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-mute call: "+e.getCallId()+": "+e.getUnmuteCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unmute",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.enableMic=function(e){return e.getEnableMicrophoneCapability().isAllowed?this._callProvider.enableMic(e).catch(function(e){throw _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Failed to enable microphone ",e),e}):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect enable microphone capability: "+e.getCallId()+": "+e.getEnableMicrophoneCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.disableMic=function(e){return e.getDisableMicrophoneCapability().isAllowed?this._callProvider.disableMic(e).catch(function(e){throw _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Failed to disable microphone ",e),e}):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect disable microphone capability: "+e.getCallId()+": "+e.getDisableMicrophoneCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.muteVideo=function(e){return e.getMuteVideoCapability().isAllowed?(e._muteVideoCapability._recalculate(),this._callProvider.muteVideo(e).then(function(){e._videoMuteState=_.Services.Call.MediaMuteStates.MUTED,e._muteVideoCapability._recalculate(),e._unmuteVideoCapability._recalculate(),this._triggerCallbacksAsync(e._onCallVideoMuteStatusChangedCallbacks,e,!0)}.bind(this)).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("muteVideo",_.Services.Analytics.AnalyticsErrorCode.MUTE_VIDEO_ERROR)}.bind(this))):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect mute video capability: "+e.getCallId()+": "+e.getMuteVideoCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.unmuteVideo=function(e){return e.getUnmuteVideoCapability().isAllowed?(e._unmuteVideoCapability._recalculate(),this._callProvider.unmuteVideo(e).then(function(){e._videoMuteState=_.Services.Call.MediaMuteStates.UNMUTED,e._muteVideoCapability._recalculate(),e._unmuteVideoCapability._recalculate(),this._triggerCallbacksAsync(e._onCallVideoMuteStatusChangedCallbacks,e,!1)}.bind(this)).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("unmuteVideo",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_VIDEO_ERROR)}.bind(this))):(_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"Incorrect unmute video: "+e.getCallId()+": "+e.getUnmuteVideoCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.muteSpeaker=function(e){if(e.getMuteSpeakerCapability().isAllowed)return this._callProvider.muteSpeaker(e).then(function(){e._isSpeakerMuted=!0,this._triggerCallbacksAsync(e._onCallSpeakerMuteStatusChangedCallbacks,e,!0)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",_.Services.Analytics.AnalyticsErrorCode.MUTE_SPEAKER_ERROR),E.Deferred().reject(e).promise()}.bind(this));_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not mute speakers for call: "+e.getCallId()+": "+e.getMuteSpeakerCapability().denialReason);var t=_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED;return this._callsAnalyticsService.sendOperationFailureEvent("muteSpeaker",t),E.Deferred().reject(new _.Services.Call.CallException(t)).promise()},e.prototype.unmuteSpeaker=function(e){return e.getUnmuteSpeakerCapability().isAllowed?this._callProvider.unmuteSpeaker(e).then(function(){e._isSpeakerMuted=!1,this._triggerCallbacksAsync(e._onCallSpeakerMuteStatusChangedCallbacks,e,!1)}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",_.Services.Analytics.AnalyticsErrorCode.UNMUTE_SPEAKER_ERROR),E.Deferred().reject(e).promise()}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-mute speakers for call: "+e.getCallId()+": "+e.getUnmuteSpeakerCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unmuteSpeaker",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.hold=function(t){if(t.getHoldCapability().isAllowed){t._setState(_.Services.Call.CallStates.HOLDING);var e=this._callProvider.hold(t);return e.then(function(){t._heldTime=new Date,t._setState(_.Services.Call.CallStates.HELD),this._triggerCallbacksAsync(t._onCallHeldCallbacks,t)}.bind(this),function(e){return t.getState()===_.Services.Call.CallStates.HOLDING&&t._setState(_.Services.Call.CallStates.ESTABLISHED),this._callsAnalyticsService.sendOperationFailureEvent("hold",_.Services.Analytics.AnalyticsErrorCode.HOLD_CALL_ERROR),E.Deferred().reject(e).promise()}.bind(this)),e}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not hold call: "+t.getCallId()+": "+t.getHoldCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("hold",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.unhold=function(t){var e=this._callManager.getActiveCall(),i=function(){t._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(t._onCallUnheldCallbacks,t)}.bind(this),a=function(e){return t.getState()===_.Services.Call.CallStates.UNHOLDING&&t._setState(_.Services.Call.CallStates.HELD),this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.FAILED),E.Deferred().reject(e).promise()}.bind(this);return t.getUnholdCapability().isAllowed?e!==T?(t._setState(_.Services.Call.CallStates.UNHOLDING),e.hold().then(function(){return this._callProvider.unhold(t).then(i,a)}.bind(this),function(){var e=E.Deferred();return this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.AUTO_HOLD_FAILED),e.reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED)),e.promise()}.bind(this))):this._callProvider.unhold(t).then(i,a):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not un-hold call: "+t.getCallId()+": "+t.getUnholdCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("unhold",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.ignore=function(e){var t=E.Deferred();return e.getState()===_.Services.Call.CallStates.ALERTING?(e._setState(_.Services.Call.CallStates.IGNORED),this._triggerCallbacksAsync(e._onCallIgnoredCallbacks,e),t.resolve()):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not ignore call: "+e.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("ignore",_.Services.Call.CallError.CALL_STATE_MISMATCH),t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH))),t.promise()},e.prototype._triggerCallbacksAsync=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();t&&setTimeout(function(){t.fire.apply(null,e)},0)},e.prototype._notifyCallFailure=function(e,t,i,a,r){e._setState(_.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(e._callFailedCallbacks,e,new _.Services.Call.CallException(t,i,a,r))},e.prototype._stopCollaboration=function(e){var t;this._collaborations&&(this._collaborations._isCollaborationForCall(e.getCallId())?(t=this._collaborations.getCollaborationForCall(e.getCallId())).stop().always(function(){this._collaborations._deleteCollaboration(t._collaborationId)}.bind(this)):this._collaborations._isCollaborationForCall("standalone")&&(t=this._collaborations.getCollaborationForCall("standalone")).stop().always(function(){this._collaborations._deleteCollaboration(t._collaborationId)}.bind(this)))},e.prototype.accept=function(t){t._setIsMissed(!1),t.getServiceQualityScoreCapability()._recalculate(),t.addOnCallEndedCallback(function(e){this._stopCollaboration(e)}.bind(this));var e=this._getMicrophoneAvailability(),i=this._getSpeakersAvailability();if(this._setupVideoResolution(t),this._setupDevicesListeners(t),this._setupAnalyticsListeners(t),this._setupStatisticsLogger(t),e){if(i){if(t.getState()!==_.Services.Call.CallStates.ALERTING&&t.getState()!==_.Services.Call.CallStates.IGNORED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.CALL_STATE_MISMATCH),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();0<t.getVideoChannels().length&&(this._getCameraAvailability(t)||t.getVideoChannels()[0]._setRequestedDirection(_.Services.Call.MediaDirection.RECV_ONLY));i=this._callManager.getActiveCall();return i!==T?i.hold().then(function(){return this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))}.bind(this),function(e){if(e&&e.getError()===_.Services.Call.CallError.ENDED)return this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this));e=E.Deferred();return this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.AUTO_HOLD_FAILED),e.reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED)),e.promise()}.bind(this)):this._callProvider.accept(t,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice(),this._mediaServices.getVideoInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_CALL_ERROR)}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": Speakers not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.SPEAKERS_NOT_FOUND),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.SPEAKERS_NOT_FOUND))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not accept call: "+t.getCallId()+": Microphone not available"),this._callsAnalyticsService.sendOperationFailureEvent("accept",_.Services.Call.CallError.MICROPHONE_NOT_FOUND),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.MICROPHONE_NOT_FOUND))},e.prototype.acceptSendVideo=function(i,e){if(i.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i.getState()!==_.Services.Call.CallStates.ESTABLISHED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not acceptSendVideo for call: "+i.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",_.Services.Call.CallError.AUTO_HOLD_FAILED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();this._mediaServices.getVideoInterface().addOnSelectedDeviceChangedCallback(function(e,t){this._callProvider.updateDevices(i,t).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("updateDevices",_.Services.Call.CallError.FAILED)}.bind(this))}.bind(this)),this._getCameraAvailability(i)||(e=_.Services.Call.VideoMode.RECEIVE_ONLY);function t(){i.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&i._setState(_.Services.Call.CallStates.ESTABLISHED)}var a=function(e){return t(),this._callsAnalyticsService.sendOperationFailureEvent("acceptSendVideo",_.Services.Analytics.AnalyticsErrorCode.ACCEPT_SEND_VIDEO_ERROR),E.Deferred().reject(e).promise()}.bind(this);return this._callProvider.acceptSendVideo(i,this._mediaServices.getVideoInterface().getSelectedDevice(),e).then(t,a)},e.prototype.denySendVideo=function(e){if(e.getState()!==_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e.getState()!==_.Services.Call.CallStates.ESTABLISHED)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not denySendVideo for call: "+e.getCallId()+": CALL_STATE_MISMATCH"),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",_.Services.Call.CallError.CALL_STATE_MISMATCH),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CALL_STATE_MISMATCH)).promise();function t(){e.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)}var i=function(e){return t(),this._callsAnalyticsService.sendOperationFailureEvent("denySendVideo",_.Services.Analytics.AnalyticsErrorCode.DENY_SEND_VIDEO_ERROR),E.Deferred().reject(e).promise()}.bind(this);return this._callProvider.denySendVideo(e).then(t,i)},e.prototype.transfer=function(t,e){if(t.getTransferCapability().isAllowed){var i=t.getState();return t._setState(_.Services.Call.CallStates.TRANSFERRING),this._callProvider.transfer(t,e).then(function(){t._setState(_.Services.Call.CallStates.ESTABLISHED)},function(e){return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Unattended transfer failed: "+e),t._setState(i),this._callsAnalyticsService.sendOperationFailureEvent("transfer",_.Services.Analytics.AnalyticsErrorCode.TRANSFER_CALL_ERROR),E.Deferred().reject(e).promise()}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not transfer call: "+t.getCallId()+": "+t.getTransferCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("transfer",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.attendedTransfer=function(t,e){if(t.getTransferCapability().isAllowed&&e.getTransferToCapability().isAllowed){var i=t.getState();return t._setState(_.Services.Call.CallStates.TRANSFERRING),this._callProvider.attendedTransfer(t,e).then(function(){t._setState(_.Services.Call.CallStates.ESTABLISHED)},function(e){return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Attended transfer failed: "+e),t._setState(i),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",_.Services.Analytics.AnalyticsErrorCode.ATTENDED_TRANSFER_CALL_ERROR),E.Deferred().reject(e).promise()}.bind(this))}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not attended transfer call: "+t.getCallId()+": "+t.getTransferCapability().denialReason+" "+e.getTransferToCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("attendedTransfer",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.join=function(e){if(!e.getJoinCapability().isAllowed)return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not join call: "+e.getCallId()+": "+e.getJoinCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise();var t=this._getMicrophoneAvailability(),i=this._getSpeakersAvailability();if(this._setupDevicesListeners(e),this._setupAnalyticsListeners(e),this._setupStatisticsLogger(e),t){if(i){e.getServiceQualityScoreCapability()._recalculate();i=this._callManager.getActiveCall();return i!==T&&i.getCallId()!==e.getCallId()?i.hold().then(function(){return this._callProvider.join(e,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this))}.bind(this),function(){return this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.AUTO_HOLD_FAILED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.AUTO_HOLD_FAILED))}.bind(this)):this._callProvider.join(e,this._mediaServices.getAudioInterface().getInputInterface().getSelectedDevice()).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Analytics.AnalyticsErrorCode.JOIN_CALL_ERROR)}.bind(this))}this._notifyCallFailure(e,_.Services.Call.CallError.SPEAKERS_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.SPEAKERS_NOT_FOUND)}else this._notifyCallFailure(e,_.Services.Call.CallError.MICROPHONE_NOT_FOUND),this._callsAnalyticsService.sendOperationFailureEvent("join",_.Services.Call.CallError.MICROPHONE_NOT_FOUND)},e.prototype.start=function(i){return this._startDfd=E.Deferred(),this._calls=i,this._config.mediaConfiguration&&this._config.mediaConfiguration.voipConfigurationVideo&&this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork&&(this.videoResolution=this._callProvider.getMediaServiceFactory().getMediaServicesService().getUserMedia().adjustVideoResolution(this._config.callUserConfiguration.videoMaxBandwidthAnyNetwork,_.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution])||_.Base.VideoResolution[this._config.mediaConfiguration.voipConfigurationVideo.videoResolution]),this._recalculateVideoCapability(),this._registerCallbacks(),this._callProvider.on(_.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(_.Base.Utils.isUndefined(i._isAvailable)||i._isAvailable)&&(i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i))}.bind(this)),this._callProvider.on(_.Base.NetworkProviderEvents.AUTHORIZED,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i))}.bind(this)),this._initAnalyticsMetrics(),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i),this._config.sgConfiguration.credentialProvider&&this._config.sgConfiguration.credentialProvider.isGuest&&i._triggerRegistrationStatus(!0)),i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNSUPPORTED,function(){this._isServiceAvailable=!1,i._isAvailable=!1,i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i),this.trigger(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,[])}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,function(){!_.Base.Utils.isUndefined(i._isAvailable)&&!i._isAvailable&&this._isServiceAvailable||(i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i)),i._voipCallingCapability._recalculate(),this._startDfd.state()===_.Base.DeferredStates.PENDING&&this._startDfd.reject()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_AVAILABLE,function(){i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MEDIA_CHANNEL_GUIDELINES_UNAVAILABLE,function(){i._voipCallingCapability._recalculate()}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.UPLOAD_LOGS_UPDATE,function(e,t,i){var a=_.Base.Utils.parseUrl(e);a&&(_.Base.Logger.info("Initializing remote logger provider"),a=new _.Config.ServerInfo(a.hostname,a.port,a.isSecure,a.path),this._uploadLoggerProvider=this._remoteLoggerProvider.getProvider(_.Providers.RemoteLogger.Names.MPAAS),this._uploadLoggerProvider.start(a,e,t,this._config._mediaServiceConfiguration.sessionId,i,this._config.sgConfiguration.credentialProvider).then(function(){this.uploadLogs()}.bind(this)))}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.AUDIO_STREAM_UPDATED,function(e,t){this._triggerCallbacksAsync(e._onAudioStreamUpdatedCallback,e,t)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_ACTIVATED,function(e){i._triggerRegistrationStatus(!0)}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_DEACTIVATED,function(e,t){i._triggerRegistrationStatus(!1),"REGISTRATION_TERMINATED"===t&&(this._isRegistrationTerminated=!0,i._voipCallingCapability._recalculate(),this._callProvider.stop().always(function(){this._isServiceAvailable=!1,i._isAvailable=!1,this._triggerCallbacksAsync(i._callsServiceUnavailableCallbacks,i)}.bind(this)))}.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INITIATING_MEDIA_RECOVERY,function(e){e.getEstablishedTime()&&e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING)}),this._callProvider.start(this._config,this.videoResolution).then(function(e){return this._onContactListChanged=function(){this._callManager.getAllCalls().forEach(this._updateMatchedContactsForCall,this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),this._startDfd.state()===_.Base.DeferredStates.PENDING&&this._startDfd.resolve(),!_.Base.Utils.isUndefined(i._isAvailable)&&i._isAvailable||(i._isAvailable=!0,this._triggerCallbacksAsync(i._callsServiceAvailableCallbacks,i)),e}.bind(this),function(e){this._callsAnalyticsService.sendOperationFailureEvent("start",_.Services.Analytics.AnalyticsErrorCode.STARTING_CALL_ERROR),this._startDfd.reject(e)}.bind(this)),this._startDfd.promise()},e.prototype.stop=function(){return this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer),this._limitedVideoResolutionStoring(),this._callProvider.stop().then(function(e){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,this._calls=T,e}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("stop",_.Services.Analytics.AnalyticsErrorCode.STOPPING_CALL_ERROR),E.Deferred().reject(e).promise()}.bind(this))},e.prototype.stopImmediately=function(){return this._limitedVideoResolutionStoring(),this._callProvider.stopImmediately().fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("stopImmediately",_.Services.Call.CallError.FAILED)}.bind(this))},e.prototype.sendDTMF=function(e,t){return e.getSendDTMFCapability().isAllowed?this._callProvider.sendDTMF(e,t).fail(function(e){this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",_.Services.Analytics.AnalyticsErrorCode.SEND_DTMF_ERROR)}.bind(this)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not send DTMF for call: "+e.getCallId()+": "+e.getSendDTMFCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("sendDTMF",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise())},e.prototype.isVideoEnabled=function(){var e=_.Base.Utils.queryJSONObject(this._config,"callUserConfiguration.videoEnabled");return this._videoLicenseEnabled&&(!!e||_.Base.Utils.isUndefined(e))},e.prototype.isWebCollaborationEnabled=function(e){return e._webCollaboration},e.prototype.isUccpEnabled=function(){return!(!_.Base.Utils.isDefined(this._config.uccpConfiguration)||!_.Base.Utils.isDefined(this._config.uccpConfiguration.enabled))&&this._config.uccpConfiguration.enabled},e.prototype.setVideoChannels=function(e,t){return 0===t.length?this.setVideoMode(e,_.Services.Call.VideoMode.DISABLE):this.setVideoMode(e,this._getVideoMode(t[0].direction))},e.prototype._getVideoMode=function(e){switch(e){case _.Services.Call.MediaDirection.SEND_RECV:return _.Services.Call.VideoMode.SEND_RECEIVE;case _.Services.Call.MediaDirection.SEND_ONLY:return _.Services.Call.VideoMode.SEND_ONLY;case _.Services.Call.MediaDirection.RECV_ONLY:return _.Services.Call.VideoMode.RECEIVE_ONLY;case _.Services.Call.MediaDirection.DISABLE:return _.Services.Call.VideoMode.DISABLE;default:return _.Services.Call.VideoMode.INACTIVE}},e.prototype.setVideoMode=function(t,e,i){if(t.getState()===_.Services.Call.CallStates.IDLE||t.getState()===_.Services.Call.CallStates.ALERTING||t.getState()===_.Services.Call.CallStates.IGNORED||t.getUpdateVideoChannelsCapability().isAllowed){if(!this._isSetVideoModeCapabilityAllowed(t,e))return E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED));t.getState()===_.Services.Call.CallStates.ESTABLISHED&&t._setState(_.Services.Call.CallStates.RENEGOTIATING);var a=function(){t.getState()===_.Services.Call.CallStates.RENEGOTIATING&&t._setState(_.Services.Call.CallStates.ESTABLISHED)},r=function(e){return a(),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",_.Services.Analytics.AnalyticsErrorCode.SETTING_VIDEO_MODE_ERROR),E.Deferred().reject(e).promise()}.bind(this),e=this._callProvider.setVideoMode(t,e,this._mediaServices.getVideoInterface().getSelectedDevice(),i);return e.then(function(){var e;a(),this._collaborations&&this._collaborations._isCollaborationForCall(t.getCallId())&&(e=this._collaborations.getCollaborationForCall(t.getCallId())).getContentSharing()._recalculateShareContentVideoCapability(e)}.bind(this),r),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.CAMERA_DEALLOCATED,[i]),e}return _.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setVideoMode for call: "+t.getCallId()+": "+t.getUpdateVideoChannelsCapability().denialReason),this._callsAnalyticsService.sendOperationFailureEvent("setVideoMode",_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.setVideoSendResolution=function(e,t,i){var a,r=e.getVideoChannels();if(0<r.length){r=r[0].getNegotiatedDirection();return r===_.Services.Call.MediaDirection.SEND_ONLY||r===_.Services.Call.MediaDirection.SEND_RECV?this._callProvider.setVideoSendResolution(e,t,i):(a="The call does not have an active send video channel",E.Deferred().reject(a).promise())}return a="The call does not have a video channel",E.Deferred().reject(a).promise()},e.prototype.getVideoSendBandwidth=function(e){return this._callProvider.getVideoSendBandwidth(e)},e.prototype.getVideoBandwidth=function(e){return this._callProvider.getVideoBandwidth(e)},e.prototype.getVideoResolution=function(e){return this._callProvider.getVideoResolution(e)},e.prototype.getNegotiatedVideoResolution=function(e){return this._callProvider.getNegotiatedVideoResolution(e)},e.prototype.getNegotiatedVideoResolutionByCallId=function(e){e=this._callManager.getCallById(e);return e?this._callProvider.getNegotiatedVideoResolution(e):this.getDefaultVideoResolution()},e.prototype.getVideoSendResolution=function(e){return this._callProvider.getVideoSendResolution(e)},e.prototype.hasVideoTracks=function(e){return this._callProvider.hasVideoTracks(e)},e.prototype._isSetVideoModeCapabilityAllowed=function(e,t){switch(t){case _.Services.Call.VideoMode.SEND_RECEIVE:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeSendReceiveCapability().isAllowed;case _.Services.Call.VideoMode.SEND_ONLY:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeSendOnlyCapability().isAllowed;case _.Services.Call.VideoMode.RECEIVE_ONLY:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeReceiveOnlyCapability().isAllowed;case _.Services.Call.VideoMode.INACTIVE:return e.getState()===_.Services.Call.CallStates.IDLE||e.getUpdateVideoModeInactiveCapability().isAllowed;case _.Services.Call.VideoMode.DISABLE:return e.getUpdateVideoModeDisableCapability().isAllowed;default:return!1}},e.prototype.setAudioMode=function(e,t){return e.getUpdateAudioModeCapability().isAllowed||t===_.Services.Call.AudioMode.DISABLE?this._callProvider.setAudioMode(e,t):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setAudioMode for call: "+e.getUpdateAudioModeCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},e.prototype.setWebCollaboration=function(e,t){return e.getUpdateWebCollaborationCapability().isAllowed||this._isCollabCallCapable(e)?(e._webCollaboration=t,this._callProvider.setWebCollaboration(e,t)):(_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Could not setWebCollaboration for call: "+e.getUpdateWebCollaborationCapability().denialReason),E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)))},e.prototype.isServiceAvailable=function(){return this._isServiceAvailable},e.prototype.getVideoCapability=function(){return this._videoCapability},e.prototype.getDefaultVideoResolution=function(){return this._config.mediaConfiguration.voipConfigurationVideo.videoResolution},e.prototype._recalculateVideoCapability=function(){var e=!0,t=_.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this.isServiceAvailable()&&this.isVideoEnabled()&&this._config.mediaConfiguration.mediaEngineEnabled||(e=!1,t=_.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._videoCapability._updateIfChanged(e,t)},e.prototype.startRinging=function(e){return this._callProvider.startRinging(e)},e.prototype.acceptAnswerCallRequest=function(e){return this._callProvider.acceptAnswerCallRequest(e)},e.prototype.acceptTerminateCallRequest=function(e){return this._callProvider.acceptTerminateCallRequest(e)},e.prototype.acceptUpdateCallRequest=function(e,t){return this._callProvider.acceptUpdateCallRequest(e,t)},e.prototype.acceptMakeCallRequest=function(e){return this._callProvider.acceptMakeCallRequest(e)},e.prototype.rejectAnswerCallRequest=function(e){return this._callProvider.rejectAnswerCallRequest(e)},e.prototype.rejectTerminateCallRequest=function(e){return this._callProvider.rejectTerminateCallRequest(e)},e.prototype.rejectUpdateCallRequest=function(e,t){return this._callProvider.rejectUpdateCallRequest(e,t)},e.prototype.rejectMakeCallRequest=function(e){return this._callProvider.rejectMakeCallRequest(e)},e.prototype.isAudioOrDataOnly=function(e){if(e){var t=this._callManager.getCallById(e);if(t){e=t.getVideoChannels();return t._sessionId&&(t._isDataOnly()||0===e.length||e[0].isDisabled())}}return!1},e.prototype.isMPaasCall=function(e){if(e){e=this._callManager.getCallById(e);return e&&e._sessionId}return!1},e.prototype.startContentVideoSharing=function(e,t){return this.isMPaasCall(e)&&!this.isAudioOrDataOnly(e)?this._callProvider.startContentVideoSharing(e,t):E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype.stopContentVideoSharing=function(e){var t=this._callManager.getCallById(e);return t&&t.muteVideo(),this._callProvider.stopContentVideoSharing(e)},e.prototype.updateAudioSourceForVideoSharing=function(e,t){return this._callProvider.updateAudioSourceForVideoSharing(e,t)},e.prototype._registerCallbacks=function(){this._callProvider._removeListeners(),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CONFERENCE_ESCALATION,this._conferenceEscalationHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_STARTED,this._callStartedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_RINGING,this._callRingingHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHED,this._callEstablishedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ESTABLISHING,this._callEstablishingHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ICE_CONNECTION_UPDATE,this._iceConnectionUpdateHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_CALL,this._incomingCallHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_REQUEST,this._incomingAddVideoRequestHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_ACCEPTED,this._incomingAddVideoAcceptedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_DENIED,this._incomingAddVideoDeniedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_ADD_VIDEO_TIMEDOUT,this._incomingAddVideoTimedOutHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_HOLD,this._incomingHoldHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.INCOMING_UNHOLD,this._incomingUnholdHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.VIDEO_CHANNEL_UPDATE,this._videoChannelUpdateHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_ENDED,this._callEndedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_FAILURE,this._callFailureHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_UNAVAILABLE,this._callServiceUnavailableHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_SERVICE_AVAILABLE,this._callServiceAvailableHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MAX_NETWORK_RECOVERY_ATTEMPTED,this._maxNetworkRecoveryAttemptedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.REMOTE_ADDRESS_CHANGED,this._remoteAddressChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.REMOTE_CALL_CREATED,this._remoteCallCreatedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,this._performanceManagerProfileChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.PERFORMANCE_MONITOR_ALERT,this._performanceMonitorAlertHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.VIDEO_LICENSE_UPDATED,this._videoLicenseUpdatedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.RINGBACK_TONE_URLS_CHANGED,this._ringbackToneURLsChangedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ANSWER_CALL_REQUESTED,this._answerCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.TERMINATE_CALL_REQUESTED,this._terminateCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.UPDATE_CALL_REQUESTED,this._updateCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.MAKE_CALL_REQUESTED,this._makeCallRequestedHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.ALLOWED_NAILEDUP_VIDEO_MODES,this._allowedNailedUpVideoModesHandler.bind(this)),this._callProvider.on(_.Providers.Interfaces.CallProviderCallbackIds.CALL_MEDIA_FAILED,this._callMediaFailedHandler.bind(this))},e.prototype._conferenceEscalationHandler=function(e,t,i,a){var r,s,n,o;i=e._webCollaboration&&_.Base.Utils.isNotEmptyString(i)?i:T,a?(e.isConference()?_.Base.Utils.isDefined(t)&&null!==t&&(this._config.uccpConfiguration.enabled?e._conference._isStarted?e._conference.stop().then(function(){r=this._parseUccpUrl(t),e._uccpUrl=t,e._conference._setConfiguration(r)}.bind(this)):(r=this._parseUccpUrl(t),e._uccpUrl=t,e._conference._setConfiguration(r),!_.Base.Utils.isUndefined(i)&&0!==i.length||this.watchForWebCollaborationURIChanges(e)):t=T,e._conference._collaborationURI=i,_.Base.Utils.isDefined(i)&&0<i.length&&this.createCollaborationForConference(e,i)):_.Base.Utils.isDefined(t)&&null!==t?(this._config.uccpConfiguration.enabled?(r=this._parseUccpUrl(t),o=this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(r),s=new _.Services.Conference.Chat(this.createChatService(o)),n=this.createParticipantService(o),o=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,o,this._contactsIntegrationService),e._setConference(new _.Services.Conference.Conference(o,n,s)),e._uccpUrl=t,e._conference._isUccpConference=!0,e._conference._setConfiguration(r),!_.Base.Utils.isUndefined(i)&&0!==i.length||this.watchForWebCollaborationURIChanges(e)):(t=T,o=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.SCOPIA_CONFERENCE),e._setConference(new _.Services.Conference.Conference(o)),e._conference._isUccpConference=!1),e._conference._collaborationURI=i,_.Base.Utils.isDefined(i)&&0<i.length&&this.createCollaborationForConference(e,i)):_.Base.Utils.isDefined(i)&&0<i.length?(a=!1,this.createCollaborationForCall(e,i)):e._createCMConference(),this._triggerCallbacksAsync(e._onCallConferenceStatusChangedCallbacks,e,a,t,i)):_.Base.Utils.isDefined(i)&&0<i.length&&(this.createCollaborationForCall(e,i),this._triggerCallbacksAsync(e._onCallConferenceStatusChangedCallbacks,e,a,t,i))},e.prototype.getScopiaConferenceProvider=function(e){e=_.Base.Utils.isDefined(e)?e:this._config.uccpConfiguration;return this._scopiaConferenceProviderFactory.getScopiaConferenceProvider(e)},e.prototype.createChatService=function(e){return new _.Services.Conference.ChatService(e)},e.prototype.createParticipantService=function(e){return new _.Services.Conference.ParticipantService(e)},e.prototype.createCollaborationForConference=function(e,t){var i;this._collaborations&&(e.getCallId()?e._conference._setCollaboration(this._collaborations.getCollaborationForCall(e.getCallId())):e._conference._setCollaboration(this._collaborations.getCollaborationForCall("standalone")),_.Base.Utils.isDefined(t)&&0<t.length&&(i=this._parseWebCollabUrl(t),this._config.wcsConfiguration=i,e._webCollabUrl=t,e._conference._collaboration._setConfiguration(this._config,i.meetingId)),this.watchForWebCollaborationURIChanges(e))},e.prototype.watchForWebCollaborationURIChanges=function(a){this._collaborations&&a._conference.addOnConferenceCollaborationURIChangedCallback(function(e,t){var i;_.Base.Utils.isDefined(t)&&0<t.length&&(i=this._parseWebCollabUrl(t),_.Base.Utils.isUndefined(e._collaboration)&&(a.getCallId()?e._setCollaboration(this._collaborations.getCollaborationForCall(a.getCallId())):e._setCollaboration(this._collaborations.getCollaborationForCall("standalone"))),e._collaborationURI===t&&!_.Base.Utils.isUndefined(e._collaboration._config)||(e._collaboration._isStarted?e._collaboration.stop().then(function(){this._config.wcsConfiguration=i,e._collaboration._setConfiguration(this._config,i.meetingId),e._collaboration.start()}.bind(this)):(this._config.wcsConfiguration=i,e._collaboration._setConfiguration(this._config,i.meetingId))))}.bind(this))},e.prototype.createCollaborationForCall=function(e,t){e.getCallId()&&(e=this._collaborations.getCollaborationForCall(e.getCallId()),_.Base.Utils.isDefined(t)&&0<t.length&&(t=this._parseWebCollabUrl(t),this._config.wcsConfiguration=t,e._setConfiguration(this._config,t.meetingId)))},e.prototype._parseUccpUrl=function(e){e=_.Base.Utils.parseUrl(e);return _.Base.Utils.isDefined(e)?{enabled:!0,networkProviderConfiguration:{webSocketConfig:new _.Config.ServerInfo(e.hostname,e.port,e.isSecure,e.path,e.credentials,e.query)}}:T},e.prototype._parseWebCollabUrl=function(e){var t,i,a,r,s;return _.Base.Utils.isDefined(e)&&0<e.length&&(t=(r=_.Base.Utils.parseUrl(e)).path.indexOf("/viewer.php"),a=r.path.substring(0,t),i="https:"===document.location.protocol||"chrome-extension:"===document.location.protocol,s=new _.Config.ServerInfo(r.hostname,r.port,i,a),(e=r.query.split("&").map(function(e){e=e.split("=");return{key:e[0],value:e[1]}})).getValue=function(t){var e=this.filter(function(e){return e.key===t});return 0!==e.length?e[0].value:null},t=e.getValue("token"),i=e.getValue("meeting_id"),a=e.getValue("mode"),r=e.getValue("login"),e=e.getValue("participantId"),s={enabled:!0,meetingId:i,credentialProvider:new _.Config.WCSCredentialTokenProvider(t,r,e,T,a),networkProviderConfiguration:{restConfig:s}}),s},e.prototype._callStartedHandler=function(e){this._triggerCallbacksAsync(e._onCallStartedCallbacks,e)},e.prototype._callRingingHandler=function(e,t,i,a,r){e.getState()===_.Services.Call.CallStates.ESTABLISHED?e._setState(_.Services.Call.CallStates.BEING_TRANSFERRED):e.getState()!==_.Services.Call.CallStates.HELD&&e._setState(_.Services.Call.CallStates.REMOTE_ALERTING),(i||a||r)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(i,a,r)),e._isEarlyMedia=t,e._sendDTMFCapability._recalculate(t),this._triggerCallbacksAsync(e._onCallRemoteAlertingCallbacks,e,t),_.Base.Utils.isDefined(e._dtmfString)&&t&&this._handleDTMFString(e)},e.prototype._callEstablishedHandler=function(e,t,i,a,r,s){e._heldRemotely=!1,e._establishedTime=new Date,e.getState()!==_.Services.Call.CallStates.HELD&&e._setState(_.Services.Call.CallStates.ESTABLISHED),_.Base.Utils.isDefined(a)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this.uploadLogs(),this._triggerCallbacksAsync(e._onCallEstablishedCallbacks,e);s=e.getAudioChannel();e.getState()!==_.Services.Call.CallStates.HELD&&s&&s._getNegotiatedDirection()===_.Services.Call.MediaDirection.RECV_ONLY&&this._incomingHoldHandler(e),e.isRemote()&&!1===i&&(this._callManager.setLastMissedCall(T),e._setRemote(!1),e._setIsMissed(!1),this._triggerCallbacksAsync(e._onCallJoinedCallbacks,e)),_.Base.Utils.isDefined(e._dtmfString)&&!e._isEarlyMedia&&this._handleDTMFString(e),this._callsAnalyticsService.sendCallInfo(e._incoming,e._videoChannels.length),this._callsAnalyticsService.sendCallType(t)},e.prototype._callEstablishingHandler=function(e){var t=e.getUserToUserInfo();t&&_.Base.Utils.isDefined(t.getUCID())&&this._triggerCallbacksAsync(e._onCallEstablishingCallbacks,e)},e.prototype._remoteCallCreatedHandler=function(e,t,i,a,r,s,n,o){o=this._callManager.createRemoteOrIncomingCall(this,e,t,i,a,r,s,n,o,_.Services.Call.CallStates.ESTABLISHED,!0,!1);this._callProvider.registerIncomingOrRemoteCall(o)},e.prototype._performanceManagerProfileChangedHandler=function(e){this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MANAGER_PROFILE_CHANGED,[e])},e.prototype._performanceMonitorAlertHandler=function(e,t){this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.PERFORMANCE_MONITOR_ALERT,[e,t])},e.prototype._incomingCallHandler=function(e,t,i,a,r,s,n,o,c,l,d,C){var u;this._isWebRTCSupportedBrowser()&&((u=this._callManager.getActiveCall())!==T&&this._callProvider.setActiveCallVideoTrack(u.getCallId()),C=this._callManager.createRemoteOrIncomingCall(this,e,t,i,a,r,s,n,o,_.Services.Call.CallStates.ALERTING,!1,!0,C),_.Base.Utils.isDefined(c)&&C._setUserToUserInfo(new _.Services.Call.UserToUserInfo(c,l,d)),this._callProvider.registerIncomingOrRemoteCall(C),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.INCOMING_CALL,[C]),(_.Base.Utils.isUndefined(this._config.callUserConfiguration.startRingingOnIncomingCall)||this._config.callUserConfiguration.startRingingOnIncomingCall)&&this.startRinging(C))},e.prototype._incomingAddVideoRequestHandler=function(e,t){e._setState(_.Services.Call.CallStates.FAR_END_RENEGOTIATING),this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestReceivedCallbacks,e,t)},e.prototype._incomingAddVideoAcceptedHandler=function(e){this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestAcceptedCallbacks,e)},e.prototype._incomingAddVideoDeniedHandler=function(e){this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestDeniedCallbacks,e)},e.prototype._incomingAddVideoTimedOutHandler=function(e){e.getState()===_.Services.Call.CallStates.FAR_END_RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(e._onCallIncomingVideoAddRequestTimedOutCallbacks,e)},e.prototype._incomingHoldHandler=function(e){e._heldTime=new Date,e._heldRemotely=!0,this._triggerCallbacksAsync(e._onCallHeldRemotelyCallbacks,e)},e.prototype._incomingUnholdHandler=function(e){e._heldRemotely=!1,this._triggerCallbacksAsync(e._onCallUnheldRemotelyCallbacks,e)},e.prototype._videoChannelUpdateHandler=function(e){e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._recalculateVideoModeCapabilities(),this._triggerCallbacksAsync(e._onCallVideoChannelsUpdatedCallback,e,e._videoChannels)},e.prototype._callEndedHandler=function(e,t,i){e.isConference()&&this._stopConferenceCall(e),e.getState()!==_.Services.Call.CallStates.ALERTING&&e.getState()!==_.Services.Call.CallStates.IGNORED||(e._setIsMissed(!0),this._callManager.setLastMissedCall(e)),e.getState()!==_.Services.Call.CallStates.ENDING||i&&i.getCause()||(t=!1);i=this._createEndCallEvent(t,i);e._setState(_.Services.Call.CallStates.ENDED),this._triggerCallbacksAsync(e._onCallEndedCallbacks,e,i),this._callManager.deleteCall(e),this._callProvider.stopExternalGatewayProvider(e).always(function(){this.uploadLogs()}.bind(this))},e.prototype._callFailureHandler=function(e,t,i,a,r){var s=t;t!==_.Services.Call.CallError.NOT_FOUND||e.getState()!==_.Services.Call.CallStates.ENDING&&e.getState()!==_.Services.Call.CallStates.ENDED||(s=_.Services.Call.CallError.ENDED),t!==_.Services.Call.CallError.SESSION_ID_NOT_FOUND&&t!==_.Services.Call.CallError.SESSION_ID_ALREADY_CONNECTED||_.Base.Logger.error(_.Base.LoggerTags.CALL_SERVICE,"Received MPaaS session failure:",t),this.uploadLogs(),this._notifyCallFailure(e,s,i,a,r),this._callsAnalyticsService.sendDroppedCallEvent(s)},e.prototype._callServiceUnavailableHandler=function(e){this._isServiceAvailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),this._isUploadedOnServiceUnavailable||(this._isUploadedOnServiceUnavailable=!0,this.uploadLogs()),_.Base.Utils.isDefined(e)&&(e._setServiceAvailability(!1),this._triggerCallbacksAsync(e._callServiceUnavailableCallbacks,e))},e.prototype._callServiceAvailableHandler=function(e){this._isServiceAvailable=!0,this._isUploadedOnServiceUnavailable=!1,this._recalculateVideoCapability(),this._calls._setOnNetworkEventsCapability._recalculate(),this._calls._removeOnNetworkEventsCapability._recalculate(),_.Base.Utils.isDefined(e)&&(e._setServiceAvailability(!0),this._triggerCallbacksAsync(e._callServiceAvailableCallbacks,e))},e.prototype._maxNetworkRecoveryAttemptedHandler=function(i){this._callManager.getAllCalls().forEach(function(e){var t;this._callProvider.isExternalGatewayCall(e,i)&&((t=e.getState())!==_.Services.Call.CallStates.INITIATING&&t!==_.Services.Call.CallStates.REMOTE_ALERTING||(this.uploadLogs(),this._notifyCallFailure(e,_.Services.Call.CallError.SERVICE_UNAVAILABLE)))}.bind(this))},e.prototype._remoteAddressChangedHandler=function(e,t,i,a,r,s){_.Base.Utils.isDefined(e)&&(_.Base.Utils.isDefined(t)&&e._setRemoteAddress(t),_.Base.Utils.isDefined(i)&&e._setRemoteDisplayName(i),_.Base.Utils.isDefined(a)&&e._setUserToUserInfo(new _.Services.Call.UserToUserInfo(a,r,s)),this._triggerCallbacksAsync(e._onCallRemoteAddressChangedCallbacks,e))},e.prototype._videoLicenseUpdatedHandler=function(e){this._videoLicenseEnabled!==e&&(this._videoLicenseEnabled=e,this._recalculateVideoCapability())},e.prototype._allowedNailedUpVideoModesHandler=function(e,t){e._setAllowedNailedUpVideoModes(t)},e.prototype._iceConnectionUpdateHandler=function(e,t){t?(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Media path connected"),e.getEstablishedTime()&&e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED),this._triggerCallbacksAsync(e._mediaConnectedCallbacks,e)):(_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Media path disconnected"),this._triggerCallbacksAsync(e._mediaDisconnectedCallbacks,e))},e.prototype._buildUccpConfig=function(e){var t=this._config.uccpConfiguration,e=_.Base.Utils.parseUrl(e);return t.networkProviderConfiguration.webSocketConfig.hostName=e.hostname,t.networkProviderConfiguration.webSocketConfig.port=e.port,t.networkProviderConfiguration.webSocketConfig.isSecure=e.isSecure,t.networkProviderConfiguration.webSocketConfig.path=e.path,t},e.prototype._updateMatchedContactsForCall=function(e){e&&this._contactsIntegrationService.updateMatchedContactsForParticipant(e.getRemoteParticipant())},e.prototype._handleDTMFString=function(t){function i(){var e;0===t._dtmfString.length?clearTimeout(a):(e=t._dtmfString.shift(),a=","!==e?(this.sendDTMF(t,this._convertToDtmf(e)),setTimeout(i.bind(this),200)):setTimeout(i.bind(this),2e3))}var a;setTimeout(function(){_.Base.Logger.info(_.Base.LoggerTags.CALL_SERVICE,"Handle DTMF string passed as part of dial string"),a=setTimeout(i.bind(this),200)}.bind(this),2e3)},e.prototype._convertToDtmf=function(e){var t;switch(e){case"1":t=_.Services.Call.DTMFTone.ONE;break;case"2":t=_.Services.Call.DTMFTone.TWO;break;case"3":t=_.Services.Call.DTMFTone.THREE;break;case"4":t=_.Services.Call.DTMFTone.FOUR;break;case"5":t=_.Services.Call.DTMFTone.FIVE;break;case"6":t=_.Services.Call.DTMFTone.SIX;break;case"7":t=_.Services.Call.DTMFTone.SEVEN;break;case"8":t=_.Services.Call.DTMFTone.EIGHT;break;case"9":t=_.Services.Call.DTMFTone.NINE;break;case"0":t=_.Services.Call.DTMFTone.ZERO;break;case"A":t=_.Services.Call.DTMFTone.A;break;case"B":t=_.Services.Call.DTMFTone.B;break;case"C":t=_.Services.Call.DTMFTone.C;break;case"D":t=_.Services.Call.DTMFTone.D;break;case"*":t=_.Services.Call.DTMFTone.STAR;break;case"#":t=_.Services.Call.DTMFTone.POUND;break;default:_.Base.Logger.warn(_.Base.LoggerTags.CALL_SERVICE,"{0} is not a DTMF symbol",e)}return t},e.prototype.createCMConference=function(e){e=new _.Providers.CM.CMConferenceProvider(this._callProvider,e.getCallId()),e=new _.Services.Conference.ConferenceService(_.Services.Conference.ConferenceType.CM_CONFERENCE,e,this._contactsIntegrationService);return new _.Services.Conference.Conference(e)},e.prototype._disconnectCallFromConference=function(e){e.isConference()&&e.getConference()._disconnect()},e.prototype._stopConferenceCall=function(e){e.isConference()&&(e.getConference()._removeOnConferenceAllowVideoDirectionChangedCallback(e._recalculateVideoModeCapabilities.bind(e)),e.getConference()._disconnect(),e.getConference()._isAvailable&&(this._triggerCallbacksAsync(e.getConference()._onConferenceConnectionEndedCallbacks,e.getConference()),e.getConference().stop()),e.getConference()._setCollaboration(T),e._setConference(T))},e.prototype.getAudioDetails=function(e){return this._getCallStatistics(e).then(function(e){return e.audioStatistics})},e.prototype.getVideoDetails=function(e){return this._getCallStatistics(e).then(function(e){return e.videoStatistics})},e.prototype._getCallStatistics=function(e){return this._callProvider.getCallStatistics(e).then(function(e){return{audioStatistics:new _.Services.Call.AudioDetails(e.audioStatistics),videoStatistics:new _.Services.Call.VideoDetails(e.videoStatistics)}}.bind(this),function(e){return this._callsAnalyticsService.sendOperationFailureEvent("_getCallStatistics",_.Services.Analytics.AnalyticsErrorCode.GETTING_CALL_STATISTICS_ERROR),_.Base.Logger.debug(_.Base.LoggerTags.CALL_SERVICE,"Call statistics download fail: ",e.getError()),E.Deferred().reject(e).promise()}.bind(this))},e.prototype.getActiveCall=function(){return this._callManager.getActiveCall()},e.prototype._parseChromeStatistics=function(e){var i,a,r,s,t,n,o;return e.result().forEach(function(e){var t=e.stat("mediaType");"ssrc"===e.type&&-1<e.id.indexOf("send")&&"audio"===t&&(i=e),"ssrc"===e.type&&-1<e.id.indexOf("send")&&"video"===t&&(r=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"audio"===t&&(a=e),"ssrc"===e.type&&-1<e.id.indexOf("recv")&&"video"===t&&(s=e)}),(a||i)&&(t={bytesReceived:parseInt(a?a.stat("bytesReceived"):0),rtcBytesReceived:parseInt(a?a.stat("transportBytesReceived"):0),packetsReceived:parseInt(a?a.stat("packetsReceived"):0),packetsLost:parseInt(a?a.stat("packetsLost"):0),googJitterReceived:parseInt(a?a.stat("googJitterReceived"):0)},n={bytesSent:parseInt(i?i.stat("bytesSent"):0),packetsSent:parseInt(i?i.stat("packetsSent"):0),googRtt:parseInt(i?i.stat("googRtt"):0),packetsLost:parseInt(i?i.stat("packetsLost"):0)},i&&""===i.stat("packetsLost")&&(n.packetsLost=0),i&&""===i.stat("googRtt")&&(n.googRtt=0),n=new _.Services.Call.AudioDetails(t.bytesReceived,n.bytesSent,t.packetsReceived,n.packetsSent,n.googRtt,n.packetsLost,t.packetsLost,t.googJitterReceived)),(s||r)&&(o={bytesReceived:parseInt(s?s.stat("bytesReceived"):0),actualBitRateReceived:T,packetsReceived:parseInt(s?s.stat("packetsReceived"):0),packetsLost:parseInt(s?s.stat("packetsLost"):0),googFrameRateReceived:parseInt(s?s.stat("googFrameRateReceived"):0)},_.Base.Utils.isUndefined(o.packetsLost)&&(o.packetsLost=0),_.Base.Utils.isUndefined(o.packetsReceived)&&(o.packetsReceived=0),0===o.packetsReceived?o.packetsLossFractionReceived=0:o.packetsLossFractionReceived=s.stat("packetsLost")/s.stat("packetsReceived"),t={bytesSent:parseInt(r?r.stat("bytesSent"):0),actualBitRateTransmitted:T,packetsSent:parseInt(r?r.stat("packetsSent"):0),packetsLost:parseInt(r?r.stat("packetsLost"):0),googFrameRateSent:parseInt(r?r.stat("googFrameRateSent"):0)},_.Base.Utils.isUndefined(t.packetsLost)&&(t.packetsLost=0),_.Base.Utils.isUndefined(t.packetsSent)&&(t.packetsSent=0),0===t.packetsSent?t.packetsLossFractionTransmitted=0:t.packetsLossFractionTransmitted=r.stat("packetsLost")/r.stat("packetsSent"),o=new _.Services.Call.VideoDetails(t.bytesSent,o.bytesReceived,t.actualBitRateTransmitted,o.actualBitRateReceived,t.packetsSent,o.packetsReceived,t.packetsLost,o.packetsLost,t.packetsLossFractionTransmitted,o.packetsLossFractionReceived,t.googFrameRateSent,o.googFrameRateReceived)),{audioStatistics:n,videoStatistics:o}},e.prototype._parseFirefoxStatistics=function(e){var t={},i={},a={},r={};return e.forEach(function(e){"audio"===e.mediaType?e.id.includes("inbound_rtp_audio")?(t.bytesReceived=e.bytesReceived,t.packetsReceived=e.packetsReceived,t.packetsLost=e.packetsLost,t.jitterReceived=e.jitter):e.id.includes("outbound_rtp_audio")?(i.bytesSent=e.bytesSent,i.packetsSent=e.packetsSent):e.id.includes("outbound_rtcp_audio")&&(i.mozRtt=e.mozRtt,i.packetsLost=e.packetsLost):"video"===e.mediaType&&(e.id.includes("inbound_rtp_video")?(a.bytesReceived=e.bytesReceived,a.actualBitRateReceived=e.bitrateMean,a.packetsReceived=e.packetsReceived,a.packetsLost=e.packetsLost,a.frameRateReceived=e.framerateMean):e.id.includes("outbound_rtcp_video")?r.packetsLost=e.packetsLost:e.id.includes("outbound_rtp_video")&&(r.bytesSent=e.bytesSent,r.actualBitRateTransmitted=e.bitrateMean,r.packetsSent=e.packetsSent,r.frameRateSent=e.framerateMean))}),_.Base.Utils.isUndefined(i.packetsLost)&&(i.packetsLost=0),_.Base.Utils.isUndefined(i.mozRtt)&&(i.mozRtt=0),e=new _.Services.Call.AudioDetails(t.bytesReceived,i.bytesSent,t.packetsReceived,i.packetsSent,i.mozRtt,i.packetsLost,t.packetsLost,t.jitterReceived),_.Base.Utils.isUndefined(a.packetsLost)&&(a.packetsLost=0),_.Base.Utils.isUndefined(a.packetsReceived)&&(a.packetsReceived=0),0===a.packetsReceived?a.packetsLossFractionReceived=0:a.packetsLossFractionReceived=a.packetsLost/a.packetsReceived,_.Base.Utils.isUndefined(r.packetsLost)&&(r.packetsLost=0),_.Base.Utils.isUndefined(r.packetsSent)&&(r.packetsSent=0),0===r.packetsSent?r.packetsLossFractionTransmitted=0:r.packetsLossFractionTransmitted=r.packetsLost/r.packetsSent,{audioStatistics:e,videoStatistics:new _.Services.Call.VideoDetails(r.bytesSent,a.bytesReceived,r.actualBitRateTransmitted,a.actualBitRateReceived,r.packetsSent,a.packetsReceived,r.packetsLost,a.packetsLost,r.packetsLossFractionTransmitted,a.packetsLossFractionReceived,r.frameRateSent,a.frameRateReceived)}},e.prototype._parseEdgeStatistics=function(e){var t={},i={},a={},r={};return _.Base.Utils.isDefined(e.rtp_audio)&&(t.bytesReceived=T,t.packetsReceived=e.rtp_audio.packetsReceived,t.packetsLost=e.rtp_audio.packetsLost,t.jitterReceived=e.rtp_audio.jitter),_.Base.Utils.isDefined(e.rtp_audio)&&(i.bytesSent=T,i.packetsSent=e.rtp_audio.packetsSent,i.packetsLost=e.rtp_audio.packetsLost),t=new _.Services.Call.AudioDetails(t.bytesReceived,i.bytesSent,t.packetsReceived,i.packetsSent,i.mozRtt,i.packetsLost,t.packetsLost,t.jitterReceived),_.Base.Utils.isDefined(e.rtp_video)&&(a.bytesReceived=T,a.packetsReceived=e.rtp_video.packetsReceived,a.packetsLost=e.rtp_video.packetsLost,a.frameRateReceived=e.rtp_video.frameRateReceived),a.packetsLossFractionReceived=e.rtp_video.fractionLost,_.Base.Utils.isDefined(e.rtp_video)&&(r.packetsLost=e.rtp_video.packetsLost,r.bytesSent=T,r.packetsSent=e.rtp_video.packetsSent,r.frameRateSent=e.rtp_video.frameRateSent),r.packetsLossFractionTransmitted=T,{audioStatistics:t,videoStatistics:new _.Services.Call.VideoDetails(r.bytesSent,a.bytesReceived,r.actualBitRateTransmitted,a.actualBitRateReceived,r.packetsSent,a.packetsReceived,r.packetsLost,a.packetsLost,r.packetsLossFractionTransmitted,a.packetsLossFractionReceived,r.frameRateSent,a.frameRateReceived)}},e.prototype._ringbackToneURLsChangedHandler=function(e){this._calls&&this._triggerCallbacksAsync(this._calls._onRingbackToneURLsChangedCallback,e)},e.prototype._answerCallRequestedHandler=function(e){this._triggerCallbacksAsync(e._answerCallRequestedCallbacks,e)},e.prototype._terminateCallRequestedHandler=function(e){this._triggerCallbacksAsync(e._terminateCallRequestedCallbacks,e)},e.prototype._updateCallRequestedHandler=function(e,t){this._triggerCallbacksAsync(e._updateCallRequestedCallbacks,e,t)},e.prototype._makeCallRequestedHandler=function(e,t,i,a,r){r=this._callManager.createMakeCall(this,e,t,i,a,r);this._callProvider.registerIncomingOrRemoteCall(r),this.trigger(_.Providers.Interfaces.CallServiceCallbackIds.MAKE_CALL_REQUESTED,[r])},e.prototype._callMediaFailedHandler=function(e){e._setState(_.Services.Call.CallStates.FAILED),this._triggerCallbacksAsync(e._mediaFailedCallbacks,e)},e.prototype._isMakeCallAllowed=function(e){return!!(e._isDataOnly()||this._isCollabCall(e)||this._isWebRTCSupportedBrowser()&&this._config.mediaConfiguration.mediaEngineEnabled)},e.prototype._isCollabCallCapable=function(e){var t=e.getVideoChannels(),e=e.getAudioChannel(),e=!!e&&e.getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE,t=!t||0===t.length||t[0].getRequestedDirection()===_.Services.Call.MediaDirection.DISABLE;return e&&t},e.prototype._isCollabCall=function(e){return this.isWebCollaborationEnabled(e)&&this._isCollabCallCapable(e)},e.prototype._isWebRTCSupportedBrowser=function(){var e=_.Base.Utils.queryJSONObject(this._config,"sgConfiguration._disableWebRTCForTheseBrowsers"),e=_.Base.Utils.isWebRTC_SupportedBrowser(e);return this._callProvider.isNailedUpVideoConnectionRequired()?e&&this._callProvider.isServerSupportsNailedUpVideoConnection():e},e.prototype._createEndCallEvent=function(e,t){var i;if(e)if(t&&t.getCause()){if(i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_DISCONNECTED_UNKNOWN_REASON,t.getProtocol(),t.getCause(),t.getText()),"avaya-action"===t.getProtocol())switch(t.getCause()){case 200:i._setReason(_.Services.Call.CallEndReason.DISCONNECTED_BY_CONFERENCE_MODERATOR);break;case 201:i._setReason(_.Services.Call.CallEndReason.CONFERENCE_TERMINATED);break;case 202:i._setReason(_.Services.Call.CallEndReason.CALL_DISCONNECTED);break;case 450:i._setReason(_.Services.Call.CallEndReason.DTLS_FAILURE);break;case 451:i._setReason(_.Services.Call.CallEndReason.ICE_FAILURE)}}else i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_DISCONNECTED);else i=new _.Services.Call.CallEndEvent(_.Services.Call.CallEndReason.CALL_ENDED_LOCALLY);return i},e.prototype.uploadLogs=function(){if(this._config.mediaServiceContext){if(this._uploadLoggerProvider){this._uploadIntervalTimer&&clearInterval(this._uploadIntervalTimer);var e=function(){return this._remoteLoggerProvider.uploadLogs(_.Providers.RemoteLogger.Names.MPAAS).fail(function(e){_.Base.Logger.error("Failed to upload logs",e)})}.bind(this);return this._uploadIntervalTimer=setInterval(function(){e()},72e5),e()}return _.Base.Logger.error("Uninitialized remote logger provider"),E.Deferred().reject("Uninitialized remote logger provider").promise()}},e.prototype.isRegistrationTerminated=function(){return this._isRegistrationTerminated},e.prototype.setOnNetworkEvents=function(e,t){return this._callProvider.setOnNetworkEvents(e,t)},e.prototype.isNetworkEventsUrlDefined=function(){return this._callProvider.isNetworkEventsUrlDefined()},e.prototype.removeOnNetworkEvents=function(){return this._callProvider.removeOnNetworkEvents()},e.prototype.isMediaConnected=function(e){return this._callProvider.isMediaConnected(e)},e.prototype.updatePreferredResolution=function(e,t){return!1===this._isSupportedResolution(t)?E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.FAILED)).promise():!1===e._call._preferredResolutionCapability.isAllowed?E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise():this._callProvider.updatePreferredResolution(e,t)},e.prototype.setPreferredReceiveResolution=function(e,t,i){return e._preferredReceiveResolutionCapability.isAllowed?0<E.map(_.Base.VideoResolution,function(e,t){return t===i?e:T}).length?this._callProvider.setPreferredReceiveResolution(e,t,i):E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.NOT_FOUND)).promise():E.Deferred().reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)).promise()},e.prototype._isSupportedResolution=function(e){return e in _.Base.VideoResolution},e.prototype._limitedVideoResolutionStoring=function(e){if(!e){if(!this._calls||!this._calls.getCalls().length||!this._callManager.getActiveCall()&&!this._callManager.getEndingCall())return;e=this._callManager.getActiveCall()||this._callManager.getEndingCall()}var t,i,a,r;this.getServerSentPreferredResolution(e)||(r=new _.Base.VideoResolutionDetails,t=this.getVideoResolution(e)&&r.convertToConfigVideoResolution(this.getVideoResolution(e)),i=this.getVideoSendResolution(e)&&r.convertToConfigVideoResolution(this.getVideoSendResolution(e)),a=_.Base.Utils,0<(r=e.getVideoChannels()).length&&((r=r[0].getPreferredResolution())&&a.toNumber(a.cutNumberFromString(r))<a.toNumber(a.cutNumberFromString(i))&&(i=r)),this.isEnoughCallMinutesPassed(e,10)&&i&&a.toNumber(a.cutNumberFromString(i))<=a.toNumber(a.cutNumberFromString(t))&&this._setVideoResolutionToLocalStorage(t,i))},e.prototype.isEnoughCallMinutesPassed=function(e,t){var i=e.getEstablishedTime(),e=new Date;return t<=Math.round((e-i)%864e5%36e5/6e4)},e.prototype._setVideoResolutionToLocalStorage=function(t,e){var i=_.Base.Storage,a=i.get(i.TYPES.LOCAL,i.KEYS.VIDEO_RESOLUTIONS),r=(a=!Array.isArray(a)?[]:a).find(function(e){return e.negotiate===t});r&&Array.isArray(r.limited)||(r={negotiate:t,limited:[]}),Array.isArray(r.limited)&&5<=r.limited.length&&r.limited.shift(),r.limited.push(e);e=a.findIndex(function(e){return e.negotiate===t});-1<e?a[e]=r:a.push(r),i.set(i.TYPES.LOCAL,i.KEYS.VIDEO_RESOLUTIONS,a)},e.prototype._getAverageLimitedResolution=function(e){var i=_.Base.Utils.getAverageValueFromArray(e),e=Object.keys(_.Base.VideoResolution).reduce(function(e,t){return"number"!=typeof e&&(e=_.Base.Utils.toNumber(_.Base.Utils.cutNumberFromString(e))),"number"!=typeof t&&(t=_.Base.Utils.toNumber(_.Base.Utils.cutNumberFromString(t))),Math.abs(t-i)!==Math.abs(e-i)&&Math.abs(t-i)<Math.abs(e-i)?t:e});return _.Base.VideoResolution["resolution"+e+"p"]},e.prototype.setNoiseReduction=function(e,t){var i=E.Deferred();return e.getSetNoiseReductionCapability().isAllowed?(e._noiseReductionSetting=t,i.resolve()):i.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),i.promise()},e.prototype.setBackgroundBlur=function(e,t){if(e.getSetBackgroundBlurCapability().isAllowed){t&&(e._backgroundImage=T),e._backgroundBlur=t,e.getSetBackgroundBlurCapability()._recalculate(),e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING);return this._callProvider.setBackgroundBlur(e,t).always(function(){e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)})}t=E.Deferred();return t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),t.promise()},e.prototype.setBackgroundImage=function(e,t){if(e.getSetBackgroundImageCapability().isAllowed){t&&(e._backgroundBlur=!1),e._backgroundImage=t,e.getSetBackgroundImageCapability()._recalculate(),e.getState()===_.Services.Call.CallStates.ESTABLISHED&&e._setState(_.Services.Call.CallStates.RENEGOTIATING);return this._callProvider.setBackgroundImage(e,t).always(function(){e.getState()===_.Services.Call.CallStates.RENEGOTIATING&&e._setState(_.Services.Call.CallStates.ESTABLISHED)})}t=E.Deferred();return t.reject(new _.Services.Call.CallException(_.Services.Call.CallError.CAPABILITY_NOT_ALLOWED)),t.promise()},e.prototype.getVideoBackgroundCapability=function(){return this._mediaServicesFactory.getMediaServicesService().getVideoInterfaceService().getVideoBackgroundCapability()},e.prototype.getVideoResolutionsTable=function(e){return this._callProvider.getVideoResolutionsTable(e)},e.prototype._nextLowerVideoResolution=function(e,t){return this._callProvider._nextLowerVideoResolution(e,t)},e.prototype._nextHigherVideoResolution=function(e,t){return this._callProvider._nextHigherVideoResolution(e,t)},e.prototype.getServerSentPreferredResolution=function(e){return this._callProvider.getServerSentPreferredResolution(e)},_.Services.Call.CallService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.CallStates={FAR_END_RENEGOTIATING:"far_end_renegotiating",IDLE:"idle",IGNORED:"ignored",INITIATING:"initiating",REMOTE_ALERTING:"remote_alerting",RENEGOTIATING:"renegotiating",FAILED:"failed",ALERTING:"alerting",HELD:"held",ENDED:"ended",ENDING:"ending",HOLDING:"holding",UNHOLDING:"unholding",ESTABLISHED:"established",BEING_TRANSFERRED:"being_transferred",TRANSFERRING:"transferring"}}(),function(){"use strict";AvayaClientServices.Services.Call.CallType={CallTypeDefaultRegisteredService:"DefaultRegisteredService",CallTypeHttpMeetMe:"HttpMeetMe"}}(),function(n){"use strict";function e(e,t,i,a,r,s){-1===t.indexOf(e.getState())?n.Base.Capability.call(this,n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE):n.Base.Capability.call(this,n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._call=e,this._validCallStates=t,this._mediaPreservedAllowed=i,this._validForRemote=a,this._validForLocal=r,this._validForBrowsers=s,e._addOnCallStateChangedCallback(this._recalculate.bind(this)),e.addOnCallServiceAvailableCallback(this._recalculate.bind(this)),e.addOnCallServiceUnavailableCallback(this._recalculate.bind(this)),e.addOnCallJoinedCallback(this._recalculate.bind(this))}(e.prototype=Object.create(n.Base.Capability.prototype))._recalculateDenialReason=function(){var e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return-1===this._validCallStates.indexOf(this._call.getState())||!this._mediaPreservedAllowed&&!this._call.isServiceAvailable()&&this._call.getState()!==n.Services.Call.CallStates.IDLE?e=n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE:this._call.isRemote()&&!this._validForRemote?e=n.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_REMOTE:this._call.isRemote()||this._validForLocal?this._isSupportedBrowser()?this._call._isDataOnly()&&(e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):e=n.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED:e=n.Base.CapabilityDenialReason.CAPABILITY_CALL_IS_NOT_REMOTE,e},e.prototype._recalculate=function(){var e=this._recalculateDenialReason(),t=e===n.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;this._updateIfChanged(t,e)},e.prototype._isSupportedBrowser=function(){var e=n.Base.Utils.getBrowserType();return!this._validForBrowsers||-1!==this._validForBrowsers.indexOf(e)},n.Services.Call.Capabilities.AbstractCallStateCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!a.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE;return e=t&&!i?a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:e},a.Services.Call.Capabilities.AbstractMicrophoneCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){r.Base.Capability.call(this,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._callService=e}(e.prototype=Object.create(r.Base.Capability.prototype))._recalculate=function(){var e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=!0,i=this._callService.isServiceAvailable(),a=this._callService.isNetworkEventsUrlDefined();i&&a||(t=!1,e=r.Services.Call.CallError.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.AbstractNetworkEventsCapability=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i,a,r,s,n){this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallHeldRemotelyCallback(this._recalculate.bind(this)),e.addOnCallUnheldRemotelyCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),o.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,a,r,s,n)}(e.prototype=Object.create(o.Services.Call.Capabilities.AbstractCallStateCapability.prototype)).isAllowedNailedUpVideoMode=function(e){var t=this._call._getAllowedNailedUpVideoModes();return!(0<t.length)||t.includes(e)},e.prototype._recalculate=function(){var e=o.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=this._call._conference,i=i?i._allowVideoDirection:T;t&&this._call._getIsContentVideoSharingStarted()&&(t=!1,e=o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),t&&o.Base.Utils.isDefined(i)&&o.Base.Utils.isDefined(this._allowVideoDirections)&&(e=-1<this._allowVideoDirections.indexOf(i)?(t=!0,o.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED):(t=!1,o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED));i=this._isDirectionAllowed();!t||!this._call.isHeldRemotely()&&this._videoCapability.isAllowed&&i||(t=!1,e=this._videoCapability.isAllowed?o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason);i=!o.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==o.Services.Call.MediaDirection.DISABLE;t&&!i&&(t=!1,e=o.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},o.Services.Call.Capabilities.AbstractUpdateVideoModeCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){var i=[a.Services.Call.CallStates.INITIATING,a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ESTABLISHED,a.Services.Call.CallStates.HELD,a.Services.Call.CallStates.HOLDING,a.Services.Call.CallStates.UNHOLDING,a.Services.Call.CallStates.RENEGOTIATING,a.Services.Call.CallStates.FAR_END_RENEGOTIATING,a.Services.Call.CallStates.REMOTE_ALERTING];this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!0,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._denyDataOnlyConference=function(e,t){e&&this._call._isDataOnly()&&(e=!1,a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},e.prototype._recalculateDenialReason=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return this._denyDataOnlyConference(t,e),this._updateIfChanged(t,e),e},a.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractMicrophoneCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractMicrophoneCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractMicrophoneCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&this._call.isMicrophoneDisabled()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.DisableMicrophoneCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Services.Call.Capabilities.AbstractMicrophoneCapability.call(this,e)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractMicrophoneCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractMicrophoneCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&!this._call.isMicrophoneDisabled()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.EnableMicrophoneCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.ESTABLISHED],i=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0,i)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.HoldCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.ESTABLISHED,r.Services.Call.CallStates.HELD];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!0,!1)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.JoinCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;!t||this._call._videoMuteState!==i.Services.Call.MediaMuteStates.MUTED&&this._call._videoMuteState!==i.Services.Call.MediaMuteStates.MUTING||(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.MuteVideoCapability=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,e)}e.prototype=Object.create(t.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),t.Services.Call.Capabilities.RemoveOnNetworkEventsCapability=e}(AvayaClientServices),function(s){"use strict";function e(e){var t=[s.Services.Call.CallStates.ESTABLISHED,s.Services.Call.CallStates.RENEGOTIATING,s.Services.Call.CallStates.FAR_END_RENEGOTIATING],i=[s.Base.BrowserType.CHROME,s.Base.BrowserType.FIREFOX];s.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0,i)}(e.prototype=Object.create(s.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(e){var t=s.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),i=t===s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,a=!s.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==s.Services.Call.MediaDirection.DISABLE,r=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==s.Services.Call.MediaDirection.DISABLE;!i&&e&&this._call.getState()===s.Services.Call.CallStates.REMOTE_ALERTING&&(i=!0,t=s.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),!i||a||r||(i=!1,t=s.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(i,t)},s.Services.Call.Capabilities.SendDTMFCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){i.Base.Capability.call(this,i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._call=e}(e.prototype=Object.create(i.Base.Capability.prototype))._recalculate=function(){var e=!1,t=i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED;this._isSupportedByBrowser()&&this._isSupportedByCallType()&&(e=!0,t=i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._updateIfChanged(e,t)},e.prototype._isSupportedByBrowser=function(){var e=i.Base.Utils.getBrowserType();return e!==i.Base.BrowserType.IE&&e!==i.Base.BrowserType.EDGE},e.prototype._isSupportedByCallType=function(){return!1===this._call._isDataOnly()},i.Services.Call.Capabilities.ServiceQualityScoreCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.INITIATING,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED,r.Services.Call.CallStates.HELD],a=[r.Base.BrowserType.CHROME];this._callService=t,r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!1,!1,!0,a),this._recalculate()}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this);return e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED&&(this._call.isBackgroundBlur()||(e=this._callService.getVideoBackgroundCapability().denialReason)),e},r.Services.Call.Capabilities.SetBackgroundBlurCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE],i=[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!0,!1,!0,i)}e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype),a.Services.Call.Capabilities.SetNoiseReductionCapability=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Call.Capabilities.AbstractNetworkEventsCapability.call(this,e)}e.prototype=Object.create(t.Services.Call.Capabilities.AbstractNetworkEventsCapability.prototype),t.Services.Call.Capabilities.SetOnNetworkEventsCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){var t=[i.Services.Call.CallStates.ESTABLISHED,i.Services.Call.CallStates.HELD];e.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),i.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&(this._call.isConference()||i.Base.Utils.isDefined(this._call._sessionId))&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===t&&!1===this._isAllowedByProvider()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},e.prototype._isAllowedByProvider=function(){if(this._call._callCreationInfo===T||typeof this._call._callCreationInfo.getServiceGatewayURL!=typeof Function.prototype)return!0;var e=this._call._callCreationInfo.getServiceGatewayURL();if(e===T)return!0;e=i.Base.Utils.parseUrl(e),e=i.Base.Utils.getHost(e),e=this._call._callService._callProvider._csgwProviderFactory.getCSGCallsProvider(e);return null===e||e.isAllowedToTransfer(this._call.getCallId())},i.Services.Call.Capabilities.TransferCapability=e}(AvayaClientServices),function(i){"use strict";function e(e){var t=[i.Services.Call.CallStates.ESTABLISHED,i.Services.Call.CallStates.HELD];e.addOnCallConferenceStatusChangedCallback(function(){this._recalculate()}.bind(this)),i.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;t&&(this._call.isConference()||i.Base.Utils.isDefined(this._call._sessionId))&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),!0===t&&!1===this._isAllowedByProvider()&&(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},e.prototype._isAllowedByProvider=i.Services.Call.Capabilities.TransferCapability.prototype._isAllowedByProvider,i.Services.Call.Capabilities.TransferToCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){var t=[r.Services.Call.CallStates.HELD],i=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0,i)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||i||a||(t=!1,e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.UnholdCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype))._recalculate=function(){var e=i.Services.Call.Capabilities.AbstractVideoMuteUnmuteCapability.prototype._recalculateDenialReason.call(this),t=e===i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;!t||this._call._videoMuteState!==i.Services.Call.MediaMuteStates.UNMUTED&&this._call._videoMuteState!==i.Services.Call.MediaMuteStates.UNMUTING||(t=!1,e=i.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._updateIfChanged(t,e)},i.Services.Call.Capabilities.UnmuteVideoCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=a.Base.Utils.isDefined(this._call._callCreationInfo)&&a.Base.Utils.isDefined(this._call._callCreationInfo.getUccpURL());!t||a.Base.Utils.isDefined(this._call._sessionId)||i||(t=!1,e=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},a.Services.Call.Capabilities.UpdateAudioModeCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this)),e.addOnCallEstablishedCallback(this._recalculate.bind(this)),r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculateDenialReason=function(){var e,t=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),i=t===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED;return i&&(this._videoCapability.isAllowed?0<(e=this._call.getVideoChannels()).length&&(e[0].getNegotiatedDirection()===r.Services.Call.MediaDirection.SEND_RECV||e[0].getNegotiatedDirection()===r.Services.Call.MediaDirection.RECV_ONLY)||(i=!1,t=r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED):(i=!1,t=this._videoCapability.denialReason)),this._updateIfChanged(i,t),t},r.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.call(this,e,t)}(e.prototype=Object.create(i.Services.Call.Capabilities.UpdatePreferredReceiveResolutionCapability.prototype))._save=function(e,t){return this._updateIfChanged(e,t),t},e.prototype._recalculateDenialReason=function(){if(i.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this)!==i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)return this._save(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED);if(!0!==this._videoCapability.isAllowed)return this._save(!1,this._videoCapability.denialReason);var e=this._call.getVideoChannels();if(0<e.length&&~[i.Services.Call.MediaDirection.RECV_ONLY,i.Services.Call.MediaDirection.SEND_RECV,i.Services.Call.MediaDirection.SEND_ONLY].indexOf(e[0].getNegotiatedDirection()))return this._save(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED);return this._save(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED)},i.Services.Call.Capabilities.UpdatePreferredResolutionCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){this._videoCapability=t,this._videoCapability.addOnChangedCallback(this._recalculate.bind(this));t=[r.Services.Call.CallStates.ESTABLISHED];r.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=r.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=!r.Base.Utils.isDefined(this._call.getAudioChannel())||this._call.getAudioChannel()._getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,a=0!==this._call.getVideoChannels().length&&this._call.getVideoChannels()[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE;!t||!this._call._isDataOnly()&&this._videoCapability.isAllowed&&(i||a)||(t=!1,e=this._call._isDataOnly()?r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED:this._videoCapability.denialReason),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.UpdateVideoChannelsCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.IGNORED,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI,r.Base.BrowserType.IE];r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=0<e.length&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.INACTIVE&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.DISABLE,e=r.Base.Utils.getBrowserType()===r.Base.BrowserType.SAFARI;return t&&!(e&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(r.Services.Call.VideoMode.DISABLE)},r.Services.Call.Capabilities.UpdateVideoModeDisableCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.SEND_ONLY,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY,a.Services.Conference.AllowVideoDirection.INACTIVE];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels();return 0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.INACTIVE&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.DISABLE&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.INACTIVE)},a.Services.Call.Capabilities.UpdateVideoModeInactiveCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE,a.Services.Conference.AllowVideoDirection.RECEIVE_ONLY];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels();return(0===e.length&&this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED||0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.RECV_ONLY)&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.RECEIVE_ONLY)},a.Services.Call.Capabilities.UpdateVideoModeReceiveOnlyCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t){this._allowVideoDirections=[r.Services.Conference.AllowVideoDirection.SEND_RECEIVE,r.Services.Conference.AllowVideoDirection.SEND_ONLY];var i=[r.Services.Call.CallStates.IDLE,r.Services.Call.CallStates.IGNORED,r.Services.Call.CallStates.ALERTING,r.Services.Call.CallStates.ESTABLISHED],a=[r.Base.BrowserType.CHROME,r.Base.BrowserType.FIREFOX,r.Base.BrowserType.EDGE,r.Base.BrowserType.SAFARI];r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0,a)}(e.prototype=Object.create(r.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=0===e.length&&this._call.getState()!==r.Services.Call.CallStates.ESTABLISHED||0<e.length&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.SEND_ONLY&&e[0].getNegotiatedDirection()!==r.Services.Call.MediaDirection.RECV_ONLY,e=r.Base.Utils.getBrowserType()===r.Base.BrowserType.SAFARI;return t&&!(e&&this._call.getEstablishedTime())&&this.isAllowedNailedUpVideoMode(r.Services.Call.VideoMode.SEND_ONLY)},r.Services.Call.Capabilities.UpdateVideoModeSendOnlyCapability=e}(AvayaClientServices),function(a){"use strict";function e(e,t){this._allowVideoDirections=[a.Services.Conference.AllowVideoDirection.SEND_RECEIVE];var i=[a.Services.Call.CallStates.IDLE,a.Services.Call.CallStates.IGNORED,a.Services.Call.CallStates.ALERTING,a.Services.Call.CallStates.ESTABLISHED];a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.call(this,e,t,i,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractUpdateVideoModeCapability.prototype))._isDirectionAllowed=function(){var e=this._call.getVideoChannels(),t=-1!==[a.Base.BrowserType.CHROME,a.Base.BrowserType.FIREFOX,a.Base.BrowserType.EDGE,a.Base.BrowserType.SAFARI].indexOf(a.Base.Utils.getBrowserType()),i=0===e.length&&(t||this._call.getState()!==a.Services.Call.CallStates.ESTABLISHED)||0<e.length&&e[0].getNegotiatedDirection()!==a.Services.Call.MediaDirection.SEND_RECV,t=!1;return a.Base.Utils.getBrowserType()===a.Base.BrowserType.SAFARI&&0!==e.length&&(t=e[0].getNegotiatedDirection()===a.Services.Call.MediaDirection.SEND_ONLY&&this._call.getEstablishedTime()),i&&!t&&this.isAllowedNailedUpVideoMode(a.Services.Call.VideoMode.SEND_RECEIVE)},a.Services.Call.Capabilities.UpdateVideoModeSendReceiveCapability=e}(AvayaClientServices),function(a){"use strict";function e(e){var t=[a.Services.Call.CallStates.IDLE];a.Services.Call.Capabilities.AbstractCallStateCapability.call(this,e,t,!1,!1,!0)}(e.prototype=Object.create(a.Services.Call.Capabilities.AbstractCallStateCapability.prototype))._recalculate=function(){var e=a.Services.Call.Capabilities.AbstractCallStateCapability.prototype._recalculateDenialReason.call(this),t=e===a.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,i=this._call._callService._config&&this._call._callService._config.wcsConfiguration&&this._call._callService._config.wcsConfiguration.enabled;t&&!i&&(t=!1,e=a.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED),this._updateIfChanged(t,e)},a.Services.Call.Capabilities.UpdateWebCollaborationCapability=e}(AvayaClientServices),function(r){"use strict";function e(e){r.Base.Capability.call(this,r.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._calls=e}(e.prototype=Object.create(r.Base.Capability.prototype))._recalculate=function(){var e=r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED,t=!0,i=this._calls._isWebRTCSupportedBrowser(),a=this._calls._isRegistrationTerminated();this._calls._isAvailable&&i&&!a||(t=!1,e=a?r.Services.Call.CallError.REGISTRATION_TERMINATED:i?r.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE:r.Services.Call.CallError.WEBRTC_NOT_SUPPORTED),this._updateIfChanged(t,e)},r.Services.Call.Capabilities.VoipCallingCapability=e}(AvayaClientServices),function(r){"use strict";function e(e,t,i,a){this._token=e,this._isOTT=!!r.Base.Utils.isDefined(t)&&t,this._meetingId=r.Base.Utils.isDefined(i)?i:null,this._passcode=r.Base.Utils.isDefined(a)?a:null}e.prototype={getToken:function(){return this._token},setToken:function(e){this._token=e},isOTT:function(){return this._isOTT},enableOTT:function(e){this._isOTT=e,this._isWebRTCAbleConf=this._isOTT},getMeetingId:function(){return this._meetingId},setMeetingId:function(e){this._meetingId=e},getPasscode:function(){return this._passcode},setPasscode:function(e){this._passcode=e}},r.Services.Call.ConferenceEntryOptions=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.DTMFTone={A:"A",B:"B",C:"C",D:"D",STAR:"*",POUND:"#",ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,ZERO:0}}(),function(t){"use strict";var e={RECV_ONLY:"recvonly",SEND_ONLY:"sendonly",SEND_RECV:"sendrecv",INACTIVE:"inactive",DISABLE:"disable",UNDEFINED:"undefined",_isDisabled:function(e){return e===t.Services.Call.MediaDirection.DISABLE||e===t.Services.Call.MediaDirection.UNDEFINED}};t.Services.Call.MediaDirection=e}(AvayaClientServices),function(e){"use strict";e.Services.Call.MediaMuteStates={UNDEFINED:0,MUTED:1,UNMUTED:2,MUTING:3,UNMUTING:4},e.Services.Call.MicrophoneStates={ENABLED:0,DISABLED:1}}(AvayaClientServices),function(e){"use strict";function t(e,t){this.call=e,this.id=t}t.prototype.startCall=function(e){},t.prototype.endCall=function(e){},e.Services.Call.Modes.AbstractCallMode=t}(AvayaClientServices),function(r){"use strict";function e(e,t,i){r.Services.Call.Modes.AbstractCallMode.call(this,e,t),this._contactsIntegrationService=i}(e.prototype=Object.create(r.Services.Call.Modes.AbstractCallMode.prototype)).startCall=function(e){if(this._createDataOnlyConference(e),r.Base.Utils.isDefined(e._callCreationInfo)&&r.Base.Utils.isDefined(e._callCreationInfo.getUccpURL())){var t=e._callCreationInfo.getUccpURL(),i=e._callService._parseUccpUrl(t);if(!r.Base.Utils.isDefined(i))return r.Base.Logger.error(r.Base.LoggerTags.CALL_SERVICE,"Failed to parse UCCP url: "+t),void e._callService._notifyCallFailure(e,r.Services.Call.CallError.SERVICE_TEMPORARILY_UNAVAILABLE);e._onCallStartedCallbacks.fire(e),e._onCallEstablishedCallbacks.fire(e),e._conference._setConfiguration(i)}e._callService.createCollaborationForConference(e),e._onCallConferenceStatusChangedCallbacks.fire(e,!0,t)},e.prototype.endCall=function(e){e.getConference()._conferenceService.sendDisconnectEvent(),e.getConference().stop(),e._setState(r.Services.Call.CallStates.ENDED);var t=new r.Services.Call.CallEndEvent(r.Services.Call.CallEndReason.CALL_DISCONNECTED);e._onCallEndedCallbacks.fire(e,t),e._callService._callManager.deleteCall(e)},e.prototype._createDataOnlyConference=function(e){var t=e._callService.getScopiaConferenceProvider(),i=e._callService.createChatService(t),a=e._callService.createParticipantService(t),i=new r.Services.Conference.Chat(i),t=new r.Services.Conference.ConferenceService(r.Services.Conference.ConferenceType.SCOPIA_CONFERENCE,t,this._contactsIntegrationService);e._setConference(new r.Services.Conference.Conference(t,a,i)),e._conference._isUccpConference=!0;i=e._callCreationInfo.getPasscode();e._conference._setPreEnteredPasscode(i)},r.Services.Call.Modes.ConferenceCallMode=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.NoiseReductionSetting={ENABLED:"ENABLED",DISABLE_CLIENT:"DISABLE_CLIENT",PREFER_CLIENT:"PREFER_CLIENT",DISABLE_ALL:"DISABLE_ALL"}}(),function(e){"use strict";function t(){this.ringback=T,this.intercept=T,this.reorder=T,this.fastBusy=T}t.prototype._setRingbackToneUrl=function(e){this.ringback=e},t.prototype.getRingbackToneUrl=function(){return this.ringback},t.prototype._setInterceptToneUrl=function(e){this.intercept=e},t.prototype.getInterceptToneUrl=function(){return this.intercept},t.prototype._setReorderToneUrl=function(e){this.reorder=e},t.prototype.getReorderToneUrl=function(){return this.reorder},t.prototype._setFastBusyToneUrl=function(e){this.fastBusy=e},t.prototype.getFastBusyToneUrl=function(){return this.fastBusy},e.Services.Call.RingbackToneURLs=t}(AvayaClientServices),function(t){"use strict";var i=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,max:3},{score:t.Base.AbsoluteCategoryRating.GOOD,max:7},{score:t.Base.AbsoluteCategoryRating.FAIR,max:10},{score:t.Base.AbsoluteCategoryRating.POOR,max:15},{score:t.Base.AbsoluteCategoryRating.BAD}],a=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,max:1},{score:t.Base.AbsoluteCategoryRating.GOOD,max:3},{score:t.Base.AbsoluteCategoryRating.FAIR,max:5},{score:t.Base.AbsoluteCategoryRating.POOR,max:10},{score:t.Base.AbsoluteCategoryRating.BAD}],r=[{score:t.Base.AbsoluteCategoryRating.EXCELLENT,min:95},{score:t.Base.AbsoluteCategoryRating.GOOD,min:75},{score:t.Base.AbsoluteCategoryRating.FAIR,min:50},{score:t.Base.AbsoluteCategoryRating.POOR,min:25},{score:t.Base.AbsoluteCategoryRating.BAD}];function e(e){this._call=e,this._bound=!1,this._score=T,this._onScoreChangedCallbacks=E.Callbacks(),this._updateScoreInterval=T,this._previousAudioReport=T,this._previousVideoReport=T,this._previousTimestamp=T,this._allowedStates=[t.Services.Call.CallStates.ESTABLISHED,t.Services.Call.CallStates.RENEGOTIATING,t.Services.Call.CallStates.FAR_END_RENEGOTIATING],this._allowedIncomingVideoModes=[t.Services.Call.MediaDirection.SEND_RECV,t.Services.Call.MediaDirection.RECV_ONLY],this._allowedOutgoingVideoModes=[t.Services.Call.MediaDirection.SEND_RECV,t.Services.Call.MediaDirection.SEND_ONLY]}e.prototype.watch=function(){return this._canBeBound()&&(this._call.addOnCallStartedCallback(this._start.bind(this)),this._call.addOnCallEstablishedCallback(this._start.bind(this)),this._call.addOnCallHeldCallback(this._stop.bind(this)),this._call.addOnCallUnheldCallback(this._start.bind(this)),this._call.addOnCallEndedCallback(this._stop.bind(this)),this._bound=!0),this._bound},e.prototype.getScore=function(){return this._score},e.prototype.addOnScoreChangedCallback=function(e){this._onScoreChangedCallbacks.add(e)},e.prototype.removeOnScoreChangedCallback=function(e){this._onScoreChangedCallbacks.remove(e)},e.prototype._canBeBound=function(){return!0===this._call.getServiceQualityScoreCapability().isAllowed&&!1===this._bound},e.prototype._start=function(){var e=E.Deferred();e.then(function(){t.Base.Utils.isUndefined(this._updateScoreInterval)&&(this._updateScoreInterval=setInterval(this._updateScore.bind(this),5e3))}.bind(this)),this._updateScore(e)},e.prototype._stop=function(){clearInterval(this._updateScoreInterval),this._updateScoreInterval=T,this._previousAudioReport=T,this._previousVideoReport=T,this._previousTimestamp=T,this._setScore(T)},e.prototype._updateScore=function(e){this._call._callService._getCallStatistics(this._call).then(function(e){var t=Date.now(),i=this._getScoreForAudio(e.audioStatistics,t),e=this._getScoreForVideo(e.videoStatistics,t);this._previousTimestamp=t,this._setScore(this._getTotalScore(i,e))}.bind(this)).always(function(){e!==T&&e.resolve()})},e.prototype._getScoreForAudio=function(e){var t=this._getPacketLossScore(e,this._previousAudioReport,i);return this._previousAudioReport=e,t},e.prototype._getScoreForVideo=function(e,t){var i=this._getPacketLossScore(e,this._previousVideoReport,a),t=this._getBitrateScore(e,this._previousVideoReport,r,t),t=this._getTotalScore(i,t);return this._previousVideoReport=e,t},e.prototype._getPacketLossScore=function(e,t,i){var a=this._getIncomingLosses(e,t),t=this._getOutgoingLosses(e,t);return a===T&&t===T?T:a===T?this._packetLossToScore(t,i):t===T?this._packetLossToScore(a,i):this._packetLossToScore(Math.max(a,t),i)},e.prototype._getBitrateScore=function(e,t,i,a){var r=this._getIncomingBitrate(e,t,a),a=this._getOutgoingBitrate(e,t,a);return r===T&&a===T?T:r===T?this._bitrateRatioToScore(a,i):a===T?this._bitrateRatioToScore(r,i):this._bitrateRatioToScore(Math.min(r,a),i)},e.prototype._getIncomingLosses=function(e,t){var i,a;return t!==T&&(i=t.packetsReceived,a=t.packetLossTotalReceived),this._getLosses(e.packetsReceived,e.packetLossTotalReceived,i,a)},e.prototype._getOutgoingLosses=function(e,t){var i,a;return t!==T&&(i=t.packetsTransmitted,a=t.packetLossTotalTransmitted),this._getLosses(e.packetsTransmitted,e.packetLossTotalTransmitted,i,a)},e.prototype._getLosses=function(e,t,i,a){return t===T||0===t?t:t===a?0:("number"==typeof i&&"number"==typeof a&&(e-=i,t-=a),t/e*100)},e.prototype._packetLossToScore=function(e,t){for(var i=0;i<t.length;++i)if(t[i].max===T||e<=t[i].max)return t[i].score;return T},e.prototype._getOutgoingBitrate=function(e,t,i){var a;return this._isOutgoingVideoActive()?(i=e.availableTransmitBitrate!==T?(a=this._getAvailableOutgoingBitrate(e),this._getExpectedVideoBitrate()):(a=this._getBitrateTrasmitted(e,t,i),this._getExpectedVideoSendBitrate()),a===T||i===T?T:this._getBitrateRatio(a,i)):T},e.prototype._getIncomingBitrate=function(e,t,i){if(!this._isIncomingVideoActive())return T;if(!this._call.isMediaConnected())return 0;var a=this._getExpectedVideoBitrate();return(i=e.availableReceiveBitrate!==T?this._getAvailableIncomingBitrate(e):this._getBitrateReceived(e,t,i))===T||a===T||0<(a=this._getBitrateRatio(i,a))&&a<=10?T:a},e.prototype._getAvailableOutgoingBitrate=function(e){return e.availableTransmitBitrate},e.prototype._getAvailableIncomingBitrate=function(e){return e.availableReceiveBitrate},e.prototype._getBitrateTrasmitted=function(e,t,i){var a;return t&&(a=t.bytesTransmitted),this._getBitrate(e.bytesTransmitted,a,i)},e.prototype._getBitrateReceived=function(e,t,i){var a;return t&&(a=t.bytesReceived),this._getBitrate(e.bytesReceived,a,i)},e.prototype._getBitrate=function(e,t,i){return e===T||t===T?T:e===t?0:(e-t)/((i-this._previousTimestamp)/1e3)*8},e.prototype._getBitrateRatio=function(e,t){return e===T||t===T?T:e/t*100},e.prototype._bitrateRatioToScore=function(e,t){for(var i=0;i<t.length;++i)if(t[i].min===T||e>=t[i].min)return t[i].score;return T},e.prototype._getExpectedVideoBitrate=function(){var e=this._call._callService.getVideoBandwidth(this._call);return e!==T?1e3*e:T},e.prototype._isVideoActive=function(e,t){var i=this._call.getVideoChannels();if(0<i.length){i=i[0].getNegotiatedDirection();if(-1!==e.indexOf(this._call.getState())&&-1!==t.indexOf(i))return!0}return!1},e.prototype._isIncomingVideoActive=function(){return this._isVideoActive(this._allowedStates,this._allowedIncomingVideoModes)},e.prototype._isOutgoingVideoActive=function(){return this._call._videoMuteState!==t.Services.Call.MediaMuteStates.MUTED&&this._isVideoActive(this._allowedStates,this._allowedOutgoingVideoModes)},e.prototype._getExpectedVideoSendBitrate=function(){var e=this._call._callService.getVideoSendBandwidth(this._call);return e!==T?1e3*e:T},e.prototype._getTotalScore=function(e,t){return e===T&&t===T?T:e===T?t:t===T?e:Math.min(e,t)},e.prototype._setScore=function(e){this._score!==e&&(this._score=e,this._onScoreChangedCallbacks.fire(e))},t.Services.Call.ServiceQuality=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.TransferProgressCode={ACCEPTED:"ACCEPTED",NONE:"NONE",REMOTE_CALL_ESTABLISHED:"REMOTE_CALL_ESTABLISHED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",REMOTE_CALL_STARTED:"REMOTE_CALL_STARTED",STARTED:"STARTED"}}(),function(){"use strict";function e(e,t,i){this._ucid=e,this._parentUcid=t,this._contextId=i}e.prototype={getUCID:function(){return this._ucid},getParentUCID:function(){return this._parentUcid},getContextId:function(){return this._contextId},setContextId:function(e){this._contextId=e},_setUCID:function(e){this._ucid=e},_setParentUCID:function(e){this._parentUcid=e}},AvayaClientServices.Services.Call.UserToUserInfo=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Call.VideoChannelDisabledReason={NONE:"none",DISABLED_BY_LOCAL_USER:"disabledByLocalUser",DISABLED_BY_REMOTE_USER:"disabledByRemoteUser",DISABLED_DUE_TO_CPU_OVERLOAD:"disabledDueToCpuOverload",DISABLED_DUE_TO_INSUFFICIENT_BANDWIDTH:"disabledDueToInsufficientBandwidth",DISABLED_DUE_TO_LOCAL_PLATFORM_LIMITATIONS:"disabledDueToLocalPlatformLimitations",DISABLED_DUE_TO_LOCAL_LAYOUT_SELECTION:"disabledDueToLocalLayoutSelection",DISABLED_DUE_TO_MISSING_H264_PLUGIN:"disabledDueToMissingH264Plugin"}}(),function(){"use strict";(AvayaClientServices||{}).Services.Call.VideoDetails=function(e){this.bytesTransmitted=e.bytesTransmitted,this.bytesReceived=e.bytesReceived,this.actualBitRateTransmitted=e.actualBitRateTransmitted,this.actualBitRateReceived=e.actualBitRateReceived,this.packetsTransmitted=e.packetsTransmitted,this.packetsReceived=e.packetsReceived,this.packetLossTotalTransmitted=e.packetLossTotalTransmitted,this.packetLossTotalReceived=e.packetLossTotalReceived,this.packetsLossFractionTransmitted=e.packetsLossFractionTransmitted,this.packetsLossFractionReceived=e.packetsLossFractionReceived,this.actualFrameRateTransmitted=e.actualFrameRateTransmitted,this.actualFrameRateReceived=e.actualFrameRateReceived,this.codec=e.codec,this.roundTripTimeMillis=e.roundTripTimeMillis,this.heightTransmitted=e.heightTransmitted,this.heightReceived=e.heightReceived,this.widthTransmitted=e.widthTransmitted,this.widthReceived=e.widthReceived,this.firCountTransmitted=e.firCountTransmitted,this.firCountReceived=e.firCountReceived,this.pliCountTransmitted=e.pliCountTransmitted,this.pliCountReceived=e.pliCountReceived,this.framesTransmitted=e.framesTransmitted,this.framesReceived=e.framesReceived,this.nackCountTransmitted=e.nackCountTransmitted,this.nackCountReceived=e.nackCountReceived,this.availableTransmitBitrate=e.availableTransmitBitrate,this.availableReceiveBitrate=e.availableReceiveBitrate,this.jitterMillisecondsReceived=e.jitterMillisecondsReceived,this.framesEncoded=e.framesEncoded,this.framesDecoded=e.framesDecoded,this.totalEncodeTime=e.totalEncodeTime,this.totalDecodeTime=e.totalDecodeTime}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoMode={SEND_RECEIVE:"SEND_RECEIVE",RECEIVE_ONLY:"RECEIVE_ONLY",SEND_ONLY:"SEND_ONLY",INACTIVE:"INACTIVE",DISABLE:"DISABLE"}}(),function(){"use strict";AvayaClientServices.Services.Call.VideoNetworkSignalingType={INDEFINITE:"indefinite",OFF:"off",SUPPORTED:"supported"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="CollaborationError"}e.prototype=Object.create(i.Base.BaseError.prototype),i.Services.Collaboration.CollaborationError=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.CollaborationErrorReason={COLLABORATION_START_FAILURE:"Failed to start collaboration.",COLLABORATION_STOP_FAILURE:"Failed to stop collaboration.",COLLABORATION_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",BROWSER_NOT_SUPPORTED:"Browser is not supported",WHITEBOARD_REMOVE_LAST_SURFACE:"Failed to remove surface. You cannot remove last surface.",WHITEBOARD_REMOVE_SURFACE_FAILED:"Failed to remove surface.",WHITEBOARD_REMOVE_SHAPE_NOT_MINE:"Failed to remove shape. You can only remove shapes that you drew.",WHITEBOARD_ALREADY_ACTIVE:"Failed to start whiteboard surface. Surface is already started.",WHITEBOARD_INACTIVE:"Whiteboard is not started.",WHITEBOARD_UNAVAILABLE:"Whiteboard unavailable.",SHARING_INACTIVE:"Sharing is not started",INTERNAL_ERROR:"An internal error occurred."}}(),function(o){"use strict";function e(e,t,i,a,r){this._userConfig=e,this._providerFactory=t,this._callPerformanceManager=a,this._colaborationsAnalyticsService=i,this._callService=r}e.prototype={create:function(e,t,i,a){a=a||this._userConfig;var r=this._providerFactory.createCollaborationProviders(a)[0],s=this._createCollaborationService(r),n=this._createWhiteboard(r),a=this._createContentSharing(r,a,e,i),e=new o.Services.Collaboration.Slider,i=new o.Services.Collaboration.Collaboration(s,n,a,e,t,i,this._callService);return n._setCollaboration(i),a._setCollaboration(i),i},_createCollaborationService:function(e){return this._identity=T,this._collaborationProviderInitialized=!1,new o.Services.Collaboration.CollaborationService(e,this._colaborationsAnalyticsService)},_createWhiteboard:function(e){e=new o.Services.Collaboration.WhiteboardService(e,this._colaborationsAnalyticsService);return new o.Services.Collaboration.Whiteboard(e)},_createContentSharing:function(e,t,i,a){a=this._createContentSharingService(e,t.collaborationConfiguration,a);return this._callPerformanceManager.setContentSharingService(a),new o.Services.Collaboration.ContentSharing(a,i)},_createContentSharingService:function(e,t,i){(o.Base.Utils.isUndefined(t)||o.Base.Utils.isUndefined(t.contentSharingWorkerPath))&&o.Base.Logger.warn(o.Base.LoggerTags.COLLABORATION_SERVICE,"Web worker path is undefined. Content sharing will not be enabled.");var a=new o.Providers.ContentSharing.ScreenSharingProviderFactory(e,this._callPerformanceManager);return new o.Services.Collaboration.ContentSharingService(e,a.getScreenSharingProvider(t),this._colaborationsAnalyticsService,this._callService,i)}},o.Services.Collaboration.CollaborationFactory=e}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a,r,s){this._x=e,this._y=t,this._width=i,this._height=a,this._bitmapData=s,this._imageType=r}t.prototype={getXOffset:function(){return this._x},getYOffset:function(){return this._y},getRawBitmapData:function(){return this._bitmapData},getBlobData:function(){var e=new Blob([this._bitmapData],{type:"image/"+(0===this._imageType?"jpeg":"png")});return window.URL.createObjectURL(e)},getBase64BitmapData:function(){return"data:image/"+(0===this._imageType?"jpeg":"png")+";base64,"+this._toBase64(this._bitmapData)},getWidth:function(){return this._width},getHeight:function(){return this._height},_toBase64:function(e){for(var t,i="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),s=r.byteLength,e=s%3,n=s-e,o=0;o<n;o+=3)i+=a[(16515072&(t=r[o]<<16|r[o+1]<<8|r[o+2]))>>18]+a[(258048&t)>>12]+a[(4032&t)>>6]+a[63&t];return 1==e?i+=a[(252&(t=r[n]))>>2]+a[(3&t)<<4]+"==":2==e&&(i+=a[(64512&(t=r[n]<<8|r[1+n]))>>10]+a[(1008&t)>>4]+a[(15&t)<<2]+"="),i}},e.Services.Collaboration.Bitmap=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.FeaturesAvailable={LIBRARY:"LIBRARY",POLLING:"POLLING",MINUTES:"MINUTES",WHITEBOARD:"WHITEBOARD",MESSAGES:"MESSAGES",REPORTS:"REPORTS",SCREEN_SHARING:"SCREEN_SHARING",SLIDER:"SLIDER",REMOTE_CONTROL:"REMOTE_CONTROL",VIDEO_SHARING_CONTROL_MESSAGING:"VIDEO_SHARING_CONTROL_MESSAGING"}}(),function(e){"use strict";function t(e,t,i,a){this._keyFrame=a,this._height=t,this._width=e,this._bitmaps=i}t.prototype={getBitmaps:function(){return this._bitmaps},getWidth:function(){return this._width},getHeight:function(){return this._height},isKeyFrame:function(){return this._keyFrame}},e.Services.Collaboration.Frame=t}(AvayaClientServices),function(e){"use strict";function t(e,t){this._x=e,this._y=t}t.prototype={getX:function(){return this._x},getY:function(){return this._y},setX:function(e){this._x=e},setY:function(e){this._y=e}},e.Services.Collaboration.Point=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.SelectionStatus={PENDING:"PENDING",CONFIRMED:"CONFIRMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardLineWidths={SMALL:4,MEDIUM:8,LARGE:12}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardPenMarkerWidths={CUSTOM_STROKE:"CUSTOM_STROKE"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTextSizes={SMALL:19,MEDIUM:23,LARGE:27}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolModes={STROKE:"STROKE",FILLED:"FILLED",CUSTOM_STROKE:"CUSTOM_STROKE"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardToolTypes={SELECTION:"SELECTION",RECTANGLE:"RECTANGLE",CIRCLE:"CIRCLE",MARKER:"MARKER",PEN:"PEN",LINE:"LINE",STAMP:"STAMP",TEXT:"TEXT",DELETE:"DELETE",CLEAR:"CLEAR"}}(),function(e){"use strict";e.Services.Collaboration.ContentSharingButtonEventType={NONE:0,PRESSED:1,RELEASED:2,CLICKED:3,DOUBLE_CLICKED:4};e.Services.Collaboration.ContentSharingButtonPressedType={NONE:0,LEFT:1,RIGHT:2,MIDDLE:3}}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r){this._collaborationProvider=e,this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,this._sharingState=n.Services.Collaboration.ContentSharingState.NOT_SHARING,this._screenSharingProvider=t,this._isScreenScraperActive=!1,this._collaborationsAnalyticsService=i,this.onPerformanceMonitorAlert=function(){},this._callService=a,this._callId=r,this._videoSharingStream=T,this._endVideoSharingStreamTimer=T,this._remoteControlState=n.Services.Collaboration.ContentSharingState.NOT_SHARING}e.prototype={start:function(e){this._screenSharingProvider.start(),this._initSharingEventHandler(e),this.getShareAnyTypeCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(e)}.bind(this)),this.getStartSharingUsingVideoCapability().addOnChangedCallback(function(){this._recalculateAllContentSharingCapabilities(e)}.bind(this))},stop:function(e){this._screenSharingProvider.stop(),this._removeSharingEventHandler(e)},setExtensionAvailable:function(e){this._screenSharingProvider.setExtensionAvailable(e)},isDisplayMediaAvailable:function(){return this._screenSharingProvider.isDisplayMediaAvailable()},startScreenSharingFullScreen:function(t,e,i){if(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start full screen sharing..."),t.getShareFullScreenCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){t._collaborationEnd=!1,this._contentSharingType=n.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING;var a=t._getCollaborations();return this._screenSharingProvider.startFullScreen(e,i).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),E.Deferred().reject(e).promise()}.bind(this))}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},isSharingFullScreen:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?T:this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===n.Services.Collaboration.ContentSharingType.FULL_SCREEN_SHARING},startSharingApplicationWindow:function(t,e,i){if(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start appl window sharing..."),t.getShareApplicationWindowCapability().isAllowed){if(this.getShareApplicationWindowCapability().isAllowed){t._collaborationEnd=!1,this._contentSharingType=n.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING;var a=t._getCollaborations();return this._screenSharingProvider.startApplicationWindow(e,i).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,this._collaborationsAnalyticsService.sendStartupEvent(!1),E.Deferred().reject(e).promise()}.bind(this))}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenCapture:function(t){return n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen capturing Service: Start screen capture any type..."),t.getStartScreenSharingCapability().isAllowed?this.getShareAnyTypeCapability().isAllowed?this._screenSharingProvider.startCapture().then(function(e){return 0<e.getVideoTracks().length&&e.getVideoTracks()[0].addEventListener("ended",function(){n.Base.Logger.warn(n.Base.LoggerTags.COLLABORATION_SERVICE,"Screen capture stopped by the user manually"),this.stopScreenCapture(),t._onCaptureEndedCallbacks.fire()}.bind(this)),e}.bind(this),function(e){return E.Deferred().reject(e).promise()}.bind(this)):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise():E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingAnyType:function(t,e){if(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing any type..."),t.getStartScreenSharingCapability().isAllowed){if(this.getShareAnyTypeCapability().isAllowed){this._screenSharingProvider.clearOutgoingScreenSharingStream(),t._collaborationEnd=!1,this._contentSharingType=n.Services.Collaboration.ContentSharingType.ANY_TYPE;var i=t._getCollaborations();return this._screenSharingProvider.startSharingAnyType(e).then(function(e){return this._screenSharingProvider.setScreenCapturerEndedHandler(function(){this.end(!1,t)}.bind(this)),this._isScreenScraperActive=!0,this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,i._activeContentSharing=t,i._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,i._activeContentSharing=T,i._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),E.Deferred().reject(e).promise()}.bind(this))}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startScreenSharingUsingVideo:function(t,e,i){if(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Start screen sharing USING VIDEO any type..."),t.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()){if(this.getStartSharingUsingVideoCapability().isAllowed){this._screenSharingProvider.clearOutgoingVideoSharingStream(),t._collaborationEnd=!1,this._contentSharingType=n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var a=t._getCollaborations();return this._screenSharingProvider.startSharingWithVideo(this,e,i).then(function(e){return 0<e.getVideoTracks().length&&e.getVideoTracks()[0].addEventListener("ended",function(){n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Screen sharing video track was unexpectedly ended (possibly by the user)"),this.stopScreenSharingUsingVideo(t)}.bind(this)),0<e.getAudioTracks().length&&t._onAudioAddedToScreenSharingUsingVideoCallback.fire(t,e.getAudioTracks()[0]),this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,a._activeContentSharing=t,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),e}.bind(this),function(e){return this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,a._activeContentSharing=T,a._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!1),E.Deferred().reject(e).promise()}.bind(this))}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_INSTALLED).promise()}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},restartScreenSharingUsingVideo:function(t,e){n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Restarting screen sharing USING VIDEO any type..."),t.getStartSharingUsingVideoCapability().isAllowed&&this.isScreenSharingUsingVideoAllowed()&&this.getStartSharingUsingVideoCapability().isAllowed&&this._screenSharingProvider._collaborationProvider.startVideoSharing().then(function(){t._collaborationEnd=!1,this._contentSharingType=n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;var e=t._getCollaborations();this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,e._activeContentSharing=t,e._onActiveContentSharingChangedCallback.fire(),this._collaborationsAnalyticsService.sendStartupEvent(!0),t._onScreenSharingUsingVideoStartedCallbacks.fire(t,t._collaboration._selfParticipant)}.bind(this),function(e){n.Base.Logger.error(n.Base.LoggerTags.COLLABORATION_SERVICE,"Failed to send StartVideoSharing event to WCS: ",e)})},stopScreenSharingUsingVideo:function(e,t){var i=e._collaboration;if(i&&(!i._selfParticipant||!i._selfParticipant._presenter)||!this.isScreenSharingUsingVideoInProgress())return n.Base.Logger.warn(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Video Sharing Service: Stop sharing is not allowed: presenter parameter is false."),E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise();if(this._stopAllVideoSharingStreams(),this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING)return n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Video content Sharing Service: Stop sharing..."),this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&(this._sharingState=n.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,(i=e._getCollaborations())._activeContentSharing=T,i._onActiveContentSharingChangedCallback.fire()),this._recalculateAllContentSharingCapabilities(e),n.Base.Utils.isUndefined(t)&&(t=!0),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,t);n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Video Sharing Service: Stop sharing is not allowed: sharing is inactive");t=E.Deferred();return t.resolve(),t.promise()},stopScreenCapture:function(){this._screenSharingProvider.isCapturing()&&this._screenSharingProvider.clearOutgoingCapturedStream()},setVideoSharingStream:function(e){this._videoSharingStream=e},sendContentVideoSharingStream:function(e){return this._callService.startContentVideoSharing(this._callId,e)},isScreenSharingUsingVideoWithAudio:function(){return!!this._videoSharingStream&&0<this._videoSharingStream.getAudioTracks().length},isScreenSharingUsingVideoInProgress:function(){return!!this._videoSharingStream},getNegotiatedVideoResolution:function(){return this._callService.getNegotiatedVideoResolutionByCallId(this._callId)},updateAudioSourceForVideoSharing:function(e){return this._callService.updateAudioSourceForVideoSharing(this._callId,e)},isSharingApplicationWindow:function(){return this._isSharingAnyType()||this.isScreenSharingUsingVideo()?T:this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===n.Services.Collaboration.ContentSharingType.APP_WINDOW_SHARING},isScreenSharingUsingVideo:function(){return this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE},isRemoteControlStarted:function(){return this._remoteControlState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING},_isSharingAnyType:function(){return this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING&&this._contentSharingType===n.Services.Collaboration.ContentSharingType.ANY_TYPE},end:function(e,t){var i=t._collaboration;if(!i||!!i._selfParticipant&&i._selfParticipant._presenter){if(this.stopScreenCapture(),this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING){if(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing..."),this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE)return this.stopScreenSharingUsingVideo(t);this._sharingState=n.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,!0===e&&(t._isPaused=!1,t._onContentSharingEndedCallbacks.fire(t,i._selfParticipant)),this._recalculateAllContentSharingCapabilities(t);t=t._getCollaborations();return t._activeContentSharing=T,t._onActiveContentSharingChangedCallback.fire(),this._isScreenScraperActive=!1,this.setScreenSharingVisibleRect(T),this.setScreenSharingMasks(T),this._screenSharingProvider.stopScreenSharing(e)}n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: sharing is inactive");e=E.Deferred();return e.resolve(),e.promise()}return n.Base.Logger.warn(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Stop sharing is not allowed: presenter parameter is false."),E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},isPresenting:function(){return this._contentSharingType!==n.Services.Collaboration.ContentSharingType.NONE},isContentSharingActive:function(){return this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING},isContentSharingPaused:function(){return this._sharingState===n.Services.Collaboration.ContentSharingState.PAUSED},pause:function(){return this._sharingState===n.Services.Collaboration.ContentSharingState.SHARING?this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise():(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Pause sharing..."),this._sharingState=n.Services.Collaboration.ContentSharingState.PAUSED,this._screenSharingProvider.pause()):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},resume:function(){return this._sharingState===n.Services.Collaboration.ContentSharingState.PAUSED?(n.Base.Logger.info(n.Base.LoggerTags.COLLABORATION_SERVICE,"Content Screen Sharing Service: Resume sharing..."),this._sharingState=n.Services.Collaboration.ContentSharingState.SHARING,this._screenSharingProvider.resume()):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_INVALID_STATE).promise()},requestRemoteControl:function(e){return e.getRequestRemoteControlCapability().isAllowed?this._screenSharingProvider.requestRemoteControl():E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},grantRemoteControl:function(e,t,i){if(e.getGrantRemoteControlCapability().isAllowed){var a=e._collaboration;return a&&a._selfParticipant&&(a._selfParticipant._remoteControlRole=n.Services.Conference.RemoteControlRole.CONTROLLEE,e._recalculateAllRemoteControlCapabilities(a)),this.isRemoteControlStarted()?this.endRemoteControl(e).always(function(){return this._screenSharingProvider.grantRemoteControl(t,i)}.bind(this)):this._screenSharingProvider.grantRemoteControl(t,i)}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},denyRemoteControl:function(e,t){return e.getGrantRemoteControlCapability().isAllowed?this._screenSharingProvider.denyRemoteControl(t):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},declineRemoteControl:function(e,t){if(e.getStartRemoteControlCapability().isAllowed){var i=e._collaboration;return i&&i._selfParticipant&&(i._selfParticipant._remoteControlRole=n.Services.Conference.RemoteControlRole.PARTICIPANT,e._recalculateAllRemoteControlCapabilities(i)),this._screenSharingProvider.declineRemoteControl(t)}return E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},startRemoteControl:function(e,t){return e.getStartRemoteControlCapability().isAllowed?this._screenSharingProvider.startRemoteControl(t).then(function(){this._remoteControlState=n.Services.Collaboration.ContentSharingState.SHARING}.bind(this)):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},endRemoteControl:function(e,t){return e.getEndRemoteControlCapability().isAllowed?this._screenSharingProvider.endRemoteControl(t).then(function(){this._remoteControlState=n.Services.Collaboration.ContentSharingState.NOT_SHARING}.bind(this)):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},copyPasteRemoteControl:function(e,t){var i,a=E.Deferred(),r=e._collaboration;return!this.isRemoteControlStarted()||!e.getEndRemoteControlCapability().isAllowed||r&&r._selfParticipant&&r._selfParticipant._remoteControlRole===n.Services.Conference.RemoteControlRole.PARTICIPANT?a.reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED):(i=r._selfParticipant._remoteControlRole===n.Services.Conference.RemoteControlRole.CONTROLLER?n.Providers.WCS.ScreenSharingCopyPasteTypes.PASTE:n.Providers.WCS.ScreenSharingCopyPasteTypes.COPY,t?this._screenSharingProvider.copyPasteRemoteControl(i,t).then(function(){a.resolve()},function(e){a.reject(e)}):navigator.clipboard?navigator.clipboard.readText().then(function(e){e?this._screenSharingProvider.copyPasteRemoteControl(i,e).then(function(){a.resolve()},function(e){a.reject(e)}):a.reject("Missing clipboard text")}.bind(this)).catch(function(e){a.reject(e)}):a.reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)),a.promise()},sendRemoteControlMouseTag:function(e,t,i,a,r){return this.isRemoteControlStarted()&&e.getEndRemoteControlCapability().isAllowed?this._screenSharingProvider.sendRemoteControlMouseTag(t,i,a,r):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},sendRemoteControlKeyboardTag(e,t,i,a,r,s){return this.isRemoteControlStarted()&&e.getEndRemoteControlCapability().isAllowed?this._screenSharingProvider.sendRemoteControlKeyboardTag(t,i,a,r,s):E.Deferred().reject(n.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED).promise()},getShareApplicationWindowCapability:function(){return this._screenSharingProvider.getShareApplicationWindowCapability()},getReceivingBitrate:function(){return this._collaborationProvider.getReceivingBitrate()},getOutgoingScreenSharingStream:function(){return this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?this._screenSharingProvider.getOutgoingVideoSharingStream():this._screenSharingProvider.getOutgoingScreenSharingStream()},getOutgoingCapturedStream:function(){return this._screenSharingProvider.getOutgoingCapturedStream()},getShareFullScreenCapability:function(){return this._screenSharingProvider.getShareFullScreenCapability()},getShareAnyTypeCapability:function(){return this._screenSharingProvider.getShareAnyTypeCapability()},getStartSharingUsingVideoCapability:function(){return this._screenSharingProvider.getStartSharingUsingVideoCapability()},isOpened:function(){return this._screenSharingProvider.isOpened()},isFeatureAvailable:function(e){return this._collaborationProvider.isFeatureAvailable(e)},setImageQuality:function(e){this._requestRemoteControlCapability=new n.Base.Capability(n.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),this._screenSharingProvider.setImageQuality(e)},getImageQuality:function(e){return this._screenSharingProvider.getImageQuality()},setScreenSharingVisibleRect:function(e){this._screenSharingProvider.setScreenSharingVisibleRect(e)},getScreenSharingVisibleRect:function(){return this._screenSharingProvider.getScreenSharingVisibleRect()},setScreenSharingMasks:function(e){this._screenSharingProvider.setScreenSharingMasks(e)},getScreenSharingMasks:function(){return this._screenSharingProvider.getScreenSharingMasks()},setMaxUploadSpeed:function(e){this._screenSharingProvider.setMaxUploadSpeed(e)},getMaxUploadSpeed:function(e){return this._screenSharingProvider.getMaxUploadSpeed()},notifyPerformanceMonitorAlert:function(e,t){this.onPerformanceMonitorAlert(e,t)},isScreenSharingUsingVideoAllowed:function(){return this._callService.isMPaasCall(this._callId)&&!this._callService.isAudioOrDataOnly(this._callId)},_initSharingEventHandler:function(e){this._startScreenSharingEventHandler=this._startScreenSharingHandler(e),this._endScreenSharingEventHandler=this._endScreenSharingHandler(),this._startVideoSharingEventHandler=this._startVideoSharingHandler(),this._endVideoSharingEventHandler=this._endVideoSharingHandler(),e.addOnContentSharingStartedCallback(this._startScreenSharingEventHandler),e.addOnContentSharingEndedCallback(this._endScreenSharingEventHandler),e.addOnScreenSharingUsingVideoStartedCallback(this._startVideoSharingEventHandler),e.addOnScreenSharingUsingVideoEndedCallback(this._endVideoSharingEventHandler)},_removeSharingEventHandler:function(e){this._startScreenSharingEventHandler&&this._endScreenSharingEventHandler&&(e.removeOnContentSharingStartedCallback(this._startScreenSharingEventHandler),e.removeOnContentSharingEndedCallback(this._endScreenSharingEventHandler)),this._startVideoSharingEventHandler&&this._endVideoSharingEventHandler&&(e.removeOnContentSharingStartedCallback(this._startVideoSharingEventHandler),e.removeOnContentSharingEndedCallback(this._endVideoSharingEventHandler))},_startScreenSharingHandler:function(t){return function(e){!0===t._isPaused&&(n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"Pause screen sharing after sharing start, contentSharing._isPaused: ",t._isPaused),this.pause())}.bind(this)},_endScreenSharingHandler:function(){return function(e){var t=this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE;if(t||(this._sharingState=n.Services.Collaboration.ContentSharingState.NOT_SHARING,this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE),this._isScreenScraperActive)return this._isScreenScraperActive=!1,this._screenSharingProvider.stopScreenSharing(!0,t)}.bind(this)},_pauseScreenSharingHandler:function(t){return function(e){t._onContentSharingPausedCallbacks.fire(e)}},_startVideoSharingHandler:function(){return function(e,t){t&&t.isLocalUser()&&clearTimeout(this._endVideoSharingStreamTimer)}.bind(this)},_endVideoSharingHandler:function(){return function(e,t,i){var a=function(){if(this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE&&this.isScreenSharingUsingVideoInProgress())return this._contentSharingType=n.Services.Collaboration.ContentSharingType.NONE,this._stopAllVideoSharingStreams(),this._screenSharingProvider.stopSharingWithVideo(this._callService,this._callId,!1)}.bind(this);i?this._endVideoSharingStreamTimer=setTimeout(a,500):e._collaboration._collaborationService.wasScreenSharingInterrupted()||a()}.bind(this)},_endActiveScreenSharing:function(e,t){this._sharingState!==n.Services.Collaboration.ContentSharingState.NOT_SHARING&&(e._collaboration._collaborationService.wasScreenSharingInterrupted()?n.Base.Logger.debug(n.Base.LoggerTags.WCS_COLLABORATION_PROVIDER,"End sharing after network disconnect, do not reset _isPaused, _isPaused:",e._isPaused):e._isPaused=!1,this._sharingState=n.Services.Collaboration.ContentSharingState.NOT_SHARING,(this._contentSharingType===n.Services.Collaboration.ContentSharingType.VIDEO_ANY_TYPE?e._onScreenSharingUsingVideoEndedCallbacks:e._onContentSharingEndedCallbacks).fire(e,t))},_stopAllVideoSharingStreams:function(){this._videoSharingStream&&(this._videoSharingStream.getTracks().forEach(function(e){e.stop()}),this._videoSharingStream=T),this._screenSharingProvider.clearOutgoingVideoSharingStream()},_recalculateAllContentSharingCapabilities:function(e){e._recalculateShareApplicationWindowCapability(e._collaboration),e._recalculateShareFullScreenCapability(e._collaboration),e._recalculateShareAnyTypeCapability(e._collaboration),e._recalculateShareContentVideoCapability(e._collaboration),e._recalculateRequestRemoteControlCapability(e._collaboration)}},n.Services.Collaboration.ContentSharingService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingState={NOT_SHARING:"not sharing",SHARING:"sharing",PAUSED:"paused"}}(),function(){"use strict";AvayaClientServices.Services.Collaboration.ContentSharingType={NONE:"none",FULL_SCREEN_SHARING:"full screen",APP_WINDOW_SHARING:"application window",ANY_TYPE:"any type",VIDEO_ANY_TYPE:"video any type"}}(),function(i){"use strict";function e(){this._slides=[],this._onSlidesAddedCallbacks=E.Callbacks(),this._onSlidesRemovedCallbacks=E.Callbacks()}e.prototype={getSlides:function(){var t=[];return this._slides.forEach(function(e){t.push(new i.Services.Collaboration.SliderSlide(e.getNumber(),e.getSlideURL(),e.getThumbnailURL(),e.getCreateTime()))}),t},_addSlides:function(e){this._slides.push(new i.Services.Collaboration.SliderSlide(e.getNumber(),e.getSlideURL(),e.getThumbnailURL(),e.getCreateTime()))},_removeSlides:function(){this._slides=[]}},i.Services.Collaboration.Slider=e}(AvayaClientServices),function(e){"use strict";E.extend(e.Services.Collaboration.Slider.prototype,{addOnSlidesAddedCallback:function(e){this._onSlidesAddedCallbacks.add(e)},removeOnSlidesAddedCallback:function(e){this._onSlidesAddedCallbacks.remove(e)},addOnSlidesRemovedCallback:function(e){this._onSlidesRemovedCallbacks.add(e)},removeOnSlidesRemovedCallback:function(e){this._onSlidesRemovedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";function t(e,t,i,a){this._number=e,this._slideURL=t,this._thumbnailURL=i,this._createTime=a}t.prototype={getSlideURL:function(){return this._slideURL},getThumbnailURL:function(){return this._thumbnailURL},getNumber:function(){return this._number},getCreateTime:function(){return this._createTime}},e.Services.Collaboration.SliderSlide=t}(AvayaClientServices),function(o){"use strict";function e(e,t){this._collaborationProvider=e,this._checkOnNewPoints=T,this._throttlingInterval=100,this._collaborationsAnalyticsService=t}e.prototype={start:function(t,e){var i=E.Deferred();if(t._collaboration.getWhiteboardCapability().isAllowed){var a=function(){i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_UNAVAILABLE))},r=function(){this._collaborationsAnalyticsService.sendStartupEvent(!0),t._collaboration.removeOnCollaborationServiceUnavailableCallback(a),i.resolve()}.bind(this),s=function(e){o.Base.Logger.error(o.Base.LoggerTags.COLLABORATION_SERVICE,"Error starting whiteboard: ",e),this._collaborationsAnalyticsService.sendStartupEvent(!1),t._collaboration.removeOnCollaborationServiceUnavailableCallback(a),i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_UNAVAILABLE))}.bind(this);if(t._collaboration.addOnCollaborationServiceUnavailableCallback(a),o.Base.Utils.isDefined(e)){if(e.isActive())return i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_ALREADY_ACTIVE)),i.promise();t.getSurfaces().forEach(function(e){e._active=!1}),this._collaborationProvider.startWhiteboard(e.getSurfaceId()).then(r,s)}else{var n=t.getSurfaces();(0===n.length?this._collaborationProvider.startWhiteboard():(e=n.filter(function(e){return e.isActive()})[0])?this._collaborationProvider.startWhiteboard(e.getSurfaceId()):this._collaborationProvider.startWhiteboard(n[0].getSurfaceId())).then(r,s)}}else i.reject(new o.Base.BaseError(o.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED));return i},end:function(e){var t=E.Deferred();if(e.getActiveSurface()){if(e._collaboration.getWhiteboardCapability().isAllowed)return this._collaborationProvider.endWhiteboard(e);t.reject(new o.Base.BaseError(o.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED))}else t.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE));return t},stop:function(e){var t=E.Deferred();return e._currentLiveDrawingWhiteboardIds=[],e._currentLiveDrawingShapes=[],e._activeSurface=T,e._recentlyActiveSurface=T,e._surfaces.length=0,e._onWhiteboardStartedCallbacks.empty(),e._onWhiteboardEndedCallbacks.empty(),e._onWhiteboardSurfaceAddedCallbacks.empty(),e._onWhiteboardSurfaceRemovedCallbacks.empty(),e._onWhiteboardSurfaceSetActiveCallbacks.empty(),e._removeWhiteboardCapability=new o.Base.Capability(o.Base.CapabilityDenialReason.CAPABILITY_INVALID_STATE),t.resolve(),t.promise()},requestNewSurface:function(e){var t=E.Deferred();return e.getActiveSurface()?e.getAddWhiteboardCapability().isAllowed?this._collaborationProvider.addWhiteboardSurface().then(function(e){t.resolve(e)},function(e){t.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,e))}):t.reject(new o.Base.BaseError(o.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):t.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),t.promise()},removeSurface:function(e,t){var i=E.Deferred();return e.getActiveSurface()?1<e.getSurfaces().length?e.getRemoveWhiteboardCapability().isAllowed?this._collaborationProvider.removeWhiteboardSurface(t.getSurfaceId()).then(function(e){i.resolve(e)},function(e){i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SURFACE_FAILED,e))}):i.reject(new o.Base.BaseError(o.Base.ErrorReasons.CAPABILITY_NOT_ALLOWED)):i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_LAST_SURFACE)):i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_INACTIVE)),i.promise()},addCircle:function(i,a){return this._collaborationProvider.addCircle(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e})},addShape:function(i,a){return a.isFinished()?this._collaborationProvider.addShape(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e}):(a._readyToSendCallbacks.add(this._throttleLiveDrawing.bind(this,a,i)),this._collaborationProvider.startDrawShape(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e}))},addText:function(i,a){return this._collaborationProvider.addText(a,i.getSurfaceId()).done(function(e){var t=a.getId();return e?(a.setId(e),delete i.getShapes()[t],i.getShapes()[e]=a):i.getShapes()[t]=a,e})},moveSelection:function(e,t){return t instanceof o.Services.Collaboration.Shape?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getPoints()[0].point):t instanceof o.Services.Collaboration.Circle?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getTopLeft()):t instanceof o.Services.Collaboration.WhiteboardText?this._collaborationProvider.moveSelection(t,e.getSurfaceId(),t.getPosition()):this._collaborationProvider.moveSelection(t,e.getSurfaceId())},removeShape:function(e,t){if(t.isMine())return t instanceof o.Services.Collaboration.Shape?i=t.getPoints()[0].point:t instanceof o.Services.Collaboration.Circle?i=t.getTopLeft():t instanceof o.Services.Collaboration.WhiteboardText&&(i=t.getPosition()),this._collaborationProvider.removeShape(t,e.getSurfaceId(),i);var i=E.Deferred();return i.reject(new o.Services.Collaboration.CollaborationError(o.Services.Collaboration.CollaborationErrorReason.WHITEBOARD_REMOVE_SHAPE_NOT_MINE)),i.promise()},clearContent:function(e){return this._collaborationProvider.clearContent(e.getSurfaceId())},endDrawShape:function(e,t){return t._hasPointsToSend()&&this._collaborationProvider.liveDrawShape(t,e.getSurfaceId()),this._collaborationProvider.endDrawShape(t,e.getSurfaceId())},_throttleLiveDrawing:function(e,t){if(e._hasPointsToSend())return this._collaborationProvider.liveDrawShape(e,t.getSurfaceId())}},o.Services.Collaboration.WhiteboardService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Collaboration.WhiteboardTools=function(){this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION]={name:"Selection",type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN,name:"Pen",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER,name:"Marker",drag:!1,live:!0},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE,name:"Line",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardLineWidths,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE,name:"Rect",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE,name:"Circle",drag:!0,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardToolModes,startFunction:function(){},endFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP,name:"Stamp",drag:!1,live:!1,drawFunction:function(){}},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT,name:"Text",drag:!1,live:!1,modes:AvayaClientServices.Services.Collaboration.WhiteboardTextSizes},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.DELETE,name:"Delete"},this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR]={type:AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CLEAR,name:"Clear All"}}}(),function(a){"use strict";function r(e,t,i,a){this._messageContent=e,this._sender=t,this._recipient=i,this._isPrivate=a,this._time=new Date,r._idCounter===Number.MAX_SAFE_INTEGER&&(r._idCounter=1e5),this._id=""+ ++r._idCounter,this.status=T}Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=Math.pow(2,53)-1),r._idCounter=1e5,r.prototype={setStatus:function(e){var t,i=!1;for(t in a.Services.Conference.ChatMessageStatus)if(a.Services.Conference.ChatMessageStatus.hasOwnProperty(t)&&e===a.Services.Conference.ChatMessageStatus[t]){a.Base.Utils.validate(e,{validators:[{type:"defined"},{type:"type",expected:"string"}]}),this.status=e,i=!0;break}return i},getSender:function(){return this._sender},getMessageContent:function(){return this._messageContent},isPrivate:function(){return this._isPrivate},getRecipient:function(){return this._recipient},getTime:function(){return this._time},getId:function(){return this._id}},a.Services.Conference.ChatMessage=r}(AvayaClientServices),function(s){"use strict";function e(e){this._conferenceProvider=e,this._enableSendingMessages=!0}e.prototype={sendMessage:function(e,t,i){if(this._enableSendingMessages){var a=i?i._participantId:T,r=new s.Services.Conference.ChatMessage(t,e._selfParticipant,i,!!i);return r.getRecipient()&&r.getRecipient().addOnParticipantNameChangedCallback(function(e){r._recipient=e}),r.setStatus(s.Services.Conference.ChatMessageStatus.PENDING),this.addMessage(e,r),this._conferenceProvider.sendChatMessage(t,a).then(function(){r.setStatus(s.Services.Conference.ChatMessageStatus.CONFIRMED)}.bind(this),function(e){return r.setStatus(s.Services.Conference.ChatMessageStatus.ERROR),E.Deferred().reject(e).promise()}.bind(this))}a="Sending messages is disabled while conference is in WAITING_ROOM state";s.Base.Logger.error(s.Base.LoggerTags.CHAT_SERVICE,a);a=new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,a);return E.Deferred().reject(a).promise()},addMessage:function(e,t){(t.isPrivate()?e._privateMessages:e._publicMessages).push(t),e._allMessages.push(t),e._onChatMessageReceivedCallbacks.fire(e,t)},_setEnableSendingMessages:function(e){this._enableSendingMessages=e}},s.Services.Conference.ChatService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceException=function(e,t){this.name=e,this.message=t}}(),function(s){"use strict";function e(e,t,i){this._conferenceType=e,this._conferenceProvider=t,this._contactsIntegrationService=i,this._onContactListChanged=T,this._isDisconnecting=!1}e.prototype={start:function(t,e){if(s.Base.Utils.isDefined(this._conferenceProvider))return s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is starting..."),t._isStarting=!0,this._conferenceProvider.start(t,e).then(function(){this._conferenceProvider.on(s.Base.NetworkProviderEvents.UNAUTHORIZED,function(){(s.Base.Utils.isUndefined(t._isAvailable)||t._isAvailable)&&(t._isAvailable=!1,t._onConferenceServiceUnavailableCallbacks.fire(t))}.bind(this)),this._conferenceProvider.on(s.Base.NetworkProviderEvents.AUTHORIZED,function(){!s.Base.Utils.isUndefined(t._isAvailable)&&t._isAvailable||(t._isAvailable=!0,t._onConferenceServiceAvailableCallbacks.fire(t))}.bind(this)),this._onContactListChanged=function(){this._updateMatchedContactsForConference(t)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),!s.Base.Utils.isUndefined(t._isAvailable)&&t._isAvailable||(t._isAvailable=!0,t._onConferenceServiceAvailableCallbacks.fire(t)),t._setConferenceStarted(!0),t._recalculateAllAddParticipantFromCallCapability(),t.addOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses)}.bind(this),function(e){return t._isStarting=!1,t._setConferenceStarted(!1),E.Deferred().reject(e).promise()});e=E.Deferred();return s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference Service is not enabled"),e.reject({name:s.Services.Conference.ConferenceStartStatus.CONFERENCE_SERVICE_NOT_ENABLED,message:"Conference Service is not enabled"}),e.promise()},stop:function(t){return t._isAvailable&&(t._isAvailable=!1,t._recalculateInConferenceChatCapability(),t._onConferenceServiceUnavailableCallbacks.fire(t)),t._isStarting=!1,t._setConferenceStarted(!1),s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stop().then(function(e){return this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,t.removeOnConferenceRecordingStatusChangedCallback(this._recalculateConferenceRecordingStatuses),t._selfParticipantId="",t._activeTalkerId="",t._lecturerId="",t._presenterId="",t._conferenceOwnerAddress="",t._mediaStatus="",t._activeParticipants=[],t._droppedParticipants=[],t._pendingParticipants=[],t._isLectureModeActive=!1,t._isHandRaised=!1,t._recordingStatus=s.Services.Conference.RecordingStatus.OFF,t._isVideoAllowed=!1,t._isWebCollaborationActive=!1,t._isLocked=!1,t._isPasscodeRequiredToBecomeModerator=!1,t._isVideoParticipantNameDisplayActive=!1,t._isVideoPersonalLayoutActive=T,t._isVideoSelfSeeActive=!1,t._isVideoSelfSeeChangeAllowed=!1,t._isVideoPinAllowed=!1,t._isVideoParticipantNameDisplayChangeAllowed=!1,t._currentVideoLayout="",t._supportedVideoLayouts=[],t._subject="",t._sipURI="",t._isApplicationSharingActive=!1,t._brandName="",t._collaborationURI="",t._joinMeetingURI="",t._streamingURI="",t._dialInInformation="",t._dialInInformationHtml="",t._admissionPermissionNeeded=!1,t._admissionPasscodeNeeded=!1,e}.bind(this)):E.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError.PROVIDER_UNAVAILABLE,"ConferenceProvider")).promise()},stopImmediately:function(e){return e._isAvailable&&(e._isAvailable=!1,e._onConferenceServiceUnavailableCallbacks.fire(e)),e._isStarting=!1,e._setConferenceStarted(!1),E.Deferred().resolve().promise()},terminateConference:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.terminateConference():E.Deferred().reject().promise()},getType:function(){return this._conferenceType},removeLastParticipant:function(){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.removeLastParticipant():E.Deferred().reject().promise()},sendAdmissionRequest:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendAdmissionRequest(e,t):E.Deferred().reject().promise()},requestToBecomeModerator:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.requestToBecomeModerator(t):E.Deferred().reject().promise()},signIn:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.signIn(t):E.Deferred().reject().promise()},videoPin:function(e,t,i,a,r){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.videoPin(e,t,i,a,r):E.Deferred().reject().promise()},extendMeeting:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.extendMeeting(e):E.Deferred().reject().promise()},addParticipant:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipant(e,t):E.Deferred().reject().promise()},addParticipantFromCall:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.addParticipantFromCall(e):E.Deferred().reject().promise()},cancelDialoutParticipant:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.cancelDialoutParticipant(e,t._participantId):E.Deferred().reject().promise()},setAsLecturer:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setAsLecturer(e._participantId):E.Deferred().reject().promise()},setLocked:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.setLocked(t):E.Deferred().reject().promise()},startRecording:function(e,t,i){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.startRecording(e,t,i):E.Deferred().reject().promise()},stopRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.stopRecording(e):E.Deferred().reject().promise()},pauseRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.pauseRecording(e):E.Deferred().reject().promise()},resumeRecording:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.resumeRecording(e):E.Deferred().reject().promise()},setVideoLayout:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return E.Deferred().reject().promise();e=e.getUpdateVideoLayoutCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayout(t);e=e.denialReason;return E.Deferred().reject(e).promise()},setVideoLayoutSelfSee:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return E.Deferred().reject().promise();e=e.getUpdateVideoSelfSeeCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayoutSelfSee(t);e=e.denialReason;return E.Deferred().reject(e).promise()},setVideoLayoutTextOverlay:function(e,t){if(!s.Base.Utils.isDefined(this._conferenceProvider))return E.Deferred().reject().promise();e=e.getUpdateDisplayVideoParticipantNameCapability();if(!1!==e.isAllowed)return this._conferenceProvider.setVideoLayoutTextOverlay(t);e=e.denialReason;return E.Deferred().reject(e).promise()},getCurrentVideoLayout:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.getCurrentVideoLayout():E.Deferred().reject().promise()},muteAllParticipants:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!0):E.Deferred().reject().promise()},unmuteAllParticipants:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.muteUnmuteAll(!1):E.Deferred().reject().promise()},raiseLowerHand:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?e?this._conferenceProvider.raiseLowerHand(s.Services.Conference.ParticipantHandState.RAISE):this._conferenceProvider.raiseLowerHand(s.Services.Conference.ParticipantHandState.LOWER):E.Deferred().reject().promise()},disconnectParticipant:function(e){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.disconnectParticipant(e):E.Deferred().reject().promise()},sendDisconnectEvent:function(){return s.Base.Utils.isDefined(this._conferenceProvider)?this._isDisconnecting?E.Deferred().resolve():(this._isDisconnecting=!0,s.Base.Logger.info(s.Base.LoggerTags.CONFERENCE_SERVICE,"Conference sent disconnect event"),this._conferenceProvider.sendDisconnectEvent(s.Services.Conference.DisconnectReason.CALL_DISCONNECTED)):E.Deferred().reject().promise()},sendLocalMuteEvent:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.sendLocalMuteEvent(e,t):E.Deferred().reject().promise()},changeParticipantName:function(e,t){return s.Base.Utils.isDefined(this._conferenceProvider)?this._conferenceProvider.changeParticipantName(e._participantId,t):E.Deferred().reject(new s.Services.Conference.ConferenceException(s.Services.Conference.ConferenceError,"Conference provider is not defined")).promise()},_recalculateAllCapabilities:function(e){e._recalculateSetLockCapability(),e._recalculateDisplayVideoParticipantNameCapability(),e._recalculateVideoSelfSeeCapability(),e._recalculateSetVideoLayoutCapability(),e._recalculateStartStopRecordingCapability(),e._recalculatePauseResumeRecordingCapability(),e._recalculateMuteUnmuteAllCapability(),e._recalculateRaiseHandSupportCapability(),e._recalculateLowerHandSupportCapability(),e._recalculateRequestToBecomeModeratorCapability(),e._recalculateVideoPinCapability(),e._recalculateRemoveSelectParticipantCapability(),e._recalculateAddParticipantViaDialoutCapability(),e._recalculateSignInCapability(),e._recalculateModerateConferenceCapability(),e._recalculateActiveTalkerCapability(),e._recalculateMuteSelfAudioCapability(),e._recalculateUnmuteSelfAudioCapability(),e._recalculateSendFeccCapability(),e._recalculateTerminateConferenceCapability(),e._recalculateAcceptPendingParticipantCapability(),e._recalculateDenyPendingParticipantCapability(),e._recalculateExtendMeetingCapability(),e._recalculateRetrieveParticipantListCapability(),e._recalculateInConferenceChatCapability()},_updateMatchedContactsForParticipant:function(e){this._contactsIntegrationService.updateMatchedContactsForParticipant(e,!0)},_updateMatchedContactsForConference:function(e){var t;this._contactsIntegrationService.isStarted()&&e&&(t=[],e.getActiveParticipants().forEach(function(e){t.push(e)}),e.getPendingParticipants().forEach(function(e){t.push(e)}),e.getDroppedParticipants().forEach(function(e){t.push(e)}),t.forEach(function(e){this._updateMatchedContactsForParticipant(e)},this))},_recalculateAddParticipantFromCallCapability:function(e,t){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapability(e,t)},_recalculateAddParticipantFromCallCapabilityByCallId:function(e,t){this._conferenceProvider&&this._conferenceProvider.recalculateAddParticipantFromCallCapabilityByCallId(e,t)},_recalculateConferenceRecordingStatuses:function(e){e._recalculateStartStopRecordingCapability(),e._recalculatePauseResumeRecordingCapability()}},s.Services.Conference.ConferenceService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceType={CM_CONFERENCE:"CM",SCOPIA_CONFERENCE:"Scopia"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AdmissionResponseCode={SUCCESS:"success",INCORRECT_PASSCODE_TRY_AGAIN:"incorrectPasscodeTryAgain",INCORRECT_PASSCODE_DISCONNECTING:"incorrectPasscodeDisconnecting",PENDING_APPROVAL:"pendingApproval",REJECTED:"rejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.AllowVideoDirection={SEND_RECEIVE:"biDirectional",RECEIVE_ONLY:"serverToClient",SEND_ONLY:"clientToServer",INACTIVE:"none"}}(),function(){"use strict";AvayaClientServices.Services.Conference.CameraControl={CAMERA_CONTROL_UP:"up",CAMERA_CONTROL_DOWN:"down",CAMERA_CONTROL_RIGHT:"right",CAMERA_CONTROL_LEFT:"left",CAMERA_CONTROL_ZOOM_IN:"in",CAMERA_CONTROL_ZOOM_OUT:"out"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatMessageStatus={PENDING:"pending",CONFIRMED:"confirmed",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ChatType={PRIVATE:"private",PUBLIC:"public"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceError={CAPABILITY_NOT_ALLOWED:"CAPABILITY_NOT_ALLOWED",INVALID_ARGUMENT:"INVALID_ARGUMENT",NETWORK_UNAVAILABLE:"NETWORK_UNAVAILABLE",CONFERENCE_CONNECTION_FAILED_TO_RECOVER:"CONFERENCE_CONNECTION_FAILED_TO_RECOVER",PROVIDER_UNAVAILABLE:"PROVIDER_UNAVAILABLE",NOT_SUPPORTED:"NOT_SUPPORTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ConferenceStartStatus={ADMISSION_NEEDED:"admissionNeeded",CONFERENCE_SERVICE_NOT_ENABLED:"conferenceServiceNotEnabled",CONFERENCE_CONFIG_NOT_ENABLED:"conferenceConfigIsNotEnabled",HANDSHAKE_REJECTED:"handshakeRejected"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ContentFromParticipantStatus={ACTIVE:"active",ALLOWED:"allowed",NOT_ALLOWED:"notAllowed"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DialoutStatus={DIALING:"dialing",UNAUTHORIZED:"unauthorized",FAIL:"fail",NOT_ADMITTED:"notAdmitted",NOT_ALLOWED:"notAllowed",CONNECT:"connect",BUSY:"busy",NO_ANSWER:"noAnswer",CANCELED:"canceled"}}(),function(){"use strict";AvayaClientServices.Services.Conference.DisconnectReason={CALL_DISCONNECTED:"callDisconnected",CONFERENCE_TERMINATED:"conferenceTerminated",DISCONNECTED_BY_MODERATOR_OR_ADMIN:"disconnectedByModeratorOrAdmin",ERROR:"error"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaFromParticipantStatus={ACTIVE:"active",NA:"na",SELF_MUTED:"selfMuted",MODERATOR_MUTED:"moderatorMuted",BOTH_MUTED:"bothMuted"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaStatus={WAITING_ROOM:"waitingRoom",ACTIVE:"active",MUTE_ALL_AUDIO:"muteAllAudio"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaToParticipantStatus={AVAILABLE:"available",NA:"na"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MediaType={AUDIO:"audio",VIDEO:"video"}}(),function(){"use strict";AvayaClientServices.Services.Conference.MeetingEncryptionStatus={YES:"yes",NO:"no",PARTIAL:"partial"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ModeratorAdmissionActions={ADMIT:"admit",REJECT:"reject"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantAuthorizationStatus={ACTIVE:"active",AUTHORIZING:"authorizing"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantConnectionStatus={CONNECTION_STATUS_UNKNOWN:"CONNECTION_STATUS_UNKNOWN",CONNECTION_STATUS_CONNECTING:"CONNECTION_STATUS_CONNECTING",CONNECTION_STATUS_CONNECTED:"CONNECTION_STATUS_CONNECTED",CONNECTION_STATUS_DISCONNECTING:"CONNECTION_STATUS_DISCONNECTING",CONNECTION_STATUS_DISCONNECTED:"CONNECTION_STATUS_DISCONNECTED"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantDisconnectionReason={DISCONNECT_REASON_UNKNOWN:"DISCONNECT_REASON_UNKNOWN",DISCONNECT_REASON_DEPARTED:"DISCONNECT_REASON_DEPARTED",DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR:"DISCONNECT_REASON_DISCONNECTED_BY_MODERATOR"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantHandState={RAISE:"raise",LOWER:"lower"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantMediaState={MEDIA_STATUS_NO_MEDIA:"MEDIA_STATUS_NO_MEDIA",MEDIA_STATUS_INACTIVE:"MEDIA_STATUS_INACTIVE",MEDIA_STATUS_RECEIVE_ONLY:"MEDIA_STATUS_RECEIVE_ONLY",MEDIA_STATUS_SEND_ONLY:"MEDIA_STATUS_SEND_ONLY",MEDIA_STATUS_SEND_RECEIVE:"MEDIA_STATUS_SEND_RECEIVE"}}(),function(){"use strict";AvayaClientServices.Services.Conference.ParticipantRole={MODERATOR:"moderator",PARTICIPANT:"participant",GUEST:"guest",OPERATOR:"operator",RESTRICTED_PARTICIPANT:"restrictedParticipant"}}(),function(){"use strict";AvayaClientServices.Services.Conference.PermissionStatus={ALLOWED:"allowed",NOT_ALLOWED:"notAllowed",NEED_SIGNIN:"needSignin",NEED_MODERATOR:"needModerator",NEED_SIGNIN_OR_MODERATOR:"needSigninOrModerator"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecorderStatus={NONE:"none",START_STOP:"start/stop",WITH_PAUSE:"withPause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingOperation={START:"start",STOP:"stop",PAUSE:"pause",RESUME:"resume"}}(),function(){"use strict";AvayaClientServices.Services.Conference.RecordingStatus={ON:"on",OFF:"off",PAUSE:"pause"}}(),function(){"use strict";AvayaClientServices.Services.Conference.VideoLayout={LAYOUT_AUTOMATIC:"1",LAYOUT_SINGLE_SCREEN:"10",LAYOUT_DOUBLE_SCREEN_HORIZONTAL:"21",LAYOUT_DOUBLE_SCREEN_VERTICAL:"22",LAYOUT_DOUBLE_SCREEN_4_TO_1:"27",LAYOUT_1_HOST_1_PIP:"28",LAYOUT_PYRAMID_3:"32",LAYOUT_LANDSCAPE_PLUS_2_ASYM:"33",LAYOUT_1_HOST_2_PIP:"34",LAYOUT_3x1:"35",LAYOUT_2x2:"40",LAYOUT_4_PYRAMID:"41",LAYOUT_3_PLUS_1:"42",LAYOUT_1_HOST_3_PIP:"43",LAYOUT_5_PYRAMID:"51",LAYOUT_1_HOST_4_PIP:"52",LAYOUT_5_PLUS_1:"60",LAYOUT_3x2:"61",LAYOUT_6_PLUS_1_1:"75",LAYOUT_7_PLUS_1_NEW:"81",LAYOUT_4x2:"82",LAYOUT_3x3:"90",LAYOUT_9_PYRAMID:"91",LAYOUT_8_PLUS_2_1_2:"101",LAYOUT_4x3:"120",LAYOUT_12_PLUS_1_1:"131",LAYOUT_12_PLUS_1_5:"135",LAYOUT_4x4:"160",LAYOUT_20_PLUS_1:"210",LAYOUT_20_PLUS_1_LEFT:"211",LAYOUT_1_PLUS_27:"280"}}(),function(a){"use strict";function e(e){this._conferenceProvider=e}e.prototype={setAsLecturer:function(e){return this._conferenceProvider.setAsLecturer(e.getParticipantId())},unsetAsLecturer:function(){return this._conferenceProvider.unsetAsLecturer()},controlRemoteCamera:function(e,t){return this._conferenceProvider.controlRemoteCamera(e.getParticipantId(),t)},mute:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!0)},unmute:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.AUDIO,!1)},accept:function(e){return this._conferenceProvider.moderatorAdmission(e,a.Services.Conference.ModeratorAdmissionActions.ADMIT)},deny:function(e){return this._conferenceProvider.moderatorAdmission(e,a.Services.Conference.ModeratorAdmissionActions.REJECT)},blockVideo:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!0)},unblockVideo:function(e){return this._conferenceProvider.muteUnmute(e.getParticipantId(),a.Services.Conference.MediaType.VIDEO,!1)},lowerHand:function(e,t){return this._conferenceProvider.moderatorLowerHand(e.getParticipantId(),t)},changeParticipantName:function(e,t){var i=e._conference.getSelfParticipant();if(i.getChangeParticipantNameCapability().isAllowed)return this._conferenceProvider.changeParticipantName(e._participantId,t);i="Cannot change participant name. Reason: "+i.getChangeParticipantNameCapability().denialReason;return a.Base.Logger.error(a.Base.LoggerTags.PARTICIPANT_SERVICE,i),E.Deferred().reject(new a.Services.Conference.ConferenceException(a.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,i)).promise()},recalculateAllCapabilities:function(e){e._recalculateBlockUnblockVideoCapability(),e._recalculateMuteUnmuteCapability(),e._recalculateLowerHandCapability(),e._recalculateSetAsLecturerCapability(),e._recalculateRemoteCameraControlCapability(),e._recalculateChangeParticipantNameCapability()}},a.Services.Conference.ParticipantService=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Conference.RecentTalkersConfiguration={SIZE:4}}(),function(){"use strict";AvayaClientServices.Services.Conference.RemoteControlRole={PARTICIPANT:"PARTICIPANT",CONTROLLER:"CONTROLLER",CONTROLLEE:"CONTROLLEE"}}(),function(e){"use strict";function t(){this._writeCapability=new e.Base.Capability(e.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED)}t.prototype={getWriteCapability:function(){return this._writeCapability},_setWriteCapability:function(e){this._writeCapability=e}},e.Services.Contacts.ContactField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._values=[]}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValues=function(){return this._values},t.prototype.isEmpty=function(){return!this._values||0===this._values.length},t.prototype.getSize=function(){return this._values?this._values.length:0},e.Services.Contacts.ContactFieldList=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._address=T,this._imAddressType=e.Services.Contacts.ContactIMAddressType.IM_ADDRESS_OTHER,this._default=!1,this._avayaAdministered=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getAddress=function(){return this._address},t.prototype.getIMAddressType=function(){return this._imAddressType},t.prototype.isDefault=function(){return this._default},t.prototype.setAvayaAdministered=function(e){this._avayaAdministered=e},t.prototype.isAvayaAdministered=function(){return this._avayaAdministered},e.Services.Contacts.ContactIMAddressField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._value=0}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},e.Services.Contacts.ContactNumberField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._phoneNumber=T,this._label1=T,this._label2=T,this._phoneNumberType=e.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK,this._speedDialEnabled=!1,this._default=!1,this._avayaAdministered=!1}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getPhoneNumber=function(){return this._phoneNumber},t.prototype.getLabel1=function(){return this._label1},t.prototype.getLabel2=function(){return this._label2},t.prototype.getPhoneNumberType=function(){return this._phoneNumberType},t.prototype.isSpeedDialEnabled=function(){return this._speedDialEnabled},t.prototype.isDefault=function(){return this._default},t.prototype.setAvayaAdministered=function(e){this._avayaAdministered=e},t.prototype.isAvayaAdministered=function(){return this._avayaAdministered},e.Services.Contacts.ContactPhoneField=t}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactField.call(this),this._value=T}(t.prototype=Object.create(e.Services.Contacts.ContactField.prototype)).getValue=function(){return this._value},e.Services.Contacts.ContactStringField=t}(AvayaClientServices),function(a){"use strict";function e(){a.Services.Contacts.ContactIMAddressField.call(this)}(e.prototype=Object.create(a.Services.Contacts.ContactIMAddressField.prototype)).setAddress=function(e){this._address=e},e.prototype.setIMAddressType=function(e){var t,i=!1;for(t in a.Services.Contacts.ContactIMAddressType)if(a.Services.Contacts.ContactIMAddressType.hasOwnProperty(t)&&e===a.Services.Contacts.ContactIMAddressType[t]){this._imAddressType=e,this._default=this._imAddressType===a.Services.Contacts.ContactIMAddressType.IM_ADDRESS_WORK,i=!0;break}return i},a.Services.Contacts.EditableContactIMAddressField=e}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactNumberField.call(this)}(t.prototype=Object.create(e.Services.Contacts.ContactNumberField.prototype)).setValue=function(e){this._value=e},e.Services.Contacts.EditableContactNumberField=t}(AvayaClientServices),function(a){"use strict";function e(){a.Services.Contacts.ContactPhoneField.call(this)}(e.prototype=Object.create(a.Services.Contacts.ContactPhoneField.prototype)).setPhoneNumber=function(e){this._phoneNumber=e},e.prototype.setLabel1=function(e){this._label1=e},e.prototype.setLabel2=function(e){this._label2=e},e.prototype.setPhoneNumberType=function(e){var t,i=!1;for(t in a.Services.Contacts.ContactPhoneNumberType)if(a.Services.Contacts.ContactPhoneNumberType.hasOwnProperty(t)&&e===a.Services.Contacts.ContactPhoneNumberType[t]){this._phoneNumberType=e,i=!0;break}return i},e.prototype.setSpeedDialEnabled=function(e){this._speedDialEnabled=e},e.prototype.setDefault=function(e){this._default=e},a.Services.Contacts.EditableContactPhoneField=e}(AvayaClientServices),function(e){"use strict";function t(){e.Services.Contacts.ContactStringField.call(this)}(t.prototype=Object.create(e.Services.Contacts.ContactStringField.prototype)).setValue=function(e){this._value=e},e.Services.Contacts.EditableContactStringField=t}(AvayaClientServices),function(g){"use strict";function e(){this._cacheKeys=[g.Services.Contacts.ContactCacheKeys.FIRST_NAME,g.Services.Contacts.ContactCacheKeys.LAST_NAME,g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,g.Services.Contacts.ContactCacheKeys.ALIAS,g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,g.Services.Contacts.ContactCacheKeys.HANDLE,g.Services.Contacts.ContactCacheKeys.LOGIN_ID,g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,g.Services.Contacts.ContactCacheKeys.CITY,g.Services.Contacts.ContactCacheKeys.DEPARTMENT,g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING,g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME],this._imdb=new g.Base.SimpleIMDB(this._cacheKeys)}e.prototype={addContact:function(e){var t=this._buildKeys(e);try{this._imdb.addElement(t,e)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to add contact to cache ("+e.message+")")}},updateContact:function(e){var t=this._buildKeysWithMatchingAddressOnly(e),i=this._buildKeys(e);try{this._imdb.updateElement(t,i,e)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to update contact in cache ("+e.message+")")}},deleteContact:function(e){e=this._buildKeysWithMatchingAddressOnly(e);try{this._imdb.deleteElements(e)}catch(e){g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to delete contact from cache ("+e.message+")")}},searchContacts:function(e,t,i){e=e.trim();if(t===g.Services.Contacts.SearchFieldType.NAME)return this.searchByName(e,i);if(t===g.Services.Contacts.SearchFieldType.HANDLE)return this.searchByHandle(e,i);if(t===g.Services.Contacts.SearchFieldType.LOGIN_ID)return this.searchByLoginId(e,i);if(t===g.Services.Contacts.SearchFieldType.TERMINAL)return this.searchByTerminal(e,i);if(t===g.Services.Contacts.SearchFieldType.ALL)return this.searchAll(e,i);throw new g.Services.Contacts.ContactsError(g.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+t)},resolveContacts:function(e,t,i){e=e.trim();if(t===g.Services.Contacts.ResolveContactsFieldType.HANDLE)return this.searchByHandle(e,i);if(t===g.Services.Contacts.ResolveContactsFieldType.PHONE_NUMBER)return this.resolveContactsByPhone(e,i);throw new g.Services.Contacts.ContactsError(g.Services.Contacts.ContactsErrorReason.INVALID_SEARCH_FIELD,"Unknown contact search scope: "+t)},searchAll:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e).split(/[,]+/);2<(i=1===(i=i.filter(function(e){return""!==e.trim()})).length?i.toString().split(/[\s]+/):i).length&&(i[2]=i.slice(2).toString().trim());var r=new Array(i.length);if(r[0]=this._imdb.searchByAllKeys(i[0].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH),r[0]===T)return T;for(var s=1;s<i.length&&s<3;s++)if(r[s]=this._imdb.searchByAllKeys(i[s].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH),r[s]===T)return T;e=g.Base.Utils.removeDuplicatesFromArray(r[0]).filter(function(e){for(s=1;s<r.length;s++){for(var t=r[s],i=!1,a=0;a<t.length;a++)e===t[a]&&(i=!0);if(!i)return!1}return!0});if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByName:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e).split(/[,]+/);2<(i=1===(i=i.filter(function(e){return""!==e.trim()})).length?i.toString().split(/[\s]+/):i).length&&(i[2]=i.slice(2).toString().trim());for(var a=new Array(i.length),r=[g.Services.Contacts.ContactCacheKeys.FIRST_NAME,g.Services.Contacts.ContactCacheKeys.LAST_NAME,g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME,g.Services.Contacts.ContactCacheKeys.ALIAS],s=0;s<i.length&&s<3;s++){a[s]=[];for(var n=0;n<r.length;n++){var o=this._imdb.searchBySingleKey(r[n],i[s].trim(),g.Base.IMDBSearchOptions.BEGINS_WITH);a[s]=a[s].concat(o)}if(0===a[s].length)return T}e=g.Base.Utils.removeDuplicatesFromArray(a[0]).filter(function(t){function e(e){return t===e}for(s=1;s<a.length;s++)if(!a[s].some(e))return!1;return!0});if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByHandle:function(e,t){var i=g.Services.Contacts.ContactsUtils.normalizeHandle(e),e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.HANDLE,i),i=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS,i),i=e.concat(i),i=g.Base.Utils.removeDuplicatesFromArray(i);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<i.length&&(t._exactType1Contacts=i,t._allContacts=i,t._empty=!1),t}return i},searchByLoginId:function(e,t){e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.LOGIN_ID,e),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByTerminal:function(e,t){e=g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(e),e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME,e,g.Base.IMDBSearchOptions.CONTAINS),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},searchByPhone:function(e,t){for(var i=this._imdb.getAllElements(),a=new g.Services.Contacts.MatchedContactsWithMatchLevel,r=!1,s=function(e,t,i){t=g.Services.Contacts.ContactsUtils.comparePhoneStrings(e,t);t===g.Services.Contacts.ContactMatchTypes.EXACT_TYPE1?(a._exactType1Contacts.push(i),r=!0):t===g.Services.Contacts.ContactMatchTypes.EXACT_TYPE2?a._exactType2Contacts.push(i):t===g.Services.Contacts.ContactMatchTypes.PARTIAL_TYPE1&&a._partialType1Contacts.push(i)}.bind(this),n=0;n<i.length&&!r;n++){for(var o=i[n],c=o.getPhoneNumbers().getValues(),l=0;l<c.length&&!r;l++)s(e,c[l].getPhoneNumber(),o);for(var d=o.getEmailAddresses().getValues(),l=0;l<d.length&&!r;l++)s(e,d[l].getAddress(),o);var C=o.getEmailAddresses().getValues();for(l=0;l<C.length&&!r;l++)s(e,C[l].getAddress(),o);s(e,o.getFirstName().getValue(),o),s(e,o.getLastName().getValue(),o),s(e,o.getDisplayName().getValue(),o),s(e,o.getASCIIFirstName().getValue(),o),s(e,o.getASCIILastName().getValue(),o),s(e,o.getASCIIDisplayName().getValue(),o),s(e,o.getAlias().getValue(),o),s(e,o.getManager().getValue(),o),s(e,o.getCompany().getValue(),o),s(e,o.getDepartment().getValue(),o),s(e,o.getNotes().getValue(),o),s(e,o.getLocation().getValue(),o),s(e,o.getStreetAddress().getValue(),o),s(e,o.getCity().getValue(),o),s(e,o.getState().getValue(),o),s(e,o.getCountry().getValue(),o),s(e,o.getPostalCode().getValue(),o),s(e,o.getWorkRoomNumber().getValue(),o);var u=o.getCustom1().getValues();for(l=0;l<u.length&&!r;l++)s(e,u[n].getValue(),o);var h=o.getCustom2().getValues();for(l=0;l<h.length&&!r;l++)s(e,h[n].getValue(),o);var _=o.getCustom3().getValues();for(l=0;l<_.length&&!r;l++)s(e,_[n].getValue(),o)}return a._allContacts=a._exactType1Contacts.concat(a._exactType2Contacts).concat(a._partialType1Contacts),a._allContacts=g.Base.Utils.removeDuplicatesFromArray(a._allContacts),t?(0<a._allContacts.length&&(a._empty=!1),a):a._allContacts},resolveContactsByPhone:function(e,t){e=this._imdb.searchBySingleKey(g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER,e,g.Base.IMDBSearchOptions.EXACT_MATCH),e=g.Base.Utils.removeDuplicatesFromArray(e);if(t){t=new g.Services.Contacts.MatchedContactsWithMatchLevel;return 0<e.length&&(t._exactType1Contacts=e,t._allContacts=e,t._empty=!1),t}return e},empty:function(){this._imdb=new g.Base.SimpleIMDB(this._cacheKeys)},_buildKeys:function(e){var t=e.getUniqueAddressForMatching();if(!this.hasUniqueAddressForMatching(t))return T;var i=[],a=e.getFirstName().getValue(),r=e.getASCIIFirstName().getValue();a!==T&&""!==a&&i.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(a)),r!==T&&""!==r&&r!==a&&i.push(r);var s=[],n=e.getLastName().getValue(),a=e.getASCIILastName().getValue();n!==T&&""!==n&&s.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(n)),a!==T&&""!==a&&a!==n&&s.push(a);r=[],n=e.getDisplayName().getValue(),a=e.getASCIIDisplayName().getValue();n!==T&&""!==n&&r.push(g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(n)),a!==T&&""!==a&&a!==n&&r.push(a);for(var o=[],c=e.getPhoneNumbers().getValues(),l=0;l<c.length;l++){var d=c[l].getPhoneNumber();d!==T&&""!==d&&-1===o.indexOf(d)&&o.push(d)}for(var C=[],u=e.getEmailAddresses().getValues(),l=0;l<u.length;l++){var h=u[l].getAddress();h!==T&&""!==h&&-1===C.indexOf(h)&&C.push(h)}var _=[],v=e.getIMAddresses().getValues();for(l=0;l<v.length;l++){var p=v[l].getAddress();p!==T&&""!==p&&-1===_.indexOf(p)&&_.push(p)}a={};a[g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[t];t=e.getAlias().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.ALIAS]=[g.Services.Contacts.ContactsUtils.normalizeAndSimplifyNameString(t)]);t=e.getCity().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.CITY]=[t]);var t=e.getAlias().getValue();t!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.DEPARTMENT]=[t]),!g.Base.Utils.isDefined(e.getTerminal())||(t=e.getTerminal().getTerminalName())!==T&&""!==t&&(a[g.Services.Contacts.ContactCacheKeys.TERMINAL_NAME]=[t]),0<i.length&&(a[g.Services.Contacts.ContactCacheKeys.FIRST_NAME]=i),0<s.length&&(a[g.Services.Contacts.ContactCacheKeys.LAST_NAME]=s),0<r.length&&(a[g.Services.Contacts.ContactCacheKeys.DISPLAY_NAME]=r),0<o.length&&(a[g.Services.Contacts.ContactCacheKeys.PHONE_NUMBER]=o),0<C.length&&(a[g.Services.Contacts.ContactCacheKeys.EMAIL_ADDRESS]=C),0<_.length&&(a[g.Services.Contacts.ContactCacheKeys.HANDLE]=_);e=e.getScopiaLoginId().getValue();return e!==T&&""!==e&&(a[g.Services.Contacts.ContactCacheKeys.LOGIN_ID]=[e]),a},_buildKeysWithMatchingAddressOnly:function(e){var t=e.getUniqueAddressForMatching();if(!this.hasUniqueAddressForMatching(t))return T;e={};return e[g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING]=[t],e},hasUniqueAddressForMatching:function(e){return!(!g.Base.Utils.isDefined(e)||""===e)||(g.Base.Logger.warn(g.Base.LoggerTags.CONTACTS_SERVICE,"Failed to build keys for contact without unique address"),!1)},isContactInCache:function(e){if(!this.hasUniqueAddressForMatching(e))return!1;var t=g.Services.Contacts.ContactCacheKeys.ADDRESS_FOR_MATCHING;return 0<this._imdb.searchBySingleKey(t,e).length}},g.Services.Contacts.ContactsCache=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a,r,s){this._uniqueSearchId=n.Base.Utils.makeId(16),this._searchString=e,this._searchField=t,this._searchSource=i,this._maxResults=a,this._maxChunkSize=r,this._searchNetworkSource=s}e.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_generateNewUniqueSearchId:function(){this._uniqueSearchId=n.Base.Utils.makeId(16)},getSearchString:function(){return this._searchString},_setSearchString:function(e){this._searchString=e},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource},getSearchNetworkSource:function(){return this._searchNetworkSource},getMaxResults:function(){return this._maxResults},getMaxChunkSize:function(){return this._maxChunkSize}},n.Services.Contacts.ContactSearchRequest=e}(AvayaClientServices),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this),this._reason=e,this.name="ContactError",this.message=t}(e.prototype=Object.create(i.Base.BaseError.prototype)).getReason=function(){return this._reason},i.Services.Contacts.ContactsError=e}(AvayaClientServices),function(s){"use strict";function e(){this._contactsService=T,this._contacts=T,this._started=!1,this._onContactsChangedCallback=T,this._externalContactListChangesCallbacks=E.Callbacks()}e.prototype={start:function(e,t){!this._started&&e&&t&&(this._started=!0,this._contactsService=e,this._contacts=t,this._registerCallbacks())},stop:function(){this._started&&(this._started=!1,this._unregisterCallbacks())},isStarted:function(){return this._started},addOnContactListChangedCallback:function(e){e&&this._externalContactListChangesCallbacks.add(e)},removeOnContactListChangedCallback:function(e){e&&this._externalContactListChangesCallbacks.remove(e)},updateMatchedContactsForParticipant:function(e,t){var i,a=s.Services.Contacts.SearchFieldType.HANDLE,r=s.Services.Contacts.SearchFieldType.ALL;this._started&&e&&((i=e.getAddress())&&(a=this._contactsService.findLocalMatchingContacts(i,a),t&&a.isEmpty()&&(i=s.Services.Contacts.ContactsUtils.parseSipUri(i).userpart,s.Base.Utils.isDefined(i)&&(a=this._contactsService.findLocalMatchingContacts(i,r))),e.setMatchedContacts(a)))},_registerCallbacks:function(){this._onContactsChangedCallback=function(){this._externalContactListChangesCallbacks.fire()}.bind(this),this._contactsService.getDataSet().addOnDataSetChangedCallback(this._onContactsChangedCallback)},_unregisterCallbacks:function(){this._contactsService.getDataSet().removeOnDataSetChangedCallback(this._onContactsChangedCallback)}},s.Services.Contacts.ContactsIntegrationService=e}(AvayaClientServices),function(c){"use strict";function e(e,t,i,a,r,s){this._presenceService=a,this._contactsService=r,this._directorySearchProvider=t,this._contactsCache=i,this._searchRequest=e,this._dataSet=new c.Base.DataSet,this._dataRetrieval=new c.Base.DataRetrieval(this._dataSet),this._dataRetrieval._onCancel=this._cancel.bind(this),this._resultsCounter=0,this._maxResults=T,this._currentUniqueSearchId=T,this._searchCompletionDate=T,this._contactsAnalyticsService=s}e.prototype={start:function(){var e=this._searchRequest.getSearchSource(),r=this._searchRequest.getUniqueSearchId();this._maxResults=0<this._searchRequest.getMaxResults()?Math.min(this._searchRequest.getMaxResults(),this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal()):this._directorySearchProvider._selectedProvider.getMaxSearchResultsTotal(),this._currentUniqueSearchId=r,this._searchCompletionDate=T,this._resultsCounter=0;var t=function(e,t,i){this._isResultValid(r)&&(!0===t?this._dataRetrieval._dataRetrievalDone.fire(t,i):this._dataRetrieval._dataRetrievalDone.fire(t,T),this._searchCompletionDate=new Date)}.bind(this),i=function(e){this._isResultValid(r)&&(this._dataRetrieval._dataRetrievalFailed.fire(e),this._searchCompletionDate=new Date)}.bind(this),a=function(e,t,i,a){this._isResultValid(r)&&this._handleResults(e,t,i,a)}.bind(this);(e===c.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():e===c.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(t,i,a)},updateRequest:function(e){this._searchRequest._setSearchString(e),this._searchRequest._generateNewUniqueSearchId(),this._dataSet.onDataSetChanged(this._dataSet.splice(0,this._dataSet.length),c.Base.DataSetChangeTypes.REMOVED),this._searchFinished=!1,this.start()},getDataRetrieval:function(){return this._dataRetrieval},getSearchCompletionDate:function(){return this._searchCompletionDate},_isResultValid:function(e){return!this._searchCompletionDate&&this._currentUniqueSearchId===e},_handleResults:function(e,t,i,a){for(var r=!1,s=function(t){try{return this._findInArray(this._dataSet,function(e){return e.getUniqueAddressForMatching()===t.getUniqueAddressForMatching()})}catch(e){return null}}.bind(this),n=0;n<e.length&&!this._searchFinished;n++){r=!0,e[n]._setPresenceService(this._presenceService),e[n]._setContactsService(this._contactsService);var o=!1;(o=a?s(e[n]):o)?this._mergeContacts(o,e[n]):this._dataSet.push(e[n]),this._searchFinished=this._maxResults!==T&&0!==this._maxResults&&++this._resultsCounter>=this._maxResults}void 0===t&&(t=!1),r&&(this._dataSet.onDataSetChanged(e.slice(0,n),c.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,t,i))},_mergeContacts:function(e,t){this._updateContactField(e.getFirstName(),t.getFirstName()),this._updateContactField(e.getLastName(),t.getLastName()),this._updateContactField(e.getDisplayName(),t.getDisplayName()),this._updateContactField(e.getASCIIFirstName(),t.getASCIIFirstName()),this._updateContactField(e.getASCIILastName(),t.getASCIILastName()),this._updateContactField(e.getASCIIDisplayName(),t.getASCIIDisplayName()),this._updateContactField(e.getAlias(),t.getAlias()),this._updateContactField(e.getLocation(),t.getLocation()),this._updateContactField(e.getWorkRoomNumber(),t.getWorkRoomNumber()),this._updateContactField(e.getStreetAddress(),t.getStreetAddress()),this._updateContactField(e.getCity(),t.getCity()),this._updateContactField(e.getState(),t.getState()),this._updateContactField(e.getCountry(),t.getCountry()),this._updateContactField(e.getPostalCode(),t.getPostalCode()),this._updateContactField(e.getCompany(),t.getCompany()),this._updateContactField(e.getManager(),t.getManager()),this._updateContactField(e.getDepartment(),t.getDepartment()),this._updateContactField(e.getLanguage(),t.getLanguage()),this._updateContactField(e.getNotes(),t.getNotes()),this._updateContactField(e.getScopiaUserId(),t.getScopiaUserId()),this._updateContactField(e.getScopiaLoginId(),t.getScopiaLoginId()),this._updateContactField(e.getRank(),t.getRank()),this._updateContactField(e.isBuddy(),t.isBuddy()),this._updateContactField(e.isFavorite(),t.isFavorite()),this._updateContactField(e.isVideoCapable(),t.isVideoCapable());var i=function(t,e){return this._findInArray(e,function(e){return e.getPhoneNumber()===t.getPhoneNumber()})}.bind(this);this._mergeContactArrayField(e.getPhoneNumbers().getValues(),t.getPhoneNumbers().getValues(),i);i=function(t,e){return this._findInArray(e,function(e){return e.getAddress()===t.getAddress()})}.bind(this);this._mergeContactArrayField(e.getEmailAddresses().getValues(),t.getEmailAddresses().getValues(),i),this._mergeContactArrayField(e.getIMAddresses().getValues(),t.getIMAddresses().getValues(),i);i=function(t,e){return this._findInArray(e,function(e){return e.getValue()===t.getValue()})}.bind(this);this._mergeContactArrayField(e.getCustom1().getValues(),t.getCustom1().getValues(),i),this._mergeContactArrayField(e.getCustom2().getValues(),t.getCustom2().getValues(),i),this._mergeContactArrayField(e.getCustom3().getValues(),t.getCustom3().getValues(),i)},_updateContactField:function(e,t){c.Base.Utils.isDefined(t._value)&&e._value!==t._value&&(e._value=t._value)},_mergeContactArrayField:function(e,t,i){for(var a=0;a<t.length;a++)i(t[a],e)||e.push(t[a])},_findInArray:function(e,t){if(!e||"function"!=typeof t)return null;for(var i=0;i<e.length;){var a=e[i];if(t(a))return a;i++}return null},_cancel:function(){this._searchCompletionDate=new Date,this._dataRetrieval._dataRetrievalFailed.fire(new c.Services.Contacts.ContactsError(c.Services.Contacts.ContactsErrorReason.REQUEST_CANCELED)),this._searchRequest.getSearchSource()!==c.Services.Contacts.SearchSourceType.LOCAL&&this._directorySearchProvider.stopDirectorySearch(this._searchRequest.getUniqueSearchId())},_limitExceeded:function(e){return this._maxResults!==T&&0!==this._maxResults&&e>this._maxResults},_resolveSearch:function(e,t,i){this._limitExceeded(t)?e.resolve(t,!1):e.resolve(t,i,t)},_searchNetworkContacts:function(){var a=this._contactsAnalyticsService.startTimingMetric(),e=this._directorySearchProvider.startDirectorySearch(this._searchRequest);return e.then(function(e,t,i){this._contactsAnalyticsService.sendNumDirectorySearches(this._searchRequest.getSearchField()),this._contactsAnalyticsService.directorySearchTimeEnd(a)}.bind(this)),e},_searchLocalContacts:function(){var e=E.Deferred(),t=this._contactsAnalyticsService.startTimingMetric(),i=this._contactsCache.searchContacts(this._searchRequest.getSearchString(),this._searchRequest.getSearchField(),!1);return this._contactsAnalyticsService.cachedContactsSearchTimeEnd(t),this._contactsAnalyticsService.sendNumCachedContactSearches(this._searchRequest.getSearchField()),setTimeout(function(){i?e.notify(i,!0,0):i=[],this._resolveSearch(e,i.length,!0)}.bind(this),0),e.promise()},_searchAllContacts:function(){function s(e,t,i){t?n=r.length+e.length:e.forEach(function(e){r.push(e.getUniqueAddressForMatching())});var a=!i&&0!==i?!1:!0;o.notify(e,a,i,t)}var n,o=E.Deferred(),r=[],t=function(e,t,i,a,r){return this._searchLocalContacts().then(function(){a?o.reject(r):this._resolveSearch(o,n,t)}.bind(this),function(e){o.reject(e)},function(e){s(e,!0,i)})}.bind(this);return this._searchNetworkContacts().then(t,function(e){c.Base.Logger.error(c.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts search failed",e),t(0,!1,0,!0,e)},s),o.promise()}},c.Services.Contacts.ContactsSearch=e}(AvayaClientServices),function(P){"use strict";function e(e,t,i,a,r){this._started=!1,this._starting=!1,this._contactsModule=T,this._contactsIntegrationService=i,this._presenceService=a,this._contactsProvider=e,this._directorySearchProvider=t,this._contactsCache=new P.Services.Contacts.ContactsCache,this._contactsDataSet=new P.Base.DataSet,this._contactsRetrieval=new P.Base.DataRetrieval(this._contactsDataSet),this._retrievalFinished=!1,this._selfContact=T,this._activeSearches={},this._activeResolveContactsRequests={},this._searchAuditIntervalId=T,this._deniedCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._addContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._updateContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._deleteContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchContactCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._searchTerminalCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._resolveContactsCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._conferenceSearchCapability=new P.Base.Capability(P.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._contactsAnalyticsService=r,this._selfContactBackoffPromise=T,this._selfContactBackoffTimeout=T}e.prototype={start:function(t,e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Starting the service");var i,a=this._contactsAnalyticsService.startTimingMetric();t.addOnContactsServiceUnavailableCallback(function(){i=this._contactsAnalyticsService.startTimingMetric()}.bind(this)),t.addOnContactsServiceAvailableCallback(function(){this._contactsAnalyticsService.durationContactProviderOutagesEnd(i)}.bind(this)),this._contactsModule=t,this._starting=!0,this._selfContactBackoffPromise=E.Deferred();var r=function(){return this._contactsProvider.on(P.Base.NetworkProviderEvents.UNAUTHORIZED,function(){t._fireContactsUnavailableCallback(t)}.bind(this)),this._directorySearchProvider.start(e,t)}.bind(this),s=function(){return this._directorySearchProvider.getSelfContact().then(function(e){e._setContactsService(this),e._setPresenceService(this._presenceService),e._setSelfContact(!0),this._selfContact=e,this._starting=!1,this._started=!0,t._fireContactsAvailableCallback(t),P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service started successfully")}.bind(this),function(e){return P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Self contact cannot be found",e),E.Deferred().reject(e).promise()}.bind(this))}.bind(this),n=function(t){var i=this._selfContactBackoffPromise;return this._selfContactBackoffTimeout=setTimeout(function(){t().then(function(){i.resolve()},function(e){e&&e.getReason&&e.getReason()===P.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT?n(t):i.reject(e)})}.bind(this),3e4),i}.bind(this),o=function(){return r().then(function(){this._registerContactChangesCallbacks(),this._recalculateCapabilities(),this._contactsIntegrationService.start(this,t)}.bind(this)).then(s).fail(function(e){t._fireContactsUnavailableCallback(t),this._starting=!1,this._started=!1,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",e),e&&e.getReason&&e.getReason()===P.Services.Contacts.ContactsErrorReason.REQUEST_TIMEOUT&&(P.Base.Logger.warn(P.Base.LoggerTags.ACS_CONTACTS_PROVIDER,"Starting backoff algorithm for populateSelfContact."),n(s))}.bind(this)).then(function(){this._contactsAnalyticsService.contactsLoadTimeEnd(a)}.bind(this))}.bind(this);return function(){return this._contactsProvider.on(P.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,function(){this.isStarted()||this.isStarting()||o()}.bind(this)),this._contactsProvider.on(P.Providers.ACS.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,function(){this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new P.Base.NetworkError(P.Base.ErrorReasons.NETWORK_ERROR)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout)}.bind(this)),this._contactsProvider.start(e,t)}.bind(this)().then(o,function(e){this._starting=!1,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to start service",e)}.bind(this))},stop:function(e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var t=E.Deferred();this._started||t.reject(new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),e._fireContactsUnavailableCallback(e),this._started=!1,this._selfContactBackoffPromise&&this._selfContactBackoffPromise.reject(new P.Base.NetworkError(P.Base.ErrorReasons.NETWORK_CANCELED)),this._selfContactBackoffTimeout&&clearTimeout(this._selfContactBackoffTimeout);var i=function(e){this._started=!0,P.Base.Logger.error(P.Base.LoggerTags.CONTACTS_SERVICE,"Failed to stop service",e),t.reject(e)}.bind(this),a=function(){return this._contactsProvider.stop().fail(i)}.bind(this),e=function(){return this._cleanupResources(),this._directorySearchProvider.stop().fail(i)}.bind(this);return a().then(e).then(function(){this._contactsIntegrationService.stop(),this._selfContact=T,P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),t.resolve()}.bind(this),i.bind(this)),t.promise()},stopImmediately:function(e){P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Stopping the service");var t=E.Deferred();return this._started||t.reject(new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),e._fireContactsUnavailableCallback(e),this._started=!1,this._contactsProvider.stopImmediately(),P.Base.Logger.info(P.Base.LoggerTags.CONTACTS_SERVICE,"Service stopped successfully"),t.resolve(),t.promise()},isStarted:function(){return this._started},isStarting:function(){return this._starting},createEditableContact:function(){var e=this._contactsProvider.createContactForAdd();return e._setContactsService(this),e},createEditableContactFromContact:function(e){if(e.getTerminal()&&""!==e.getTerminal().getTerminalId())throw new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.EDIT_TERMINAL_NOT_SUPPORTED);var t=new P.Services.Contacts.EditableContact,i=this._contactsProvider.createContactForAdd();t._setContactsService(this),t._setInContactList(e._isInContactList()),t._isInContactList()&&t._setUniqueAddressForMatching(e._getUniqueAddressWithoutChanges()),t.getFirstName().setValue(e.getFirstName().getValue()),t.getLastName().setValue(e.getLastName().getValue()),t.getDisplayName().setValue(e.getDisplayName().getValue()),t.getASCIIFirstName().setValue(e.getASCIIFirstName().getValue()),t.getASCIILastName().setValue(e.getASCIILastName().getValue()),t.getASCIIDisplayName().setValue(e.getASCIIDisplayName().getValue()),t.getAlias().setValue(e.getAlias().getValue()),t.getLocation().setValue(e.getLocation().getValue()),t.getWorkRoomNumber().setValue(e.getWorkRoomNumber().getValue()),t.getStreetAddress().setValue(e.getStreetAddress().getValue()),t.getCity().setValue(e.getCity().getValue()),t.getState().setValue(e.getState().getValue()),t.getCountry().setValue(e.getCountry().getValue()),t.getPostalCode().setValue(e.getPostalCode().getValue()),t.getCompany().setValue(e.getCompany().getValue()),t.getManager().setValue(e.getManager().getValue()),t.getDepartment().setValue(e.getDepartment().getValue()),t.getLanguage().setValue(e.getLanguage().getValue()),t.getNotes().setValue(e.getNotes().getValue()),t.getScopiaUserId().setValue(e.getScopiaUserId().getValue()),t.getScopiaLoginId().setValue(e.getScopiaLoginId().getValue()),t.getRank().setValue(e.getRank().getValue()),t.isBuddy().setValue(e.isBuddy().getValue()),t.isFavorite().setValue(e.isFavorite().getValue()),t.isVideoCapable().setValue(e.isVideoCapable().getValue()),t.getFirstName()._setWriteCapability(e.getFirstName().getWriteCapability()),t.getLastName()._setWriteCapability(e.getLastName().getWriteCapability()),t.getDisplayName()._setWriteCapability(e.getDisplayName().getWriteCapability()),t.getASCIIFirstName()._setWriteCapability(e.getASCIIFirstName().getWriteCapability()),t.getASCIILastName()._setWriteCapability(e.getASCIILastName().getWriteCapability()),t.getASCIIDisplayName()._setWriteCapability(e.getASCIIDisplayName().getWriteCapability()),t.getAlias()._setWriteCapability(e.getAlias().getWriteCapability()),t.getLocation()._setWriteCapability(e.getLocation().getWriteCapability()),t.getWorkRoomNumber()._setWriteCapability(e.getWorkRoomNumber().getWriteCapability()),t.getStreetAddress()._setWriteCapability(e.getStreetAddress().getWriteCapability()),t.getCity()._setWriteCapability(e.getCity().getWriteCapability()),t.getState()._setWriteCapability(e.getState().getWriteCapability()),t.getCountry()._setWriteCapability(e.getCountry().getWriteCapability()),t.getPostalCode()._setWriteCapability(e.getPostalCode().getWriteCapability()),t.getCompany()._setWriteCapability(e.getCompany().getWriteCapability()),t.getManager()._setWriteCapability(e.getManager().getWriteCapability()),t.getDepartment()._setWriteCapability(e.getDepartment().getWriteCapability()),t.getLanguage()._setWriteCapability(e.getLanguage().getWriteCapability()),t.getNotes()._setWriteCapability(e.getNotes().getWriteCapability()),t.getScopiaUserId()._setWriteCapability(e.getScopiaUserId().getWriteCapability()),t.getScopiaLoginId()._setWriteCapability(e.getScopiaLoginId().getWriteCapability()),t.getRank()._setWriteCapability(e.getRank().getWriteCapability()),t.isBuddy()._setWriteCapability(e.isBuddy().getWriteCapability()),t.isFavorite()._setWriteCapability(e.isFavorite().getWriteCapability()),t.isVideoCapable()._setWriteCapability(e.isVideoCapable().getWriteCapability());for(var a=e.getPhoneNumbers().getValues(),r=t.getPhoneNumbers().getValues(),s=0;s<a.length;s++){var n=new P.Services.Contacts.EditableContactPhoneField;n.setPhoneNumber(a[s].getPhoneNumber()),n.setPhoneNumberType(a[s].getPhoneNumberType()),n.setSpeedDialEnabled(a[s].isSpeedDialEnabled()),n.setLabel1(a[s].getLabel1()),n.setLabel2(a[s].getLabel2()),n.setDefault(a[s].isDefault()),n._setWriteCapability(a[s].getWriteCapability()),r.push(n)}for(var o=e.getEmailAddresses().getValues(),c=t.getEmailAddresses().getValues(),s=0;s<o.length;s++){var l=new P.Services.Contacts.EditableContactEmailAddressField;l.setAddress(o[s].getAddress()),l.setEmailAddressType(o[s].getEmailAddressType()),l._setWriteCapability(o[s].getWriteCapability()),c.push(l)}var d=e.getIMAddresses().getValues(),C=t.getIMAddresses().getValues();for(s=0;s<d.length;s++){var u=new P.Services.Contacts.EditableContactIMAddressField;u.setAddress(d[s].getAddress()),u.setIMAddressType(d[s].getIMAddressType()),u._setWriteCapability(d[s].getWriteCapability()),C.push(u)}var h=e.getCustom1().getValues(),_=t.getCustom1().getValues();for(s=0;s<h.length;s++){var v=new P.Services.Contacts.EditableContactStringField;v.setValue(h[s].getValue()),v._setWriteCapability(h[s].getWriteCapability()),_.push(v)}var p=e.getCustom2().getValues(),g=t.getCustom2().getValues();for(s=0;s<p.length;s++){var S=new P.Services.Contacts.EditableContactStringField;S.setValue(p[s].getValue()),S._setWriteCapability(p[s].getWriteCapability()),g.push(S)}var f=e.getCustom3().getValues(),E=t.getCustom3().getValues();for(s=0;s<f.length;s++){var A=new P.Services.Contacts.EditableContactStringField;A.setValue(f[s].getValue()),A._setWriteCapability(f[s].getWriteCapability()),E.push(A)}return e.getPhoneNumbers()._setWriteCapability(i.getPhoneNumbers().getWriteCapability()),e.getEmailAddresses()._setWriteCapability(i.getEmailAddresses().getWriteCapability()),e.getIMAddresses()._setWriteCapability(i.getIMAddresses().getWriteCapability()),e.getCustom1()._setWriteCapability(i.getCustom1().getWriteCapability()),e.getCustom2()._setWriteCapability(i.getCustom2().getWriteCapability()),e.getCustom3()._setWriteCapability(i.getCustom3().getWriteCapability()),t},addContact:function(e){return this._contactsProvider.addContact(e)},updateContact:function(e){return this._contactsProvider.updateContact(e)},deleteContact:function(e){return this._contactsProvider.deleteContact(e)},getContacts:function(){var e,t,i;return this._retrievalFinished?setTimeout(function(){this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this)):(e=function(){this._retrievalFinished=!0,this._contactsAnalyticsService.sendNumContactsLoaded(this._contactsDataSet.length),this._contactsRetrieval._dataRetrievalDone.fire()}.bind(this),t=function(e){this._contactsRetrieval._dataRetrievalFailed.fire(e)}.bind(this),i=function(e){this._contactsRetrieval._dataRetrievalProgress.fire(this._contactsDataSet.length,!0,e.length)}.bind(this),this._contactsProvider.retrieveAllContacts().then(e,t,i)),this._contactsRetrieval},searchContacts:function(e){var t=e.getUniqueSearchId();if(this._activeSearches[t])return P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Contact search with provided requestId is already in progress - returning associated DataRetrieval"),this._activeSearches[t].getDataRetrieval();e=new P.Services.Contacts.ContactsSearch(e,this._directorySearchProvider,this._contactsCache,this._presenceService,this,this._contactsAnalyticsService);return(this._activeSearches[t]=e).start(),e.getDataRetrieval()},resolveContacts:function(e){var t=e.getUniqueSearchId();if(this._activeResolveContactsRequests[t])return P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Contact resolution with provided requestId is already in progress - returning associated DataRetrieval"),this._activeResolveContactsRequests[t].getDataRetrieval();e=new P.Services.Contacts.ResolveContacts(e,this._directorySearchProvider,this._contactsCache,this._contactsAnalyticsService);return(this._activeResolveContactsRequests[t]=e).start(),e.getDataRetrieval()},changeSearchContactsRequest:function(e,t){var i,a;for(a in this._activeSearches)if(this._activeSearches.hasOwnProperty(a)&&this._activeSearches[a].getDataRetrieval()===e){i=this._activeSearches[a];break}if(!i)throw new P.Services.Contacts.ContactsError(P.Services.Contacts.ContactsErrorReason.SEARCH_REQUEST_NOT_FOUND);i.updateRequest(t)},_startSearchRequestsAudit:function(){this._searchAuditIntervalId=setInterval(function(){var e,t,i=new Date;for(e in this._activeSearches)!this._activeSearches.hasOwnProperty(e)||(t=this._activeSearches[e].getSearchCompletionDate())&&12e4<i-t&&delete this._activeSearches[e]}.bind(this),12e4)},_stopSearchRequestsAudit:function(){clearInterval(this._searchAuditIntervalId),this._searchAuditIntervalId=T},findLocalMatchingContacts:function(e,t){return this._contactsCache.searchContacts(e,t,!0)},getAddContactCapability:function(){return this._addContactCapability},getUpdateContactCapability:function(e){return e&&e._isInContactList()?this._updateContactCapability:this._deniedCapability},getDeleteContactCapability:function(e){return e&&e._isInContactList()?this._deleteContactCapability:this._deniedCapability},getNetworkSearchContactCapability:function(){return this._searchContactCapability},getNetworkResolveContactsCapability:function(){return this._resolveContactsCapability},getNetworkSearchTerminalCapability:function(){return this._searchTerminalCapability},getExtendedContactDetailsCapability:function(){return this._extendedDetailsCapability},getConferenceSearchCapability:function(){return this._conferenceSearchCapability},_recalculateCapabilities:function(){var e=!1,t=this._contactsProvider.getAddContactCapability();this._addContactCapability!==t&&(this._addContactCapability=t,e=!0);t=this._contactsProvider.getUpdateContactCapability();this._updateContactCapability!==t&&(this._updateContactCapability=t,e=!0);t=this._contactsProvider.getDeleteContactCapability();this._deleteContactCapability!==t&&(this._deleteContactCapability=t,e=!0);t=this._directorySearchProvider.getNetworkSearchContactCapability();this._searchContactCapability!==t&&(this._searchContactCapability=t,e=!0);t=this._directorySearchProvider.getNetworkResolveContactsCapability();this._resolveContactsCapability!==t&&(this._resolveContactsCapability=t,e=!0);t=this._directorySearchProvider.getNetworkSearchTerminalCapability();this._searchTerminalCapability!==t&&(this._searchTerminalCapability=t,e=!0);t=this._directorySearchProvider.getConferenceSearchCapability();this._conferenceSearchCapability!==t&&(this._conferenceSearchCapability=t,e=!0);t=this._contactsProvider.getExtendedContactDetailsCapability();this._extendedDetailsCapability!==t&&(this._extendedDetailsCapability=t,e=!0),e&&this._contactsModule._onCapabilitiesChangedCallbacks.fire(this)},_registerContactChangesCallbacks:function(){var e=P.Providers.Interfaces.ContactsProviderCallbackIds;this._contactsProvider.on(e.CONTACT_ADDED,function(e){for(var t=0;t<e.length;t++)e[t]._setInContactList(!0),e[t]._setPresenceService(this._presenceService),e[t]._setContactsService(this),this._contactsDataSet.push(e[t]),this._contactsCache.addContact(e[t]);this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.ADDED)}.bind(this));var a=function(e){for(var t=0;t<this._contactsDataSet.length;t++)if(e.getUniqueAddressForMatching()===this._contactsDataSet[t].getUniqueAddressForMatching())return t}.bind(this);this._contactsProvider.on(e.CONTACT_UPDATED,function(e){var t=a(e);P.Base.Utils.isDefined(t)?(this._contactsDataSet[t]=e,this._contactsDataSet.onDataSetChanged([e],P.Base.DataSetChangeTypes.UPDATED)):(P.Base.Logger.warn(P.Base.LoggerTags.CONTACTS_SERVICE,"Updated contact was not found in DataSet",e),this._contactsDataSet.push(e),this._contactsDataSet.onDataSetChanged([e],P.Base.DataSetChangeTypes.ADDED)),e._setInContactList(!0),e._setPresenceService(this._presenceService),e._setContactsService(this),this._contactsCache.updateContact(e)}.bind(this)),this._contactsProvider.on(e.CONTACT_DELETED,function(e){for(var t=0;t<e.length;t++){var i=a(e[t]);this._contactsDataSet.splice(i,1),e[t]._setInContactList(!1),e[t]._setPresenceService(this._presenceService),e[t]._setContactsService(this),this._contactsCache.deleteContact(e[t])}this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.REMOVED)}.bind(this)),this._contactsProvider.on(e.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this)),this._directorySearchProvider.on(e.CAPABILITIES_CHANGED,this._recalculateCapabilities.bind(this))},getContactsModule:function(){return this._contactsModule},isContactInCache:function(e){return this._contactsCache.isContactInCache(e.getUniqueAddressForMatching())},getSelfContact:function(){return this._selfContact},getDataSet:function(){return this._contactsDataSet},_cleanupResources:function(){this._contactsCache.empty();var e=this._contactsDataSet.splice(0,this._contactsDataSet.length);0<e.length&&this._contactsDataSet.onDataSetChanged(e,P.Base.DataSetChangeTypes.REMOVED),this._contactsDataSet.dataSetChangeCallbacks.empty(),this._contactsDataSet.dataSetInvalidatedCallbacks.empty(),this._contactsRetrieval._dataRetrievalProgress.empty(),this._contactsRetrieval._dataRetrievalDone.empty(),this._contactsRetrieval._dataRetrievalFailed.empty(),this._activeSearches={},this._activeResolveContactsRequests={}}},P.Services.Contacts.ContactsService=e}(AvayaClientServices),function(c){"use strict";var e="\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*",t="(\\*|#|\\d)\\d{0,3}",i=new RegExp("^"+e+"$","i"),a=new RegExp("^"+t+"$","i"),r=new RegExp("^((\\+?[0-9\\(\\)\\.\\-]*\\d{1}[0-9\\(\\)\\.\\-]*)|((\\*|#|\\d)\\d{0,3}))[#\\*,;]{1}[#\\*,;0-9]*$","i"),s=new RegExp("^(([^:/?#]+):)?(([^/?@#]*)@)?([^/?;#\\s]*)?","i"),n=new RegExp("^\\++[1-9]\\d{1,14}$","i"),o=new RegExp("^.+\\@.+$","i"),l=new RegExp("^\\+?[0-9a-z]+[0-9a-z\\(\\)\\.\\-]*$","i"),d={getPhoneStringType:function(e){return e&&""!==e.trim()?d.isPhoneNumber(e)?c.Services.Contacts.PhoneStringTypes.PHONE_NUMBER:d.isDialString(e)?c.Services.Contacts.PhoneStringTypes.DIALSTRING:d.isFeatureAccessCode(e)?c.Services.Contacts.PhoneStringTypes.FEATURE_ACCESS_CODE:d.isSipUri(e)?c.Services.Contacts.PhoneStringTypes.SIP_URI:c.Services.Contacts.PhoneStringTypes.UNKNOWN:c.Services.Contacts.PhoneStringTypes.UNKNOWN},isSipUri:function(e){return!!e&&!!d.parseSipUri(e).userpart},isPhoneNumber:function(e){return i.test(e)},isFeatureAccessCode:function(e){return a.test(e)},isDialString:function(e){return r.test(e)},isPhoneWithDomain:function(e){return o.test(e)},isE164Userpart:function(e){return n.test(d.parseSipUri(e).userpart)},isAlphanumericUserpart:function(e){return l.test(d.parseSipUri(e).userpart)},isNumericUserpart:function(e){return d.isPhoneNumber(d.parseSipUri(e).userpart)},normalizePhoneString:function(e){e=e.replace(/^(\+)+|([\s\-\(\)\.])+/g,"");return d.mapAlphabeticalToITU(e)},normalizeHandle:function(e){return e.replace(/^([a-z]+[a-z0-9+.-]*\:)/g,"")},normalizeAndSimplifyNameString:function(e){return e.toLowerCase().replace(/\u1E9E/g,"sz").replace(/\u00DF/g,"sz").replace(/\u00F8/g,"o").normalize("NFD").replace(/[\u0080-\u036F]/g,"").replace("ss","sz").replace("ue","u").replace("ae","a").replace("oe","o")},mapAlphabeticalToITU:function(e){return e.replace(/[ABC]{1}/i,"2").replace(/[DEF]{1}/i,"3").replace(/[GHI]{1}/i,"4").replace(/[JKL]{1}/i,"5").replace(/[MNO]{1}/i,"6").replace(/[PQRS]{1}/i,"7").replace(/[TUV]{1}/i,"8").replace(/[WXYZ]{1}/i,"9")},parseSipUri:function(e){e=e.match(s);return{scheme:e[2],userpart:e[4],host:e[5]}},comparePhoneStrings:function(e,t){var i,a,r=c.Services.Contacts.PhoneStringTypes,s=c.Services.Contacts.ContactMatchTypes,n=d.getPhoneStringType(e),o=d.getPhoneStringType(t);return n===r.UNKNOWN||o===r.UNKNOWN?s.NO_MATCH:(e=n===r.SIP_URI?(i=d.parseSipUri(e),d.normalizePhoneString(i.userpart)):d.normalizePhoneString(e),t=o===r.SIP_URI?(a=d.parseSipUri(t),d.normalizePhoneString(a.userpart)):d.normalizePhoneString(t),n!==r.SIP_URI||o!==r.SIP_URI||i.scheme===a.scheme&&i.host===a.host?e===t?n===r.SIP_URI&&o!==r.SIP_URI||n!==r.SIP_URI&&o===r.SIP_URI?s.EXACT_TYPE2:s.EXACT_TYPE1:d._trimPhoneString(e)===d._trimPhoneString(t)?s.PARTIAL_TYPE1:s.NO_MATCH:s.NO_MATCH)},_trimPhoneString:function(e){return e.substr(e.length-10)},getPhoneAndVideoChannelPresenceAddress:function(e){var t=e.getPhoneNumbers().getValues().filter(function(e){return e.isAvayaAdministered()&&e.getPhoneNumberType()===c.Services.Contacts.ContactPhoneNumberType.PHONE_NUMBER_WORK}),i=t.filter(function(e){return d.isPhoneWithDomain(e.getPhoneNumber())}),e=i.filter(function(e){return d.isE164Userpart(e.getPhoneNumber())});if(e[0])return c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first E.164 phone number as Phone/Video channel presence address"),e[0];e=i.filter(function(e){return d.isNumericUserpart(e.getPhoneNumber())});if(e[0])return c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first numeric phone number as Phone/Video channel presence address"),e[0];e=i.filter(function(e){return d.isAlphanumericUserpart(e.getPhoneNumber())});return e[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first alphanumeric phone number as Phone/Video channel presence address"),e[0]):i[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first phone number with domain as Phone/Video channel presence address"),i[0]):t[0]?(c.Base.Logger.info(c.Base.LoggerTags.CONTACTS_SERVICE,"Using first Avaya administered phone number as Phone/Video channel presence address"),t[0]):void c.Base.Logger.warn(c.Base.LoggerTags.CONTACTS_SERVICE,"No suitable Phone/Video channel presence address found in self contact. Channel presence publications might not work as expected.")}};c.Services.Contacts.ContactsUtils=d}(AvayaClientServices),function(e){"use strict";function t(){this._uniqueAddressForMatching=T,this._firstName=new e.Services.Contacts.EditableContactStringField,this._lastName=new e.Services.Contacts.EditableContactStringField,this._displayName=new e.Services.Contacts.EditableContactStringField,this._asciiFirstName=new e.Services.Contacts.EditableContactStringField,this._asciiLastName=new e.Services.Contacts.EditableContactStringField,this._asciiDisplayName=new e.Services.Contacts.EditableContactStringField,this._alias=new e.Services.Contacts.EditableContactStringField,this._company=new e.Services.Contacts.EditableContactStringField,this._location=new e.Services.Contacts.EditableContactStringField,this._workRoomNumber=new e.Services.Contacts.EditableContactStringField,this._streetAddress=new e.Services.Contacts.EditableContactStringField,this._city=new e.Services.Contacts.EditableContactStringField,this._state=new e.Services.Contacts.EditableContactStringField,this._country=new e.Services.Contacts.EditableContactStringField,this._postalCode=new e.Services.Contacts.EditableContactStringField,this._manager=new e.Services.Contacts.EditableContactStringField,this._department=new e.Services.Contacts.EditableContactStringField,this._language=new e.Services.Contacts.EditableContactStringField,this._emailAddresses=new e.Services.Contacts.ContactFieldList,this._phoneNumbers=new e.Services.Contacts.ContactFieldList,this._imAddresses=new e.Services.Contacts.ContactFieldList,this._buddy=new e.Services.Contacts.EditableContactBooleanField,this._favorite=new e.Services.Contacts.EditableContactBooleanField,this._videoCapable=new e.Services.Contacts.EditableContactBooleanField,this._rank=new e.Services.Contacts.EditableContactNumberField,this._notes=new e.Services.Contacts.EditableContactStringField,this._custom1=new e.Services.Contacts.ContactFieldList,this._custom2=new e.Services.Contacts.ContactFieldList,this._scopiaUserId=new e.Services.Contacts.EditableContactStringField,this._scopiaLoginId=new e.Services.Contacts.EditableContactStringField,this._custom3=new e.Services.Contacts.ContactFieldList,this._inContactList=!1,this._contactsService=T}t.prototype={getUniqueAddressForMatching:function(){var e,t=this._uniqueAddressForMatching;return t=-1<t.indexOf("/")?(e=t.split("/"))[e.length-1]:t},_getUniqueAddressWithoutChanges:function(){return this._uniqueAddressForMatching},_setUniqueAddressForMatching:function(e){this._uniqueAddressForMatching=e},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getDisplayName:function(){return this._displayName},getASCIIFirstName:function(){return this._asciiFirstName},getASCIILastName:function(){return this._asciiLastName},getASCIIDisplayName:function(){return this._asciiDisplayName},getAlias:function(){return this._alias},getLocation:function(){return this._location},getWorkRoomNumber:function(){return this._workRoomNumber},getStreetAddress:function(){return this._streetAddress},getCity:function(){return this._city},getState:function(){return this._state},getCountry:function(){return this._country},getPostalCode:function(){return this._postalCode},getCompany:function(){return this._company},getManager:function(){return this._manager},getDepartment:function(){return this._department},getLanguage:function(){return this._language},getEmailAddresses:function(){return this._emailAddresses},getPhoneNumbers:function(){return this._phoneNumbers},getIMAddresses:function(){return this._imAddresses},isBuddy:function(){return this._buddy},isFavorite:function(){return this._favorite},isVideoCapable:function(){return this._videoCapable},getNotes:function(){return this._notes},getRank:function(){return this._rank},getCustom1:function(){return this._custom1},getCustom2:function(){return this._custom2},getCustom3:function(){return this._custom3},getScopiaUserId:function(){return this._scopiaUserId},getScopiaLoginId:function(){return this._scopiaLoginId},_isInContactList:function(){return this._inContactList},_setInContactList:function(e){this._inContactList=e},_setContactsService:function(e){this._contactsService=e}},e.Services.Contacts.EditableContact=t}(AvayaClientServices),function(r){"use strict";E.extend(r.Services.Contacts.EditableContact.prototype,{getUpdateContactCapability:function(){return this._contactsService.getUpdateContactCapability(this)},getDeleteContactCapability:function(){return this._contactsService.getDeleteContactCapability(this)},getContactSavableCapability:function(){var e=this.getLastName()&&this.getLastName().getValue()&&""!==this.getLastName().getValue().trim(),t=this.getFirstName()&&this.getFirstName().getValue()&&""!==this.getFirstName().getValue().trim(),i=this.getPhoneNumbers().getValues()[0]&&this.getPhoneNumbers().getValues()[0].getPhoneNumber()&&""!==this.getPhoneNumbers().getValues()[0].getPhoneNumber().trim(),a=this.getEmailAddresses().getValues()[0]&&this.getEmailAddresses().getValues()[0].getAddress()&&""!==this.getEmailAddresses().getValues()[0].getAddress().trim(),a=t&&e&&(i||a)?r.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED:r.Base.CapabilityDenialReason.CAPABILITY_NOT_ALLOWED;return new r.Base.Capability(a)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ContactCacheKeys={ADDRESS_FOR_MATCHING:"ADDRESS_FOR_MATCHING",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",ALIAS:"ALIAS",CITY:"CITY",DEPARTMENT:"DEPARTMENT",PHONE_NUMBER:"PHONE_NUMBER",EMAIL_ADDRESS:"EMAIL_ADDRESS",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL_NAME:"TERMINAL_NAME"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactEmailAddressType={EMAIL_ADDRESS_WORK:"EMAIL_ADDRESS_WORK",EMAIL_ADDRESS_OTHER:"EMAIL_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactIMAddressType={IM_ADDRESS_WORK:"IM_ADDRESS_WORK",IM_ADDRESS_OTHER:"IM_ADDRESS_OTHER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactMatchTypes={EXACT_TYPE1:"EXACT_TYPE1",EXACT_TYPE2:"EXACT_TYPE2",PARTIAL_TYPE1:"PARTIAL_TYPE1",NO_MATCH:"NO_MATCH"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPhoneNumberType={PHONE_NUMBER_WORK:"PHONE_NUMBER_WORK",PHONE_NUMBER_HANDLE:"PHONE_NUMBER_HANDLE",PHONE_NUMBER_MOBILE:"PHONE_NUMBER_MOBILE",PHONE_NUMBER_HOME:"PHONE_NUMBER_HOME",PHONE_NUMBER_FAX:"PHONE_NUMBER_FAX",PHONE_NUMBER_PAGER:"PHONE_NUMBER_PAGER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactPictureSize={XSMALL:"XSMALL",SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",XLARGE:"XLARGE",XXLARGE:"XXLARGE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ContactsErrorReason={UNKNOWN_REASON:"UNKNOWN_REASON",INTERNAL_ERROR:"INTERNAL_ERROR",RETRY:"RETRY",SERVER_UNAVAILABLE:"SERVER_UNAVAILABLE",INVALID_SERVER_RESPONSE:"INVALID_SERVER_RESPONSE",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED",AUTHENTICATION_CANCELLED:"AUTHENTICATION_CANCELLED",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",REQUEST_CANCELED:"REQUEST_CANCELED",DUPLICATE_CONTACT:"DUPLICATE_CONTACT",INVALID_CONTACT:"INVALID_CONTACT",REQUIRED_DATA_MISSING:"REQUIRED_DATA_MISSING",DELETE_CONTACT_NOT_AVAILABLE:"DELETE_CONTACT_NOT_AVAILABLE",ADD_CONTACT_NOT_AVAILABLE:"ADD_CONTACT_NOT_AVAILABLE",UPDATE_CONTACT_NOT_AVAILABLE:"UPDATE_CONTACT_NOT_AVAILABLE",SEARCH_CONTACTS_NOT_AVAILABLE:"SEARCH_CONTACTS_NOT_AVAILABLE",SEARCH_TERMINALS_NOT_AVAILABLE:"SEARCH_TERMINALS_NOT_AVAILABLE",GET_CONTACTS_NOT_AVAILABLE:"GET_CONTACTS_NOT_AVAILABLE",CONTACT_NOT_FOUND:"CONTACT_NOT_FOUND",INVALID_SEARCH_REQUEST:"INVALID_SEARCH_REQUEST",INVALID_SEARCH_STRING:"INVALID_SEARCH_STRING",INVALID_SEARCH_STRINGS:"INVALID_SEARCH_STRINGS",INVALID_SEARCH_SOURCE:"INVALID_SEARCH_SOURCE",INVALID_SEARCH_FIELD:"INVALID_SEARCH_FIELD",SEARCH_REQUEST_NOT_FOUND:"SEARCH_REQUEST_NOT_FOUND",SEARCH_STRINGS_TOO_LARGE:"SEARCH_STRINGS_TOO_LARGE",EDIT_TERMINAL_NOT_SUPPORTED:"EDIT_TERMINAL_NOT_SUPPORTED",CONTACTS_NOTIFICATIONS_CHANNEL_FAILED:"CONTACTS_NOTIFICATIONS_CHANNEL_FAILED",INCOMPATIBLE_SERVER_VERSION:"INCOMPATIBLE_SERVER_VERSION"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.PhoneStringTypes={PHONE_NUMBER:"PHONE_NUMBER",DIALSTRING:"DIALSTRING",FEATURE_ACCESS_CODE:"FEATURE_ACCESS_CODE",SIP_URI:"SIP_URI",UNKNOWN:"UNKNOWN"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactsFieldType={HANDLE:"HANDLE",PHONE_NUMBER:"PHONE_NUMBER"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchFieldType={NAME:"NAME",HANDLE:"HANDLE",LOGIN_ID:"LOGIN_ID",TERMINAL:"TERMINAL",ALL:"ALL"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchNetworkSource={CONFERENCE_ONLY:"CONFERENCE_ONLY",ANYWHERE:"ANYWHERE"}}(),function(){"use strict";AvayaClientServices.Services.Contacts.SearchSourceType={LOCAL:"LOCAL",NETWORK:"NETWORK",ALL:"ALL"}}(),function(e){"use strict";function t(){this._exactType1Contacts=[],this._exactType2Contacts=[],this._partialType1Contacts=[],this._allContacts=[],this._empty=!0}t.prototype={getExactType1Contacts:function(){return this._exactType1Contacts},getExactType2Contacts:function(){return this._exactType2Contacts},getPartialType1Contacts:function(){return this._partialType1Contacts},getAllContacts:function(){return this._allContacts},isEmpty:function(){return this._empty},_setExactType1Contacts:function(e){this._exactType1Contacts=e},_setExactType2Contacts:function(e){this._exactType2Contacts=e},_setPartialType1Contacts:function(e){this._partialType1Contacts=e},_setAllContacts:function(e){this._allContacts=e},_setEmpty:function(e){this._empty=e},_equals:function(e){return e&&this.empty===e.empty&&this._areArraysEqual(this._exactType1Contacts,e._exactType1Contacts)&&this._areArraysEqual(this._exactType2Contacts,e._exactType2Contacts)&&this._areArraysEqual(this._partialType1Contacts,e._partialType1Contacts)},_areArraysEqual:function(e,i){return e.length===i.length&&e.every(function(e,t){return e===i[t]})}},e.Services.Contacts.MatchedContactsWithMatchLevel=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Contacts.ResolveContactResult=function(e,t,i){this.searchString=e,this.searchScope=t,this.contacts=i}}(),function(s){"use strict";function e(e,t,i,a){this._directorySearchProvider=t,this._contactsCache=i,this._resolveContactsRequest=e,this._dataSet=new s.Base.DataSet,this._dataRetrieval=new s.Base.DataRetrieval(this._dataSet),this._uniqueSearchStrings=s.Base.Utils.removeDuplicatesFromArray(e.getSearchStrings()),this._contactsAnalyticsService=a}e.prototype={start:function(){var e=this._resolveContactsRequest.getSearchSource(),t=function(){this._dataRetrieval._dataRetrievalDone.fire()}.bind(this),i=function(e){this._dataRetrieval._dataRetrievalFailed.fire(e)}.bind(this),a=function(e){this._handleResults(e)}.bind(this);(e===s.Services.Contacts.SearchSourceType.NETWORK?this._searchNetworkContacts():e===s.Services.Contacts.SearchSourceType.LOCAL?this._searchLocalContacts():this._searchAllContacts()).then(t,i,a)},getDataRetrieval:function(){return this._dataRetrieval},_handleResults:function(e){var t=!1;e.forEach(function(e){e.contacts.length&&(t=!0,this._dataSet.push(e))}.bind(this)),t&&(this._dataSet.onDataSetChanged(e.slice(),s.Base.DataSetChangeTypes.ADDED),this._dataRetrieval._dataRetrievalProgress.fire(this._dataSet.length,!1))},_searchNetworkContacts:function(e){var e=e||this._uniqueSearchStrings,t=this._contactsAnalyticsService.startTimingMetric(),i=this._resolveContactsRequest.getSearchField(),e=this._directorySearchProvider.startResolvingContacts(e,i);return e.then(function(){this._contactsAnalyticsService.sendNumResolveContacts(i),this._contactsAnalyticsService.resolveContactsTimeEnd(t)}.bind(this)),e},_searchLocalContacts:function(){var e=E.Deferred(),a=this._resolveContactsRequest.getSearchField(),t=this._uniqueSearchStrings.reduce(function(e,t){var i=this._contactsCache.resolveContacts(t,a,!1);return e.push(new s.Services.Contacts.ResolveContactResult(t,a,i)),e}.bind(this),[]);return setTimeout(function(){t&&e.notify(t),e.resolve()},0),e.promise()},_searchAllContacts:function(){function t(e){e.forEach(function(e){e.contacts.length&&a.push(e.searchString)}),i.notify(e)}var i=E.Deferred(),a=[],r=function(){var e=this._uniqueSearchStrings.filter(function(e){return-1===a.indexOf(e)});if(e.length)return this._searchNetworkContacts(e).then(function(){i.resolve()},function(e){s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"Network contacts quick search failed",e),i.reject(e)},function(e){t(e)});i.resolve()}.bind(this);return this._searchLocalContacts().then(r,function(e){s.Base.Logger.error(s.Base.LoggerTags.CONTACTS_SERVICE,"Local contacts quick search failed",e),r()},t),i.promise()}},s.Services.Contacts.ResolveContacts=e}(AvayaClientServices),function(a){"use strict";function e(e,t,i){this._uniqueSearchId=a.Base.Utils.makeId(16),this._searchStrings=e,this._searchField=t,this._searchSource=i}e.prototype={getUniqueSearchId:function(){return this._uniqueSearchId},_setSearchStrings:function(e){this._searchStrings=e},_setSearchField:function(e){this._searchField=e},_setSearchSource:function(e){this._searchSource=e},getSearchStrings:function(){return this._searchStrings},getSearchField:function(){return this._searchField},getSearchSource:function(){return this._searchSource}},a.Services.Contacts.ResolveContactsRequest=e}(AvayaClientServices),function(e){"use strict";function t(){this._terminalId="",this._terminalName=""}t.prototype={getTerminalId:function(){return this._terminalId},getTerminalName:function(){return this._terminalName}},e.Services.Contacts.Terminal=t}(AvayaClientServices),function(e){"use strict";function t(e){this._attachmentBuilder=e}t.prototype={_resizeImage:function(e,t){var i,a=document.createElement("canvas"),t=t.scale?(i=e.width*t.scale,e.height*t.scale):t.width&&!t.height?(i=t.width,parseInt(t.width*e.height/e.width)):t.height&&!t.width?(i=parseInt(t.height*e.width/e.height),t.height):(i=e.width,e.height);return a.height=t,a.width=i,a.getContext("2d").drawImage(e,0,0,i,t),a.toDataURL("image/jpeg")},create:function(){}},e.Services.Messaging.AbstractThumbnailCreator=t}(AvayaClientServices),function(a){"use strict";function e(e){this._thumbnailCreator=e}e.prototype={build:function(e,t){var i=new a.Services.Messaging.Attachment(this._thumbnailCreator);return i.disposition=(e=e||{}).disposition,i.duration=e.duration,i.mimeType=e.mimeType,i.id=e.partId,i.location=e.location||e.media,i.size=e.size,i.name=i.getName(),i.file=t,i.status=e.status||a.Services.Messaging.ResourceStatus.PUBLISHED,this._recalculateCapabilities(i),i},update:function(e,t){t.thumbnail&&(e.thumbnail.location=t.thumbnail.location),e.id=t.partId,e.location=t.location||t.media,e.duration!==t.duration&&(e.duration=t.duration,e._onDurationChangedCallbacks.fire(e,t.duration)),e.status!==a.Services.Messaging.ResourceStatus.PUBLISHED&&(e.status=a.Services.Messaging.ResourceStatus.PUBLISHED,e._onStatusChangedCallbacks.fire(e,a.Services.Messaging.ResourceStatus.PUBLISHED)),e.file&&(e.file=T)},_recalculateCapabilities:function(e){e._recalculateUpdateNameCapability(),e._recalculateUpdateMimeTypeCapability(),e._recalculateUpdateDurationCapability(),e._recalculateUpdateIsSelfGeneratedCapability(),e._recalculateCreateThumbnailCapability(),e._recalculateRemoveThumbnailCapability(),e._recalculateRemoveCapability()}},a.Services.Messaging.AttachmentBuilder=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentStatus={READY_TO_DOWNLOAD:"READY_TO_DOWNLOAD",DOWNLOADING:"DOWNLOADING",READY_TO_CONSUME:"READY_TO_CONSUME",CONSUMED:"CONSUMED",ERROR:"ERROR"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.AttachmentType={MAIN:"MAIN",THUMBNAIL:"THUMBNAIL"}}(),function(e){"use strict";function t(e,t){this.action=e&&e.action||"typing",this.participant=t,this.state=e&&e.state||"paused",this.timestamp=e?e.timestamp:T}t.prototype={getAction:function(){return this.action},getParticipant:function(){return this.participant},getState:function(){return this.state},getTimestamp:function(){return this.timestamp}},e.Services.Messaging.ChatStateEvent=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ConversationType={THREAD:"THREAD"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageImportance={HIGH:"HIGH",LOW:"LOW",NORMAL:"NORMAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.MessageType={MESSAGE:"MESSAGE",JOINED:"JOINED",LEFT:"LEFT",SESSION:"SESSION",SUBJECT_CHANGE:"SUBJECT_CHANGE",CLOSED:"CLOSED",START:"START"}}(),function(i){"use strict";function e(e,t){i.Base.BaseError.call(this,e,t),this.name="MessagingError",this.message=e}e.prototype=Object.create(i.Base.BaseError.prototype),i.Services.Messaging.MessagingError=e}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.MessagingErrorReason={MESSAGING_NOTIFICATIONS_DISABLED:"Notification channel is disabled.",MESSAGING_CLOSE_FAILED:"Server failed to be closed.",MESSAGING_SEND_ATTACHMENT_FAILED:"Failed to send attachment.",MESSAGING_FEATURE_NOT_AVAILABLE:"Feature is not available in determined server version.",MESSAGING_SERVER_ERROR:"Action failed due to server error.",MESSAGING_NOTIFICATION_FAILED:"Notification failed.",MESSAGING_PARTICIPANT_ADDRESS_INVALID:"Failed to add Participant to Conversation.",MESSAGING_LEAVE_CONVERSATION_FAILED:"Failed to leave one or more conversations.",MESSAGING_NOT_STARTED:"Failed to perform selected action. Messaging is not started.",MESSAGING_CREATE_ATTACHMENT_FAILED:"Failed to create attachment. Internal browser error.",MESSAGING_BODY_LENGTH_EXCEEDED:"Failed to send message. Maximum message body length exceeded.",MESSAGING_SUBJECT_LENGTH_EXCEEDED:"Failed to send message. Maximum message subject length exceeded.",MESSAGING_INVALID_STATE:"Invalid state.",MESSAGING_NOTIFICATIONS_CHANNEL_FAILED:"Start notification channel failed.",MESSAGING_INTERNAL_ERROR:"An internal error occurred.",MESSAGING_TIMEOUT:"An operation has timed out"}}(),function(e){"use strict";function t(){this._searchBody=!1,this._searchParticipants=!1,this._searchSubject=!1,this._resultsPerConversation=0,this._query="",this._after=T}t.prototype={isSearchParticipants:function(){return this._searchParticipants},isSearchSubject:function(){return this._searchSubject},isSearchBody:function(){return this._searchBody},getQueryAfter:function(){return this._after},getQuery:function(){return this._query},getNumberResultsPerConversation:function(){return this._resultsPerConversation},searchParticipants:function(e){this._searchParticipants=e},searchSubject:function(e){this._searchSubject=e},searchBody:function(e){this._searchBody=e},setQueryAfter:function(e){this._after=e},setQuery:function(e){this._query=e.toLowerCase()},setNumberResultsPerConversation:function(e){this._resultsPerConversation=e}},e.Services.Messaging.MessagingQuery=t}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Messaging.ResourceStatus={DRAFT_UNSENT:"DRAFT_UNSENT",DRAFT_SENDING:"DRAFT_SENDING",DRAFT_REMOVING:"DRAFT_REMOVING",DRAFT_ERROR:"DRAFT_ERROR",PUBLISHED:"PUBLISHED",PUBLISHED_LEAVING:"PUBLISHED_LEAVING",PUBLISHED_LEFT:"PUBLISHED_LEFT"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SensitivityLevel={NORMAL:"NORMAL",PERSONAL:"PERSONAL",PRIVATE:"PRIVATE",CONFIDENTIAL:"CONFIDENTIAL"}}(),function(){"use strict";AvayaClientServices.Services.Messaging.SessionType={AUDIO:"AUDIO",VIDEO:"VIDEO"}}(),function(e){"use strict";function t(e){this._href=e&&e.href||"",this._id=e&&e.id||"",this._lastAccessedTime=e&&e.lastAccessedTime||"",this._lastUpdated=e&&e.lastUpdated||""}t.prototype={getHref:function(){return this._href},getId:function(){return this._id},getLastAccessedTime:function(){return this._lastAccessedTime},getLastUpdatedTime:function(){return this._lastUpdated}},e.Services.Messaging.ConversationId=t}(AvayaClientServices),function(_){"use strict";function e(e,t,i,a,r,s,n){this._provider=e,this._messageService=t,this._participantsService=i,this._escalationService=a,this._messageBuilder=r,this._messagingService=T,this._conversationBuilder=s,this._messagingAnalyticsService=n}e.prototype={getParticipants:function(e,t,i){return e.participants},createMessage:function(a){var e={subject:a.subject,threadId:a.id,to:a.participants,event:{type:_.Services.Messaging.MessageType.MESSAGE},resourceStatus:_.Services.Messaging.ResourceStatus.DRAFT_UNSENT,flags:{sensitivity:a.getSensitivity()}},r=this._messageBuilder.build(e,this._participantsService.getSelfParticipant(),this._messageService,a);return this._provider.on(_.Providers.AMM.ProviderStates.AVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),this._provider.on(_.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),a._getLastMessage()&&(r.coalesced=this._messageBuilder.isMessageCoalesced(r,a._getLastMessage())),r.addOnStatusChangedCallback(function(e,t){var i;t===_.Services.Messaging.ResourceStatus.PUBLISHED?(i=a._draftMessages.indexOf(e),a._draftMessages.splice(i,1),a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.id=e.threadId,a.getParticipants(),a._setStatus(_.Services.Messaging.ResourceStatus.PUBLISHED))):t===_.Services.Messaging.ResourceStatus.DRAFT_ERROR?(a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_ERROR),a.messages.onDataSetChanged([r],_.Base.DataSetChangeTypes.UPDATED)):t===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&(a.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_SENDING),a._onMessagesAddedCallbacks.fire(a,[r]),a.messages.onDataSetChanged([r],_.Base.DataSetChangeTypes.UPDATED)),this._messageService._recalculateAllMessageCapabilities(r)}.bind(this)),a._draftMessages.push(r),a.messages.unshift(r),r},getMessageById:function(e,t){for(var i=0;i<e.length;i++)if(e[i].id===t)return e[i]},createNewClientMessage:function(e,t){return this._messageBuilder.build(e,this._participantsService.getOrCreateParticipant(e.from),this._messageService,t)},leave:function(t){var i=E.Deferred();return _.Base.Utils.isDefined(t.id)?this._provider.leaveConversation(t.id).then(function(){var e=this._messagingService.conversations.indexOf(t);0<=e&&(this._messagingService.conversations.splice(e,1),this._messagingService.conversations.onDataSetChanged([t],_.Base.DataSetChangeTypes.REMOVED)),i.resolve(!0)}.bind(this),function(e){i.reject(e)}):i.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED)),i.promise()},changeSubject:function(e,t){for(var i={threadId:e.id,body:"",event:{type:"SUBJECT_CHANGE"},subject:t,to:[]},a=e.getParticipants(),r=0;r<a.length;r++)i.to.push({address:a[r].getAddress(),type:a[r].getType()});return this._provider.changeSubject(i)},getOtherMessages:function(e,t,i,a){var r,s=new _.Base.DataRetrieval,n=s.getDataSet(),o=this._provider.getMaxMessageCount();return i&&o<i?this._getMoreOtherMessages(e,t,i,a,o,s):(this._provider.getMessages(r={cancel:function(){}},a.getId(),i,e,t).done(function(e){0<a.getMessages().length&&(e=this._conversationBuilder.update(a,e,this),n.push(e),n.onDataSetChanged(e,_.Base.DataSetChangeTypes.ADDED),s._dataRetrievalProgress.fire(e.length,!0,e.length),s.isCompleted=!0,s._dataRetrievalDone.fire())}.bind(this)).fail(function(e){s._dataRetrievalFailed.fire(e)}),s._onCancel=function(){r.cancel()}),s},_getMoreOtherMessages:function(e,t,i,a,n,o){var c=[],l={},d=o.getDataSet(),C=0,u=Math.floor(i/n),h=i%n;h&&(u+=1);for(var r=function(t,i,a,r){var s,e;o.isCancelled||o.isCompleted||(this._provider.getMessages(e={cancel:function(){}},r.id,a,t,i).done(function(e){0===C?l=e:l.messages=l.messages.concat(e.messages),t?t=e.messages[e.messages.length-1]:i=e.messages[e.messages.length-1],(C+=1)<u&&e.messages.length===n?(C===u-1&&h?c[C](t,i,h,r):c[C](t,i,a,r),s=this._conversationBuilder.updateMessages(r,l,this),d.push(s),d.onDataSetChanged(s,_.Base.DataSetChangeTypes.ADDED),o._dataRetrievalProgress.fire(e.messages.length,!1)):(s=this._conversationBuilder.updateMessages(r,l,this),d.push(s),d.onDataSetChanged(s,_.Base.DataSetChangeTypes.ADDED),o._dataRetrievalProgress.fire(e.messages.length,!1),o.isCompleted=!0,o._dataRetrievalDone.fire())}.bind(this)).fail(function(e){o._dataRetrievalFailed.fire(e)}),o._onCancel=function(){e.cancel()})}.bind(this),s=0;s<u;s++)c.push(r);c[0](e,t,T,a)},markAllAsRead:function(e){return this._provider.markAllAsRead(e.id)},markMultipleAsRead:function(e,t,i){return this._provider.markAllAsRead(e.id,t,i)},removeMessage:function(e,t,i){var a,r=E.Deferred();return i?i.getRemoveCapability().isAllowed?(0<=(a=e.indexOf(i))&&(e.splice(a,1),e.onDataSetChanged([i],_.Base.DataSetChangeTypes.REMOVED)),0<=(a=t.indexOf(i))&&t.splice(a,1),r.resolve()):r.reject(i.getRemoveCapability().denialReason):r.reject(),r.promise()},createEscalation:function(i){var e={type:_.Services.Messaging.MessageType.SESSION,extensions:{},conversation:i},a=new _.Services.Messaging.Escalation(e,this._escalationService);return this._provider.on(_.Providers.AMM.ProviderStates.AVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),this._provider.on(_.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),a.addParticipants(this.getParticipants(i)),a._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_UNSENT),a.addOnStatusChangedCallback(function(e,t){t===_.Services.Messaging.ResourceStatus.PUBLISHED?(e=i._draftEscalations.indexOf(e),i._draftEscalations.splice(e,1)):t===_.Services.Messaging.ResourceStatus.DRAFT_ERROR&&i.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_SENDING?i._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_ERROR):t===_.Services.Messaging.ResourceStatus.DRAFT_SENDING&&i.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&i._setStatus(_.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._escalationService._recalculateAllEscalationCapabilities(a)}.bind(this)),a},removeEscalation:function(e,t){var i,a=E.Deferred();return e?e.getRemoveCapability().isAllowed?(0<=(i=t.indexOf(e))&&t.splice(i,1),a.resolve()):a.reject(e.getRemoveCapability().denialReason):a.reject(),a.promise()},addParticipantAddresses:function(s,e){var n=E.Deferred();_.Base.Utils.clean(e,"");var t=E.map(s.getActiveParticipants(),function(e,t){return e.getAddress()}),i=e.filter(function(e){return-1===t.indexOf(e)}),o=e.filter(function(e){return-1!==t.indexOf(e)}),a=function(e){var t=[];if(s.getStatus()===_.Services.Messaging.ResourceStatus.PUBLISHED){for(var i={participants:[]},a=0;a<e.length;a++)i.participants.push({address:e[a]._address,type:"CONTACT"}),t.push(e[a]._address);this._provider.addParticipantsToConversation(s.getId(),i).then(function(e){this._updateParticipantsList(s,e.participants),n.resolve(t)}.bind(this),function(e){n.reject(e)})}else if(s.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var r=0;r<e.length;r++)t.push(e[r]._address);this._updateParticipantsList(s,e),n.resolve(t)}}.bind(this),e=function(e,t){if(t&&0<t.length){for(var i=[],a={participants:[]},r=0;r<t.length;r++)a.participants.push({address:t[r]._address,type:t[r].type}),i.push(t[r]._address);s.getStatus()===_.Services.Messaging.ResourceStatus.PUBLISHED?this._provider.addParticipantsToConversation(s.getId(),a).then(function(e){this._updateParticipantsList(s,e.participants),n.resolve(i)}.bind(this),function(e){n.reject(e)}):s.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(this._updateParticipantsList(s,t),n.resolve(i))}else e._data=e.getData().concat(o),n.reject(e)}.bind(this);return this.validateUsers(i).then(a,e.bind(this)),n.promise()},validateUsers:function(e){var t,a=E.Deferred(),i=this._provider.getRoutableDomains(),r=[],s=[];for(var n,o,c=0;c<e.length;c++){if(t=l=!1,n=e[c],/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(n)){for(var l=!0,d=0;d<i.length;d++)if(null!==e[c].match(i[d])){r.push(e[c]),t=!0;break}t||0}l&&t||(s.push(e[c]),_.Base.Logger.debug(_.Base.LoggerTags.MESSAGING_SERVICE,"Invalid address email:",e[c]))}return 0<r.length?(o=this._messagingAnalyticsService.startTimingMetric(),this._provider.validateUsers(r).then(function(e){this._messagingAnalyticsService.trackTimeRequestsValidateAddressesEnd(o);for(var t=[],i=0;i<e.validatedAddresses.length;i++)0<e.validatedAddresses[i].addresses.length?t.push(e.validatedAddresses[i].addresses[0]):s.push(e.validatedAddresses[i].query);0<s.length?a.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,s),t):a.resolve(t)}.bind(this),function(e){var t=_.Services.Messaging.MessagingErrorReason.MESSAGING_SERVER_ERROR;this._messagingAnalyticsService.trackErrorsResponseValidateAddresses(t),a.reject(new _.Services.Messaging.MessagingError(t,e))}.bind(this))):a.reject(new _.Services.Messaging.MessagingError(_.Services.Messaging.MessagingErrorReason.MESSAGING_PARTICIPANT_ADDRESS_INVALID,s)),a.promise()},addParticipants:function(e,t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].address);return this.addParticipantAddresses(e,i)},_updateParticipantsList:function(e,t){for(var i=[],a=[],r=0;r<t.length;r++){for(var s,n=!0,o=0;o<e.participants.length;o++)if(t[r]._address===e.participants[o]._address){n=!1;break}n&&(s=this._participantsService.getOrCreateParticipant(t[r]),i.push(s),e.participants.push(s),a.push(s))}return 0<a.length&&(e.participants.onDataSetChanged(a,_.Base.DataSetChangeTypes.ADDED),e._onParticipantsAddedCallbacks.fire(e,a)),e.participants},getParticipantsFromMessage:function(e){for(var t=new _.Base.DataSet,i=0;i<e.to.length;i++){var a=this._participantsService.getOrCreateParticipant(e.to[i]);t.push(a)}if(_.Base.Utils.isDefined(e.event)&&e.event.type===_.Services.Messaging.MessageType.LEFT)for(var r=0;r<e.event.participants.length;r++){var s=this._participantsService.getOrCreateParticipant(e.event.participants[r]),s=t.indexOf(s);t.splice(s,1)}return t},removeParticipantAddresses:function(e,t){var i=E.Deferred(),a=!1,r=[];if(_.Base.Utils.clean(t,""),e.getStatus()===_.Services.Messaging.ResourceStatus.DRAFT_UNSENT){for(var s=0;s<t.length;s++)for(var n=e.participants.length-1;0<=n;n--)if(e.participants[n]._address===t[s]){r.push(e.participants.splice(n,1)[0]),a=!0;break}a&&(e.participants.onDataSetChanged(r,_.Base.DataSetChangeTypes.REMOVED),e._onParticipantsRemovedCallbacks.fire(e,r)),i.resolve()}else i.reject("Could not remove participants");return i.promise()},removeParticipants:function(e,t){for(var i=[],a=0;a<t.length;a++)i.push(t[a].address);return this.removeParticipantAddresses(e,i)},close:function(t){return this._provider.close(t.id).then(function(e){return t.closed=!0,t._onClosedStatusChangedCallbacks.fire(t,t.closed),e}.bind(this))},setLastAccessTime:function(e){this._provider.setLastAccessTime(e.id,{}).then(function(){e._onLastAccessTimeChangedCallbacks.fire(e,e.lastAccessTime)})},subscribeForTypingEvents:function(i,a){var e=function(e){var t;a&&(t=new _.Services.Messaging.ChatStateEvent(e,this._participantsService._getParticipant(e.address)),a(t)),"composing"===e.state?this.addComposingParticipantToConversation(i,this._participantsService._getParticipant(e.address)):"paused"===e.state&&this.removeComposingParticipantFromConversation(i,this._participantsService._getParticipant(e.address))}.bind(this);return this._provider.subscribeForTypingEventsInConversation(i.getId(),e).then(function(e){return i._isSubscribed=!0,this._recalculateAllConversationCapabilities(i),e}.bind(this))},unsubscribeForTypingEvents:function(t){return this._provider.unsubscribeForTypingEventsInConversation(t.getId()).then(function(e){return t._isSubscribed=!1,this._recalculateAllConversationCapabilities(t),e}.bind(this))},reportTyping:function(e,t){var i=this._participantsService.getSelfParticipant();t?this._provider.reportTyping(e.threadId,t).then(function(){this.addComposingParticipantToConversation(e.conversation,i)}.bind(this),function(e){_.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report typing: ",e)}.bind(this)):this._provider.reportTyping(e.conversation.id,t).then(function(){this.removeComposingParticipantFromConversation(e.conversation,i)}.bind(this),function(e){_.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report paused typing: ",e)}.bind(this))},reportCustomChatNotification:function(t,e,i){var a=this._participantsService.getSelfParticipant();return i?this._provider.reportCustomChatNotification(t.getId(),e,i).then(function(e){return this.addComposingParticipantToConversation(t,a),e}.bind(this),function(e){return _.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report custom chat notification: ",e),E.Deferred().reject(e).promise()}.bind(this)):this._provider.reportCustomChatNotification(t.getId(),e,i).then(function(e){return this.removeComposingParticipantFromConversation(t,a),e}.bind(this),function(e){return _.Base.Logger.error(_.Base.LoggerTags.MESSAGING_SERVICE,"Error on report pause custom chat notification: ",e),E.Deferred().reject(e).promise()}.bind(this))},addComposingParticipantToConversation:function(e,t){e.getComposingParticipants().indexOf(t)<0&&(e.composingParticipants.push(t),e._onIsComposingStatusChangedCallbacks.fire(e,!0))},removeComposingParticipantFromConversation:function(e,t){t=e.composingParticipants.indexOf(t);0<=t&&(e.composingParticipants.splice(t,1),e._onIsComposingStatusChangedCallbacks.fire(e,!0))},isOpened:function(){return this._provider.isOpened()},isServiceAvailable:function(){return this._provider.isAvailable()},getMaxMessageCount:function(){return this._provider.getMaxMessageCount()},_recalculateAllConversationCapabilities:function(e){e._recalculateUpdateSubjectCapability(),e._recalculateUpdateLastAccessTimeCapability(),e._recalculateUpdateSensitivityCapability(),e._recalculateOlderContentCapability(),e._recalculateAddParticipantsCapability(),e._recalculateRemoveParticipantsCapability(),e._recalculateCreateMessageCapability(),e._recalculateCreateEscalationCapability(),e._recalculateMarkAllContentAsReadCapability(),e._recalculateLeaveCapability(),e._recalculateRemoveCapability(),e._recalculateStartCapability(),e._recalculateIsTypingCapability()},isUpdateSubjectSupported:function(){return this._provider.isUpdateSubjectSupported()},isMarkAllContentAsReadSupported:function(){return this._provider.isMarkAllContentAsReadSupported()},getNumberOfMessagesWithUnreadContentSinceLastAccess:function(t){var e=t.getMessages();return(t.getLastAccessTime().getTime()?e.filter(function(e){return!e.isRead()&&e.getReceivedDate()>t.getLastAccessTime()}):e).length}},_.Services.Messaging.ConversationService=e}(AvayaClientServices),function(c){"use strict";function e(e){this._provider=e}e.prototype={start:function(t){for(var e={extensions:t.extensions,sessionType:t.sessionType||c.Services.Messaging.SessionType.AUDIO,type:t.type,participants:[]},i=0;i<t.participants.length;i++)e.participants.push({address:t.participants[i]._address});return t._setStatus(c.Services.Messaging.ResourceStatus.DRAFT_SENDING),this._provider.callEscalationEvent(e,t.conversation.id).then(function(e){return t._setStatus(c.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllEscalationCapabilities(t),t._onStartSuccessCallbacks.fire(t),e}.bind(this),function(e){this._recalculateAllEscalationCapabilities(t),t._onStartFailedCallbacks.fire(t,e)}.bind(this))},addParticipantAddresses:function(e,t){var i=E.Deferred(),a=this._provider.getRoutableDomains();if(e.getAddParticipantsCapability().isAllowed){for(var r=[],s=0;s<t.length;s++)for(var n,o=0;o<a.length;o++)null!==t[s].match(a[o])&&(n={_address:t[s]},e.participants.push(n),r.push(n));0<r.length&&e.participants.onDataSetChanged(r,c.Base.DataSetChangeTypes.ADDED),i.resolve(e)}else i.reject(e.getAddParticipantsCapability().denialReason);return i.promise()},addParticipants:function(e,t){var i=E.Deferred();if(e.getAddParticipantsCapability().isAllowed){for(var a=!1,r=0;r<t.length;r++)e.participants.push(t[r]),a=!0;a&&e.participants.onDataSetChanged(t,c.Base.DataSetChangeTypes.ADDED),i.resolve(e)}else i.reject(e.getAddParticipantsCapability().denialReason);return i.promise()},removeParticipantAddresses:function(e,t){var i=E.Deferred();if(e.getRemoveParticipantsCapability().isAllowed){for(var a=[],r=e.participants.length-1;0<=r;r--)for(var s=t.length-1;0<=s;s--)if(e.participants[r]._address===t[s]){a.push(e.participants[r]),e.participants.splice(r,1),t.splice(s,1);break}0<a.length&&e.participants.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED),i.resolve(e)}else i.reject(e.getRemoveParticipantsCapability().denialReason);return i.promise()},removeParticipants:function(e,t){var i=E.Deferred(),a=[];if(e.getRemoveParticipantsCapability().isAllowed){for(var r=e.participants.length-1;0<=r;r--)for(var s=t.length-1;0<=s;s--)if(e.participants[r]._address===t[s]._address){a.push(e.participants[r]),e.participants.splice(r,1),t.splice(s,1);break}0<a.length&&e.participants.onDataSetChanged(a,c.Base.DataSetChangeTypes.REMOVED),i.resolve(e)}else i.reject(e.getRemoveParticipantsCapability().denialReason);return i.promise()},setSessionType:function(e,t){if(!c.Base.Utils.isDefined(c.Services.Messaging.SessionType[t]))throw e._onSessionTypeChangedFailedCallbacks.fire(this,t),new Error("Unknown Session type");e.sessionType=t,e._onSessionTypeChangedSuccessCallbacks.fire(this,t)},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllEscalationCapabilities:function(e){e._recalculateStartCapability(),e._recalculateAddParticipantsCapability(),e._recalculateRemoveParticipantsCapability(),e._recalculateUpdateSessionTypeCapability(),e._recalculateRemoveCapability()}},c.Services.Messaging.EscalationService=e}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Messaging.AbstractThumbnailCreator.call(this,e)}(e.prototype=Object.create(t.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(i,a){var r=E.Deferred(),s={disposition:i.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:i.status},e=new FileReader;return e.onloadend=function(){var t=new Image;t.src=e.result,t.onload=function(){var e=new Blob([this._resizeImage(t,a)],{type:"image/jpeg"});s.size=e.size,i.thumbnail=this._attachmentBuilder.build(s,e),r.resolve(i.thumbnail)}.bind(this)}.bind(this),e.onerror=function(e){r.reject(e)}.bind(this),e.readAsDataURL(i.file),r.promise()},t.Services.Messaging.ImageThumbnailCreator=e}(AvayaClientServices),function(n){"use strict";function e(e,t){this._attachmentBuilder=e,this._participantService=t}e.prototype={build:function(e,t,i,a){var r,s=new n.Services.Messaging.Message(i,a);return s.resourceStatus=e.resourceStatus||n.Services.Messaging.ResourceStatus.PUBLISHED,s.body=e.body,n.Base.Utils.isDefined(e.htmlBody)&&(s.htmlBody=e.htmlBody),e.event&&(s.type=e.event.type,s.eventRelatedParticipants=e.event.participants,s._sessionType=e.event.sessionType),e.flags&&(s.sensitivity=e.flags.sensitivity,s.importance=e.flags.importance,s.read=e.flags.read,s.doNotForward=e.flags.doNotForward),s.from=t,s.inReplyTo=e.inReplyTo,s.href=e.href,s.id=e.id,s.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):new Date,s.receivedDate=new Date(e.receivedDate),s.subject=e.subject,s.threadId=e.threadId,s.to=[],e.to&&e.to.forEach&&(e.to.forEach(function(e){s.to.push(this._participantService.getOrCreateParticipant(e))}.bind(this)),a._updateParticipantsList(s.to)),e.parts&&(r=[],e.parts.forEach(function(e){r.push(this._attachmentBuilder.build(e))}.bind(this)),s.parts=this.pairThumbnailsAndAttachments(r)),i._recalculateAllMessageCapabilities(s),s},update:function(i,e){i.body!==e.body&&(i.body=e.body,i._onBodyChangedCallbacks.fire(i,i.body)),i.type!==e.event.type&&(i.type=e.event.type,i._onTypeChangedCallbacks.fire(i,i.type)),i.doNotForward!==e.flags.doNotForward&&(i.doNotForward=e.flags.doNotForward,i._onDoNotForwardStatusChangedCallbacks.fire(i,i.doNotForward)),i.importance!==e.flags.importance&&(i.importance=e.flags.importance,i._onImportanceChangedCallbacks.fire(i,i.importance)),i.sensitivity!==e.flags.sensitivity&&(i.sensitivity=e.flags.sensitivity,i._onSensitivityChangedCallbacks.fire(i,i.sensitivity)),i.read!==e.flags.read&&(i.read=e.flags.read,i._onIsReadStatusChangedCallbacks.fire(i,i.read)),i.href!==e.href&&(i.href=e.href);var t=new Date(e.lastModifiedDate);i.lastModifiedDate&&i.lastModifiedDate.toISOString()===t.toISOString()||(i.lastModifiedDate=t,i._onLastModifiedDateChangedCallbacks.fire(i,t)),t=new Date(e.receivedDate),i.receivedDate&&"Invalid Date"!==i.receivedDate.toString()&&i.receivedDate.toISOString()===t.toISOString()||(i.receivedDate=t),i.subject!==e.subject&&(i.subject=e.subject),i.id!==e.id&&(i.id=e.id),i.threadId!==e.threadId&&(i.threadId=e.threadId),i.getInReplyTo()!==e.inReplyTo&&(i.inReplyTo=e.inReplyTo,i._onInReplyToChangedCallbacks(i,i.getInReplyTo()));var a=[];e.parts.forEach(function(e){a.push(this._attachmentBuilder.build(e))}.bind(this)),this.pairThumbnailsAndAttachments(a).forEach(function(t){var e=i.parts.filter(function(e){return e.disposition===t.disposition})[0];e&&this._attachmentBuilder.update(e,t)}.bind(this)),0<i._attachments.length&&i._attachments.splice(0,i._attachments.length)},isMessageCoalesced:function(e,t){if(null===e||e===T)return!1;if(null===t||t===T)return!1;if(e.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_ERROR)return!1;if(t.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_ERROR)return!1;if(e.getFromParticipant()!==T&&e.getFromParticipant().getAddress()!==t.getFromParticipant().getAddress())return!1;if(e.hasAttachment())return!1;if(e.getType()===n.Services.Messaging.MessageType.JOINED||e.getType()===n.Services.Messaging.MessageType.LEFT||e.getType()===n.Services.Messaging.MessageType.CLOSED||e.getType()===n.Services.Messaging.MessageType.START)return!1;if(t.getType()===n.Services.Messaging.MessageType.JOINED||t.getType()===n.Services.Messaging.MessageType.LEFT||t.getType()===n.Services.Messaging.MessageType.CLOSED||t.getType()===n.Services.Messaging.MessageType.START)return!1;if(e.getSensitivity()!==t.getSensitivity())return!1;if(t.hasAttachment())return!1;if(e.getReceivedDate()<t.getReceivedDate())return!1;t=e.getReceivedDate()-t.getReceivedDate();return!(isNaN(t)||6e4<t)},pairThumbnailsAndAttachments:function(e){for(var t,i={},a=[],r=0;r<e.length;r++)i[e[r].getName()]=e.filter(function(t){return function(e){return e.getName()===t}}(e[r].getName()));for(t in i)if(i.hasOwnProperty(t))if(2===i[t].length){var s=i[t][0]._isThumbnail()?i[t][0]:i[t][1],n=i[t][0]._isThumbnail()?i[t][1]:i[t][0];n.thumbnail=s,a.push(n)}else for(r=0;r<i[t].length;r++)a.push(i[t][r]);return a}},n.Services.Messaging.MessageBuilder=e}(AvayaClientServices),function(n){"use strict";function e(e,t,i,a){this._provider=e,this._attachmentBuilder=i,this._messageBuilder=t,this._messagesToRead=[],this._promises=[],this._messagingAnalyticsService=a}e.prototype={_prepareMessage:function(e){var t={body:e.getBody(),subject:e.subject,threadId:e.threadId,flags:{sensitivity:e.getSensitivity(),importance:e.getImportance()},to:[]};n.Base.Utils.isUndefined(e.inReplyTo)||(t.inReplyTo=e.inReplyTo);for(var i=e.conversation.getParticipants(),a=0;a<i.length;a++)t.to.push({address:i[a].getAddress(),type:i[a].type});return t},send:function(i){var e=E.Deferred();if(i.subject.length>this._provider.getMaxSubjectLength())return e.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_SUBJECT_LENGTH_EXCEEDED)),e.promise();if(i.getBody().length>this._provider.getMaxTextLength())return e.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_BODY_LENGTH_EXCEEDED)),e.promise();var a=this._messagingAnalyticsService.startTimingMetric();i.conversation.getStatus()===n.Services.Messaging.ResourceStatus.DRAFT_UNSENT&&(i.subject=i.conversation.getSubject());function t(e){this._messagingAnalyticsService.trackTimeRequestsSendMessageEnd(a),this._messageBuilder.update(i,e),i.lastModifiedDate=new Date,i._setStatus(n.Services.Messaging.ResourceStatus.PUBLISHED),this._recalculateAllMessageCapabilities(i);var t=i.getAttachments().length;return 0<t&&i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.PUBLISHED),this._messagingAnalyticsService.trackMessageAttachmentSize(e.size,e.mimeType)}.bind(this)),e=i.getBody().length,this._messagingAnalyticsService.trackNumMessagesSent(e,t),i}function r(e){return this._messagingAnalyticsService.trackErrorsResponseSendMessage(n.Services.Analytics.AnalyticsErrorCode.MESSAGE_SENDING_ERROR),i._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_ERROR),this._recalculateAllMessageCapabilities(i),0<i.getAttachments().length&&i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_ERROR)}.bind(this)),E.Deferred().reject(e).promise()}var s=this._prepareMessage(i),e=0<i.getAttachments().length?(i.getAttachments().forEach(function(e){e._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_SENDING)}.bind(this)),this._provider.sendMessageWithAttachments(s,i.getAttachments()).then(t.bind(this),r.bind(this))):this._provider.sendMessage(s).then(t.bind(this),r.bind(this));return i._setStatus(n.Services.Messaging.ResourceStatus.DRAFT_SENDING),e},getPartById:function(e,t){return e.filter(function(e){return e.id===t})[0]},markAsRead:function(e){var t=E.Deferred();return 0===this._messagesToRead.length&&setTimeout(function(){var t=[];this._messagesToRead.forEach(function(e){t.push(e.id)}),this._provider.markAsReadBatch(t).then(function(t){this._messagesToRead.forEach(function(e){e._recalculateMarkAsReadCapability()}),this._promises.forEach(function(e){e.resolve(t)}),this._messagesToRead=[],this._promises=[]}.bind(this),function(t){this._messagesToRead.forEach(function(e){e._recalculateMarkAsReadCapability()}),this._promises.forEach(function(e){e.reject(t)}),this._messagesToRead=[],this._promises=[]}.bind(this))}.bind(this),2e3),this._messagesToRead.push(e),this._promises.push(t),t.promise()},removeDraftAttachment:function(e,t){var i=e.parts.indexOf(t);-1!==i&&(e.parts.splice(i,1),e.parts.onDataSetChanged([t],n.Base.DataSetChangeTypes.REMOVED)),-1!==(i=e._attachments.indexOf(t))&&e._attachments.splice(e._attachments.indexOf(t),1)},removeAllDraftAttachments:function(i){var a=[];i._attachments.forEach(function(e){var t=i.parts.indexOf(e);-1!==t&&(i.parts.splice(t,1),a.push(e))}.bind(i)),0<a.length&&i.parts.onDataSetChanged(a,n.Base.DataSetChangeTypes.REMOVED),i._attachments.splice(0,i._attachments.length)},createAttachment:function(e,t){if(this._validateAttachmentSize(t)){var i={disposition:'attachment; filename="'+t.name+'"',mimeType:""!==t.type?t.type:"application/octet-stream",size:t.size,status:n.Services.Messaging.ResourceStatus.DRAFT_UNSENT},a=this._attachmentBuilder.build(i,t);return e._attachments.push(a),e.parts.push(a),e.parts.onDataSetChanged([a],n.Base.DataSetChangeTypes.ADDED),a.addOnStatusChangedCallback(function(){this._recalculateAllAttachmentCapabilities(a)}.bind(this)),a}throw new Error("Size not valid.")},stop:function(){this._messagesToRead=[],this._promises=[]},setBodyAndReportTyping:function(e,t,i){var a=E.Deferred();return e.getUpdateBodyCapability().isAllowed?(e.body=i,e._onBodyChangedCallbacks.fire(e,i),t.getStatus()===n.Services.Messaging.ResourceStatus.PUBLISHED&&t.getIsTypingCapability().isAllowed&&t._conversationService.reportTyping(e,!0),a.resolve(this._provider.getMaxTextLength()-e.body.length)):a.reject(new n.Services.Messaging.MessagingError(n.Services.Messaging.MessagingErrorReason.MESSAGING_INVALID_STATE)),a.promise()},isServiceAvailable:function(){return this._provider.isAvailable()},_recalculateAllMessageCapabilities:function(e){e._recalculateUpdateBodyCapability(),e._recalculateUpdateSensitivityCapability(),e._recalculateUpdateInReplyToCapability(),e._recalculateUpdateDoNotForwardCapability(),e._recalculateUpdateImportanceCapability(),e._recalculateCreateAttachmentCapability(),e._recalculateSendCapability(),e._recalculateMarkAsReadCapability(),e._recalculateRemoveCapability()},_recalculateAllAttachmentCapabilities:function(e){e._recalculateUpdateNameCapability(),e._recalculateUpdateMimeTypeCapability(),e._recalculateUpdateDurationCapability(),e._recalculateUpdateIsSelfGeneratedCapability(),e._recalculateCreateThumbnailCapability(),e._recalculateRemoveThumbnailCapability(),e._recalculateRemoveCapability()},_validateAttachmentSize:function(e){return!e.type||!(-1!==e.type.indexOf("image")&&this._provider.getMaxImageSize()&&e.size>this._provider.getMaxImageSize()||-1!==e.type.indexOf("video")&&this._provider.getMaxVideoSize()&&e.size>this._provider.getMaxVideoSize()||-1!==e.type.indexOf("audio")&&this._provider.getMaxAudioSize()&&e.size>this._provider.getMaxAudioSize())&&!(-1===e.type.indexOf("image")&&-1===e.type.indexOf("video")&&-1===e.type.indexOf("audio")&&this._provider.getMaxGenericAttachmentSize()&&e.size>this._provider.getMaxGenericAttachmentSize())}},n.Services.Messaging.MessageService=e}(AvayaClientServices),function(o){"use strict";function e(e,t,i){this._contactsIntegrationService=i;i=new o.Services.Messaging.ThumbnailCreator,e=t.getMessagingProviders(e)[0];this._messagingService=this._createMessagingService(e,i)}e.prototype={create:function(){var e=new o.Services.Messaging.Messaging(this._messagingService);return this._messagingService._recalculateAllMessagingCapabilities(e),e},_createMessagingService:function(e,t){var i=new o.Services.Messaging.ParticipantService,a=new o.Services.Messaging.AttachmentBuilder(t);t.registerCreator("image/*",new o.Services.Messaging.ImageThumbnailCreator(a)),t.registerCreator("video/*",new o.Services.Messaging.VideoThumbnailCreator(a));var r=new o.Services.Messaging.MessageBuilder(a,i),s=new o.Services.Analytics.MessagingAnalyticsService,n=new o.Services.Messaging.MessageService(e,r,a,s),t=new o.Services.Messaging.EscalationService(e),a=new o.Services.Messaging.ConversationBuilder(r),r=new o.Services.Messaging.ConversationService(e,n,i,t,r,a,s),s=new o.Services.Messaging.MessagingService(e,r,n,i,a,this._contactsIntegrationService,s);return r._messagingService=s}},o.Services.Messaging.MessagingFactory=e}(AvayaClientServices),function(d){"use strict";function e(e,t,i,a,r,s,n){this._hasStarted=!1,this._conversationsSubscribed=!1,this._provider=e,this._messageService=i,this._conversationService=t,this.conversations=new d.Base.DataSet,this._draftConversations=[],this._identity={},this._participantsService=a,this._conversationBuilder=r,this._updateByIdDataSetFnc=T,this._contactsIntegrationService=s,this._onContactListChanged=T,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=T,this._unreadConversationsCounter=T,this._messagingAnalyticsService=n}e.prototype={getActiveConversations:function(t){var i=new d.Base.DataRetrieval(this.conversations),a=this._messagingAnalyticsService.startTimingMetric(),e=function(e){this._messagingAnalyticsService.trackTimeRequestsGetConversationsEnd(a),this._updateConversationsContainer(e,this.conversations,t),0===this.conversations.length&&this.conversations.onDataSetChanged(this.conversations,d.Base.DataSetChangeTypes.ADDED),this._subscribeForConversationsUpdates(t),i.isCompleted=!0,i._dataRetrievalProgress.fire(this.conversations.length,!1),i._dataRetrievalDone.fire()}.bind(this),r=function(e){this._messagingAnalyticsService.trackErrorsResponseGetConversations(d.Services.Analytics.AnalyticsErrorCode.GETTING_CONVERSATIONS_ERROR),i._dataRetrievalFailed.fire(e)}.bind(this),s={cancel:function(){}},n=this._provider.getConversations(s);return i._onCancel=function(){s.cancel()},n.then(e,r,function(e){i._dataRetrievalProgress.fire(e,!1)}),i},getDraftConversations:function(){return this._draftConversations},leaveAllConversations:function(){return this.leaveConversations(this.conversations)},leaveConversations:function(e){for(var t=this._messagingAnalyticsService.startTimingMetric(),i=[],a=E.Deferred(),r=e.length,s=0;s<r;s++)i.push(e[s].leave());return E.when.apply(this,i).then(function(){this._messagingAnalyticsService.trackTimeRequestsLeaveConversationsEnd(t),a.resolve(!0)}.bind(this),function(){var e=d.Services.Messaging.MessagingErrorReason.MESSAGING_LEAVE_CONVERSATION_FAILED;this._messagingAnalyticsService.trackErrorsResponseLeaveConversations(e),a.reject(new d.Services.Messaging.MessagingError(e))}.bind(this)),a.promise()},createConversation:function(e){var t=this._conversationBuilder.build({resourceStatus:d.Services.Messaging.ResourceStatus.DRAFT_UNSENT},this._conversationService);return t.participants.push(this._participantsService.getSelfParticipant()),this.conversations.push(t),this.conversations.onDataSetChanged([t],d.Base.DataSetChangeTypes.ADDED),this._draftConversations.push(t),this._provider.on(d.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(t)}.bind(this)),this._provider.on(d.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(t)}.bind(this)),t.addOnStatusChangedCallback(function(e,t){t===d.Services.Messaging.ResourceStatus.PUBLISHED&&(t=this._draftConversations.indexOf(e),this._draftConversations.splice(t,1)),this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.addOnActiveStatusChangedCallback(function(e){this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.addOnClosedStatusChangedCallback(function(e,t){var i=this.conversations.indexOf(e);-1<i&&(this.conversations.splice(i,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.REMOVED)),this._conversationService._recalculateAllConversationCapabilities(e)}.bind(this)),t.lastUpdated=new Date,t},start:function(t,e){return d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Messaging Service is starting..."),this._serviceUnavailableAnalyticsInit(t),this._hasStarted=!0,this._provider.on(d.Base.NetworkProviderEvents.UNAUTHORIZED,function(){t._fireMessagingUnavailableCallback(d.Services.Analytics.AnalyticsErrorCode.UNAUTHORIZED)}.bind(this)),this._provider.on(d.Base.NetworkProviderEvents.AUTHORIZED,function(){t._fireMessagingAvailableCallback()}.bind(this)),this._provider.start(e.ammConfiguration,t).then(function(){return this.validateUsers([this._provider.getSelfAddress()])}.bind(this)).then(function(e){e=this._participantsService.getOrCreateParticipant(e[0]);this._identity.participant=e,this._participantsService.setSelfParticipant(e),this._recalculateAllMessagingCapabilities(t),this._onContactListChanged=function(){this.conversations.forEach(function(e){this._updateMatchedContactsForConversation(e)},this)}.bind(this),this._contactsIntegrationService.addOnContactListChangedCallback(this._onContactListChanged),t.addOnMessagingServiceAvailableCallback(function(){this._recalculateAllMessagingCapabilities(t)}.bind(this)),t.addOnMessagingServiceUnavailableCallback(function(){this._recalculateAllMessagingCapabilities(t)}.bind(this))}.bind(this),function(e){return this._hasStarted=!1,this._recalculateAllMessagingCapabilities(t),E.Deferred().reject(e).promise()}.bind(this))},_serviceUnavailableAnalyticsInit:function(e){var t;e.addOnMessagingServiceUnavailableCallback(function(e){e._messagingUnavailableReason&&(t=this._messagingAnalyticsService.startTimingMetric(),this._messagingAnalyticsService.trackServiceUnavailable(e._messagingUnavailableReason))}.bind(this)),e.addOnMessagingServiceAvailableCallback(function(){this._messagingAnalyticsService.trackDurationServiceUnavailableEnd(t)}.bind(this))},stop:function(l){l._isAvailable&&(l._isAvailable=T,l._onMessagingServiceUnavailableCallbacks.fire(l));var e=function(){if(this._hasStarted)return this._provider.stop().then(function(e){this._messageService.stop(),this._participantsService.stop(),this._draftConversations=[];for(var t=this.conversations.length,i=0;i<t;i++){for(var a=this.conversations[i].messages.length,r=0;r<a;r++){for(var s=this.conversations[i].messages[r].parts.length,n=0;n<s;n++)delete this.conversations[i].messages[r].parts[n];delete this.conversations[i].messages[r]}for(var o=this.conversations[i]._draftEscalations.length,c=0;c<o;c++)delete this.conversations[i]._draftEscalations[c];delete this.conversations[i]}return this.conversations=new d.Base.DataSet,this._hasStarted=!1,l._onMessagingLimitsChangedCallbacks.empty(),l._onNumberOfConversationsWithUnreadContentChangedCallbacks.empty(),l._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.empty(),l._onRoutableDomainsChangedCallbacks.empty(),this._contactsIntegrationService.removeOnContactListChangedCallback(this._onContactListChanged),this._onContactListChanged=T,this._unreadConversationsCounter=T,this._numberOfConversationsWithUnreadContentSinceLastAccessTime=T,this._recalculateAllMessagingCapabilities(l),e}.bind(this));var e=E.Deferred(),t=new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED);return e.reject(t),e.promise()}.bind(this);return this.logout().then(e,e)},_stopImmediately:function(e){d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Stopping the Service"),e._isAvailable&&e._onMessagingServiceUnavailableCallbacks.fire(e);e=E.Deferred();return this._hasStarted?(this._provider.stopImmediately(),d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Service stopped successfully"),e.resolve()):(d.Base.Logger.debug(d.Base.LoggerTags.MESSAGING_SERVICE,"Service failed to stop"),e.reject(new d.Services.Messaging.MessagingError(d.Services.Messaging.MessagingErrorReason.MESSAGING_NOT_STARTED))),e.promise()},logout:function(){return this._provider.logout()},getNumberOfConversationsWithUnreadContent:function(){return this.conversations.filter(function(e){return 0<e.getUnreadMessageCount()||0<e.getUnreadAttachmentCount()}).length},getNumberOfConversationsWithUnreadContentSinceLastAccess:function(){return this.conversations.filter(function(e){return e.hasUnreadMessagesSinceLastAccess()}).length},validateUsers:function(e){return this._conversationService.validateUsers(e)},searchConversations:function(e,t){var i=this._messagingAnalyticsService.startTimingMetric(),a=new d.Base.DataRetrieval,r=a.getDataSet(),s={cancel:function(){}},n={q:e.getQuery(),subject:e.isSearchSubject(),participants:e.isSearchParticipants(),body:e.isSearchBody()};e.getQueryAfter()&&(n.after=e.getQueryAfter().toISOString());var o=function(e){this._messagingAnalyticsService.trackTimeRequestsSearchConversationsEnd(i),this._updateConversationsContainer(e,r,t),a.isCompleted=!0,a._dataRetrievalProgress.fire(r.length,!1),a._dataRetrievalDone.fire(),this._messagingAnalyticsService.trackNumConversationSearchRequests(n.body,n.subject,n.participants)}.bind(this),c=function(e){this._messagingAnalyticsService.trackErrorsResponseSearchConversations(d.Services.Analytics.AnalyticsErrorCode.SEARCHING_CONVERSATIONS_ERROR),a._dataRetrievalFailed.fire(e)}.bind(this),l=function(e){a._dataRetrievalProgress.fire(e,!1)}.bind(this);return this._provider.getConversationsByQuery(n,null,s).then(o,c,l),a._onCancel=function(){s.cancel()},this._searchLocalConversations(this.conversations,e).forEach(function(e){r.push(e)}),setTimeout(function(){r.onDataSetChanged(r,d.Base.DataSetChangeTypes.ADDED),l(r,!1)},0),a},_createNewConversation:function(e,t){var i=this._conversationBuilder.build(e,this._conversationService);return this._provider.on(d.Providers.AMM.ProviderStates.AVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(i)}.bind(this)),this._provider.on(d.Providers.AMM.ProviderStates.UNAVAILABLE,function(){this._conversationService._recalculateAllConversationCapabilities(i)}.bind(this)),this._conversationBuilder.update(i,e,this._conversationService),i.addOnClosedStatusChangedCallback(function(e,t){var i=this.conversations.indexOf(e);-1<i&&(this.conversations.splice(i,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.ADDED))}.bind(this)),i},_getById:function(e,t){return e.filter(function(e){return e.id===t})[0]},_updateConversationsContainer:function(e,t,i){if(e&&e.conversations&&0<e.conversations.length){for(var a=[],r=[],s=0;s<e.conversations.length;s++){var n=e.conversations[s],o=this._getById(t,n.id);o?(this._conversationBuilder.update(o,n,this._conversationService),a.push(o),this._updateMatchedContactsForConversation(o)):n.flags.active&&((o=this._createNewConversation(n,i)).participants=this._conversationService.getParticipantsFromMessage(n.messages[0]),t.unshift(o),r.push(o),this._updateMatchedContactsForConversation(o))}0<r.length&&t.onDataSetChanged(r,d.Base.DataSetChangeTypes.ADDED),0<a.length&&t.onDataSetChanged(a,d.Base.DataSetChangeTypes.UPDATED),this._updateNumberOfConversationsWithUnreadContent(i),this._updateNumberOfConversationsWithUnreadContentSinceLastAccessTime(i)}},_searchLocalConversations:function(e,s){var n=[];return e.forEach(function(e){var t=!1;s.isSearchSubject()&&-1!==e.getSubject().toLowerCase().indexOf(s.getQuery())&&(t=!0),s.isSearchParticipants()&&e.getParticipants().forEach(function(e){-1===e.givenName.toLowerCase().indexOf(s.getQuery())&&-1===e.surname.toLowerCase().indexOf(s.getQuery())||(t=!0)});var i=e.getMessages();s.isSearchBody()&&(i=e.getMessages().filter(function(e){if(s.isSearchBody()&&e.body&&-1!==e.body.toLowerCase().indexOf(s.getQuery()))return t=!0}));var a,r=s.getQueryAfter();(t=r&&t?e.getLastUpdatedTime()>=r:t)&&((a=E.extend(new d.Services.Messaging.Conversation,e)).messages=new d.Base.DataSet,i.forEach(function(e){a.messages.push(E.extend(new d.Services.Messaging.Message(this._messageService,a),e))}.bind(this)),this._conversationBuilder._updatePreviewText(a),n.push(a))}.bind(this)),n},_subscribeForConversationsUpdates:function(t){this._conversationsSubscribed||this._provider.observeConversations().then(function(){this._provider.on(d.Providers.Interfaces.MessagingProviderHandlers.CONVERSATIONS_UPDATE,function(e){this._updateConversationsContainer(e,this.conversations,t)}.bind(this)),this._conversationsSubscribed=!0}.bind(this))},_updateConversationsByIdDataSet:function(e,i,t){var a={conversations:[]};e.forEach(function(t){var e=i.filter(function(e){return e.id===t.id})[0];e&&a.conversations.push(e)}.bind(this)),0<a.conversations.length&&this._updateConversationsContainer(a,e,t)},removeConversation:function(e){var t,i=E.Deferred();return e.getRemoveCapability().isAllowed?(0<=(t=this.conversations.indexOf(e))&&(this.conversations.splice(t,1),this.conversations.onDataSetChanged([e],d.Base.DataSetChangeTypes.REMOVED)),0<=(t=this._draftConversations.indexOf(e))&&this._draftConversations.splice(t,1),i.resolve()):i.reject(new d.Base.BaseError(e.getRemoveCapability().denialReason)),i.promise()},removeAllDraftConversations:function(){for(var e=this._draftConversations.length-1;0<=e;e--)this.removeConversation(this._draftConversations[e])},serviceIsAvailable:function(){return!!this._provider.isAvailable()&&this._hasStarted},_recalculateAllMessagingCapabilities:function(e){e._recalculateRetrieveConversationsCapability(),e._recalculateStartServiceCapability(),e._recalculateCreateConversationCapability(),e._recalculateSearchConversationsCapability(),e._recalculateValidateParticipantAddressCapability(),e._recalculateMarkContentAsReadCapability()},getRoutableDomains:function(){return this._provider.getRoutableDomains()},getSelfAddress:function(){return this._provider.getSelfAddress()},getConversationResource:function(){return this._provider.getSelfAddress()},getValidateAddressResource:function(){return this._provider.getValidateAddressResource()},getMarkAsReadResource:function(){return this._provider.getMarkAsReadResource()},_updateMatchedContactsForConversation:function(e){this._contactsIntegrationService.isStarted()&&e.getParticipants().forEach(function(e){this._updateMatchedContactsForParticipant(e)},this)},_updateMatchedContactsForParticipant:function(e){this._contactsIntegrationService.updateMatchedContactsForParticipant(e)},_updateNumberOfConversationsWithUnreadContent:function(e){var t=this.getNumberOfConversationsWithUnreadContent(),i=d.Base.Utils.isDefined(this._unreadConversationsCounter);this._unreadConversationsCounter!==t&&(this._unreadConversationsCounter=t,i&&e._onNumberOfConversationsWithUnreadContentChangedCallbacks.fire(e,t))},_updateNumberOfConversationsWithUnreadContentSinceLastAccessTime:function(e){var t=this.getNumberOfConversationsWithUnreadContentSinceLastAccess(),i=d.Base.Utils.isDefined(this._numberOfConversationsWithUnreadContentSinceLastAccessTime);this._numberOfConversationsWithUnreadContentSinceLastAccessTime!==t&&(this._numberOfConversationsWithUnreadContentSinceLastAccessTime=t,i&&e._onNumberOfConversationsWithUnreadContentSinceLastAccessChangedCallbacks.fire(e,t))}},d.Services.Messaging.MessagingService=e}(AvayaClientServices),function(a){"use strict";function e(){this._participants=[],this._selfParticipant=T}e.prototype={getOrCreateParticipant:function(e){var t=e._address||e.address||e.from._address||e.from.address,i=this._getParticipant(t);return i||(t=!!this._selfParticipant&&this._selfParticipant.getAddress()===t,i=new a.Services.Messaging.Participant(e,t),this._participants.push(i)),i},_getParticipant:function(t){return this._participants.filter(function(e){return e.getAddress()===t})[0]},setSelfParticipant:function(e){this._selfParticipant=e,this._selfParticipant.self=!0},getSelfParticipant:function(){return this._selfParticipant},stop:function(){this._selfParticipant=T,this._participants=[]}},a.Services.Messaging.ParticipantService=e}(AvayaClientServices),function(e){"use strict";function t(e){this._config=e||{width:128},this._creators={}}t.prototype={getConfig:function(){return this._config},setConfig:function(e){this._config=e},registerCreator:function(e,t){this._creators[e]=t},unregisterCreator:function(e){this._creators[e]=T},create:function(e,t){if(t=t||this._config,e.getCreateThumbnailCapability().isAllowed){var i=this._creators[e.getMimeType()]?e.getMimeType():e.getMimeType().slice(0,e.getMimeType().indexOf("/")+1)+"*";return this._creators[i].create(e,t)}}},e.Services.Messaging.ThumbnailCreator=t}(AvayaClientServices),function(t){"use strict";function e(e){t.Services.Messaging.AbstractThumbnailCreator.call(this,e)}(e.prototype=Object.create(t.Services.Messaging.AbstractThumbnailCreator.prototype)).create=function(i,a){var r=E.Deferred(),s={disposition:i.disposition.replace("attachment","inline"),mimeType:"image/jpeg",status:i.status},e=new FileReader;return e.onloadend=function(){this._getFirstFrameFromVideo(e.result,function(e){var t=new Image;t.src=e;t=new Blob([this._resizeImage(t,a)],{type:"image/jpeg"});s.size=t.size,i.thumbnail=this._attachmentBuilder.build(s,t),r.resolve(i.thumbnail)}.bind(this))}.bind(this),e.readAsDataURL(i.file),r.promise()},e.prototype._getFirstFrameFromVideo=function(e,t){var i,a,r=document.createElement("canvas"),s=document.createElement("video"),n=document.createElement("source");n.src=e,n.type="video/mp4",s.appendChild(n),E(s).on("loadedmetadata",function(){r.height=a=s.videoHeight,r.width=i=s.videoWidth}),E(s).on("loadeddata",function(){r.getContext("2d").drawImage(s,0,0,i,a),t(r.toDataURL("image/jpeg"))}),E(s).on("error",function(){throw new Error}),s.load()},t.Services.Messaging.VideoThumbnailCreator=e}(AvayaClientServices),function(e){"use strict";function t(){this._address="",this._participantId=T,this._displayName="",this._localUser=!1,this._joinTime=Date.now(),this._matchedContacts=new e.Services.Contacts.MatchedContactsWithMatchLevel,this._onParticipantMatchedContactsChangedCallbacks=E.Callbacks()}t.prototype={getAddress:function(){return this._address},setAddress:function(e){this._address=e},getDisplayName:function(){return this._displayName},setDisplayName:function(e){this._displayName=e},getParticipantId:function(){return this._participantId},isLocalUser:function(){return this._localUser},getBestContactMatch:function(){if(this._matchedContacts&&!this._matchedContacts.empty)return 0<this._matchedContacts._exactType1Contacts.length?this._matchedContacts._exactType1Contacts[0]:0<this._matchedContacts._exactType2Contacts.length?this._matchedContacts._exactType2Contacts[0]:0<this._matchedContacts._partialType1Contacts.length?this._matchedContacts._partialType1Contacts[0]:void 0},getAllPossibleContactMatches:function(){return this._matchedContacts},setMatchedContacts:function(e){(e&&!e._equals(this._matchedContacts)||!e&&this._matchedContacts)&&(this._matchedContacts=e,this._onParticipantMatchedContactsChangedCallbacks.fire(this))}},e.Services.Participant=t}(AvayaClientServices),function(e){"use strict";E.extend(e.Services.Participant.prototype,{addOnParticipantMatchedContactsChangedCallback:function(e){this._onParticipantMatchedContactsChangedCallbacks.add(e)},removeOnParticipantMatchedContactsChangedCallback:function(e){this._onParticipantMatchedContactsChangedCallbacks.remove(e)}})}(AvayaClientServices),function(){"use strict";AvayaClientServices.Services.Presence.PresenceErrorReason={UNKNOWN:"UNKNOWN",UNSUPPORTED:"UNSUPPORTED",CANCELED:"CANCELED",INVALID_REQUEST:"INVALID_REQUEST",INVALID_STATE:"INVALID_STATE",INTERNAL_ERROR:"INTERNAL_ERROR",SEND_ERROR:"SEND_ERROR",TIMEOUT:"TIMEOUT",RETRY_LIMIT_EXCEEDED:"RETRY_LIMIT_EXCEEDED",INVALID_RESPONSE:"INVALID_RESPONSE",AUTHENTICATION_ERROR:"AUTHENTICATION_ERROR",SERVER_ERROR:"SERVER_ERROR"}}();!function(){"use strict";AvayaClientServices.Services.Presence.PresenceLocationMode={PRESENCE_LOCATION_MODE_UNSPECIFIED:"PRESENCE_LOCATION_MODE_UNSPECIFIED",PRESENCE_LOCATION_MODE_OFFICE:"PRESENCE_LOCATION_MODE_OFFICE",PRESENCE_LOCATION_MODE_HOME:"PRESENCE_LOCATION_MODE_HOME",PRESENCE_LOCATION_MODE_MOBILE:"PRESENCE_LOCATION_MODE_MOBILE",PRESENCE_LOCATION_MODE_TRAVELING:"PRESENCE_LOCATION_MODE_TRAVELING"}}(),function(e){"use strict";var t={PRESENCE_STATE_UNKNOWN:"PRESENCE_STATE_UNKNOWN",PRESENCE_STATE_UNSPECIFIED:"PRESENCE_STATE_UNSPECIFIED",PRESENCE_STATE_AVAILABLE:"PRESENCE_STATE_AVAILABLE",PRESENCE_STATE_ON_A_CALL:"PRESENCE_STATE_ON_A_CALL",PRESENCE_STATE_BUSY:"PRESENCE_STATE_BUSY",PRESENCE_STATE_AWAY:"PRESENCE_STATE_AWAY",PRESENCE_STATE_DO_NOT_DISTURB:"PRESENCE_STATE_DO_NOT_DISTURB",PRESENCE_STATE_OUT_OF_OFFICE:"PRESENCE_STATE_OUT_OF_OFFICE",PRESENCE_STATE_OFFLINE:"PRESENCE_STATE_OFFLINE"};e.Services.Presence.PresenceState=t,e.Services.Presence.ManualPresenceState={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_BUSY:t.PRESENCE_STATE_BUSY,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:t.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE},e.Services.Presence.PhonePresenceState={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:t.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OUT_OF_OFFICE:t.PRESENCE_STATE_OUT_OF_OFFICE,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE},e.Services.Presence.VideoPresenceState={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_ON_A_CALL:t.PRESENCE_STATE_ON_A_CALL,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE},e.Services.Presence.IMPresenceState={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE},e.Services.Presence.CalendarPresenceState={PRESENCE_STATE_UNKNOWN:t.PRESENCE_STATE_UNKNOWN,PRESENCE_STATE_UNSPECIFIED:t.PRESENCE_STATE_UNSPECIFIED,PRESENCE_STATE_AVAILABLE:t.PRESENCE_STATE_AVAILABLE,PRESENCE_STATE_AWAY:t.PRESENCE_STATE_AWAY,PRESENCE_STATE_OFFLINE:t.PRESENCE_STATE_OFFLINE}}(AvayaClientServices),function(e){"use strict";function t(e){this._presentity=e,this._locationMode=T,this._note=T,this._calendarStartTime=T,this._calendarEndTime=T,this._calendarState=T,this._manualState=T,this._overallState=T,this._enterpriseIMState=T,this._phoneState=T,this._videoState=T,this._enterpriseIMContact=T,this._phoneContact=T,this._videoContact=T}t.prototype={getPresentity:function(){return this._presentity},getOverallState:function(){return this._overallState},_setOverallState:function(e){this._overallState=e},getManualState:function(){return this._manualState},_setManualState:function(e){this._manualState=e},getPhoneState:function(){return this._phoneState},_setPhoneState:function(e){this._phoneState=e},getPhoneContact:function(){return this._phoneContact},_setPhoneContact:function(e){this._phoneContact=e},getVideoState:function(){return this._videoState},_setVideoState:function(e){this._videoState=e},getVideoContact:function(){return this._videoContact},_setVideoContact:function(e){this._videoContact=e},getEnterpriseIMState:function(){return this._enterpriseIMState},_setEnterpriseIMState:function(e){this._enterpriseIMState=e},getEnterpriseIMContact:function(){return this._enterpriseIMContact},_setEnterpriseIMContact:function(e){this._enterpriseIMContact=e},getCalendarState:function(){return this._calendarState},_setCalendarState:function(e){this._calendarState=e},getCalendarStartTime:function(){return this._calendarStartTime},_setCalendarStartTime:function(e){this._calendarStartTime=e},getCalendarEndTime:function(){return this._calendarEndTime},_setCalendarEndTime:function(e){this._calendarEndTime=e},getLocationMode:function(){return this._locationMode},_setLocationMode:function(e){this._locationMode=e},getNote:function(){return this._note},_setNote:function(e){this._note=e}},e.Services.Presence.Presence=t}(AvayaClientServices),function(e){"use strict";function t(e){Error.call(this),this._reason=e}(t.prototype=Object.create(Error.prototype)).getReason=function(){return this._reason},e.Services.Presence.PresenceError=t}(AvayaClientServices),function(a){"use strict";function e(){}(e.prototype=Object.create(a.Services.Presence.Presence.prototype)).setPhoneState=function(e){var t,i=!1;for(t in a.Services.Presence.PhonePresenceState)if(a.Services.Presence.PhonePresenceState.hasOwnProperty(t)&&e===a.Services.Presence.PhonePresenceState[t]){this._setPhoneState(e),i=!0;break}return i},e.prototype.setVideoState=function(e){var t,i=!1;for(t in a.Services.Presence.VideoPresenceState)if(a.Services.Presence.VideoPresenceState.hasOwnProperty(t)&&e===a.Services.Presence.VideoPresenceState[t]){this._setVideoState(e),i=!0;break}return i},e.prototype.setEnterpriseIMState=function(e){var t,i=!1;for(t in a.Services.Presence.IMPresenceState)if(a.Services.Presence.IMPresenceState.hasOwnProperty(t)&&e===a.Services.Presence.IMPresenceState[t]){this._setEnterpriseIMState(e),i=!0;break}return i},a.Services.Presence.SelfPresence=e}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getCallLogId:function(){},getParticipantList:function(){},getStartTime:function(){},getCallDuration:function(){},isCallerIdPrivate:function(){},getSubject:function(){},getRemoteAddress:function(){},getLocalAddress:function(){},getCallType:function(){},getWebConferenceAddress:function(){},getChannelTypeList:function(){},isBridged:function(){},isIncoming:function(){},isMissed:function(){},isDeclined:function(){},isFailed:function(){},isRead:function(){},getCorrelatedCallLogIdList:function(){}},e.Services.SessionLogs.CallLogItem=t}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getUnreadCount:function(){}},e.Services.SessionLogs.CallLogsDataSet=t}(AvayaClientServices),function(e){"use strict";e.Services.SessionLogs.create=function(){return new e.Services.SessionLogs.SessionLogs}}(AvayaClientServices),function(e){"use strict";function t(){}t.prototype={getCurrentCallLogItemList:function(){},markAsRead:function(e,t){},deleteCallLogItemList:function(e,t){}},e.Services.SessionLogs.SessionLogs=t}(AvayaClientServices),function(i){"use strict";function e(){this._vmProvider=T,this._available=T,this._starting=!1,this._started=!1,this._vmNumber=T,this._vmStatus=new i.Services.VoiceMessaging.VoiceMessagingStatusParameters(!1),this._onVoicemailNumberChange=T,this._onMWIStatusChange=T,this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._onVoicemailNumberChangedCallbacks=E.Callbacks(),this._onVoiceMessagingStatusChangedCallbacks=E.Callbacks(),this._onVoiceMessagingServiceAvailableCallbacks=E.Callbacks(),this._onVoiceMessagingServiceUnavailableCallbacks=E.Callbacks(),this._serviceAvailableCapability=new i.Base.Capability(i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED)}e.prototype={getVoicemailNumber:function(){return this._vmNumber},getVoiceMessagingStatus:function(){return this._vmStatus},start:function(e,t){return t&&(this._vmProvider=t),e.sgConfiguration.credentialProvider.isGuest?(i.Base.Logger.warn(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Cannot start service for guest"),E.Deferred().reject(new i.Services.Call.CallException(i.Services.Call.CallError.USER_NOT_FOUND)).promise()):(this.startDfd=E.Deferred(),i.Base.Utils.isWebRTC_SupportedBrowser(e.sgConfiguration._disableWebRTCForTheseBrowsers)?(i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Starting the service"),this._subscribeForProvidersNotifications(),this._starting=!0,this._vmProvider.start(T,e.sgConfiguration).fail(function(e){this._starting=!1,this._available=!1,i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service",e),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.reject(e)}.bind(this)),i.Base.Utils.isDefined(this._vmProvider.isServiceAvailable)&&this._vmProvider.isServiceAvailable()&&this._onServiceAvailable(),this.startDfd.promise()):(this._available=!1,this._started=!0,this._onVoiceMessagingServiceUnavailableCallbacks.fire(this),this._serviceAvailableCapability._updateIfChanged(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),E.Deferred().reject(new i.Services.Call.CallException(i.Services.Call.CallError.WEBRTC_NOT_SUPPORTED)).promise()))},stop:function(){i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._unsubscribeFromProvidersNotifications(),this._onServiceUnavailable();var t=function(){this._started=!1,this._onVoicemailNumberChangedCallbacks.empty(),this._onVoiceMessagingStatusChangedCallbacks.empty(),this._onVoiceMessagingServiceAvailableCallbacks.empty(),this._onVoiceMessagingServiceUnavailableCallbacks.empty()}.bind(this);return this._vmProvider.stop().then(function(){t(),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully")}.bind(this),function(e){return t(),i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to stop service",e),E.Deferred().reject(e).promise()}.bind(this))},_stopImmediately:function(){return i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Stopping the service"),this._started=!1,this._onServiceUnavailable(),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service stopped successfully"),E.Deferred().resolve().promise()},_onServiceAvailable:function(){var e;this._available||(this._started||(this._starting=!1,this._started=!0,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service started successfully"),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.resolve()),this._serviceAvailableCapability._updateIfChanged(!0,i.Base.CapabilityDenialReason.CAPABILITY_NOT_DENIED),this._available=!0,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is available"),this._onVoiceMessagingServiceAvailableCallbacks.fire(this),e=this._vmProvider.getVoicemailMWI(),this._vmStatus.isMessageWaiting()!==e&&(this._vmStatus._setMessageWaiting(e),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New MWI is "+e)),e=this._vmProvider.getVoicemailNumber(),this._vmNumber!==e&&(this._vmNumber=e,this._onVoicemailNumberChangedCallbacks.fire(e),i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"New voicemail number is "+e)))},_onServiceUnavailable:function(){(this._available||this._starting)&&(this._starting&&(this._starting=!1,i.Base.Logger.error(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Failed to start service"),this.startDfd.state()===i.Base.DeferredStates.PENDING&&this.startDfd.reject()),this._serviceAvailableCapability._updateIfChanged(!1,i.Base.CapabilityDenialReason.CAPABILITY_NOT_SUPPORTED),this._available=!1,i.Base.Logger.info(i.Base.LoggerTags.VOICE_MESSAGING_SERVICE,"Service is unavailable"),this._onVoiceMessagingServiceUnavailableCallbacks.fire(this))},_subscribeForProvidersNotifications:function(){this._started||this._starting||(this._onVoicemailNumberChange=function(e){this._vmNumber!==e&&(this._vmNumber=e,this._onVoicemailNumberChangedCallbacks.fire(e))}.bind(this),this._onMWIStatusChange=function(e){this._vmStatus.isMessageWaiting()!==e&&(this._vmStatus._setMessageWaiting(e),this._onVoiceMessagingStatusChangedCallbacks.fire(this._vmStatus))}.bind(this),this._onNetworkAvailable=this._onServiceAvailable.bind(this),this._onNetworkUnavailable=this._onServiceUnavailable.bind(this),this._vmProvider.on(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.on(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.on(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.on(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_ACTIVATED,this._onNetworkAvailable),this._vmProvider.on(i.Providers.CallServiceGateway.ObservableEvents.CALLS_SERVICE_DEACTIVATED,this._onNetworkUnavailable))},_unsubscribeFromProvidersNotifications:function(){this._started&&(this._vmProvider.off(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.VOICEMAIL_NUMBER_CHANGED,this._onVoicemailNumberChange),this._vmProvider.off(i.Providers.Interfaces.VoiceMessagingProviderCallbackIds.MWI_STATUS_CHANGED,this._onMWIStatusChange),this._vmProvider.off(i.Base.NetworkProviderEvents.UNAUTHORIZED,this._onNetworkUnavailable),this._vmProvider.off(i.Base.NetworkProviderEvents.AUTHORIZED,this._onNetworkAvailable),this._vmProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_UNAVAILABLE,this._onNetworkUnavailable),this._vmProvider.off(i.Providers.CallServiceGateway.ObservableEvents.NETWORK_PROVIDER_IS_AVAILABLE,this._onNetworkAvailable),this._onNetworkAvailable=T,this._onNetworkUnavailable=T,this._onVoicemailNumberChange=T,this._onMWIStatusChange=T)}},i.Services.VoiceMessaging.VoiceMessaging=e}(AvayaClientServices),function(e){"use strict";E.extend(e.Services.VoiceMessaging.VoiceMessaging.prototype,{addOnVoiceMessagingServiceUnavailableCallback:function(e){this._onVoiceMessagingServiceUnavailableCallbacks.add(e)},removeOnVoiceMessagingServiceUnavailableCallback:function(e){this._onVoiceMessagingServiceUnavailableCallbacks.remove(e)},addOnVoiceMessagingServiceAvailableCallback:function(e){this._onVoiceMessagingServiceAvailableCallbacks.add(e)},removeOnVoiceMessagingServiceAvailableCallback:function(e){this._onVoiceMessagingServiceAvailableCallbacks.remove(e)},addOnVoicemailNumberChangedCallback:function(e){this._onVoicemailNumberChangedCallbacks.add(e)},removeOnVoicemailNumberChangedCallback:function(e){this._onVoicemailNumberChangedCallbacks.remove(e)},addOnVoiceMessagingStatusChangedCallback:function(e){this._onVoiceMessagingStatusChangedCallbacks.add(e)},removeVoiceMessagingStatusChangedCallback:function(e){this._onVoiceMessagingStatusChangedCallbacks.remove(e)}})}(AvayaClientServices),function(e){"use strict";E.extend(e.Services.VoiceMessaging.VoiceMessaging.prototype,{getSubscribeForVoicemailNumberChangesCapability:function(){return this._serviceAvailableCapability},getSubscribeForVoiceMessagingStatusChangesCapability:function(){return this._serviceAvailableCapability}})}(AvayaClientServices),function(e){"use strict";function t(e){this._messageWaiting=e}t.prototype={isMessageWaiting:function(){return this._messageWaiting},_setMessageWaiting:function(e){this._messageWaiting=e}},e.Services.VoiceMessaging.VoiceMessagingStatusParameters=t}(AvayaClientServices),function(l){"use strict";var d={createLogAPICallAdvice:function(r){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.BEFORE,function(e,t,i,a){l.Base.Logger.info(r,"API called: "+t+"."+i)})},createWrapCaughtErrorInPromiseAdvice:function(o,c){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.AROUND,function(e,t,i,a,r,s){try{var n=r.apply(a,s);return n&&"function"==typeof n.fail&&n.fail(function(e){d._isSupportedExceptionClass(e)&&(l.Base.Logger.warn(o,"Caught error inside promise handler",e),l.Base.AOPTools.triggerExceptionCallback(e))}),n}catch(e){return l.Base.Logger.warn(o,"Caught error in execution of function returning promise",e),l.Base.AOPTools.triggerExceptionCallback(e),E.Deferred().reject(c).promise()}})},_isSupportedExceptionClass:function(e){return e instanceof Error||e instanceof l.Base.BaseError||e instanceof l.Services.Conference.ConferenceException||e instanceof l.Services.Collaboration.CollaborationError||e instanceof l.Services.Call.CallException||e instanceof l.Services.Contacts.ContactsError||e instanceof l.Services.Presence.PresenceError},createWrapCaughtErrorInAdvice:function(n){return new l.Base.AOPAdvice(l.Base.AOPPointcutType.AROUND,function(e,t,i,a,r,s){try{return r.apply(a,s)}catch(e){throw l.Base.Logger.warn(n,"Caught error in execution of function",e),l.Base.AOPTools.triggerExceptionCallback(e),e}})}};d.LOG_CALL_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CALL_SERVICE),d.LOG_PRESENCE_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.PRESENCE_SERVICE),d.LOG_CONTACTS_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CONTACTS_SERVICE),d.LOG_MESSAGING_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.MESSAGING_SERVICE),d.LOG_COLLABORATION_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.COLLABORATION_SERVICE),d.LOG_CONFERENCE_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.CONFERENCE_SERVICE),d.LOG_USER_API_CALLS=d.createLogAPICallAdvice(l.Base.LoggerTags.USER_SERVICE),d.WRAP_CAUGHT_CALL_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CALL_SERVICE,new l.Services.Call.CallException(l.Services.Call.CallError.INTERNAL_ERROR)),d.WRAP_CAUGHT_CALL_EXCEPTION=d.createWrapCaughtErrorInAdvice(l.Base.LoggerTags.CALL_SERVICE,new l.Services.Call.CallException(l.Services.Call.CallError.INTERNAL_ERROR)),d.WRAP_CAUGHT_PRESENCE_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.PRESENCE_SERVICE,new l.Services.Presence.PresenceError(l.Services.Presence.PresenceErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_CONTACTS_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CONTACTS_SERVICE,new l.Services.Contacts.ContactsError(l.Services.Contacts.ContactsErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_MESSAGING_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.MESSAGING_SERVICE,new l.Services.Messaging.MessagingError(l.Services.Messaging.MessagingErrorReason.MESSAGING_INTERNAL_ERROR)),d.WRAP_CAUGHT_COLLABORATION_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.COLLABORATION_SERVICE,new l.Services.Collaboration.CollaborationError(l.Services.Collaboration.CollaborationErrorReason.INTERNAL_ERROR)),d.WRAP_CAUGHT_CONFERENCE_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.CONFERENCE_SERVICE,new l.Services.Conference.ConferenceException(l.Services.Conference.ConferenceError.CAPABILITY_NOT_ALLOWED,"An internal error occurred.")),d.WRAP_CAUGHT_USER_ERROR=d.createWrapCaughtErrorInPromiseAdvice(l.Base.LoggerTags.USER_SERVICE,new l.Base.BaseError(l.Base.ErrorReasons.INTERNAL_ERROR)),l.Base.AOPCommonAdvices=d}(AvayaClientServices),function(l){"use strict";function e(e){l.Base.Observable.call(this),this._elements={},this._appliedElementIds=[],this._elementsIds=[],this._elementAdditionDates=[],this._options=e||new l.Base.CacheOptions,this.auditIntervald=T,this._startAudit()}(e.prototype=Object.create(l.Base.Observable.prototype)).getElement=function(e){return e=this._cutIdFromUrl(e),this._elements[e]},e.prototype.getAllElements=function(){var e,t=[];for(e in this._elements)this._elements.hasOwnProperty(e)&&t.push(this._elements[e]);return l.Base.Utils.removeDuplicatesFromArray(t)},e.prototype.addElement=function(e,t){return!!this._addElement(e,t)&&(this.trigger(l.Base.ElementCacheEvents.ELEMENT_ADDED,[[t]]),!0)},e.prototype.addElements=function(e){var t=this._makeRoomForNewElements(e);if(t.length)for(var i=0;i<t.length;i++)this.addElement(t[i].elementId,t[i].element)||l.Base.Logger.error(l.Base.LoggerTags.CACHE,"The element was not added",t[i]);return t},e.prototype.updateElement=function(e,t){if(e&&t){e=this._cutIdFromUrl(e);var i=this.getElement(e);if(i&&!this._areElementsEqual(i,t)){i=this._getIndexOfElementId(e);return-1<i&&(this._elements[e]=t,this._elementAdditionDates.splice(i,1),this._elementsIds.splice(i,1),this._elementAdditionDates.push(new Date),this._elementsIds.push(e)),this.trigger(l.Base.ElementCacheEvents.ELEMENT_UPDATED,[t]),!0}}return!1},e.prototype.deleteElement=function(e){e=this._deleteElement(e);return!!e&&(this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[[e]]),!0)},e.prototype.empty=function(){var e,t,i=[];for(e in this._elements)!this._elements.hasOwnProperty(e)||(t=this._deleteElement(e))&&i.push(t);this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[i])},e.prototype.applyElements=function(e,t){for(var i,a,r,s=e.length,n=[],o=[],c=0;c<s;c++)i=e[c].elementId,a=e[c].element,i&&a&&(this._addElement(i,a)?(this._appliedElementIds.push(i),n.push(a)):this.updateElement(i,a)||this.getElement(i)?this._appliedElementIds.push(i):l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Failed to add or update cache element",a));if(0<n.length&&this.trigger(l.Base.ElementCacheEvents.ELEMENT_ADDED,[n]),!t){for(i in this._elements)-1!==E.inArray(i,this._appliedElementIds)||(r=this._deleteElement(i))&&o.push(r);this._appliedElementIds=[]}0<o.length&&this.trigger(l.Base.ElementCacheEvents.ELEMENT_DELETED,[o])},e.prototype.getCacheSize=function(){return this._elementsIds.length},e.prototype.getCacheMaxSize=function(){return this._options.maxElements},e.prototype._addElement=function(e,t){if(e&&t&&!this.getElement(e)){t=this._makeRoomForNewElements([{elementId:e,element:t}]);if(t.length)return this._elements[t[0].elementId]=t[0].element,this._elementsIds.push(t[0].elementId),this._elementAdditionDates.push(new Date),this._startAudit(),!0}return!1},e.prototype._deleteElement=function(e){var t=this.getElement(e);if(t){var i=this._getIndexOfElementId(e);return-1<i&&(e=this._cutIdFromUrl(e),delete this._elements[e],this._elementAdditionDates.splice(i,1),this._elementsIds.splice(i,1)),this.getCacheSize()||this._stopAudit(),t}return T},e.prototype._deleteElements=function(e){for(var t=!0,i=e.length,a=0;a<i;a++)this._deleteElement(e[a])||(t=!1,l.Base.Logger.error(l.Base.LoggerTags.CACHE,"The element was not deleted",e[a]));return t},e.prototype._areElementsEqual=function(e,t){return e===t||"function"==typeof e.equals&&e.equals(t)},e.prototype._makeRoomForNewElements=function(e){var t=this.getCacheSize(),i=this.getCacheMaxSize(),a=void 0!==i?i-t:T,r=e.length,t=void 0!==a?r-a:T,a=e.slice();return i&&i<r?(this.empty(),a=e.slice(-i),l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Some elements can not be added, because the size of adding data more then max cache size",e.slice(0,-i))):t&&0<t&&this._deleteElements(this._elementsIds.slice(0,t)),a},e.prototype._startAudit=function(){this._options.auditInterval?this.auditIntervald||(this.auditIntervald=setInterval(function(){this._audit()}.bind(this),this._options.auditInterval)):this._stopAudit()},e.prototype._audit=function(){if(this._options.timeToLive)for(var e,t=new Date,i=this._elementAdditionDates.length,a=0;a<i;a++)t-this._elementAdditionDates[a]>this._options.timeToLive&&(e=this._elementsIds[a],this._deleteElement(e))},e.prototype._stopAudit=function(){this.auditIntervald&&(clearInterval(this.auditIntervald),this.auditIntervald=T)},e.prototype._getIndexOfElementId=function(e){e=this._cutIdFromUrl(e);var t=this._elementsIds.indexOf(e);return-1===t&&l.Base.Logger.warn(l.Base.LoggerTags.CACHE,"Can not find index of element",e),t},e.prototype._cutIdFromUrl=function(e){var t;return e=e&&"string"==typeof e&&-1<e.indexOf("/")?(t=e.split("/"))[t.length-1]:e},l.Base.ElementCache=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this._rect=e,this._color=t}t.prototype={getRect:function(){return this._rect},getColor:function(){return this._color},toString:function(){return"rect:{"+this._rect+"} color:"+this._color}},e.Base.Mask=t}(AvayaClientServices),function(t){"use strict";function e(e){this._audioInputInterfaceService=e,t.Base.MediaInterface.call(this,e)}(e.prototype=Object.create(t.Base.MediaInterface.prototype)).setVolume=function(e){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: setVolume.")},e.prototype.getVolume=function(){t.Base.Logger.warn(t.Base.LoggerTags.MEDIA_ENGINE,"Deprecated function is called: getVolume.")},e.prototype._canPickDevices=function(){return!0},e.prototype.toString=function(){return"Mic"},t.Base.AudioInputInterface=e}(AvayaClientServices),function(t){"use strict";function e(){t.Base.MediaInterfaceService.call(this),this._deviceIdentifier=t.Base.MediaTypes.AUDIO_INPUT,this._audioInputVolumeController=T,this._localStreamMap={}}(e.prototype=Object.create(t.Base.MediaInterfaceService.prototype)).start=function(e){return!1===this._isStarted&&(this._audioInputVolumeController=new t.Base.AudioInputVolumeController),t.Base.MediaInterfaceService.prototype.start.call(this,e)},e.prototype.stop=function(e){return this._audioInputVolumeController&&(this._audioInputVolumeController.stop(),this._audioInputVolumeController=T),this._localStreamMap={},t.Base.MediaInterfaceService.prototype.stop.call(this,e)},e.prototype._buildDevice=function(e){return new t.Base.AudioDevice(e.deviceId,e.groupId,e.label,t.Base.MediaTypes.AUDIO_INPUT)},e.prototype.localMediaStreamCreated=function(e,t){e&&t&&0<t.getAudioTracks().length&&(this._localStreamMap[e]=t)},e.prototype.setVolume=function(e){this._audioInputVolumeController.setVolume(e)},e.prototype.getVolume=function(){return this._audioInputVolumeController.getVolume()},e.prototype.getAudioInputVolumeController=function(){return this._audioInputVolumeController},e.prototype.replaceLocalMediaStream=function(e,t){this._localStreamMap[e]=t},e.prototype.removeLocalMediaStream=function(e){delete this._localStreamMap[e]},e.prototype.getLocalMediaStream=function(e){return this._localStreamMap[e]},t.Base.AudioInputInterfaceService=e}(AvayaClientServices),function(e){"use strict";function t(e,t){this._inputInterface=e,this._outputInterface=t,this._localStreamMap={}}(t.prototype=Object.create(e.Base.MediaInterface.prototype)).getInputInterface=function(){return this._inputInterface},t.prototype.start=function(){return E.when(this._inputInterface.start(),this._outputInterface.start())},t.prototype.stop=function(){return E.when(this._inputInterface.stop(),this._outputInterface.stop())},t.prototype.getOutputInterface=function(){return this._outputInterface},t.prototype.getLocalMediaStream=function(e){if(this._inputInterface.getMediaAccessCapability().isAllowed)return this._inputInterface._audioInputInterfaceService.getLocalMediaStream(e);throw new Error("AudioInterface.getLocalMediaStream(): Capability not allowed")},t.prototype.getRemoteMediaStream=function(e){if(this._outputInterface.getMediaAccessCapability().isAllowed)return this._outputInterface._audioOutputInterfaceService.getRemoteMediaStream(e);throw new Error("AudioInterface.getRemoteMediaStream(): Capability not allowed")},e.Base.AudioInterface=t}(AvayaClientServices),function(i){"use strict";function e(e){this._audioOutputInterfaceService=e,i.Base.MediaInterface.call(this,e),this.addOnSelectedDeviceChangedCallback(e.onSelectedDeviceChanged.bind(e))}(e.prototype=Object.create(i.Base.MediaInterface.prototype)).mute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.mute: Capability not allowed");this._audioOutputInterfaceService.mute()},e.prototype.unmute=function(){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.unmute: Capability not allowed");this._audioOutputInterfaceService.unmute()},e.prototype.isMuted=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.isMuted();throw new Error("AudioOutputInterface.isMuted(): Capability not allowed")},e.prototype.setVolume=function(e){if(!this._mediaAccessCapability.isAllowed)throw new Error("AudioOutputInterface.setVolume(): Capability not allowed");this._audioOutputInterfaceService.setVolume(e)},e.prototype.getVolume=function(){if(this._mediaAccessCapability.isAllowed)return this._audioOutputInterfaceService.getVolume();throw new Error("AudioOutputInterface.getVolume(): Capability not allowed")},e.prototype.addOnGestureRequiredCallback=function(e){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().addOnGestureRequiredCallback(e)},e.prototype.removeOnGestureRequiredCallback=function(e){if(!this._audioOutputInterfaceService.getAudioOutput())throw new Error("Missing audio output. Most likely due to media engine not enabled in MediaConfiguration.");this._audioOutputInterfaceService.getAudioOutput().removeOnGestureRequiredCallback(e)},e.prototype._canPickDevices=function(){var e=i.Base.Utils.getBrowserType(),t=[i.Base.BrowserType.CHROME];return!0===i.Base.Utils.includes(e,t)&&!0===i.Base.Utils.hasProperty("audio","setSinkId")},e.prototype.toString=function(){return"Speaker"},i.Base.AudioOutputInterface=e}(AvayaClientServices),function(t){"use strict";function e(){t.Base.MediaInterfaceService.call(this),this._deviceIdentifier=t.Base.MediaTypes.AUDIO_OUTPUT,this._audioOutput=T,this._remoteStreamMap={}}(e.prototype=Object.create(t.Base.MediaInterfaceService.prototype)).start=function(e){return!1===this._isStarted&&(t.Base.Utils.getBrowserType()===t.Base.BrowserType.SAFARI?this._audioOutput=new t.Base.SafariAudioOutput:this._audioOutput=new t.Base.AudioOutput),t.Base.MediaInterfaceService.prototype.start.call(this,e)},e.prototype.stop=function(e){return this._audioOutput&&(this._audioOutput.stop(),this._audioOutput=T),this._remoteStreamMap={},t.Base.MediaInterfaceService.prototype.stop.call(this,e)},e.prototype._buildDevice=function(e){return new t.Base.AudioDevice(e.deviceId,e.groupId,e.label,t.Base.MediaTypes.AUDIO_OUTPUT)},e.prototype.mute=function(){this._audioOutput.mute()},e.prototype.unmute=function(){this._audioOutput.unmute()},e.prototype.isMuted=function(){return this._audioOutput.isMuted()},e.prototype.setVolume=function(e){this._audioOutput.setVolume(e)},e.prototype.getVolume=function(){return this._audioOutput.getVolume()},e.prototype.onSelectedDeviceChanged=function(e,t){this._audioOutput.onSelectedDeviceChanged(t)},e.prototype.getAudioOutput=function(){return this._audioOutput},e.prototype.getRemoteMediaStream=function(e){return this._remoteStreamMap[e]},e.prototype.setRemoteMediaStream=function(e,t){this._remoteStreamMap[e]=t},e.prototype.removeRemoteMediaStream=function(e){delete this._remoteStreamMap[e]},t.Base.AudioOutputInterfaceService=e}(AvayaClientServices),function(l){"use strict";var d=[33,40,50,66,83,100,120,200,500,1e3],C=[2,4,6,9,12,18,30,50,125,250],u=[0,1.75,3.75,5.75,8.75,11.75,17,29,49,124];function a(e,t,i,a,r,s){l.Base.MediaStreamVideoProcessor.call(this,e,t,i),this._selfieFactory=a,this._selfieSegmentation=T,this._maskCanvas=T,this._backgroundCanvas=T,this._webglMaskProgram=T,this._vertexShader=T,this._fragShader=T,this._glPositionBuffer=T,this._glTexccordBuffer=T,this._texture=T,this._blurAmount=s.backgroundBlurAmount||12,this._maskProcessingThreshold=s.maskProcessingThreshold||.15,this._frameData={index:3,deltaList:[],previousTime:0,highVarianceCount:0,lowVarianceCount:0,previousPerfTime:0,videoWidth:0,videoHeight:0,frameStart:0},this._minIndex=0,this._perfState=null,this._lastReportedHighCpuUsage=0,r.registerPerformanceSource(this)}(a.prototype=Object.create(l.Base.MediaStreamVideoProcessor.prototype)).init=function(){l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Initializing MediaPipeVideoProcessor ",this._origStream,this._outputStream),this._lastReportedHighCpuUsage=0,this._selfieSegmentation=this._selfieFactory.take();var t=l.Base.Utils.isChromeOS();l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - MediaPipeVideoProcessor.prototype.init, resetting selfie"),this._selfieSegmentation.reset(),this._selfieSegmentation.onResults=function(e){this._postProcessMask(e.segmentationMask),this._canvasCtxt.save(),this._canvasCtxt.clearRect(0,0,this._canvas.width,this._canvas.height),this._canvasCtxt.filter="blur(2px)",t&&this._canvasCtxt.setTransform(1,0,0,-1,0,this._maskCanvas.height),this._canvasCtxt.drawImage(this._maskCanvas,0,0,this._canvas.width,this._canvas.height),t&&this._canvasCtxt.setTransform(1,0,0,1,0,0),this._canvasCtxt.filter="none",this._canvasCtxt.globalCompositeOperation="source-in",this._canvasCtxt.drawImage(e.image,0,0,this._canvas.width,this._canvas.height),this._createBackground(e),this._canvasCtxt.globalCompositeOperation="destination-over",this._canvasCtxt.drawImage(this._backgroundCanvas,0,0,this._canvas.width,this._canvas.height),this._requestingFrames&&this._outputStream.getVideoTracks()[0].requestFrame(),this._canvasCtxt.restore();e=performance.now()-this._frameData.frameStart;this._updateFrameData(e),this._timeoutWorker.postMessage(Math.max(0,d[this._frameData.index]-e))}.bind(this),this._maskCanvas=document.createElement("canvas"),this._backgroundCanvas=document.createElement("canvas"),this._webglMaskProgram=this._createWebGLMaskProgram(),window.addEventListener("resize",a.prototype._resizeHandler.bind(this)),this._perfIntervalId=setInterval(a.prototype._reportPerformanceState.bind(this),1e3),this._timeoutWorker=new Worker(URL.createObjectURL(new Blob(["onmessage=function(e){setTimeout(function(){postMessage(e.data);}, e.data);}"],{type:"text/javascript"}))),this._timeoutWorker.onmessage=function(){this._runLoop()}.bind(this);var i=E.Deferred();return this._webglMaskProgram?this._selfieSegmentation.getInitPromise().then(function(){i.resolve()}.bind(this),function(e){i.reject(e)}.bind(this)):i.reject("webgl error"),i.promise()},a.prototype._runLoop=function(){this._isStreamAlive()?this._isVideoEnabled()?(this._updateCanvasSize(),this._selfieSegmentation.isStarted()?(this._frameData.frameStart=performance.now(),this._selfieSegmentation.send({image:this._inputVideo})):this._deliverUnsegmentedVideo()):setTimeout(function(){this._runLoop()}.bind(this),d[this._frameData.index]):this.cleanup()},a.prototype.cleanup=function(){var e;l.Base.MediaStreamVideoProcessor.prototype.cleanup.call(this),l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Cleaning up MediaPipeVideoProcessor ",this._origStream,this._outputStream),this._selfieSegmentation&&(l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - MediaPipeVideoProcessor.prototype.cleanup, resetting selfie"),this._selfieSegmentation.reset(),this._selfieFactory.return(this._selfieSegmentation),this._selfieSegmentation=T),window.removeEventListener("resize",a.prototype._resizeHandler.bind(this)),clearInterval(this._perfIntervalId),this._resetFrameData(),this._timeoutWorker&&(this._timeoutWorker.terminate(),this._timeoutWorker=T),!this._maskCanvas||(e=this._maskCanvas.getContext("webgl2"))&&(this._webglMaskProgram&&e.deleteProgram(this._webglMaskProgram),this._vertexShader&&e.deleteShader(this._vertexShader),this._fragShader&&e.deleteShader(this._fragShader),this._glPositionBuffer&&e.deleteBuffer(this._glPositionBuffer),this._glTexccordBuffer&&e.deleteBuffer(this._glTexccordBuffer),this._texture&&e.deleteTexture(this._texture)),this._webglMaskProgram=T,this._vertexShader=T,this._fragShader=T,this._glPositionBuffer=T,this._glTexccordBuffer=T,this._texture=T,this._maskCanvas=T,this._backgroundCanvas=T,this._lastReportedHighCpuUsage=0},a.prototype._postProcessMask=function(e){this._maskCanvas.width=640,this._maskCanvas.height=360;var t=this._maskCanvas.getContext("webgl2");t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(this._webglMaskProgram),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e),t.uniform2fv(t.getUniformLocation(this._webglMaskProgram,"u_resolution"),[t.canvas.width,t.canvas.height]),t.drawArrays(t.TRIANGLE_STRIP,0,4)},a.prototype._createWebGLMaskProgram=function(){var e=this._maskCanvas.getContext("webgl2");if(!e)return null;this._vertexShader=this._createShader(e,e.VERTEX_SHADER,"#version 300 es \nin vec2 a_position; in vec2 a_texCoord; out vec2 v_texCoord; void main() { gl_Position = vec4(a_position, 0, 1); v_texCoord = a_texCoord; }"),this._fragShader=this._createShader(e,e.FRAGMENT_SHADER,"#version 300 es \nprecision mediump float; uniform sampler2D u_image; uniform vec2 u_resolution; in vec2 v_texCoord; out vec4 outColor;vec4 clampPix(vec4 pix) {float lowerBound = 0.5;float upperBound = 0.95;pix.a = pix.r; if(pix.a < lowerBound) {pix.a = 0.0;pix.r = 0.0;} else if(pix.a > upperBound) {pix.a = 1.0;pix.r = 1.0;}return pix;} \nvec2 sumColumn(vec2 size, vec2 pos) {float sum = 0.0;float base = 0.0;for(int i=0; i < int(u_resolution.y); i=i+2) { float y = size.y * float(i);vec4 pix = clampPix(texture(u_image, vec2(pos.x,y)));if(i >= (int(u_resolution.y)-2) && pix.a > 0.85) { base = pix.a;} sum = sum + pix.a;} return vec2(base, sum*2.0);} \nfloat sumRow(vec2 size, vec2 pos) {int step = 2;float sum = 0.0;int xstart = int(pos.x/size.x);for(int i=xstart; i < int(u_resolution.x); i=i+step) {float x = size.x + float(i);vec4 pix = clampPix(texture(u_image, vec2(x,pos.y)));if(pix.a > 0.85) {sum = sum + pix.a;} else { break;} } for(int i=xstart; i >= 0; i=i-step) {float x = size.x * float(i);vec4 pix = clampPix(texture(u_image, vec2(x, pos.y)));if(pix.a > 0.85) { sum = sum + pix.a;} else { break;} } sum = sum * float(step);vec4 pix = texture(u_image, pos);sum = sum - pix.a;return sum;} \nvoid main() { vec2 size = 1.0 / u_resolution; vec4 pix = texture(u_image, v_texCoord); outColor = clampPix(pix); if(outColor.a > 0.0) { vec2 relPos = v_texCoord / u_resolution; vec2 col = sumColumn(size, v_texCoord); float ypercent = col.y / u_resolution.y; float xpercent = sumRow(size, v_texCoord) / u_resolution.x; float xCenter = v_texCoord.x > 0.5 ? 1.0-v_texCoord.x : v_texCoord.x; float w = xCenter*0.25 + ypercent*0.4 + xpercent*0.25 + col.x*0.1;if(w < "+this._maskProcessingThreshold+") { outColor.a = 0.0;outColor.r = 0.0;} } } ");var t=e.createProgram();if(e.attachShader(t,this._vertexShader),e.attachShader(t,this._fragShader),e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS))return e.deleteProgram(t),null;this._glPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._glPositionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,1,1,-1,-1,1,-1]),e.STATIC_DRAW),this._glTexccordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._glTexccordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),e.STATIC_DRAW),this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);var i=e.getAttribLocation(t,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,this._glPositionBuffer),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);i=e.getAttribLocation(t,"a_texCoord");return e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,this._glTexccordBuffer),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),t},a.prototype._createShader=function(e,t,i){t=e.createShader(t);return e.shaderSource(t,i),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)?t:(e.deleteShader(t),null)},a.prototype._createBackground=function(e){this._backgroundCanvas.width=this._canvas.width,this._backgroundCanvas.height=this._canvas.height;var t=this._backgroundCanvas.getContext("2d"),e=this._backgroundImage||e.image;t.save(),this._backgroundBlur&&(t.filter="blur("+Math.round(this._blurAmount*this._canvas.height/360)+"px)"),t.drawImage(e,0,0,this._backgroundCanvas.width,this._backgroundCanvas.height),t.restore()},a.prototype._updateFrameData=function(e){if("visible"===document.visibilityState){if(this._frameData.videoWidth!==this._inputVideo.videoWidth&&this._frameData.videoHeight!==this._inputVideo.videoHeight){if(0<this._inputVideo.srcObject.getVideoTracks().length)for(var t=this._inputVideo.srcObject.getVideoTracks()[0].getSettings(),i=1e3/t.frameRate,a=0;a<d.length;++a)if(i-d[a]<d[a]+C[a]){this._minIndex=a,l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - new resolution: "+this._inputVideo.videoWidth+"x"+this._inputVideo.videoHeight+", input framerate: "+parseInt(t.frameRate)+", input frametime: "+parseInt(i)+"ms, minimum timeout["+this._minIndex+"]: "+d[this._minIndex]+"ms");break}this._frameData.index=3,this._resetFrameData(),this._frameData.previousPerfTime=0,this._frameData.videoWidth=this._inputVideo.videoWidth,this._frameData.videoHeight=this._inputVideo.videoHeight}if(0!==this._frameData.previousTime)if(this._frameData.deltaList.push(e),20===this._frameData.deltaList.length){for(var r=0,s=0,n=this._frameData.deltaList.length;s<n;++s)r+=this._frameData.deltaList[s];var o=r/this._frameData.deltaList.length;this._frameData.deltaList=[];var c=C[this._frameData.index],e=u[this._frameData.index];c<o?(this._perfState=l.Base.PerformanceAlertType.CPU_USAGE_WARNING,this._frameData.lowVarianceCount=0,this._frameData.highVarianceCount++,3<=this._frameData.highVarianceCount&&((this._frameData.index<4||this._inputVideo.videoHeight<=360)&&(this._frameData.index=Math.min(this._frameData.index+(3*c<o?2:1),d.length-1),l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe new frameTimeout(high["+this._frameData.index+"]): "+d[this._frameData.index]+"ms, because avg:"+parseInt(o)+"ms > high threshold:"+c+"ms")),this._frameData.highVarianceCount=0)):o<e?(this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount++,3<=this._frameData.lowVarianceCount&&(this._frameData.index>this._minIndex&&(this._frameData.index--,l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe new frameTimeout(low["+this._frameData.index+"]): "+d[this._frameData.index]+"ms, because avg:"+parseInt(o)+"ms < low threshold:"+e+"ms")),this._frameData.lowVarianceCount=0)):(3<=this._frameData.index&&this._frameData.index>this._minIndex&&(e=Date.now(),(0===this._lastReportedHighCpuUsage||2500<=e-this._lastReportedHighCpuUsage)&&(this._lastReportedHighCpuUsage=e,l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe high CPU because index:"+this._frameData.index+" >= overload-1:3 AND index > min:"+this._minIndex)),this._perfState=l.Base.PerformanceAlertType.CPU_USAGE_WARNING),this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount=0)}this._frameData.previousTime=performance.now()}else this._frameData.previousTime=0},a.prototype._resetFrameData=function(){this._frameData.deltaList=[],this._frameData.highVarianceCount=0,this._frameData.lowVarianceCount=0,this._frameData.previousTime=0},a.prototype._resizeHandler=function(){var e=this._frameData.previousTime;this._resetFrameData(),this._frameData.previousTime=e},a.prototype._reportPerformanceState=function(){var e,t=this._perfState;4<=this._frameData.index&&this._frameData.index>this._minIndex&&(t=l.Base.PerformanceAlertType.CPU_USAGE_OVERLOADED,this.onPerformanceMonitorAlert(t,"Media pipe - frame processing time(ms) greater than "+d[this._frameData.index]+"ms")),null===t&&"hidden"!==document.visibilityState||(t=l.Base.PerformanceAlertType.CPU_USAGE_WARNING,5e3<(e=performance.now())-this._frameData.previousPerfTime&&(l.Base.Logger.debug(l.Base.LoggerTags.MEDIA_ENGINE,"Media pipe - warning("+this._inputVideo.videoWidth+"x"+this._inputVideo.videoHeight+"), timeout["+this._frameData.index+"]: "+d[this._frameData.index]+"ms"),this.onPerformanceMo